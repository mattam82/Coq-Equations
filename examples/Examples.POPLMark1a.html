<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>Examples.POPLMark1a</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<div class="code">
</div>

<div class="doc">
<a id="lab1"></a><h2 class="section">POPLMark 1a solution</h2>


<div class="paragraph"> </div>

  Original development by Rafaël Bocquet: POPLmark part 1A with
  inductive definition of scope and well-scoped variables (and terms,
  types and environments). 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Stdlib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Program</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Equations.Prop</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="keyword">Equations</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Stdlib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">EquivDec</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Stdlib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Arith</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">scope</span> := <span class="id" title="var">nat</span>.<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">var</span> : <span class="id" title="var">scope</span> → <span class="id" title="keyword">Set</span> :=<br/>
| <span class="id" title="var">FO</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">n</span>}, <span class="id" title="var">var</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>)<br/>
| <span class="id" title="var">FS</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">n</span>}, <span class="id" title="var">var</span> <span class="id" title="var">n</span> → <span class="id" title="var">var</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>)<br/>
.<br/>
<span class="id" title="keyword">Derive</span> <span class="id" title="var">Signature</span> <span class="id" title="var">NoConfusion</span> <span class="id" title="var">NoConfusionHom</span> <span class="id" title="keyword">for</span> <span class="id" title="var">var</span>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">scope_le</span> : <span class="id" title="var">scope</span> → <span class="id" title="var">scope</span> → <span class="id" title="keyword">Set</span> :=<br/>
<span class="comment">(*&nbsp;We&nbsp;use&nbsp;an&nbsp;equality&nbsp;in&nbsp;the&nbsp;constructor&nbsp;here&nbsp;to&nbsp;avoid&nbsp;requiring&nbsp;UIP&nbsp;on&nbsp;<span class="inlinecode"><span class="id" title="var">nat</span></span>.&nbsp;*)</span><br/>
| <span class="id" title="var">scope_le_n</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">n</span> <span class="id" title="var">m</span>}, <span class="id" title="var">n</span> = <span class="id" title="var">m</span> → <span class="id" title="var">scope_le</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span><br/>
| <span class="id" title="var">scope_le_S</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">n</span> <span class="id" title="var">m</span>}, <span class="id" title="var">scope_le</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> → <span class="id" title="var">scope_le</span> <span class="id" title="var">n</span> (<span class="id" title="var">S</span> <span class="id" title="var">m</span>)<br/>
| <span class="id" title="var">scope_le_map</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">n</span> <span class="id" title="var">m</span>}, <span class="id" title="var">scope_le</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> → <span class="id" title="var">scope_le</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>) (<span class="id" title="var">S</span> <span class="id" title="var">m</span>).<br/>

<br/>
<span class="id" title="keyword">Derive</span> <span class="id" title="var">Signature</span> <span class="id" title="var">NoConfusion</span> <span class="id" title="var">NoConfusionHom</span> <span class="id" title="var">Subterm</span> <span class="id" title="keyword">for</span> <span class="id" title="var">scope_le</span>.<br/>

<br/>
<span class="id" title="keyword">Equations</span> <span class="id" title="var">scope_le_app</span> {<span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>} (<span class="id" title="var">p</span> : <span class="id" title="var">scope_le</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>) (<span class="id" title="var">q</span> : <span class="id" title="var">scope_le</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>) : <span class="id" title="var">scope_le</span> <span class="id" title="var">a</span> <span class="id" title="var">c</span> :=<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;by&nbsp;wf&nbsp;(signature_pack&nbsp;q)&nbsp;scope_le_subterm&nbsp;:=&nbsp;*)</span><br/>
<span class="id" title="var">scope_le_app</span> <span class="id" title="var">p</span> (<span class="id" title="var">scope_le_n</span> <span class="id" title="var">eq_refl</span>) := <span class="id" title="var">p</span>;<br/>
<span class="id" title="var">scope_le_app</span> <span class="id" title="var">p</span> (<span class="id" title="var">scope_le_S</span> <span class="id" title="var">q</span>) := <span class="id" title="var">scope_le_S</span> (<span class="id" title="var">scope_le_app</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span>);<br/>
<span class="id" title="var">scope_le_app</span> <span class="id" title="var">p</span> (<span class="id" title="var">scope_le_map</span> <span class="id" title="var">q</span>) <span class="id" title="keyword">with</span> <span class="id" title="var">p</span> :=<br/>
{ | <span class="id" title="var">scope_le_n</span> <span class="id" title="var">eq_refl</span> := <span class="id" title="var">scope_le_map</span> <span class="id" title="var">q</span>;<br/>
&nbsp;&nbsp;| <span class="id" title="var">scope_le_S</span> <span class="id" title="var">p'</span> := <span class="id" title="var">scope_le_S</span> (<span class="id" title="var">scope_le_app</span> <span class="id" title="var">p'</span> <span class="id" title="var">q</span>);<br/>
&nbsp;&nbsp;| (<span class="id" title="var">scope_le_map</span> <span class="id" title="var">p'</span>) := <span class="id" title="var">scope_le_map</span> (<span class="id" title="var">scope_le_app</span> <span class="id" title="var">p'</span> <span class="id" title="var">q</span>) }.<br/>
<span class="comment">(*&nbsp;Proof.&nbsp;all:repeat&nbsp;constructor.&nbsp;Defined.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">scope_le_app_len</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> (<span class="id" title="var">q</span> : <span class="id" title="var">scope_le</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span>) : <span class="id" title="var">scope_le_app</span> (<span class="id" title="var">scope_le_n</span> <span class="id" title="var">eq_refl</span>) <span class="id" title="var">q</span> = <span class="id" title="var">q</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">depind</span> <span class="id" title="var">q</span>; <span class="id" title="var">simp</span> <span class="id" title="var">scope_le_app</span>; <span class="id" title="tactic">trivial</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">e</span>; <span class="id" title="tactic">reflexivity</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHq</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Rewrite</span> <span class="id" title="var">scope_le_app_len</span> : <span class="id" title="var">scope_le_app</span>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="keyword">type</span> : <span class="id" title="var">scope</span> → <span class="id" title="keyword">Type</span> :=<br/>
| <span class="id" title="var">tvar</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">n</span>}, <span class="id" title="var">var</span> <span class="id" title="var">n</span> → <span class="id" title="keyword">type</span> <span class="id" title="var">n</span><br/>
| <span class="id" title="var">ttop</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">n</span>}, <span class="id" title="keyword">type</span> <span class="id" title="var">n</span><br/>
| <span class="id" title="var">tarr</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">n</span>}, <span class="id" title="keyword">type</span> <span class="id" title="var">n</span> → <span class="id" title="keyword">type</span> <span class="id" title="var">n</span> → <span class="id" title="keyword">type</span> <span class="id" title="var">n</span><br/>
| <span class="id" title="var">tall</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">n</span>}, <span class="id" title="keyword">type</span> <span class="id" title="var">n</span> → <span class="id" title="keyword">type</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>) → <span class="id" title="keyword">type</span> <span class="id" title="var">n</span><br/>
.<br/>
<span class="id" title="keyword">Derive</span> <span class="id" title="var">Signature</span> <span class="id" title="var">NoConfusion</span> <span class="id" title="var">NoConfusionHom</span> <span class="id" title="keyword">for</span> <span class="id" title="keyword">type</span>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">env</span> : <span class="id" title="var">scope</span> → <span class="id" title="var">scope</span> → <span class="id" title="keyword">Set</span> :=<br/>
| <span class="id" title="var">empty</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">n</span> <span class="id" title="var">m</span>}, <span class="id" title="var">n</span> = <span class="id" title="var">m</span> → <span class="id" title="var">env</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span><br/>
| <span class="id" title="var">cons</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">n</span> <span class="id" title="var">m</span>}, <span class="id" title="keyword">type</span> <span class="id" title="var">m</span> → <span class="id" title="var">env</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> → <span class="id" title="var">env</span> <span class="id" title="var">n</span> (<span class="id" title="var">S</span> <span class="id" title="var">m</span>)<br/>
.<br/>
<span class="id" title="keyword">Derive</span> <span class="id" title="var">Signature</span> <span class="id" title="var">NoConfusion</span> <span class="id" title="var">NoConfusionHom</span> <span class="id" title="keyword">for</span> <span class="id" title="var">env</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">env_scope_le</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">n</span> <span class="id" title="var">m</span>}, <span class="id" title="var">env</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> → <span class="id" title="var">scope_le</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> <span class="id" title="var">Γ</span>; <span class="id" title="var">depind</span> <span class="id" title="var">Γ</span>. <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">constructor</span> 2; <span class="id" title="tactic">auto</span>. <span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">Equations</span> <span class="id" title="var">env_app</span> {<span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>} (<span class="id" title="var">Γ</span> : <span class="id" title="var">env</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>) (<span class="id" title="var">Δ</span> : <span class="id" title="var">env</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>) : <span class="id" title="var">env</span> <span class="id" title="var">a</span> <span class="id" title="var">c</span> :=<br/>
<span class="id" title="var">env_app</span> <span class="id" title="var">Γ</span> (<span class="id" title="var">empty</span> <span class="id" title="var">eq_refl</span>)      := <span class="id" title="var">Γ</span>;<br/>
<span class="id" title="var">env_app</span> <span class="id" title="var">Γ</span> (<span class="id" title="var">cons</span> <span class="id" title="var">t</span> <span class="id" title="var">Δ</span>) := <span class="id" title="var">cons</span> <span class="id" title="var">t</span> (<span class="id" title="var">env_app</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cons_app</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>} (<span class="id" title="var">Γ</span> : <span class="id" title="var">env</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>) (<span class="id" title="var">Δ</span> : <span class="id" title="var">env</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>) <span class="id" title="var">t</span>, <span class="id" title="var">cons</span> <span class="id" title="var">t</span> (<span class="id" title="var">env_app</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span>) = <span class="id" title="var">env_app</span> <span class="id" title="var">Γ</span> (<span class="id" title="var">cons</span> <span class="id" title="var">t</span> <span class="id" title="var">Δ</span>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">env_app</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Rewrite</span> @<span class="id" title="var">cons_app</span>.<br/>

<br/>
<span class="id" title="keyword">Equations</span> <span class="id" title="var">map_var</span> {<span class="id" title="var">n</span> <span class="id" title="var">m</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">var</span> <span class="id" title="var">n</span> → <span class="id" title="var">var</span> <span class="id" title="var">m</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">var</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>)) : <span class="id" title="var">var</span> (<span class="id" title="var">S</span> <span class="id" title="var">m</span>) :=<br/>
<span class="id" title="var">map_var</span> <span class="id" title="var">f</span> <span class="id" title="var">FO</span>     := <span class="id" title="var">FO</span>;<br/>
<span class="id" title="var">map_var</span> <span class="id" title="var">f</span> (<span class="id" title="var">FS</span> <span class="id" title="var">x</span>) := <span class="id" title="var">FS</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map_var_a</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">n</span> <span class="id" title="var">m</span> <span class="id" title="var">o</span>} <span class="id" title="var">f</span> <span class="id" title="var">g</span> <span class="id" title="var">a</span>, @<span class="id" title="var">map_var</span> <span class="id" title="var">n</span> <span class="id" title="var">o</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">t</span> ⇒ <span class="id" title="var">f</span> (<span class="id" title="var">g</span> <span class="id" title="var">t</span>)) <span class="id" title="var">a</span> = @<span class="id" title="var">map_var</span> <span class="id" title="var">m</span> <span class="id" title="var">o</span> <span class="id" title="var">f</span> (@<span class="id" title="var">map_var</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> <span class="id" title="var">g</span> <span class="id" title="var">a</span>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="var">depind</span> <span class="id" title="var">a</span>; <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">map_var</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map_var_b</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">n</span> <span class="id" title="var">m</span>} (<span class="id" title="var">f</span> <span class="id" title="var">g</span> : <span class="id" title="var">var</span> <span class="id" title="var">n</span> → <span class="id" title="var">var</span> <span class="id" title="var">m</span>), (<span class="id" title="keyword">∀</span> <span class="id" title="var">x</span>, <span class="id" title="var">f</span> <span class="id" title="var">x</span> = <span class="id" title="var">g</span> <span class="id" title="var">x</span>) →<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">a</span>, <span class="id" title="var">map_var</span> <span class="id" title="var">f</span> <span class="id" title="var">a</span> = <span class="id" title="var">map_var</span> <span class="id" title="var">g</span> <span class="id" title="var">a</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="var">depind</span> <span class="id" title="var">a</span>; <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">map_var</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">f_equal</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Equations</span> <span class="id" title="var">lift_var_by</span> {<span class="id" title="var">n</span> <span class="id" title="var">m</span>} (<span class="id" title="var">p</span> : <span class="id" title="var">scope_le</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span>) :  <span class="id" title="var">var</span> <span class="id" title="var">n</span> → <span class="id" title="var">var</span> <span class="id" title="var">m</span> :=<br/>
<span class="id" title="var">lift_var_by</span> (<span class="id" title="var">scope_le_n</span> <span class="id" title="var">eq_refl</span>)       := <span class="id" title="keyword">fun</span> <span class="id" title="var">t</span> ⇒ <span class="id" title="var">t</span>;<br/>
<span class="id" title="var">lift_var_by</span> (<span class="id" title="var">scope_le_S</span> <span class="id" title="var">p</span>)   := <span class="id" title="keyword">fun</span> <span class="id" title="var">t</span> ⇒ <span class="id" title="var">FS</span> (<span class="id" title="var">lift_var_by</span> <span class="id" title="var">p</span> <span class="id" title="var">t</span>);<br/>
<span class="id" title="var">lift_var_by</span> (<span class="id" title="var">scope_le_map</span> <span class="id" title="var">p</span>) := <span class="id" title="var">map_var</span> (<span class="id" title="var">lift_var_by</span> <span class="id" title="var">p</span>).<br/>

<br/>
<span class="id" title="keyword">Equations</span> <span class="id" title="var">lift_type_by</span> {<span class="id" title="var">n</span> <span class="id" title="var">m</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">scope_le</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span>) (<span class="id" title="var">t</span> : <span class="id" title="keyword">type</span> <span class="id" title="var">n</span>) : <span class="id" title="keyword">type</span> <span class="id" title="var">m</span> :=<br/>
<span class="id" title="var">lift_type_by</span> <span class="id" title="var">f</span> (<span class="id" title="var">tvar</span> <span class="id" title="var">x</span>)   := <span class="id" title="var">tvar</span> (<span class="id" title="var">lift_var_by</span> <span class="id" title="var">f</span> <span class="id" title="var">x</span>);<br/>
<span class="id" title="var">lift_type_by</span> <span class="id" title="var">f</span> <span class="id" title="var">ttop</span>       := <span class="id" title="var">ttop</span>;<br/>
<span class="id" title="var">lift_type_by</span> <span class="id" title="var">f</span> (<span class="id" title="var">tarr</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>) := <span class="id" title="var">tarr</span> (<span class="id" title="var">lift_type_by</span> <span class="id" title="var">f</span> <span class="id" title="var">a</span>) (<span class="id" title="var">lift_type_by</span> <span class="id" title="var">f</span> <span class="id" title="var">b</span>);<br/>
<span class="id" title="var">lift_type_by</span> <span class="id" title="var">f</span> (<span class="id" title="var">tall</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>) := <span class="id" title="var">tall</span> (<span class="id" title="var">lift_type_by</span> <span class="id" title="var">f</span> <span class="id" title="var">a</span>) (<span class="id" title="var">lift_type_by</span> (<span class="id" title="var">scope_le_map</span> <span class="id" title="var">f</span>) <span class="id" title="var">b</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">lift_var_by_app</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">b</span> <span class="id" title="var">c</span>} (<span class="id" title="var">p</span> : <span class="id" title="var">scope_le</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>) {<span class="id" title="var">a</span>} (<span class="id" title="var">q</span> : <span class="id" title="var">scope_le</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>) <span class="id" title="var">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lift_var_by</span> <span class="id" title="var">p</span> (<span class="id" title="var">lift_var_by</span> <span class="id" title="var">q</span> <span class="id" title="var">t</span>) = <span class="id" title="var">lift_var_by</span> (<span class="id" title="var">scope_le_app</span> <span class="id" title="var">q</span> <span class="id" title="var">p</span>) <span class="id" title="var">t</span>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">with</span> <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">lift_var_by</span> <span class="id" title="var">map_var</span> <span class="id" title="var">scope_le_app</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span> <span class="id" title="var">p</span>; <span class="id" title="tactic">induction</span> <span class="id" title="var">p</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">q</span> <span class="id" title="var">t</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">e</span>...<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHp</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">p</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">depind</span> <span class="id" title="var">q</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">intros</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHp</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHp</span> <span class="id" title="var">_</span> <span class="id" title="var">q</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">map_var_b</span> (<span class="id" title="var">lift_var_by</span> (<span class="id" title="var">scope_le_app</span> <span class="id" title="var">q</span> <span class="id" title="var">p</span>)) (<span class="id" title="keyword">fun</span> <span class="id" title="var">t</span> ⇒ <span class="id" title="var">lift_var_by</span> <span class="id" title="var">p</span> (<span class="id" title="var">lift_var_by</span> <span class="id" title="var">q</span> <span class="id" title="var">t</span>))); <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">map_var_a</span>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Rewrite</span> @<span class="id" title="var">lift_var_by_app</span> : <span class="id" title="var">lift_var_by</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">lift_type_by_id</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">n</span>} (<span class="id" title="var">t</span> : <span class="id" title="keyword">type</span> <span class="id" title="var">n</span>) <span class="id" title="var">P</span>, (<span class="id" title="keyword">∀</span> <span class="id" title="var">x</span>, <span class="id" title="var">lift_var_by</span> <span class="id" title="var">P</span> <span class="id" title="var">x</span> = <span class="id" title="var">x</span>) → <span class="id" title="var">lift_type_by</span> <span class="id" title="var">P</span> <span class="id" title="var">t</span> = <span class="id" title="var">t</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">depind</span> <span class="id" title="var">t</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">lift_type_by</span>; <span class="id" title="tactic">rewrite</span> ?<span class="id" title="var">H</span>, ?<span class="id" title="var">IHt1</span>, ?<span class="id" title="var">IHt2</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>; <span class="id" title="var">depelim</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">lift_var_by</span> <span class="id" title="var">map_var</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">f_equal</span>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">lift_type_by_n</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">n</span>} (<span class="id" title="var">t</span> : <span class="id" title="keyword">type</span> <span class="id" title="var">n</span>), <span class="id" title="var">lift_type_by</span> (<span class="id" title="var">scope_le_n</span> <span class="id" title="var">eq_refl</span>) <span class="id" title="var">t</span> = <span class="id" title="var">t</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">eapply</span> <span class="id" title="var">lift_type_by_id</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">lift_var_by</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="keyword">Qed</span>.<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Rewrite</span> @<span class="id" title="var">lift_type_by_n</span> : <span class="id" title="var">lift_type_by</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">lift_type_by_app</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">a</span>} <span class="id" title="var">t</span> {<span class="id" title="var">b</span> <span class="id" title="var">c</span>} (<span class="id" title="var">p</span> : <span class="id" title="var">scope_le</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>) (<span class="id" title="var">q</span> : <span class="id" title="var">scope_le</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lift_type_by</span> <span class="id" title="var">p</span> (<span class="id" title="var">lift_type_by</span> <span class="id" title="var">q</span> <span class="id" title="var">t</span>) = <span class="id" title="var">lift_type_by</span> (<span class="id" title="var">scope_le_app</span> <span class="id" title="var">q</span> <span class="id" title="var">p</span>) <span class="id" title="var">t</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">depind</span> <span class="id" title="var">t</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span> <span class="id" title="var">p</span>; <span class="id" title="var">depind</span> <span class="id" title="var">p</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">q</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> (<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">scope_le_app</span> <span class="id" title="var">lift_var_by</span> <span class="id" title="var">lift_type_by</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> ?<span class="id" title="var">IHt1</span>, ?<span class="id" title="var">IHt2</span>; <span class="id" title="tactic">auto</span>).<br/>
<span class="id" title="keyword">Qed</span>.<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Rewrite</span> @<span class="id" title="var">lift_type_by_app</span> : <span class="id" title="var">lift_type_by</span>.<br/>

<br/>
<span class="id" title="keyword">Equations</span> <span class="id" title="var">lookup</span> {<span class="id" title="var">n</span>} (<span class="id" title="var">Γ</span> : <span class="id" title="var">env</span> <span class="id" title="var">O</span> <span class="id" title="var">n</span>) (<span class="id" title="var">x</span> : <span class="id" title="var">var</span> <span class="id" title="var">n</span>) : <span class="id" title="keyword">type</span> <span class="id" title="var">n</span> :=<br/>
<span class="id" title="var">lookup</span> (<span class="id" title="var">n</span>:=(<span class="id" title="var">S</span> <span class="id" title="var">_</span>)) (<span class="id" title="var">cons</span> <span class="id" title="var">a</span> <span class="id" title="var">Γ</span>) <span class="id" title="var">FO</span>     := <span class="id" title="var">lift_type_by</span> (<span class="id" title="var">scope_le_S</span> (<span class="id" title="var">scope_le_n</span> <span class="id" title="var">eq_refl</span>)) <span class="id" title="var">a</span>;<br/>
<span class="id" title="var">lookup</span> (<span class="id" title="var">n</span>:=(<span class="id" title="var">S</span> <span class="id" title="var">_</span>)) (<span class="id" title="var">cons</span> <span class="id" title="var">a</span> <span class="id" title="var">Γ</span>) (<span class="id" title="var">FS</span> <span class="id" title="var">x</span>) := <span class="id" title="var">lift_type_by</span> (<span class="id" title="var">scope_le_S</span> (<span class="id" title="var">scope_le_n</span> <span class="id" title="var">eq_refl</span>)) (<span class="id" title="var">lookup</span> <span class="id" title="var">Γ</span> <span class="id" title="var">x</span>)<br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">lookup_app</span> {<span class="id" title="var">n</span>} (<span class="id" title="var">Γ</span> : <span class="id" title="var">env</span> <span class="id" title="var">O</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>)) {<span class="id" title="var">m</span>} (<span class="id" title="var">Δ</span> : <span class="id" title="var">env</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>) (<span class="id" title="var">S</span> <span class="id" title="var">m</span>)) <span class="id" title="var">x</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">lookup</span> (<span class="id" title="var">env_app</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span>) (<span class="id" title="var">lift_var_by</span> (<span class="id" title="var">env_scope_le</span> <span class="id" title="var">Δ</span>) <span class="id" title="var">x</span>) =<br/>
&nbsp;&nbsp;<span class="id" title="var">lift_type_by</span> (<span class="id" title="var">env_scope_le</span> <span class="id" title="var">Δ</span>) (<span class="id" title="var">lookup</span> <span class="id" title="var">Γ</span> <span class="id" title="var">x</span>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">with</span> <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">lookup</span> <span class="id" title="var">scope_le_app</span> <span class="id" title="var">env_app</span> <span class="id" title="var">lift_var_by</span> <span class="id" title="var">lift_type_by</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Δ</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>...<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHΔ</span>...<br/>
<span class="id" title="keyword">Qed</span>.<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Rewrite</span> @<span class="id" title="var">lookup_app</span> : <span class="id" title="var">lookup</span>.<br/>

<br/>
</div>

<div class="doc">
The subtyping judgment 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">sa</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">n</span>}, <span class="id" title="var">env</span> <span class="id" title="var">O</span> <span class="id" title="var">n</span> → <span class="id" title="keyword">type</span> <span class="id" title="var">n</span> → <span class="id" title="keyword">type</span> <span class="id" title="var">n</span> → <span class="id" title="keyword">Prop</span> :=<br/>
| <span class="id" title="var">sa_top</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">n</span>} (<span class="id" title="var">Γ</span> : <span class="id" title="var">env</span> <span class="id" title="var">O</span> <span class="id" title="var">n</span>) <span class="id" title="var">s</span>, <span class="id" title="var">sa</span> <span class="id" title="var">Γ</span> <span class="id" title="var">s</span> <span class="id" title="var">ttop</span><br/>
| <span class="id" title="var">sa_var_refl</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">n</span>} (<span class="id" title="var">Γ</span> : <span class="id" title="var">env</span> <span class="id" title="var">O</span> <span class="id" title="var">n</span>) <span class="id" title="var">x</span>, <span class="id" title="var">sa</span> <span class="id" title="var">Γ</span> (<span class="id" title="var">tvar</span> <span class="id" title="var">x</span>) (<span class="id" title="var">tvar</span> <span class="id" title="var">x</span>)<br/>
| <span class="id" title="var">sa_var_trans</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">n</span>} (<span class="id" title="var">Γ</span> : <span class="id" title="var">env</span> <span class="id" title="var">O</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>)) <span class="id" title="var">x</span> <span class="id" title="var">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sa</span> <span class="id" title="var">Γ</span> (<span class="id" title="var">lookup</span> <span class="id" title="var">Γ</span> <span class="id" title="var">x</span>) <span class="id" title="var">t</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sa</span> <span class="id" title="var">Γ</span> (<span class="id" title="var">tvar</span> <span class="id" title="var">x</span>) <span class="id" title="var">t</span><br/>
| <span class="id" title="var">sa_arr</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">n</span>} {<span class="id" title="var">Γ</span> : <span class="id" title="var">env</span> <span class="id" title="var">O</span> <span class="id" title="var">n</span>} {<span class="id" title="var">t1</span> <span class="id" title="var">t2</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span>},<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sa</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t1</span> <span class="id" title="var">s1</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sa</span> <span class="id" title="var">Γ</span> <span class="id" title="var">s2</span> <span class="id" title="var">t2</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sa</span> <span class="id" title="var">Γ</span> (<span class="id" title="var">tarr</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span>) (<span class="id" title="var">tarr</span> <span class="id" title="var">t1</span> <span class="id" title="var">t2</span>)<br/>
| <span class="id" title="var">sa_all</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">n</span>} {<span class="id" title="var">Γ</span> : <span class="id" title="var">env</span> <span class="id" title="var">O</span> <span class="id" title="var">n</span>} {<span class="id" title="var">t1</span> <span class="id" title="var">t2</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span>},<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sa</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t1</span> <span class="id" title="var">s1</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sa</span> (<span class="id" title="var">cons</span> <span class="id" title="var">t1</span> <span class="id" title="var">Γ</span>) <span class="id" title="var">s2</span> <span class="id" title="var">t2</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sa</span> <span class="id" title="var">Γ</span> (<span class="id" title="var">tall</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span>) (<span class="id" title="var">tall</span> <span class="id" title="var">t1</span> <span class="id" title="var">t2</span>)<br/>
.<br/>
<span class="id" title="keyword">Derive</span> <span class="id" title="var">Signature</span> <span class="id" title="keyword">for</span> <span class="id" title="var">sa</span>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">sa_env</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">n</span>}, <span class="id" title="var">env</span> <span class="id" title="var">O</span> <span class="id" title="var">n</span> → <span class="id" title="var">env</span> <span class="id" title="var">O</span> <span class="id" title="var">n</span> → <span class="id" title="keyword">Prop</span> :=<br/>
| <span class="id" title="var">sa_empty</span> : <span class="id" title="var">sa_env</span> (<span class="id" title="var">empty</span> <span class="id" title="var">eq_refl</span>) (<span class="id" title="var">empty</span> <span class="id" title="var">eq_refl</span>)<br/>
| <span class="id" title="var">sa_cons</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">n</span>} (<span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span> : <span class="id" title="var">env</span> <span class="id" title="var">O</span> <span class="id" title="var">n</span>) <span class="id" title="var">a</span> <span class="id" title="var">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sa</span> <span class="id" title="var">Γ</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sa_env</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span> → <span class="id" title="var">sa_env</span> (<span class="id" title="var">cons</span> <span class="id" title="var">a</span> <span class="id" title="var">Γ</span>) (<span class="id" title="var">cons</span> <span class="id" title="var">b</span> <span class="id" title="var">Δ</span>)<br/>
.<br/>
<span class="id" title="keyword">Derive</span> <span class="id" title="var">Signature</span> <span class="id" title="keyword">for</span> <span class="id" title="var">sa_env</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sa_refl</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">n</span>} (<span class="id" title="var">Γ</span> : <span class="id" title="var">env</span> <span class="id" title="var">O</span> <span class="id" title="var">n</span>) <span class="id" title="var">x</span>, <span class="id" title="var">sa</span> <span class="id" title="var">Γ</span> <span class="id" title="var">x</span> <span class="id" title="var">x</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="var">depind</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sa_env_refl</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">n</span>} (<span class="id" title="var">Γ</span> : <span class="id" title="var">env</span> <span class="id" title="var">O</span> <span class="id" title="var">n</span>), <span class="id" title="var">sa_env</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Γ</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="var">depind</span> <span class="id" title="var">Γ</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">auto</span> <span class="id" title="keyword">using</span> <span class="id" title="var">sa_refl</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">env_extend</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">b</span> <span class="id" title="var">c</span>}, <span class="id" title="var">env</span> <span class="id" title="var">O</span> <span class="id" title="var">b</span> → <span class="id" title="var">env</span> <span class="id" title="var">O</span> <span class="id" title="var">c</span> → <span class="id" title="var">scope_le</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span> → <span class="id" title="keyword">Prop</span> :=<br/>
| <span class="id" title="var">env_extend_refl</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">b</span>} (<span class="id" title="var">Γ</span> : <span class="id" title="var">env</span> <span class="id" title="var">O</span> <span class="id" title="var">b</span>), <span class="id" title="var">env_extend</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Γ</span> (<span class="id" title="var">scope_le_n</span> <span class="id" title="var">eq_refl</span>)<br/>
| <span class="id" title="var">env_extend_cons</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">b</span> <span class="id" title="var">c</span>} (<span class="id" title="var">Γ</span> : <span class="id" title="var">env</span> <span class="id" title="var">O</span> <span class="id" title="var">b</span>) (<span class="id" title="var">Δ</span> : <span class="id" title="var">env</span> <span class="id" title="var">O</span> <span class="id" title="var">c</span>) <span class="id" title="var">p</span> <span class="id" title="var">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">env_extend</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span> <span class="id" title="var">p</span> → <span class="id" title="var">env_extend</span> (<span class="id" title="var">cons</span> <span class="id" title="var">a</span> <span class="id" title="var">Γ</span>) (<span class="id" title="var">cons</span> (<span class="id" title="var">lift_type_by</span> <span class="id" title="var">p</span> <span class="id" title="var">a</span>) <span class="id" title="var">Δ</span>) (<span class="id" title="var">scope_le_map</span> <span class="id" title="var">p</span>)<br/>
| <span class="id" title="var">env_extend_2</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">b</span> <span class="id" title="var">c</span>} (<span class="id" title="var">Γ</span> : <span class="id" title="var">env</span> <span class="id" title="var">O</span> <span class="id" title="var">b</span>) (<span class="id" title="var">Δ</span> : <span class="id" title="var">env</span> <span class="id" title="var">O</span> <span class="id" title="var">c</span>) <span class="id" title="var">p</span> <span class="id" title="var">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">env_extend</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span> <span class="id" title="var">p</span> → <span class="id" title="var">env_extend</span> <span class="id" title="var">Γ</span> (<span class="id" title="var">cons</span> <span class="id" title="var">a</span> <span class="id" title="var">Δ</span>) (<span class="id" title="var">scope_le_S</span> <span class="id" title="var">p</span>)<br/>
.<br/>
<span class="id" title="keyword">Derive</span> <span class="id" title="var">Signature</span> <span class="id" title="keyword">for</span> <span class="id" title="var">env_extend</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">env_app_extend</span> {<span class="id" title="var">b</span> <span class="id" title="var">c</span>} (<span class="id" title="var">Γ</span> : <span class="id" title="var">env</span> <span class="id" title="var">O</span> <span class="id" title="var">b</span>) (<span class="id" title="var">Δ</span> : <span class="id" title="var">env</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>) : <span class="id" title="var">env_extend</span> <span class="id" title="var">Γ</span> (<span class="id" title="var">env_app</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span>) (<span class="id" title="var">env_scope_le</span> <span class="id" title="var">Δ</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">depind</span> <span class="id" title="var">Δ</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">env_app</span> <span class="id" title="var">scope_le_app</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">simpl</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">env_extend_lookup</span> {<span class="id" title="var">b</span> <span class="id" title="var">c</span>} (<span class="id" title="var">Γ</span> : <span class="id" title="var">env</span> <span class="id" title="var">O</span> <span class="id" title="var">b</span>) (<span class="id" title="var">Δ</span> : <span class="id" title="var">env</span> <span class="id" title="var">O</span> <span class="id" title="var">c</span>) <span class="id" title="var">P</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">env_extend</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span> <span class="id" title="var">P</span> → <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span>, <span class="id" title="var">lift_type_by</span> <span class="id" title="var">P</span> (<span class="id" title="var">lookup</span> <span class="id" title="var">Γ</span> <span class="id" title="var">x</span>) = <span class="id" title="var">lookup</span> <span class="id" title="var">Δ</span> (<span class="id" title="var">lift_var_by</span> <span class="id" title="var">P</span> <span class="id" title="var">x</span>).<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">with</span> <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">lift_type_by</span> <span class="id" title="var">lift_var_by</span> <span class="id" title="var">map_var</span> <span class="id" title="var">lookup</span> <span class="id" title="var">scope_le_app</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">A</span>; <span class="id" title="var">depind</span> <span class="id" title="var">A</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>; <span class="id" title="var">depelim</span> <span class="id" title="var">x</span>...<br/>
&nbsp;&nbsp;<span class="id" title="var">all</span>:<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHA</span>...<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sa_weakening</span> {<span class="id" title="var">b</span>} (<span class="id" title="var">Γ</span> : <span class="id" title="var">env</span> <span class="id" title="var">O</span> <span class="id" title="var">b</span>) <span class="id" title="var">p</span> <span class="id" title="var">q</span> (<span class="id" title="var">A</span> : <span class="id" title="var">sa</span> <span class="id" title="var">Γ</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> {<span class="id" title="var">c</span> <span class="id" title="var">P</span>} (<span class="id" title="var">Δ</span> : <span class="id" title="var">env</span> <span class="id" title="var">O</span> <span class="id" title="var">c</span>) (<span class="id" title="var">B</span> : <span class="id" title="var">env_extend</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span> <span class="id" title="var">P</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sa</span> <span class="id" title="var">Δ</span> (<span class="id" title="var">lift_type_by</span> <span class="id" title="var">P</span> <span class="id" title="var">p</span>) (<span class="id" title="var">lift_type_by</span> <span class="id" title="var">P</span> <span class="id" title="var">q</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">A</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">c</span> <span class="id" title="var">P</span> <span class="id" title="var">Δ</span> <span class="id" title="var">B</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">lift_type_by</span> <span class="id" title="tactic">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">auto</span>; <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">auto</span>; <span class="id" title="tactic">fail</span>).<br/>
&nbsp;&nbsp;- <span class="id" title="var">depelim</span> <span class="id" title="var">c</span>; [<span class="id" title="var">depelim</span> <span class="id" title="var">B</span>|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">env_extend_lookup</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">B</span>); <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHA2</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sa_weakening_app</span> {<span class="id" title="var">b</span>} (<span class="id" title="var">Γ</span> : <span class="id" title="var">env</span> <span class="id" title="var">O</span> <span class="id" title="var">b</span>) <span class="id" title="var">p</span> <span class="id" title="var">q</span> (<span class="id" title="var">A</span> : <span class="id" title="var">sa</span> <span class="id" title="var">Γ</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span>) {<span class="id" title="var">c</span>} (<span class="id" title="var">Δ</span> : <span class="id" title="var">env</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">sa</span> (<span class="id" title="var">env_app</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span>) (<span class="id" title="var">lift_type_by</span> (<span class="id" title="var">env_scope_le</span> <span class="id" title="var">Δ</span>) <span class="id" title="var">p</span>) (<span class="id" title="var">lift_type_by</span> (<span class="id" title="var">env_scope_le</span> <span class="id" title="var">Δ</span>) <span class="id" title="var">q</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>; <span class="id" title="tactic">eapply</span> <span class="id" title="var">sa_weakening</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exact</span> <span class="id" title="var">A</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">auto</span> <span class="id" title="keyword">using</span> <span class="id" title="var">env_app_extend</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sa_toname</span> {<span class="id" title="var">n</span> <span class="id" title="var">m</span>} <span class="id" title="var">Γ</span> (<span class="id" title="var">Δ</span> : <span class="id" title="var">env</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>) <span class="id" title="var">m</span>) <span class="id" title="var">x</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">x</span> ≠ <span class="id" title="var">lift_var_by</span> (<span class="id" title="var">env_scope_le</span> <span class="id" title="var">Δ</span>) <span class="id" title="var">FO</span> →<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span>, <span class="id" title="var">lookup</span> (<span class="id" title="var">env_app</span> (<span class="id" title="var">cons</span> <span class="id" title="var">p</span> <span class="id" title="var">Γ</span>) <span class="id" title="var">Δ</span>) <span class="id" title="var">x</span> = <span class="id" title="var">lookup</span> (<span class="id" title="var">env_app</span> (<span class="id" title="var">cons</span> <span class="id" title="var">q</span> <span class="id" title="var">Γ</span>) <span class="id" title="var">Δ</span>) <span class="id" title="var">x</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">depind</span> <span class="id" title="var">Δ</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">A</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">env_app</span> <span class="id" title="var">lookup</span> <span class="id" title="var">lift_var_by</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">exfalso</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHΔ</span> <span class="id" title="var">Γ</span> <span class="id" title="var">x</span>). <span class="id" title="var">forward</span> <span class="id" title="var">IHΔ</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">intro</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">IHΔ</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span>).<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">var_dec_eq</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">n</span>} (<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">var</span> <span class="id" title="var">n</span>), {<span class="id" title="var">x</span> = <span class="id" title="var">y</span>} + {<span class="id" title="var">x</span> ≠ <span class="id" title="var">y</span>}.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">depind</span> <span class="id" title="var">x</span>; <span class="id" title="var">depelim</span> <span class="id" title="var">y</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">left</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">right</span>; <span class="id" title="tactic">intro</span> <span class="id" title="var">H</span>; <span class="id" title="var">depelim</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">right</span>; <span class="id" title="tactic">intro</span> <span class="id" title="var">H</span>; <span class="id" title="var">depelim</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">IHx</span> <span class="id" title="var">y</span>); <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">left</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">right</span>; <span class="id" title="tactic">intro</span> <span class="id" title="var">H</span>; <span class="id" title="var">depelim</span> <span class="id" title="var">H</span>. <span class="id" title="var">contradiction</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sa_narrowing</span> {<span class="id" title="var">s</span>} <span class="id" title="var">q</span> :<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> {<span class="id" title="var">s'</span>} (<span class="id" title="var">P</span> : <span class="id" title="var">scope_le</span> <span class="id" title="var">s</span> <span class="id" title="var">s'</span>) (<span class="id" title="var">Γ</span> : <span class="id" title="var">env</span> <span class="id" title="var">O</span> <span class="id" title="var">s'</span>) <span class="id" title="var">p</span> (<span class="id" title="var">A</span> : <span class="id" title="var">sa</span> <span class="id" title="var">Γ</span> <span class="id" title="var">p</span> (<span class="id" title="var">lift_type_by</span> <span class="id" title="var">P</span> <span class="id" title="var">q</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">s''</span> (<span class="id" title="var">Δ</span> : <span class="id" title="var">env</span> (<span class="id" title="var">S</span> <span class="id" title="var">s'</span>) <span class="id" title="var">s''</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> <span class="id" title="var">b</span> (<span class="id" title="var">B</span> : <span class="id" title="var">sa</span> (<span class="id" title="var">env_app</span> (<span class="id" title="var">cons</span> (<span class="id" title="var">lift_type_by</span> <span class="id" title="var">P</span> <span class="id" title="var">q</span>) <span class="id" title="var">Γ</span>) <span class="id" title="var">Δ</span>) <span class="id" title="var">a</span> <span class="id" title="var">b</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sa</span> (<span class="id" title="var">env_app</span> (<span class="id" title="var">cons</span> <span class="id" title="var">p</span> <span class="id" title="var">Γ</span>) <span class="id" title="var">Δ</span>) <span class="id" title="var">a</span> <span class="id" title="var">b</span>) ∧<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> {<span class="id" title="var">s'</span>} (<span class="id" title="var">A</span> : <span class="id" title="var">scope_le</span> <span class="id" title="var">s</span> <span class="id" title="var">s'</span>) (<span class="id" title="var">Γ</span> : <span class="id" title="var">env</span> <span class="id" title="var">O</span> <span class="id" title="var">s'</span>) <span class="id" title="var">p</span> (<span class="id" title="var">B</span> : <span class="id" title="var">sa</span> <span class="id" title="var">Γ</span> <span class="id" title="var">p</span> (<span class="id" title="var">lift_type_by</span> <span class="id" title="var">A</span> <span class="id" title="var">q</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">r</span> (<span class="id" title="var">C</span> : <span class="id" title="var">sa</span> <span class="id" title="var">Γ</span> (<span class="id" title="var">lift_type_by</span> <span class="id" title="var">A</span> <span class="id" title="var">q</span>) <span class="id" title="var">r</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sa</span> <span class="id" title="var">Γ</span> <span class="id" title="var">p</span> <span class="id" title="var">r</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">q</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [ |- <span class="id" title="var">_</span> ∧ ?<span class="id" title="var">Q</span> ] ⇒ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">PLOP</span>:<span class="id" title="var">Q</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ <span class="id" title="tactic">intros</span> <span class="id" title="var">s'</span> <span class="id" title="var">A</span> <span class="id" title="var">Γ</span> <span class="id" title="var">p</span> <span class="id" title="var">B</span>; <span class="id" title="var">depind</span> <span class="id" title="var">B</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">r</span> <span class="id" title="var">C</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">lift_type_by</span> <span class="id" title="var">lift_var_by</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">try</span> <span class="id" title="var">noconf</span> <span class="id" title="var">H</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">auto</span>; <span class="id" title="tactic">fail</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHB</span>; <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">lift_type_by</span>; <span class="id" title="tactic">auto</span>; <span class="id" title="tactic">fail</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="var">depelim</span> <span class="id" title="var">C</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">constructor</span>; <span class="id" title="var">destruct_pairs</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">noconf</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>; <span class="id" title="tactic">fail</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHB</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">IHq1</span> <span class="id" title="var">IHq2</span> <span class="id" title="var">A</span>); <span class="id" title="var">destruct_pairs</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">noconf</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">eauto</span>; <span class="id" title="tactic">fail</span>); <span class="id" title="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ <span class="id" title="tactic">intros</span> <span class="id" title="var">s'</span> <span class="id" title="var">P</span> <span class="id" title="var">Γ</span> <span class="id" title="var">p</span> <span class="id" title="var">A</span>; <span class="id" title="var">depind</span> <span class="id" title="var">A</span>; <span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">s''</span> <span class="id" title="var">Δ</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">B</span>; <span class="id" title="var">destruct_pairs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">env_app</span> (<span class="id" title="var">cons</span> <span class="id" title="var">_</span> <span class="id" title="var">Γ</span>) <span class="id" title="var">Δ</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">PPP</span>; <span class="id" title="var">depind</span> <span class="id" title="var">B</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">subst</span>; <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">auto</span>; <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">core</span>; <span class="id" title="tactic">auto</span>; <span class="id" title="tactic">fail</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">B</span>; <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHB</span> <span class="id" title="var">_</span> <span class="id" title="var">HeqPPP</span>); <span class="id" title="tactic">subst</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="var">noconf</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">auto</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">IHB</span> : <span class="id" title="var">sa</span> <span class="id" title="var">_</span> (<span class="id" title="var">lookup</span> (<span class="id" title="var">env_app</span> (<span class="id" title="var">cons</span> ?<span class="id" title="var">a</span> <span class="id" title="var">_</span>) <span class="id" title="var">_</span>) ?<span class="id" title="var">x</span>) <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- <span class="id" title="var">sa</span> <span class="id" title="var">_</span> (<span class="id" title="var">lookup</span> (<span class="id" title="var">env_app</span> (<span class="id" title="var">cons</span> ?<span class="id" title="var">b</span> <span class="id" title="var">_</span>) <span class="id" title="var">_</span>) <span class="id" title="var">_</span>) <span class="id" title="var">_</span> ] ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">var_dec_eq</span> <span class="id" title="var">x</span> (<span class="id" title="var">lift_var_by</span> (<span class="id" title="var">env_scope_le</span> <span class="id" title="var">Δ</span>) <span class="id" title="var">FO</span>)) <span class="id" title="keyword">as</span> [<span class="id" title="var">Heq</span>|<span class="id" title="var">Hneq</span>] ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ <span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">lookup</span> <span class="id" title="var">lift_type_by</span> <span class="id" title="var">lift_var_by</span> <span class="id" title="tactic">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="var">noconf</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">auto</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">lookup</span> <span class="id" title="var">lift_type_by</span> <span class="id" title="var">lift_var_by</span> <span class="id" title="var">scope_le_app</span> <span class="id" title="tactic">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [<span class="id" title="tactic">auto</span>; <span class="id" title="var">depelim</span> <span class="id" title="var">IHB</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">lookup</span> <span class="id" title="var">lift_type_by</span> <span class="id" title="var">lift_var_by</span> <span class="id" title="var">scope_le_app</span> <span class="id" title="tactic">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>; <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">auto</span>; <span class="id" title="tactic">fail</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [(<span class="id" title="tactic">apply</span> <span class="id" title="var">sa_var_trans</span> <span class="id" title="tactic">in</span> <span class="id" title="var">A</span> || <span class="id" title="tactic">assert</span> (<span class="id" title="var">A</span> := <span class="id" title="var">sa_arr</span> <span class="id" title="var">A1</span> <span class="id" title="var">A2</span>) || <span class="id" title="tactic">assert</span> (<span class="id" title="var">A</span> := <span class="id" title="var">sa_all</span> <span class="id" title="var">A1</span> <span class="id" title="var">A2</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">A</span> : <span class="id" title="var">sa</span> <span class="id" title="var">_</span> ?<span class="id" title="var">p</span> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> ] ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">apply</span> @<span class="id" title="var">sa_weakening_app</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">Δ</span>:=<span class="id" title="var">cons</span> <span class="id" title="var">p</span> (<span class="id" title="var">empty</span> <span class="id" title="var">eq_refl</span>)) <span class="id" title="tactic">in</span> <span class="id" title="var">A</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> @<span class="id" title="var">sa_weakening_app</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">Δ</span>:=<span class="id" title="var">Δ</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">A</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">lookup</span> <span class="id" title="var">env_app</span> <span class="id" title="var">lift_var_by</span> <span class="id" title="var">lift_type_by</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">PLOP</span>; [<span class="id" title="tactic">exact</span> <span class="id" title="var">A</span> | <span class="id" title="tactic">exact</span> <span class="id" title="var">IHB</span>])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>; <span class="id" title="tactic">fail</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="tactic">rewrite</span> <span class="id" title="var">sa_toname</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">p</span>:=<span class="id" title="var">b</span>) (<span class="id" title="var">q</span>:=<span class="id" title="var">a</span>); <span class="id" title="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="tactic">assumption</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">clear</span> <span class="id" title="var">IHB1</span> <span class="id" title="var">IHB2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">C</span>; [<span class="id" title="tactic">constructor</span>|]; <span class="id" title="var">destruct_pairs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">H1</span> <span class="id" title="var">_</span> <span class="id" title="var">A</span> <span class="id" title="var">Γ</span> <span class="id" title="var">_</span> <span class="id" title="var">C1</span> <span class="id" title="var">_</span> (<span class="id" title="var">empty</span> <span class="id" title="var">eq_refl</span>) <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">B2</span>; <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">env_app</span> <span class="id" title="tactic">in</span> <span class="id" title="var">B2</span>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Print</span> <span class="id" title="keyword">Assumptions</span> <span class="id" title="var">sa_narrowing</span>.<br/>
<span class="comment">(*&nbsp;Closed&nbsp;under&nbsp;the&nbsp;global&nbsp;context&nbsp;*)</span><br/>
</div>
<hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>