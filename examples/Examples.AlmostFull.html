<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>Examples.AlmostFull</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">Equations.Prop</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="keyword">Equations</span>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Examples.Fin</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Stdlib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Relations</span> <span class="id" title="var">Utf8</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Stdlib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Relations</span> <span class="id" title="var">Wellfounded</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Stdlib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Setoid</span> <span class="id" title="var">RelationClasses</span> <span class="id" title="var">Morphisms</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Stdlib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Lia</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Stdlib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Bool</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Stdlib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">List</span> <span class="id" title="var">Arith</span> <span class="id" title="var">String</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Stdlib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">FunctionalExtensionality</span>.<br/>

<br/>
<span class="id" title="keyword">Set</span> <span class="id" title="keyword">Equations</span> <span class="id" title="keyword">Transparent</span>.<br/>
<span class="id" title="keyword">Set</span> <span class="id" title="var">Keyed</span> <span class="id" title="var">Unification</span>.<br/>
<span class="id" title="keyword">Set</span> <span class="id" title="var">Asymmetric</span> <span class="id" title="var">Patterns</span>.<br/>
<span class="id" title="keyword">Local</span> <span class="id" title="keyword">Set</span> <span class="id" title="var">Firstorder</span> <span class="id" title="var">Solver</span> <span class="id" title="tactic">auto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">arith</span> <span class="id" title="var">core</span> <span class="id" title="var">datatypes</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">intuition_solver</span> ::= <span class="id" title="tactic">auto</span> <span class="id" title="keyword">with</span> ×.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">Equality</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Class</span> <span class="id" title="var">Eq</span> (<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">eqb</span> : <span class="id" title="var">A</span> → <span class="id" title="var">A</span> → <span class="id" title="var">bool</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eqb_spec</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>, <span class="id" title="var">reflect</span> (<span class="id" title="var">x</span> = <span class="id" title="var">y</span>) (<span class="id" title="var">eqb</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>) }.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">fin_eq</span> {<span class="id" title="var">k</span>} (<span class="id" title="var">f</span> <span class="id" title="var">f'</span> : <span class="id" title="var">fin</span> <span class="id" title="var">k</span>) : <span class="id" title="var">bool</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">fin_eq</span> <span class="id" title="var">fz</span> <span class="id" title="var">fz</span> ⇒ <span class="id" title="var">true</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">fin_eq</span> (<span class="id" title="var">fs</span> <span class="id" title="var">f</span>) (<span class="id" title="var">fs</span> <span class="id" title="var">f'</span>) ⇒ <span class="id" title="var">fin_eq</span> <span class="id" title="var">f</span> <span class="id" title="var">f'</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">fin_eq</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">false</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">fin_Eq</span> <span class="id" title="var">k</span> : <span class="id" title="var">Eq</span> (<span class="id" title="var">fin</span> <span class="id" title="var">k</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">fin_eq</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">x</span>; <span class="id" title="var">depelim</span> <span class="id" title="var">y</span>; <span class="id" title="var">simp</span> <span class="id" title="var">fin_eq</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">H</span>; <span class="id" title="var">noconf</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">H</span>; <span class="id" title="var">noconf</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">IHx</span> <span class="id" title="var">y</span>). <span class="id" title="tactic">subst</span> <span class="id" title="var">x</span>; <span class="id" title="var">now</span> <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">intro</span> <span class="id" title="var">H</span>; <span class="id" title="var">noconf</span> <span class="id" title="var">H</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">n0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">bool_Eq</span> : <span class="id" title="var">Eq</span> <span class="id" title="var">bool</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">bool_eq</span>. <span class="id" title="tactic">intros</span> [] []; <span class="id" title="var">now</span> <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">prod_eq</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="var">Eq</span> <span class="id" title="var">A</span> → <span class="id" title="var">Eq</span> <span class="id" title="var">B</span> → <span class="id" title="var">Eq</span> (<span class="id" title="var">A</span> × <span class="id" title="var">B</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">∃</span> (<span class="id" title="keyword">fun</span> '(<span class="id" title="var">x</span>, <span class="id" title="var">y</span>) '(<span class="id" title="var">x'</span>, <span class="id" title="var">y'</span>) ⇒ <span class="id" title="var">eqb</span> <span class="id" title="var">x</span> <span class="id" title="var">x'</span> &amp;&amp; <span class="id" title="var">eqb</span> <span class="id" title="var">y</span> <span class="id" title="var">y'</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [] []. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">eqb_spec</span> <span class="id" title="var">a</span> <span class="id" title="var">a0</span>); <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">eqb_spec</span> <span class="id" title="var">b</span> <span class="id" title="var">b0</span>); <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">intro</span> <span class="id" title="var">H</span>; <span class="id" title="var">noconf</span> <span class="id" title="var">H</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">elim</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="var">simplify</span> ×. <span class="id" title="var">now</span> <span class="id" title="tactic">elim</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">option_eq</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} {<span class="id" title="var">E</span>:<span class="id" title="var">Eq</span> <span class="id" title="var">A</span>} (<span class="id" title="var">o</span> <span class="id" title="var">o'</span> : <span class="id" title="var">option</span> <span class="id" title="var">A</span>) : <span class="id" title="var">bool</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">option_eq</span> <span class="id" title="var">None</span> <span class="id" title="var">None</span> := <span class="id" title="var">true</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">option_eq</span> (<span class="id" title="var">Some</span> <span class="id" title="var">o</span>) (<span class="id" title="var">Some</span> <span class="id" title="var">o'</span>) := <span class="id" title="var">eqb</span> <span class="id" title="var">o</span> <span class="id" title="var">o'</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">option_eq</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> := <span class="id" title="var">false</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">option_Eq</span> <span class="id" title="var">A</span> : <span class="id" title="var">Eq</span> <span class="id" title="var">A</span> → <span class="id" title="var">Eq</span> (<span class="id" title="var">option</span> <span class="id" title="var">A</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">A_Eq</span>. <span class="id" title="tactic">∃</span> <span class="id" title="var">option_eq</span>. <span class="id" title="tactic">intros</span> [] []; <span class="id" title="var">simp</span> <span class="id" title="var">option_eq</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">eqb_spec</span> <span class="id" title="var">a</span> <span class="id" title="var">a0</span>); <span class="id" title="tactic">subst</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">intro</span> <span class="id" title="var">H</span>; <span class="id" title="var">noconf</span> <span class="id" title="var">H</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">elim</span> <span class="id" title="var">n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">simplify</span> ×. <span class="id" title="var">simplify</span> ×. <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <span class="id" title="var">EqFin_fn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">A</span>} `{<span class="id" title="var">Eq</span> <span class="id" title="var">A</span>}.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">eq_fin_fn</span> {<span class="id" title="var">k</span>} (<span class="id" title="var">f</span> <span class="id" title="var">g</span> : <span class="id" title="var">fin</span> <span class="id" title="var">k</span> → <span class="id" title="var">A</span>) : <span class="id" title="var">bool</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eq_fin_fn</span> (<span class="id" title="var">k</span>:=0) <span class="id" title="var">f</span> <span class="id" title="var">g</span> := <span class="id" title="var">true</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eq_fin_fn</span> (<span class="id" title="var">k</span>:=<span class="id" title="var">S</span> <span class="id" title="var">k</span>) <span class="id" title="var">f</span> <span class="id" title="var">g</span> := <span class="id" title="var">eqb</span> (<span class="id" title="var">f</span> <span class="id" title="var">fz</span>) (<span class="id" title="var">g</span> <span class="id" title="var">fz</span>) &amp;&amp; <span class="id" title="var">eq_fin_fn</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">n</span> ⇒ <span class="id" title="var">f</span> (<span class="id" title="var">fs</span> <span class="id" title="var">n</span>)) (<span class="id" title="keyword">fun</span> <span class="id" title="var">n</span> ⇒ <span class="id" title="var">g</span> (<span class="id" title="var">fs</span> <span class="id" title="var">n</span>)).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">Eq_graph</span> <span class="id" title="var">k</span> : <span class="id" title="var">Eq</span> (<span class="id" title="var">fin</span> <span class="id" title="var">k</span> → <span class="id" title="var">A</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">eq_fin_fn</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">k</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="var">simp</span> <span class="id" title="var">eq_fin_fn</span>. <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">extensionality</span> <span class="id" title="var">i</span>. <span class="id" title="var">depelim</span> <span class="id" title="var">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">eqb_spec</span> (<span class="id" title="var">x</span> <span class="id" title="var">fz</span>) (<span class="id" title="var">y</span> <span class="id" title="var">fz</span>)). <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">IHk</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">n</span> ⇒ <span class="id" title="var">x</span> (<span class="id" title="var">fs</span> <span class="id" title="var">n</span>)) (<span class="id" title="keyword">fun</span> <span class="id" title="var">n</span> ⇒ <span class="id" title="var">y</span> (<span class="id" title="var">fs</span> <span class="id" title="var">n</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">extensionality</span> <span class="id" title="var">n</span>. <span class="id" title="var">depelim</span> <span class="id" title="var">n</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">equal_f</span> <span class="id" title="tactic">in</span> <span class="id" title="var">e0</span>. <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">H'</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">elim</span> <span class="id" title="var">n</span>. <span class="id" title="tactic">extensionality</span> <span class="id" title="var">n'</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H'</span>; <span class="id" title="tactic">elim</span> <span class="id" title="var">n</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <span class="id" title="var">EqFin_fn</span>.<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">Equality</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">dec_rel</span> {<span class="id" title="var">X</span>:<span class="id" title="keyword">Type</span>} (<span class="id" title="var">R</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>) := ∀ <span class="id" title="var">x</span> <span class="id" title="var">y</span>, {<span class="id" title="var">R</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>} + {<span class="id" title="var">not</span> (<span class="id" title="var">R</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>)}.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">AlmostFull</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <span class="id" title="var">WFT</span> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">ZT</span> : <span class="id" title="var">WFT</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">SUP</span> : (<span class="id" title="var">X</span> → <span class="id" title="var">WFT</span>) → <span class="id" title="var">WFT</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Derive</span> <span class="id" title="var">NoConfusion</span> <span class="id" title="var">Subterm</span> <span class="id" title="keyword">for</span> <span class="id" title="var">WFT</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">sec_disj</span> (<span class="id" title="var">R</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>) <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> := <span class="id" title="var">R</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ∨ <span class="id" title="var">R</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">SecureBy</span> (<span class="id" title="var">R</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>) (<span class="id" title="var">p</span> : <span class="id" title="var">WFT</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">p</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">ZT</span> ⇒ <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>, <span class="id" title="var">R</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">SUP</span> <span class="id" title="var">f</span> ⇒ <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span>, <span class="id" title="var">SecureBy</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ⇒ <span class="id" title="var">R</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ∨ <span class="id" title="var">R</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>) (<span class="id" title="var">f</span> <span class="id" title="var">x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">SecureBy_mon</span> <span class="id" title="var">p</span> (<span class="id" title="var">R'</span> <span class="id" title="var">S</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>) (<span class="id" title="var">H</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>, <span class="id" title="var">R'</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> → <span class="id" title="var">S</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SecureBy</span> <span class="id" title="var">R'</span> <span class="id" title="var">p</span> → <span class="id" title="var">SecureBy</span> <span class="id" title="var">S</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">R'</span> <span class="id" title="var">S</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">p</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">H</span>. 2:<span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">almost_full</span> (<span class="id" title="var">R</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>) := <span class="id" title="tactic">∃</span> <span class="id" title="var">p</span>, <span class="id" title="var">SecureBy</span> <span class="id" title="var">R</span> <span class="id" title="var">p</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<span class="id" title="var">R</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>) (<span class="id" title="var">decR</span> : <span class="id" title="var">dec_rel</span> <span class="id" title="var">R</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">af_tree_iter</span> {<span class="id" title="var">x</span> : <span class="id" title="var">X</span>} (<span class="id" title="var">accX</span> : <span class="id" title="var">Acc</span> <span class="id" title="var">R</span> <span class="id" title="var">x</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">accX</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Acc_intro</span> <span class="id" title="var">f</span> ⇒ <span class="id" title="var">SUP</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">y</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">decR</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="tactic">left</span> <span class="id" title="var">Ry</span> ⇒ <span class="id" title="var">af_tree_iter</span> (<span class="id" title="var">f</span> <span class="id" title="var">y</span> <span class="id" title="var">Ry</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="tactic">right</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">ZT</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<span class="id" title="var">wfR</span> : <span class="id" title="var">well_founded</span> <span class="id" title="var">R</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">af_tree</span> : <span class="id" title="var">X</span> → <span class="id" title="var">WFT</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> ⇒ <span class="id" title="var">af_tree_iter</span> (<span class="id" title="var">wfR</span> <span class="id" title="var">x</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Scheme</span> <span class="id" title="var">Acc_ind_dep</span> := <span class="id" title="keyword">Induction</span> <span class="id" title="keyword">for</span> <span class="id" title="var">Acc</span> <span class="id" title="keyword">Sort</span> <span class="id" title="keyword">Prop</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">secure_from_wf</span> : <span class="id" title="var">SecureBy</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> ⇒ <span class="id" title="var">not</span> (<span class="id" title="var">R</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span>)) (<span class="id" title="var">SUP</span> <span class="id" title="var">af_tree</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">af_tree</span>. <span class="id" title="tactic">generalize</span> (<span class="id" title="var">wfR</span> <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">a</span> <span class="id" title="keyword">using</span> <span class="id" title="var">Acc_ind_dep</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">y</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">decR</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span>). <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">SecureBy_mon</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intuition</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intuition</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Corollary</span> <span class="id" title="var">af_from_wf</span> : <span class="id" title="var">almost_full</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> ⇒ <span class="id" title="var">not</span> (<span class="id" title="var">R</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">∃</span> (<span class="id" title="var">SUP</span> <span class="id" title="var">af_tree</span>). <span class="id" title="tactic">apply</span> <span class="id" title="var">secure_from_wf</span>. <span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">AlmostFull</span>.<br/>

<br/>
<span class="id" title="keyword">Class</span> <span class="id" title="var">AlmostFull</span> {<span class="id" title="var">X</span>} (<span class="id" title="var">R</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">is_almost_full</span> : <span class="id" title="var">almost_full</span> <span class="id" title="var">R</span>.<br/>

<br/>
#[<span class="id" title="var">export</span>] <span class="id" title="keyword">Instance</span> <span class="id" title="var">proper_af</span> <span class="id" title="var">X</span> : <span class="id" title="var">Proper</span> (<span class="id" title="var">relation_equivalence</span> ==&gt; <span class="id" title="var">iff</span>) (@<span class="id" title="var">AlmostFull</span> <span class="id" title="var">X</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">R</span> <span class="id" title="var">S</span> <span class="id" title="var">eqRS</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">p</span> <span class="id" title="var">Hp</span>]. <span class="id" title="tactic">∃</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">R</span> <span class="id" title="var">S</span> <span class="id" title="var">eqRS</span> <span class="id" title="var">Hp</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">p</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">intros</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">eqRS</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">H</span> <span class="id" title="var">x</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ⇒ <span class="id" title="var">R</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ∨ <span class="id" title="var">R</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>)). <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">red</span>; <span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Hp</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">p</span> <span class="id" title="var">Hp</span>]. <span class="id" title="tactic">∃</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">R</span> <span class="id" title="var">S</span> <span class="id" title="var">eqRS</span> <span class="id" title="var">Hp</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">p</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">intros</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">eqRS</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">H</span> <span class="id" title="var">x</span> <span class="id" title="var">_</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ⇒ <span class="id" title="var">S</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ∨ <span class="id" title="var">S</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>)). <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">red</span>; <span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Hp</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">Arguments</span> <span class="id" title="var">WFT</span> <span class="id" title="var">_</span> : <span class="id" title="tactic">clear</span> <span class="id" title="var">implicits</span>.<br/>

<br/>
#[<span class="id" title="var">export</span>] <span class="id" title="keyword">Instance</span> <span class="id" title="var">almost_full_le</span> : <span class="id" title="var">AlmostFull</span> <span class="id" title="var">Peano.le</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">relation_equivalence</span> <span class="id" title="var">Peano.le</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> ⇒ ¬ (<span class="id" title="var">y</span> &lt; <span class="id" title="var">x</span>))) <span class="id" title="keyword">as</span> →.<br/>
&nbsp;&nbsp;{ <span class="id" title="var">cbn</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>. <span class="id" title="tactic">intuition</span> <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">red</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>. <span class="id" title="var">lia</span>. <span class="id" title="var">lia</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">red</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">af_from_wf</span>. 2:<span class="id" title="tactic">apply</span> <span class="id" title="var">lt_wf</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">lt_dec</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">Arguments</span> <span class="id" title="var">WFT</span> <span class="id" title="var">X</span> : <span class="id" title="tactic">clear</span> <span class="id" title="var">implicits</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">WfFromAF</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">clos_trans_n1_left</span> {<span class="id" title="var">R</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>} <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> : <span class="id" title="var">R</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> → <span class="id" title="var">clos_trans_n1</span> <span class="id" title="var">_</span> <span class="id" title="var">R</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> → <span class="id" title="var">clos_trans_n1</span> <span class="id" title="var">_</span> <span class="id" title="var">R</span> <span class="id" title="var">x</span> <span class="id" title="var">z</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> 2. <span class="id" title="tactic">econstructor</span> 2; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span> 2. <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">clos_trans_1n_n1</span> {<span class="id" title="var">R</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>} <span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">clos_trans_1n</span> <span class="id" title="var">_</span> <span class="id" title="var">R</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> → <span class="id" title="var">clos_trans_n1</span> <span class="id" title="var">_</span> <span class="id" title="var">R</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> 1. <span class="id" title="var">now</span> <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">clos_trans_n1_left</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">clos_refl_trans_right</span> {<span class="id" title="var">R</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>} <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">R</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> → <span class="id" title="var">clos_refl_trans</span> <span class="id" title="var">_</span> <span class="id" title="var">R</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> → <span class="id" title="var">clos_trans_n1</span> <span class="id" title="var">_</span> <span class="id" title="var">R</span> <span class="id" title="var">x</span> <span class="id" title="var">z</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Ryz</span> <span class="id" title="var">Rxy</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">clos_rt_rtn1_iff</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Rxy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Rxy</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Ryz</span>, <span class="id" title="var">z</span> |- ×. <span class="id" title="tactic">econstructor</span> 1; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">econstructor</span> 2; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">clos_trans_1n_right</span> {<span class="id" title="var">R</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>} <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> : <span class="id" title="var">R</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> → <span class="id" title="var">clos_trans_1n</span> <span class="id" title="var">_</span> <span class="id" title="var">R</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> → <span class="id" title="var">clos_trans_1n</span> <span class="id" title="var">_</span> <span class="id" title="var">R</span> <span class="id" title="var">x</span> <span class="id" title="var">z</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> 2. <span class="id" title="tactic">econstructor</span> 2; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span> 2. <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">clos_trans_n1_1n</span> {<span class="id" title="var">R</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>} <span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">clos_trans_n1</span> <span class="id" title="var">_</span> <span class="id" title="var">R</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> → <span class="id" title="var">clos_trans_1n</span> <span class="id" title="var">_</span> <span class="id" title="var">R</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> 1. <span class="id" title="var">now</span> <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">clos_trans_1n_right</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">acc_from_af</span> (<span class="id" title="var">p</span> : <span class="id" title="var">WFT</span> <span class="id" title="var">X</span>) (<span class="id" title="var">T</span> <span class="id" title="var">R</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>) <span class="id" title="var">y</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(∀ <span class="id" title="var">x</span> <span class="id" title="var">z</span>, <span class="id" title="var">clos_refl_trans</span> <span class="id" title="var">X</span> <span class="id" title="var">T</span> <span class="id" title="var">z</span> <span class="id" title="var">y</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">clos_trans_1n</span> <span class="id" title="var">X</span> <span class="id" title="var">T</span> <span class="id" title="var">x</span> <span class="id" title="var">z</span> ∧ <span class="id" title="var">R</span> <span class="id" title="var">z</span> <span class="id" title="var">x</span> → <span class="id" title="var">False</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;→ <span class="id" title="var">SecureBy</span> <span class="id" title="var">R</span> <span class="id" title="var">p</span> → <span class="id" title="var">Acc</span> <span class="id" title="var">T</span> <span class="id" title="var">y</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">p</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">p</span> <span class="id" title="var">IHp</span>] <span class="id" title="tactic">in</span> <span class="id" title="var">T</span>, <span class="id" title="var">R</span>, <span class="id" title="var">y</span> |- × .<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">z</span> <span class="id" title="var">Tz</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">z</span> <span class="id" title="var">y</span>). <span class="id" title="tactic">elim</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">constructor</span> 2. <span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span> <span class="id" title="var">cond</span> <span class="id" title="var">secure</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">z</span> <span class="id" title="var">Tzy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">secure</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHp</span> <span class="id" title="var">y</span> <span class="id" title="var">T</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">y0</span> <span class="id" title="var">z0</span> ⇒ <span class="id" title="var">R</span> <span class="id" title="var">y0</span> <span class="id" title="var">z0</span> ∨ <span class="id" title="var">R</span> <span class="id" title="var">y</span> <span class="id" title="var">y0</span>) <span class="id" title="var">z</span>). <span class="id" title="tactic">apply</span> <span class="id" title="var">IHp</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">w</span> <span class="id" title="var">wz</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">wy</span>: <span class="id" title="var">clos_refl_trans</span> <span class="id" title="var">X</span> <span class="id" title="var">T</span> <span class="id" title="var">w</span> <span class="id" title="var">y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">econstructor</span> 3. <span class="id" title="tactic">eauto</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">constructor</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">cond</span> <span class="id" title="var">x</span> <span class="id" title="var">w</span> <span class="id" title="var">wy</span>). <span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">cond</span> <span class="id" title="var">w</span> <span class="id" title="var">y</span>). <span class="id" title="tactic">apply</span> <span class="id" title="var">cond</span>. <span class="id" title="tactic">constructor</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intuition</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">clos_trans_n1_1n</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">clos_refl_trans_right</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">wf_from_af</span> (<span class="id" title="var">p</span> : <span class="id" title="var">WFT</span> <span class="id" title="var">X</span>) (<span class="id" title="var">T</span> <span class="id" title="var">R</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(∀ <span class="id" title="var">x</span> <span class="id" title="var">y</span>, <span class="id" title="var">clos_trans_1n</span> <span class="id" title="var">X</span> <span class="id" title="var">T</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> ∧ <span class="id" title="var">R</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span> → <span class="id" title="var">False</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;→ <span class="id" title="var">SecureBy</span> <span class="id" title="var">R</span> <span class="id" title="var">p</span> → <span class="id" title="var">well_founded</span> <span class="id" title="var">T</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intro</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">acc_from_af</span>;<span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">compose_rel</span> {<span class="id" title="var">X</span>} (<span class="id" title="var">R</span> <span class="id" title="var">S</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>) : <span class="id" title="var">relation</span> <span class="id" title="var">X</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> ⇒ <span class="id" title="tactic">∃</span> <span class="id" title="var">z</span>, <span class="id" title="var">R</span> <span class="id" title="var">x</span> <span class="id" title="var">z</span> ∧ <span class="id" title="var">S</span> <span class="id" title="var">z</span> <span class="id" title="var">y</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">power</span> (<span class="id" title="var">k</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">T</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>) : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">power</span> 0 <span class="id" title="var">T</span> := <span class="id" title="var">T</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">power</span> (<span class="id" title="var">S</span> <span class="id" title="var">k</span>) <span class="id" title="var">T</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> ⇒ <span class="id" title="tactic">∃</span> <span class="id" title="var">z</span>, <span class="id" title="var">power</span> <span class="id" title="var">k</span> <span class="id" title="var">T</span> <span class="id" title="var">x</span> <span class="id" title="var">z</span> ∧ <span class="id" title="var">T</span> <span class="id" title="var">z</span> <span class="id" title="var">y</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Transparent</span> <span class="id" title="var">power</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">acc_incl</span> (<span class="id" title="var">T</span> <span class="id" title="var">T'</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>) <span class="id" title="var">x</span> : (<span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>, <span class="id" title="var">T'</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> → <span class="id" title="var">T</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>) → <span class="id" title="var">Acc</span> <span class="id" title="var">T</span> <span class="id" title="var">x</span> → <span class="id" title="var">Acc</span> <span class="id" title="var">T'</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">HT</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">induction</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> |- ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">HT</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">power_clos_trans</span> (<span class="id" title="var">T</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>) <span class="id" title="var">k</span> : <span class="id" title="var">inclusion</span> <span class="id" title="var">_</span> (<span class="id" title="var">power</span> <span class="id" title="var">k</span> <span class="id" title="var">T</span>) (<span class="id" title="var">clos_trans</span> <span class="id" title="var">_</span> <span class="id" title="var">T</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">k</span> <span class="id" title="tactic">in</span> <span class="id" title="var">x</span>, <span class="id" title="var">y</span> |- ×. <span class="id" title="tactic">simpl</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span> [<span class="id" title="var">z</span> [<span class="id" title="var">Pxz</span> <span class="id" title="var">Tzy</span>]]. <span class="id" title="tactic">econstructor</span> 2. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHk</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">clos_trans_power</span> (<span class="id" title="var">T</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>) <span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">clos_trans</span> <span class="id" title="var">_</span> <span class="id" title="var">T</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> → <span class="id" title="tactic">∃</span> <span class="id" title="var">k</span>, <span class="id" title="var">power</span> <span class="id" title="var">k</span> <span class="id" title="var">T</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">clos_trans_tn1_iff</span>. <span class="id" title="tactic">induction</span> 1. <span class="id" title="tactic">∃</span> 0; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IHclos_trans_n1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">k</span> <span class="id" title="var">pkyz</span>]. <span class="id" title="tactic">∃</span> (<span class="id" title="var">S</span> <span class="id" title="var">k</span>). <span class="id" title="var">simp</span> <span class="id" title="var">power</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">∃</span> <span class="id" title="var">y</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">acc_power</span> (<span class="id" title="var">T</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>) <span class="id" title="var">x</span> <span class="id" title="var">k</span> : <span class="id" title="var">Acc</span> <span class="id" title="var">T</span> <span class="id" title="var">x</span> → <span class="id" title="var">Acc</span> (<span class="id" title="var">power</span> <span class="id" title="var">k</span> <span class="id" title="var">T</span>) <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Acc_clos_trans</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">revert</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">acc_incl</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> (<span class="id" title="var">power_clos_trans</span> <span class="id" title="var">_</span> <span class="id" title="var">k</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">secure_power</span> (<span class="id" title="var">k</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">p</span> : <span class="id" title="var">WFT</span> <span class="id" title="var">X</span>) : <span class="id" title="var">WFT</span> <span class="id" title="var">X</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">secure_power</span> 0 <span class="id" title="var">p</span> := <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">secure_power</span> (<span class="id" title="var">S</span> <span class="id" title="var">k</span>) <span class="id" title="var">p</span> := <span class="id" title="var">SUP</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> ⇒ <span class="id" title="var">secure_power</span> <span class="id" title="var">k</span> <span class="id" title="var">p</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Transparent</span> <span class="id" title="var">secure_power</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">secure_by_power</span> <span class="id" title="var">R</span> <span class="id" title="var">p</span> (<span class="id" title="var">H</span> : <span class="id" title="var">SecureBy</span> <span class="id" title="var">R</span> <span class="id" title="var">p</span>) <span class="id" title="var">k</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SecureBy</span> <span class="id" title="var">R</span> (<span class="id" title="var">secure_power</span> <span class="id" title="var">k</span> <span class="id" title="var">p</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">k</span> <span class="id" title="tactic">in</span> <span class="id" title="var">R</span>, <span class="id" title="var">p</span>, <span class="id" title="var">H</span> |- *; <span class="id" title="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">p</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> ×. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHk</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHk</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">x0</span>). <span class="id" title="tactic">eapply</span> <span class="id" title="var">SecureBy_mon</span>. 2:<span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">acc_from_power_af</span> (<span class="id" title="var">p</span> : <span class="id" title="var">WFT</span> <span class="id" title="var">X</span>) (<span class="id" title="var">T</span> <span class="id" title="var">R</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>) <span class="id" title="var">y</span> <span class="id" title="var">k</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(∀ <span class="id" title="var">x</span> <span class="id" title="var">z</span>, <span class="id" title="var">clos_refl_trans</span> <span class="id" title="var">_</span> <span class="id" title="var">T</span> <span class="id" title="var">z</span> <span class="id" title="var">y</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">clos_trans_1n</span> <span class="id" title="var">X</span> (<span class="id" title="var">power</span> <span class="id" title="var">k</span> <span class="id" title="var">T</span>) <span class="id" title="var">x</span> <span class="id" title="var">z</span> ∧ <span class="id" title="var">R</span> <span class="id" title="var">z</span> <span class="id" title="var">x</span> → <span class="id" title="var">False</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;→ <span class="id" title="var">SecureBy</span> <span class="id" title="var">R</span> (<span class="id" title="var">secure_power</span> <span class="id" title="var">k</span> <span class="id" title="var">p</span>) → <span class="id" title="var">Acc</span> <span class="id" title="var">T</span> <span class="id" title="var">y</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;induction&nbsp;k&nbsp;in&nbsp;T,&nbsp;R,&nbsp;y&nbsp;|-&nbsp;*.&nbsp;simpl.&nbsp;intros.&nbsp;simp&nbsp;secure_power&nbsp;in&nbsp;H0.&nbsp;eapply&nbsp;acc_from_af;&nbsp;eauto.&nbsp;admit.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;intros.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;simp&nbsp;secure_power&nbsp;in&nbsp;H0.&nbsp;simpl&nbsp;in&nbsp;H0.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;constructor.&nbsp;intros&nbsp;x&nbsp;Txy.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;specialize&nbsp;(IHk&nbsp;T&nbsp;(sec_disj&nbsp;R&nbsp;x)).&nbsp;specialize&nbsp;(H0&nbsp;x).&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;apply&nbsp;IHk;&nbsp;auto.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;intros.&nbsp;destruct&nbsp;H1;&nbsp;subst.&nbsp;unfold&nbsp;sec_disj&nbsp;in&nbsp;*.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;intuition.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;intuition.&nbsp;red&nbsp;in&nbsp;H4.&nbsp;apply&nbsp;(H&nbsp;x&nbsp;z).&nbsp;*)</span><br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">p</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">p</span> <span class="id" title="var">IHp</span>] <span class="id" title="tactic">in</span> <span class="id" title="var">T</span>, <span class="id" title="var">R</span>, <span class="id" title="var">y</span>, <span class="id" title="var">k</span> |- × .<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;+&nbsp;simpl.&nbsp;intros.&nbsp;constructor.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intros&nbsp;z&nbsp;Tz.&nbsp;specialize&nbsp;(H&nbsp;z&nbsp;y).&nbsp;elim&nbsp;H.&nbsp;constructor&nbsp;2.&nbsp;split;&nbsp;auto.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;constructor.&nbsp;auto.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;+&nbsp;intros&nbsp;cond&nbsp;secure.&nbsp;constructor.&nbsp;intros&nbsp;z&nbsp;Tzy.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;secure.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;specialize&nbsp;(IHp&nbsp;y&nbsp;T&nbsp;(fun&nbsp;y0&nbsp;z0&nbsp;=&gt;&nbsp;R&nbsp;y0&nbsp;z0&nbsp;\/&nbsp;R&nbsp;y&nbsp;y0)&nbsp;z).&nbsp;eapply&nbsp;(IHp&nbsp;k);&nbsp;auto.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intros&nbsp;x&nbsp;w&nbsp;wz.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert(wy:&nbsp;clos_refl_trans&nbsp;X&nbsp;(power&nbsp;(S&nbsp;k)&nbsp;T)&nbsp;w&nbsp;y).&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;econstructor&nbsp;3.&nbsp;eauto.&nbsp;constructor.&nbsp;&nbsp;&nbsp;&nbsp;now&nbsp;constructor.&nbsp;}&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pose&nbsp;proof&nbsp;(cond&nbsp;x&nbsp;w&nbsp;wy).&nbsp;intuition.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;specialize&nbsp;(cond&nbsp;w&nbsp;y).&nbsp;apply&nbsp;cond.&nbsp;constructor&nbsp;2.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intuition.&nbsp;apply&nbsp;clos_trans_n1_1n.&nbsp;eapply&nbsp;clos_refl_trans_right;&nbsp;eauto.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Defined.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Admitted</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;induction&nbsp;k.&nbsp;eapply&nbsp;acc_from_af;&nbsp;eauto.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;apply&nbsp;IHk.&nbsp;intros.&nbsp;eapply&nbsp;H.&nbsp;eauto.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;constructor.&nbsp;intros.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;apply&nbsp;IHk;&nbsp;auto.&nbsp;intros&nbsp;x&nbsp;z&nbsp;Hzy&nbsp;<span class="inlinecode"><span class="id" title="var">Hxz</span></span> <span class="inlinecode"><span class="id" title="var">Rzx</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;specialize&nbsp;(H&nbsp;x&nbsp;z).&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;specialize&nbsp;(H&nbsp;x&nbsp;_&nbsp;H2).&nbsp;apply&nbsp;H.&nbsp;split;&nbsp;intuition.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;induction&nbsp;H4.&nbsp;constructor.&nbsp;simpl.&nbsp;exists&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;eapply&nbsp;acc_power&nbsp;with&nbsp;0.&nbsp;eapply&nbsp;acc_from_af;&nbsp;eauto.&nbsp;intros.&nbsp;intuition.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;power&nbsp;in&nbsp;*.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;apply&nbsp;clos_trans_1n_n1&nbsp;in&nbsp;H3.&nbsp;destruct&nbsp;H3.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;specialize&nbsp;(H&nbsp;x&nbsp;_&nbsp;H1).&nbsp;apply&nbsp;H;&nbsp;split;&nbsp;auto.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;specialize&nbsp;(H&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;induction&nbsp;p&nbsp;as&nbsp;<span class="inlinecode">|<span class="id" title="var">p</span></span> <span class="inlinecode"><span class="id" title="var">IHp</span></span>&nbsp;in&nbsp;T,&nbsp;R,&nbsp;y&nbsp;|-&nbsp;*&nbsp;.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;simpl.&nbsp;intros.&nbsp;constructor.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intros&nbsp;z&nbsp;Tz.&nbsp;specialize&nbsp;(H&nbsp;z&nbsp;y).&nbsp;elim&nbsp;H.&nbsp;constructor&nbsp;2.&nbsp;split;&nbsp;auto.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;constructor.&nbsp;auto.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;intros&nbsp;cond&nbsp;secure.&nbsp;constructor.&nbsp;intros&nbsp;z&nbsp;Tzy.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl&nbsp;in&nbsp;secure.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;specialize&nbsp;(IHp&nbsp;y&nbsp;T&nbsp;(fun&nbsp;y0&nbsp;z0&nbsp;=&gt;&nbsp;R&nbsp;y0&nbsp;z0&nbsp;\/&nbsp;R&nbsp;y&nbsp;y0)&nbsp;z).&nbsp;apply&nbsp;IHp;&nbsp;auto.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intros&nbsp;x&nbsp;w&nbsp;wz.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert(wy:&nbsp;clos_refl_trans&nbsp;X&nbsp;T&nbsp;w&nbsp;y).&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;econstructor&nbsp;3.&nbsp;eauto.&nbsp;now&nbsp;constructor.&nbsp;}&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pose&nbsp;proof&nbsp;(cond&nbsp;x&nbsp;w&nbsp;wy).&nbsp;intuition.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;specialize&nbsp;(cond&nbsp;w&nbsp;y).&nbsp;apply&nbsp;cond.&nbsp;constructor&nbsp;2.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intuition.&nbsp;apply&nbsp;clos_trans_n1_1n.&nbsp;eapply&nbsp;clos_refl_trans_right;&nbsp;eauto.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;Defined.&nbsp;*)</span><br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">wf_from_power_af</span> (<span class="id" title="var">p</span> : <span class="id" title="var">WFT</span> <span class="id" title="var">X</span>) (<span class="id" title="var">T</span> <span class="id" title="var">R</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>) <span class="id" title="var">k</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(∀ <span class="id" title="var">x</span> <span class="id" title="var">y</span>, <span class="id" title="var">clos_trans_1n</span> <span class="id" title="var">X</span> (<span class="id" title="var">power</span> <span class="id" title="var">k</span> <span class="id" title="var">T</span>) <span class="id" title="var">x</span> <span class="id" title="var">y</span> ∧ <span class="id" title="var">R</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span> → <span class="id" title="var">False</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;→ <span class="id" title="var">SecureBy</span> <span class="id" title="var">R</span> <span class="id" title="var">p</span> → <span class="id" title="var">well_founded</span> <span class="id" title="var">T</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intro</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">acc_from_power_af</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">secure_by_power</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">WfFromAF</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">FixAF</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">T</span> <span class="id" title="var">R</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">af</span> : <span class="id" title="var">AlmostFull</span> <span class="id" title="var">R</span>}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<span class="id" title="var">H</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>, <span class="id" title="var">clos_trans_1n</span> <span class="id" title="var">X</span> <span class="id" title="var">T</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> ∧ <span class="id" title="var">R</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span> → <span class="id" title="var">False</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">af_wf</span> : <span class="id" title="var">WellFounded</span> <span class="id" title="var">T</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">red</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">af</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">wf_from_af</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="keyword">Defined</span>.<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">FixAF</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">PowerAf</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<span class="id" title="var">T</span> <span class="id" title="var">R</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">af</span> : <span class="id" title="var">AlmostFull</span> <span class="id" title="var">R</span>}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<span class="id" title="var">k</span> : <span class="id" title="var">nat</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> (<span class="id" title="var">H</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>, <span class="id" title="var">clos_trans_1n</span> <span class="id" title="var">X</span> (<span class="id" title="var">power</span> <span class="id" title="var">k</span> <span class="id" title="var">T</span>) <span class="id" title="var">x</span> <span class="id" title="var">y</span> ∧ <span class="id" title="var">R</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span> → <span class="id" title="var">False</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">af_power_wf</span> : <span class="id" title="var">WellFounded</span> <span class="id" title="var">T</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">af</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">p</span> <span class="id" title="var">Sp</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">wf_from_power_af</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">PowerAf</span>.<br/>

<br/>
<span class="id" title="keyword">Equations</span> <span class="id" title="var">cofmap</span> {<span class="id" title="var">X</span> <span class="id" title="var">Y</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">Y</span> → <span class="id" title="var">X</span>) (<span class="id" title="var">p</span> : <span class="id" title="var">WFT</span> <span class="id" title="var">X</span>) : <span class="id" title="var">WFT</span> <span class="id" title="var">Y</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">cofmap</span> <span class="id" title="var">f</span> <span class="id" title="var">ZT</span> := <span class="id" title="var">ZT</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">cofmap</span> <span class="id" title="var">f</span> (<span class="id" title="var">SUP</span> <span class="id" title="var">w</span>) := <span class="id" title="var">SUP</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">y</span> ⇒ <span class="id" title="var">cofmap</span> <span class="id" title="var">f</span> (<span class="id" title="var">w</span> (<span class="id" title="var">f</span> <span class="id" title="var">y</span>))).<br/>
<span class="id" title="keyword">Transparent</span> <span class="id" title="var">cofmap</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cofmap_secures</span> {<span class="id" title="var">X</span> <span class="id" title="var">Y</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">Y</span> → <span class="id" title="var">X</span>) (<span class="id" title="var">p</span> : <span class="id" title="var">WFT</span> <span class="id" title="var">X</span>) (<span class="id" title="var">R</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">SecureBy</span> <span class="id" title="var">R</span> <span class="id" title="var">p</span> → <span class="id" title="var">SecureBy</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> ⇒ <span class="id" title="var">R</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span>) (<span class="id" title="var">f</span> <span class="id" title="var">y</span>)) (<span class="id" title="var">cofmap</span> <span class="id" title="var">f</span> <span class="id" title="var">p</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">p</span> <span class="id" title="tactic">in</span> <span class="id" title="var">R</span> |- *; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> : <span class="id" title="var">X</span> ⇒ <span class="id" title="var">R</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ∨ <span class="id" title="var">R</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span>) <span class="id" title="var">y</span>)). <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
#[<span class="id" title="var">export</span>] <span class="id" title="keyword">Instance</span> <span class="id" title="var">AlmostFull_MR</span> {<span class="id" title="var">X</span> <span class="id" title="var">Y</span>} <span class="id" title="var">R</span> (<span class="id" title="var">f</span> : <span class="id" title="var">Y</span> → <span class="id" title="var">X</span>) : <span class="id" title="var">AlmostFull</span> <span class="id" title="var">R</span> → <span class="id" title="var">AlmostFull</span> (<span class="id" title="var">Wf.MR</span> <span class="id" title="var">R</span> <span class="id" title="var">f</span>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span> [<span class="id" title="var">p</span> <span class="id" title="var">sec</span>]. <span class="id" title="tactic">∃</span> (<span class="id" title="var">cofmap</span> <span class="id" title="var">f</span> <span class="id" title="var">p</span>). <span class="id" title="tactic">apply</span> (<span class="id" title="var">cofmap_secures</span> <span class="id" title="var">f</span> <span class="id" title="var">p</span> <span class="id" title="var">_</span> <span class="id" title="var">sec</span>). <span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">oplus_nullary</span> {<span class="id" title="var">X</span>:<span class="id" title="keyword">Type</span>} (<span class="id" title="var">p</span>:<span class="id" title="var">WFT</span> <span class="id" title="var">X</span>) (<span class="id" title="var">q</span>:<span class="id" title="var">WFT</span> <span class="id" title="var">X</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">p</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">ZT</span> ⇒ <span class="id" title="var">q</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">SUP</span> <span class="id" title="var">f</span> ⇒ <span class="id" title="var">SUP</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> ⇒ <span class="id" title="var">oplus_nullary</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span>) <span class="id" title="var">q</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">oplus_nullary_sec_intersection</span> {<span class="id" title="var">X</span>} (<span class="id" title="var">p</span> : <span class="id" title="var">WFT</span> <span class="id" title="var">X</span>) (<span class="id" title="var">q</span>: <span class="id" title="var">WFT</span> <span class="id" title="var">X</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">C</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>) (<span class="id" title="var">A</span> : <span class="id" title="keyword">Prop</span>) (<span class="id" title="var">B</span> : <span class="id" title="keyword">Prop</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">SecureBy</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ⇒ <span class="id" title="var">C</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ∨ <span class="id" title="var">A</span>) <span class="id" title="var">p</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">SecureBy</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ⇒ <span class="id" title="var">C</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ∨ <span class="id" title="var">B</span>) <span class="id" title="var">q</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">SecureBy</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ⇒ <span class="id" title="var">C</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ∨ (<span class="id" title="var">A</span> ∧ <span class="id" title="var">B</span>)) (<span class="id" title="var">oplus_nullary</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">C</span> <span class="id" title="var">q</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">p</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">q</span> <span class="id" title="tactic">in</span> <span class="id" title="var">C</span>, <span class="id" title="var">H</span>, <span class="id" title="var">H0</span> |- *; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>). <span class="id" title="tactic">specialize</span> (<span class="id" title="var">H0</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>). <span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H1</span> <span class="id" title="var">x</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ⇒ (<span class="id" title="var">C</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ∨ <span class="id" title="var">A</span> ∧ <span class="id" title="var">B</span>) ∨ <span class="id" title="var">C</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>)). <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> ×.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">SecureBy_mon</span>. 2:<span class="id" title="tactic">eapply</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intuition</span>. <span class="id" title="tactic">intuition</span>. <span class="id" title="tactic">firstorder</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">SecureBy_mon</span>. 2:<span class="id" title="tactic">eapply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">firstorder</span> <span class="id" title="tactic">auto</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">x</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ⇒ <span class="id" title="var">C</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ∨ <span class="id" title="var">C</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>)). <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> ×.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">SecureBy_mon</span>. 2:<span class="id" title="tactic">eapply</span> <span class="id" title="var">H</span>. <span class="id" title="var">all</span>:<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">firstorder</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">SecureBy_mon</span>. 2:<span class="id" title="tactic">eapply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">SecureBy_mon</span>. 2:<span class="id" title="tactic">eapply</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intuition</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">OplusUnary</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>}.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Nested&nbsp;version&nbsp;is&nbsp;harder&nbsp;to&nbsp;work&nbsp;with&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Equations&nbsp;oplus_unary&nbsp;(p&nbsp;:&nbsp;WFT&nbsp;X)&nbsp;(q&nbsp;:&nbsp;WFT&nbsp;X)&nbsp;:&nbsp;WFT&nbsp;X&nbsp;by&nbsp;struct&nbsp;p&nbsp;:=&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;oplus_unary&nbsp;ZT&nbsp;q&nbsp;:=&nbsp;q;&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;oplus_unary&nbsp;(SUP&nbsp;f)&nbsp;g&nbsp;:=&nbsp;SUP&nbsp;(fun&nbsp;x&nbsp;=&gt;&nbsp;oplus_unary_right&nbsp;g&nbsp;x)&nbsp;*)</span><br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;where&nbsp;oplus_unary_right&nbsp;(q&nbsp;:&nbsp;WFT&nbsp;X)&nbsp;(x&nbsp;:&nbsp;X)&nbsp;:&nbsp;WFT&nbsp;X&nbsp;by&nbsp;struct&nbsp;q&nbsp;:=&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;{&nbsp;oplus_unary_right&nbsp;ZT&nbsp;x&nbsp;:=&nbsp;f&nbsp;x;&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oplus_unary_right&nbsp;(SUP&nbsp;g)&nbsp;x&nbsp;:=&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oplus_nullary&nbsp;(oplus_unary&nbsp;(f&nbsp;x)&nbsp;(SUP&nbsp;g))&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(oplus_unary_right&nbsp;(g&nbsp;x)&nbsp;x)&nbsp;}.&nbsp;*)</span><br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span>? <span class="id" title="var">oplus_unary</span> (<span class="id" title="var">p</span> : <span class="id" title="var">WFT</span> <span class="id" title="var">X</span>) (<span class="id" title="var">q</span> : <span class="id" title="var">WFT</span> <span class="id" title="var">X</span>) : <span class="id" title="var">WFT</span> <span class="id" title="var">X</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> <span class="id" title="keyword">wf</span> (<span class="id" title="var">p</span>, <span class="id" title="var">q</span>) (<span class="id" title="var">Subterm.lexprod</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">WFT_subterm</span> <span class="id" title="var">WFT_subterm</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">oplus_unary</span> <span class="id" title="var">ZT</span> <span class="id" title="var">q</span> := <span class="id" title="var">q</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">oplus_unary</span> <span class="id" title="var">p</span> <span class="id" title="var">ZT</span> := <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">oplus_unary</span> (<span class="id" title="var">SUP</span> <span class="id" title="var">f</span>) (<span class="id" title="var">SUP</span> <span class="id" title="var">g</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SUP</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> ⇒ <span class="id" title="var">oplus_nullary</span> (<span class="id" title="var">oplus_unary</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span>) (<span class="id" title="var">SUP</span> <span class="id" title="var">g</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">oplus_unary</span> (<span class="id" title="var">SUP</span> <span class="id" title="var">f</span>) (<span class="id" title="var">g</span> <span class="id" title="var">x</span>))).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span> 2. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span>? <span class="id" title="var">oplus_binary</span> (<span class="id" title="var">p</span> : <span class="id" title="var">WFT</span> <span class="id" title="var">X</span>) (<span class="id" title="var">q</span> : <span class="id" title="var">WFT</span> <span class="id" title="var">X</span>) : <span class="id" title="var">WFT</span> <span class="id" title="var">X</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> <span class="id" title="keyword">wf</span> (<span class="id" title="var">p</span>, <span class="id" title="var">q</span>) (<span class="id" title="var">Subterm.lexprod</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">WFT_subterm</span> <span class="id" title="var">WFT_subterm</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">oplus_binary</span> <span class="id" title="var">ZT</span> <span class="id" title="var">q</span> := <span class="id" title="var">q</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">oplus_binary</span> <span class="id" title="var">p</span> <span class="id" title="var">ZT</span> := <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">oplus_binary</span> (<span class="id" title="var">SUP</span> <span class="id" title="var">f</span>) (<span class="id" title="var">SUP</span> <span class="id" title="var">g</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SUP</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> ⇒ <span class="id" title="var">oplus_unary</span> (<span class="id" title="var">oplus_binary</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span>) (<span class="id" title="var">SUP</span> <span class="id" title="var">g</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">oplus_binary</span> (<span class="id" title="var">SUP</span> <span class="id" title="var">f</span>) (<span class="id" title="var">g</span> <span class="id" title="var">x</span>))).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span> 2. <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">OplusUnary</span>.<br/>

<br/>
<span class="id" title="keyword">Local</span> <span class="id" title="keyword">Set</span> <span class="id" title="var">Firstorder</span> <span class="id" title="var">Solver</span> <span class="id" title="tactic">auto</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Lemma&nbsp;oplus_unary_sec_intersection&nbsp;{X}&nbsp;(p&nbsp;q&nbsp;:&nbsp;WFT&nbsp;X)&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(C&nbsp;:&nbsp;X&nbsp;-&gt;&nbsp;X&nbsp;-&gt;&nbsp;Prop)&nbsp;(A&nbsp;B&nbsp;:&nbsp;X&nbsp;-&gt;&nbsp;Prop)&nbsp;:&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;SecureBy&nbsp;(fun&nbsp;y&nbsp;z&nbsp;=&gt;&nbsp;C&nbsp;y&nbsp;z&nbsp;\/&nbsp;A&nbsp;y)&nbsp;p&nbsp;-&gt;&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;SecureBy&nbsp;(fun&nbsp;y&nbsp;z&nbsp;=&gt;&nbsp;C&nbsp;y&nbsp;z&nbsp;\/&nbsp;B&nbsp;y)&nbsp;q&nbsp;-&gt;&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;SecureBy&nbsp;(fun&nbsp;y&nbsp;z&nbsp;=&gt;&nbsp;C&nbsp;y&nbsp;z&nbsp;\/&nbsp;(A&nbsp;y&nbsp;/\&nbsp;B&nbsp;y))&nbsp;(oplus_unary&nbsp;p&nbsp;q).&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;Proof.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;intros.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;revert&nbsp;H&nbsp;H0.&nbsp;revert&nbsp;q&nbsp;C.&nbsp;induction&nbsp;p.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;intros.&nbsp;simp&nbsp;oplus_unary.&nbsp;eapply&nbsp;SecureBy_mon;&nbsp;<span class="inlinecode">|<span class="id" title="tactic">eapply</span></span> <span class="inlinecode"><span class="id" title="var">H0</span></span>.&nbsp;firstorder.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;simpl.&nbsp;induction&nbsp;q.&nbsp;simpl.&nbsp;intros.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;eapply&nbsp;SecureBy_mon;&nbsp;<span class="inlinecode">|<span class="id" title="tactic">eapply</span></span> <span class="inlinecode"><span class="id" title="var">H0</span></span>.&nbsp;simpl.&nbsp;firstorder&nbsp;auto.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;intros.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;simp&nbsp;oplus_unary.&nbsp;simpl.&nbsp;intros&nbsp;x.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;eapply&nbsp;SecureBy_mon;&nbsp;<span class="inlinecode">|<span class="id" title="tactic">eapply</span></span> <span class="inlinecode">(<span class="id" title="var">oplus_nullary_sec_intersection</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">(<span class="id" title="var">A</span></span> <span class="inlinecode"><span class="id" title="var">x</span>)</span> <span class="inlinecode">(<span class="id" title="var">B</span></span> <span class="inlinecode"><span class="id" title="var">x</span>))</span>.&nbsp;simpl.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;intros.&nbsp;destruct&nbsp;H3;&nbsp;<span class="inlinecode">|<span class="id" title="tactic">intuition</span></span>.&nbsp;rewrite&nbsp;&lt;-&nbsp;or_assoc.&nbsp;left.&nbsp;eapply&nbsp;H3.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;-&nbsp;simpl.&nbsp;simpl&nbsp;in&nbsp;H2.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;SecureBy_mon;&nbsp;<span class="inlinecode">|<span class="id" title="tactic">eapply</span></span> <span class="inlinecode">(<span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">(<span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span> <span class="inlinecode"><span class="id" title="var">z</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="var">C</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span> <span class="inlinecode"><span class="id" title="var">z</span></span> <span class="inlinecode">∨</span> <span class="inlinecode"><span class="id" title="var">C</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span> <span class="inlinecode">∨</span> <span class="inlinecode"><span class="id" title="var">A</span></span> <span class="inlinecode"><span class="id" title="var">x</span>))</span>;&nbsp;auto.&nbsp;simpl;&nbsp;intros.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intuition&nbsp;auto.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;SecureBy_mon;&nbsp;<span class="inlinecode">|<span class="id" title="tactic">eapply</span></span> <span class="inlinecode"><span class="id" title="var">H1</span></span>;&nbsp;simpl.&nbsp;intros.&nbsp;intuition&nbsp;auto.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl.&nbsp;intros.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;SecureBy_mon;&nbsp;<span class="inlinecode">|<span class="id" title="tactic">eapply</span></span> <span class="inlinecode"><span class="id" title="var">H2</span></span>;&nbsp;simpl.&nbsp;intros.&nbsp;intuition&nbsp;auto.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;-&nbsp;simpl.&nbsp;eapply&nbsp;SecureBy_mon;&nbsp;<span class="inlinecode">|<span class="id" title="tactic">eapply</span></span> <span class="inlinecode">(<span class="id" title="var">H0</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">(<span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span> <span class="inlinecode"><span class="id" title="var">z</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="var">C</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span> <span class="inlinecode"><span class="id" title="var">z</span></span> <span class="inlinecode">∨</span> <span class="inlinecode"><span class="id" title="var">C</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span> <span class="inlinecode">∨</span> <span class="inlinecode"><span class="id" title="var">B</span></span> <span class="inlinecode"><span class="id" title="var">x</span>))</span>;&nbsp;simpl.&nbsp;intuition&nbsp;auto.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intuition.&nbsp;simpl&nbsp;in&nbsp;H2.&nbsp;eapply&nbsp;SecureBy_mon;&nbsp;<span class="inlinecode">|<span class="id" title="tactic">eapply</span></span> <span class="inlinecode"><span class="id" title="var">H1</span></span>;&nbsp;simpl.&nbsp;intuition&nbsp;auto.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;SecureBy_mon;&nbsp;<span class="inlinecode">|<span class="id" title="tactic">eapply</span></span> <span class="inlinecode"><span class="id" title="var">H2</span></span>;&nbsp;simpl.&nbsp;intros.&nbsp;intuition&nbsp;auto.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;Defined.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">oplus_unary_sec_intersection</span> {<span class="id" title="var">X</span>} (<span class="id" title="var">p</span> <span class="id" title="var">q</span> : <span class="id" title="var">WFT</span> <span class="id" title="var">X</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">C</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>) (<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">SecureBy</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ⇒ <span class="id" title="var">C</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ∨ <span class="id" title="var">A</span> <span class="id" title="var">y</span>) <span class="id" title="var">p</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">SecureBy</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ⇒ <span class="id" title="var">C</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ∨ <span class="id" title="var">B</span> <span class="id" title="var">y</span>) <span class="id" title="var">q</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">SecureBy</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ⇒ <span class="id" title="var">C</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ∨ (<span class="id" title="var">A</span> <span class="id" title="var">y</span> ∧ <span class="id" title="var">B</span> <span class="id" title="var">y</span>)) (<span class="id" title="var">oplus_unary</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">funelim</span> (<span class="id" title="var">oplus_unary</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span>); <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">SecureBy_mon</span>; [|<span class="id" title="tactic">eapply</span> <span class="id" title="var">H0</span>]; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">SecureBy_mon</span>; [|<span class="id" title="tactic">eapply</span> <span class="id" title="var">H</span>]. <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eapply</span> <span class="id" title="var">SecureBy_mon</span>. 2:<span class="id" title="tactic">eapply</span> (<span class="id" title="var">oplus_nullary_sec_intersection</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">A</span> <span class="id" title="var">x</span>) (<span class="id" title="var">B</span> <span class="id" title="var">x</span>)). <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H3</span>; [|<span class="id" title="tactic">intuition</span> <span class="id" title="tactic">auto</span>]. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">or_assoc</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">SecureBy_mon</span>; [|<span class="id" title="tactic">eapply</span> (<span class="id" title="var">H</span> <span class="id" title="var">_</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ⇒ <span class="id" title="var">C</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ∨ <span class="id" title="var">C</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> ∨ <span class="id" title="var">A</span> <span class="id" title="var">x</span>) <span class="id" title="var">A</span> <span class="id" title="var">B</span>)]. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intuition</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">SecureBy_mon</span>; [|<span class="id" title="tactic">eapply</span> <span class="id" title="var">H1</span>]; <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intuition</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">SecureBy_mon</span>; [|<span class="id" title="tactic">eapply</span> <span class="id" title="var">H2</span>]; <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intuition</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">H0</span> <span class="id" title="var">x</span>). <span class="id" title="tactic">eapply</span> <span class="id" title="var">SecureBy_mon</span>; [|<span class="id" title="tactic">eapply</span> (<span class="id" title="var">H0</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ⇒ <span class="id" title="var">C</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ∨ <span class="id" title="var">C</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> ∨ <span class="id" title="var">B</span> <span class="id" title="var">x</span>) <span class="id" title="var">A</span> <span class="id" title="var">B</span>)]; <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intuition</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intuition</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">SecureBy_mon</span>; [|<span class="id" title="tactic">eapply</span> <span class="id" title="var">H1</span>]; <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intuition</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">SecureBy_mon</span>; [|<span class="id" title="tactic">eapply</span> <span class="id" title="var">H2</span>]; <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intuition</span> <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">oplus_binary_sec_intersection'</span> {<span class="id" title="var">X</span>} (<span class="id" title="var">p</span> <span class="id" title="var">q</span> : <span class="id" title="var">WFT</span> <span class="id" title="var">X</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">C</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>) (<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">SecureBy</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ⇒ <span class="id" title="var">C</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ∨ <span class="id" title="var">A</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span>) <span class="id" title="var">p</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">SecureBy</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ⇒ <span class="id" title="var">C</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ∨ <span class="id" title="var">B</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span>) <span class="id" title="var">q</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">SecureBy</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ⇒ <span class="id" title="var">C</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ∨ (<span class="id" title="var">A</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ∧ <span class="id" title="var">B</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span>)) (<span class="id" title="var">oplus_binary</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">funelim</span> (<span class="id" title="var">oplus_binary</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span>); <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">SecureBy_mon</span>. 2:<span class="id" title="tactic">eapply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">SecureBy_mon</span>; [|<span class="id" title="tactic">eapply</span> <span class="id" title="var">H</span>]. <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">SecureBy_mon</span>. 2:<span class="id" title="tactic">eapply</span> (<span class="id" title="var">oplus_unary_sec_intersection</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">A</span> <span class="id" title="var">x</span>) (<span class="id" title="var">B</span> <span class="id" title="var">x</span>)). <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H3</span>; [|<span class="id" title="tactic">intuition</span> <span class="id" title="tactic">auto</span>]. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">or_assoc</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">SecureBy_mon</span>; [|<span class="id" title="tactic">eapply</span> (<span class="id" title="var">H</span> <span class="id" title="var">_</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ⇒ <span class="id" title="var">C</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ∨ <span class="id" title="var">C</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> ∨ <span class="id" title="var">A</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>) <span class="id" title="var">A</span> <span class="id" title="var">B</span>)]. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intuition</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">SecureBy_mon</span>; [|<span class="id" title="tactic">eapply</span> <span class="id" title="var">H1</span>]; <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intuition</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">SecureBy_mon</span>; [|<span class="id" title="tactic">eapply</span> <span class="id" title="var">H2</span>]; <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intuition</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">SecureBy_mon</span>; [|<span class="id" title="tactic">eapply</span> (<span class="id" title="var">H0</span> <span class="id" title="var">x</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ⇒ <span class="id" title="var">C</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ∨ <span class="id" title="var">C</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> ∨ <span class="id" title="var">B</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>) <span class="id" title="var">A</span> <span class="id" title="var">B</span>)]; <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intuition</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intuition</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">SecureBy_mon</span>; [|<span class="id" title="tactic">eapply</span> <span class="id" title="var">H1</span>]; <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intuition</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">SecureBy_mon</span>; [|<span class="id" title="tactic">eapply</span> <span class="id" title="var">H2</span>]; <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intuition</span> <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">oplus_binary_sec_intersection</span> {<span class="id" title="var">X</span>} (<span class="id" title="var">p</span> <span class="id" title="var">q</span> : <span class="id" title="var">WFT</span> <span class="id" title="var">X</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">SecureBy</span> <span class="id" title="var">A</span> <span class="id" title="var">p</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">SecureBy</span> <span class="id" title="var">B</span> <span class="id" title="var">q</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">SecureBy</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ⇒ <span class="id" title="var">A</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ∧ <span class="id" title="var">B</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span>) (<span class="id" title="var">oplus_binary</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span>. <span class="id" title="var">funelim</span> (<span class="id" title="var">oplus_binary</span> <span class="id" title="var">p</span> <span class="id" title="var">q</span>); <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">SecureBy_mon</span>. 2:<span class="id" title="tactic">eapply</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">SecureBy_mon</span>; [|<span class="id" title="tactic">eapply</span> <span class="id" title="var">H</span>]. <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">SecureBy_mon</span>. 2:<span class="id" title="tactic">eapply</span> (<span class="id" title="var">oplus_unary_sec_intersection</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">A</span> <span class="id" title="var">x</span>) (<span class="id" title="var">B</span> <span class="id" title="var">x</span>)). <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H3</span>; [|<span class="id" title="tactic">intuition</span> <span class="id" title="tactic">auto</span>]. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">SecureBy_mon</span>; [|<span class="id" title="tactic">eapply</span> (<span class="id" title="var">H</span> <span class="id" title="var">_</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ⇒ <span class="id" title="var">A</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ∨ <span class="id" title="var">A</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>) <span class="id" title="var">B</span>)]; <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">sec_disj</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intuition</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">SecureBy_mon</span>; [|<span class="id" title="tactic">eapply</span> <span class="id" title="var">H1</span>]; <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intuition</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">SecureBy_mon</span>; [|<span class="id" title="tactic">eapply</span> <span class="id" title="var">H2</span>]; <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">intuition</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">H0</span> <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">SecureBy_mon</span>; [|<span class="id" title="tactic">eapply</span> (<span class="id" title="var">H0</span> <span class="id" title="var">A</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ⇒ <span class="id" title="var">B</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> ∨ <span class="id" title="var">B</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>))]; <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intuition</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intuition</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H2</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">inter_rel</span> {<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>) := <span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> ⇒ <span class="id" title="var">A</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> ∧ <span class="id" title="var">B</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>.<br/>

<br/>
<span class="id" title="keyword">Corollary</span> <span class="id" title="var">af_interesection</span> {<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">AlmostFull</span> <span class="id" title="var">A</span> → <span class="id" title="var">AlmostFull</span> <span class="id" title="var">B</span> → <span class="id" title="var">AlmostFull</span> (<span class="id" title="var">inter_rel</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">pa</span> <span class="id" title="var">Ha</span>] [<span class="id" title="var">pb</span> <span class="id" title="var">Hb</span>]. <span class="id" title="tactic">∃</span> (<span class="id" title="var">oplus_binary</span> <span class="id" title="var">pa</span> <span class="id" title="var">pb</span>). <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">oplus_binary_sec_intersection</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Non-functional&nbsp;construction&nbsp;in&nbsp;intuition&nbsp;auto!&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;Lemma&nbsp;oplus_unary_sec_intersection'&nbsp;{X}&nbsp;(p&nbsp;q&nbsp;:&nbsp;WFT&nbsp;X)&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(C&nbsp;:&nbsp;X&nbsp;-&gt;&nbsp;X&nbsp;-&gt;&nbsp;Prop)&nbsp;(A&nbsp;B&nbsp;:&nbsp;X&nbsp;-&gt;&nbsp;Prop)&nbsp;:&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;SecureBy&nbsp;(fun&nbsp;y&nbsp;z&nbsp;=&gt;&nbsp;C&nbsp;y&nbsp;z&nbsp;\/&nbsp;A&nbsp;y)&nbsp;p&nbsp;-&gt;&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;SecureBy&nbsp;(fun&nbsp;y&nbsp;z&nbsp;=&gt;&nbsp;C&nbsp;y&nbsp;z&nbsp;\/&nbsp;B&nbsp;y)&nbsp;q&nbsp;-&gt;&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;SecureBy&nbsp;(fun&nbsp;y&nbsp;z&nbsp;=&gt;&nbsp;C&nbsp;y&nbsp;z&nbsp;\/&nbsp;(A&nbsp;y&nbsp;/\&nbsp;B&nbsp;y))&nbsp;(oplus_unary&nbsp;p&nbsp;q).&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;Proof.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;revert&nbsp;p&nbsp;q&nbsp;C;&nbsp;intros&nbsp;p&nbsp;q.&nbsp;funelim&nbsp;(oplus_unary&nbsp;p&nbsp;q);&nbsp;simpl;&nbsp;intros.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;eapply&nbsp;SecureBy_mon.&nbsp;2:eapply&nbsp;H0.&nbsp;simpl.&nbsp;firstorder.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;eapply&nbsp;SecureBy_mon;&nbsp;<span class="inlinecode">|<span class="id" title="tactic">eapply</span></span> <span class="inlinecode"><span class="id" title="var">H</span></span>.&nbsp;simpl;&nbsp;firstorder.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;eapply&nbsp;SecureBy_mon.&nbsp;2:eapply&nbsp;(oplus_nullary_sec_intersection&nbsp;_&nbsp;_&nbsp;_&nbsp;(A&nbsp;x)&nbsp;(B&nbsp;x)).&nbsp;simpl.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;intros.&nbsp;destruct&nbsp;H3;&nbsp;<span class="inlinecode">|<span class="id" title="tactic">intuition</span></span> <span class="inlinecode"><span class="id" title="tactic">auto</span></span>.&nbsp;rewrite&nbsp;&lt;-&nbsp;or_assoc.&nbsp;left.&nbsp;eapply&nbsp;H3.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;-&nbsp;simpl.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;SecureBy_mon;&nbsp;<span class="inlinecode">|<span class="id" title="tactic">eapply</span></span> <span class="inlinecode">(<span class="id" title="var">H</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">(<span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span> <span class="inlinecode"><span class="id" title="var">z</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="var">C</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span> <span class="inlinecode"><span class="id" title="var">z</span></span> <span class="inlinecode">∨</span> <span class="inlinecode"><span class="id" title="var">C</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span> <span class="inlinecode">∨</span> <span class="inlinecode"><span class="id" title="var">A</span></span> <span class="inlinecode"><span class="id" title="var">x</span>))</span>.&nbsp;simpl.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clear&nbsp;H&nbsp;H0.&nbsp;<span class="comment">(*&nbsp;BUG&nbsp;*)</span>&nbsp;intuition&nbsp;auto.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;SecureBy_mon;&nbsp;<span class="inlinecode">|<span class="id" title="tactic">eapply</span></span> <span class="inlinecode"><span class="id" title="var">H1</span></span>;&nbsp;simpl.&nbsp;intros.&nbsp;intuition&nbsp;auto.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpl.&nbsp;intros.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;SecureBy_mon;&nbsp;<span class="inlinecode">|<span class="id" title="tactic">eapply</span></span> <span class="inlinecode"><span class="id" title="var">H2</span></span>;&nbsp;simpl.&nbsp;intros.&nbsp;intuition&nbsp;auto.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;-&nbsp;simpl.&nbsp;eapply&nbsp;SecureBy_mon;&nbsp;<span class="inlinecode">|<span class="id" title="tactic">eapply</span></span> <span class="inlinecode">(<span class="id" title="var">H0</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">(<span class="id" title="keyword">fun</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span> <span class="inlinecode"><span class="id" title="var">z</span></span> <span class="inlinecode">⇒</span> <span class="inlinecode"><span class="id" title="var">C</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span> <span class="inlinecode"><span class="id" title="var">z</span></span> <span class="inlinecode">∨</span> <span class="inlinecode"><span class="id" title="var">C</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span> <span class="inlinecode">∨</span> <span class="inlinecode"><span class="id" title="var">B</span></span> <span class="inlinecode"><span class="id" title="var">x</span>))</span>;&nbsp;simpl.&nbsp;intuition&nbsp;auto.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intuition.&nbsp;simpl&nbsp;in&nbsp;H2.&nbsp;eapply&nbsp;SecureBy_mon;&nbsp;<span class="inlinecode">|<span class="id" title="tactic">eapply</span></span> <span class="inlinecode"><span class="id" title="var">H1</span></span>;&nbsp;simpl.&nbsp;intuition&nbsp;auto.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;SecureBy_mon;&nbsp;<span class="inlinecode">|<span class="id" title="tactic">eapply</span></span> <span class="inlinecode"><span class="id" title="var">H2</span></span>;&nbsp;simpl.&nbsp;intros.&nbsp;intuition&nbsp;auto.&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;Qed.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">af_bool</span> : <span class="id" title="var">AlmostFull</span> (@<span class="id" title="var">eq</span> <span class="id" title="var">bool</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (<span class="id" title="var">SUP</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">SUP</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">ZT</span>))).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> <span class="id" title="var">w</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span>, <span class="id" title="var">y</span>, <span class="id" title="var">z</span>, <span class="id" title="var">w</span>; <span class="id" title="tactic">intuition</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">product_rel</span> {<span class="id" title="var">X</span> <span class="id" title="var">Y</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">A</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>) (<span class="id" title="var">B</span> : <span class="id" title="var">Y</span> → <span class="id" title="var">Y</span> → <span class="id" title="keyword">Prop</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> ⇒ <span class="id" title="var">A</span> (<span class="id" title="var">fst</span> <span class="id" title="var">x</span>) (<span class="id" title="var">fst</span> <span class="id" title="var">y</span>) ∧ <span class="id" title="var">B</span> (<span class="id" title="var">snd</span> <span class="id" title="var">x</span>) (<span class="id" title="var">snd</span> <span class="id" title="var">y</span>).<br/>

<br/>
#[<span class="id" title="var">export</span>] <span class="id" title="keyword">Instance</span> <span class="id" title="var">af_product</span> {<span class="id" title="var">X</span> <span class="id" title="var">Y</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">A</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>) (<span class="id" title="var">B</span> : <span class="id" title="var">Y</span> → <span class="id" title="var">Y</span> → <span class="id" title="keyword">Prop</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">AlmostFull</span> <span class="id" title="var">A</span> → <span class="id" title="var">AlmostFull</span> <span class="id" title="var">B</span> → <span class="id" title="var">AlmostFull</span> (<span class="id" title="var">product_rel</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">pose</span> (<span class="id" title="var">af_interesection</span> (<span class="id" title="var">Wf.MR</span> <span class="id" title="var">A</span> <span class="id" title="var">fst</span>) (<span class="id" title="var">Wf.MR</span> <span class="id" title="var">B</span> <span class="id" title="var">snd</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">relation_equivalence</span> (<span class="id" title="var">inter_rel</span> (<span class="id" title="var">Wf.MR</span> <span class="id" title="var">A</span> <span class="id" title="var">fst</span>) (<span class="id" title="var">Wf.MR</span> <span class="id" title="var">B</span> <span class="id" title="var">snd</span>)) (<span class="id" title="var">product_rel</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">red</span>; <span class="id" title="tactic">intuition</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">a</span>; <span class="id" title="var">typeclasses</span> <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">T</span> (<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">nat</span> × <span class="id" title="var">nat</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;(<span class="id" title="var">fst</span> <span class="id" title="var">x</span> = <span class="id" title="var">snd</span> <span class="id" title="var">y</span> ∧ <span class="id" title="var">snd</span> <span class="id" title="var">x</span> &lt; <span class="id" title="var">snd</span> <span class="id" title="var">y</span>) ∨<br/>
&nbsp;&nbsp;(<span class="id" title="var">fst</span> <span class="id" title="var">x</span> = <span class="id" title="var">snd</span> <span class="id" title="var">y</span> ∧ <span class="id" title="var">snd</span> <span class="id" title="var">x</span> &lt; <span class="id" title="var">fst</span> <span class="id" title="var">y</span>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">Tl</span> (<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">nat</span> × (<span class="id" title="var">nat</span> × <span class="id" title="var">unit</span>)) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;(<span class="id" title="var">fst</span> <span class="id" title="var">x</span> = <span class="id" title="var">fst</span> (<span class="id" title="var">snd</span> <span class="id" title="var">y</span>) ∧ <span class="id" title="var">fst</span> (<span class="id" title="var">snd</span> <span class="id" title="var">x</span>) &lt; <span class="id" title="var">fst</span> (<span class="id" title="var">snd</span> <span class="id" title="var">y</span>)).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">Tr</span> (<span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">nat</span> × (<span class="id" title="var">nat</span> × <span class="id" title="var">unit</span>)) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;(<span class="id" title="var">fst</span> <span class="id" title="var">x</span> = <span class="id" title="var">fst</span> (<span class="id" title="var">snd</span> <span class="id" title="var">y</span>) ∧ <span class="id" title="var">fst</span> (<span class="id" title="var">snd</span> <span class="id" title="var">x</span>) &lt; <span class="id" title="var">fst</span> <span class="id" title="var">y</span>).<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">destruct_pairs</span> := <span class="id" title="tactic">repeat</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;[ <span class="id" title="var">x</span> : <span class="id" title="var">_</span> × <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> ] ⇒ <span class="id" title="keyword">let</span> <span class="id" title="var">x0</span> := <span class="id" title="tactic">fresh</span> <span class="id" title="var">x</span> <span class="id" title="tactic">in</span> <span class="id" title="keyword">let</span> <span class="id" title="var">x1</span> := <span class="id" title="tactic">fresh</span> <span class="id" title="var">x</span> <span class="id" title="tactic">in</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">x0</span> <span class="id" title="var">x1</span>]; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> ×<br/>
&nbsp;&nbsp;| [ <span class="id" title="var">x</span> : <span class="id" title="tactic">∃</span> <span class="id" title="var">_</span> : <span class="id" title="var">_</span>, <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> ] ⇒ <span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;| [ <span class="id" title="var">x</span> : <span class="id" title="var">_</span> ∧ <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> ] ⇒ <span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Stdlib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">ssreflect</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">SCT</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">subgraph</span> <span class="id" title="var">k</span> <span class="id" title="var">k'</span> := <span class="id" title="var">fin</span> <span class="id" title="var">k</span> → <span class="id" title="var">option</span> (<span class="id" title="var">bool</span> × <span class="id" title="var">fin</span> <span class="id" title="var">k'</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">graph</span> <span class="id" title="var">k</span> := <span class="id" title="var">subgraph</span> <span class="id" title="var">k</span> <span class="id" title="var">k</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">strict</span> {<span class="id" title="var">k</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">fin</span> <span class="id" title="var">k</span>) := <span class="id" title="var">Some</span> (<span class="id" title="var">true</span>, <span class="id" title="var">f</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">large</span> {<span class="id" title="var">k</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">fin</span> <span class="id" title="var">k</span>) := <span class="id" title="var">Some</span> (<span class="id" title="var">false</span>, <span class="id" title="var">f</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Declare Scope</span> <span class="id" title="var">fin_scope</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Delimit</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">fin_scope</span> <span class="id" title="keyword">with</span> <span class="id" title="var">fin</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Bind Scope</span> <span class="id" title="var">fin_scope</span> <span class="id" title="keyword">with</span> <span class="id" title="var">fin</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> &quot;0" := <span class="id" title="var">fz</span> : <span class="id" title="var">fin_scope</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> &quot;1" := (<span class="id" title="var">fs</span> 0) : <span class="id" title="var">fin_scope</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">fin_scope</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;bug&nbsp;scopes&nbsp;not&nbsp;handled&nbsp;well&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">T_graph_l</span> (<span class="id" title="var">x</span> : <span class="id" title="var">fin</span> 2) : <span class="id" title="var">option</span> (<span class="id" title="var">bool</span> × <span class="id" title="var">fin</span> 2) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">T_graph_l</span> <span class="id" title="var">fz</span> := <span class="id" title="var">large</span> (<span class="id" title="var">fs</span> <span class="id" title="var">fz</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">T_graph_l</span> (<span class="id" title="var">fs</span> <span class="id" title="var">fz</span>) := <span class="id" title="var">strict</span> (<span class="id" title="var">fs</span> <span class="id" title="var">fz</span>) }.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">T_graph_r</span> (<span class="id" title="var">x</span> : <span class="id" title="var">fin</span> 2) : <span class="id" title="var">option</span> (<span class="id" title="var">bool</span> × <span class="id" title="var">fin</span> 2) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">T_graph_r</span> <span class="id" title="var">fz</span> := <span class="id" title="var">large</span> (<span class="id" title="var">fs</span> <span class="id" title="var">fz</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">T_graph_r</span> (<span class="id" title="var">fs</span> <span class="id" title="var">fz</span>) := <span class="id" title="var">strict</span> <span class="id" title="var">fz</span> }.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">graph_compose</span> {<span class="id" title="var">k</span>} (<span class="id" title="var">g1</span> <span class="id" title="var">g2</span> : <span class="id" title="var">graph</span> <span class="id" title="var">k</span>) : <span class="id" title="var">graph</span> <span class="id" title="var">k</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">graph_compose</span> <span class="id" title="var">g1</span> <span class="id" title="var">g2</span> <span class="id" title="var">arg0</span> <span class="id" title="keyword">with</span> <span class="id" title="var">g1</span> <span class="id" title="var">arg0</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ | <span class="id" title="var">Some</span> (<span class="id" title="var">weight</span>, <span class="id" title="var">arg1</span>) <span class="id" title="keyword">with</span> <span class="id" title="var">g2</span> <span class="id" title="var">arg1</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ | <span class="id" title="var">Some</span> (<span class="id" title="var">weight'</span>, <span class="id" title="var">arg2</span>) ⇒ <span class="id" title="var">Some</span> (<span class="id" title="var">weight</span> || <span class="id" title="var">weight'</span>, <span class="id" title="var">arg2</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">None</span> ⇒ <span class="id" title="var">None</span> };<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">None</span> ⇒ <span class="id" title="var">None</span> }.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Infix</span> &quot;⋅" := <span class="id" title="var">graph_compose</span> (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 90).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Eval</span> <span class="id" title="tactic">compute</span> <span class="id" title="tactic">in</span> (<span class="id" title="var">T_graph_l</span> ⋅ <span class="id" title="var">T_graph_r</span>) <span class="id" title="var">fz</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">k_tuple_type</span> (<span class="id" title="var">k</span> : <span class="id" title="var">nat</span>) : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">k_tuple_type</span> 0 := <span class="id" title="var">unit</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">k_tuple_type</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>) := <span class="id" title="var">nat</span> × <span class="id" title="var">k_tuple_type</span> <span class="id" title="var">n</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">k_tuple_val</span> {<span class="id" title="var">k</span> : <span class="id" title="var">nat</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">fin</span> <span class="id" title="var">k</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">k_tuple_type</span> <span class="id" title="var">k</span>) : <span class="id" title="var">nat</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">k_tuple_val</span> <span class="id" title="var">fz</span> (<span class="id" title="var">x</span>, <span class="id" title="var">_</span>) := <span class="id" title="var">x</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">k_tuple_val</span> (<span class="id" title="var">fs</span> <span class="id" title="var">f</span>) (<span class="id" title="var">_</span>, <span class="id" title="var">t</span>) := <span class="id" title="var">k_tuple_val</span> <span class="id" title="var">f</span> <span class="id" title="var">t</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">k_related</span> (<span class="id" title="var">k</span> <span class="id" title="var">k'</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">G</span> : <span class="id" title="var">subgraph</span> <span class="id" title="var">k</span> <span class="id" title="var">k'</span>) : <span class="id" title="var">k_tuple_type</span> <span class="id" title="var">k</span> → <span class="id" title="var">k_tuple_type</span> <span class="id" title="var">k'</span> → <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">k_related</span> 0 <span class="id" title="var">k'</span> <span class="id" title="var">g</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">True</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">k_related</span> (<span class="id" title="var">S</span> <span class="id" title="var">k</span>) <span class="id" title="var">k'</span> <span class="id" title="var">g</span> <span class="id" title="keyword">with</span> <span class="id" title="var">g</span> <span class="id" title="var">fz</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ | <span class="id" title="var">Some</span> (<span class="id" title="var">weight</span>, <span class="id" title="var">d</span>) := <span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">if</span> <span class="id" title="var">weight</span> <span class="id" title="keyword">then</span> <span class="id" title="var">k_tuple_val</span> <span class="id" title="var">fz</span> <span class="id" title="var">x</span> &lt; <span class="id" title="var">k_tuple_val</span> <span class="id" title="var">d</span> <span class="id" title="var">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> (<span class="id" title="var">Peano.le</span> (<span class="id" title="var">k_tuple_val</span> <span class="id" title="var">fz</span> <span class="id" title="var">x</span>) (<span class="id" title="var">k_tuple_val</span> <span class="id" title="var">d</span> <span class="id" title="var">y</span>))) ∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">k_related</span> <span class="id" title="var">k</span> <span class="id" title="var">k'</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">f</span> ⇒ <span class="id" title="var">g</span> (<span class="id" title="var">fs</span> <span class="id" title="var">f</span>)) (<span class="id" title="var">snd</span> <span class="id" title="var">x</span>) <span class="id" title="var">y</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">None</span> ⇒ <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">False</span> }.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">graph_relation</span> {<span class="id" title="var">k</span> : <span class="id" title="var">nat</span>} (<span class="id" title="var">G</span> : <span class="id" title="var">graph</span> <span class="id" title="var">k</span>) : <span class="id" title="var">relation</span> (<span class="id" title="var">k_tuple_type</span> <span class="id" title="var">k</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">k_related</span> <span class="id" title="var">k</span> <span class="id" title="var">k</span> <span class="id" title="var">G</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">k_related_spec</span> {<span class="id" title="var">k</span> <span class="id" title="var">k'</span> : <span class="id" title="var">nat</span>} (<span class="id" title="var">G</span> : <span class="id" title="var">subgraph</span> <span class="id" title="var">k</span> <span class="id" title="var">k'</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>, <span class="id" title="var">k_related</span> <span class="id" title="var">k</span> <span class="id" title="var">k'</span> <span class="id" title="var">G</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> ↔<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">f</span> : <span class="id" title="var">fin</span> <span class="id" title="var">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">G</span> <span class="id" title="var">f</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> (<span class="id" title="var">weight</span>, <span class="id" title="var">d</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">weight</span> <span class="id" title="keyword">then</span> <span class="id" title="var">k_tuple_val</span> <span class="id" title="var">f</span> <span class="id" title="var">x</span> &lt; <span class="id" title="var">k_tuple_val</span> <span class="id" title="var">d</span> <span class="id" title="var">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">Peano.le</span> (<span class="id" title="var">k_tuple_val</span> <span class="id" title="var">f</span> <span class="id" title="var">x</span>) (<span class="id" title="var">k_tuple_val</span> <span class="id" title="var">d</span> <span class="id" title="var">y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">None</span> ⇒ <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">k_related_elim</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">intros</span> []. <span class="id" title="tactic">intros</span> <span class="id" title="var">f</span>. <span class="id" title="var">depelim</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">k''</span> <span class="id" title="var">g</span> <span class="id" title="var">b</span> <span class="id" title="var">f</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">gz</span> [<span class="id" title="var">x</span> <span class="id" title="var">rx</span>] <span class="id" title="var">y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> (<span class="id" title="var">x</span>, <span class="id" title="var">rx</span>) <span class="id" title="var">y</span> <span class="id" title="var">rx</span> <span class="id" title="var">y</span>). <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span> [<span class="id" title="var">xlt</span> <span class="id" title="var">relr</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">f'</span>. <span class="id" title="var">depelim</span> <span class="id" title="var">f'</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">gz</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">xlt</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">relr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span> <span class="id" title="var">Hf</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hf</span> <span class="id" title="var">fz</span>). <span class="id" title="tactic">rewrite</span> <span class="id" title="var">gz</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hf</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Hf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">f'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Hf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">k''</span> <span class="id" title="var">g</span> <span class="id" title="var">gf</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="tactic">intros</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">f</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">f</span> <span class="id" title="var">fz</span>). <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">gf</span> <span class="id" title="tactic">in</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">graph_relation_spec</span> {<span class="id" title="var">k</span> : <span class="id" title="var">nat</span>} (<span class="id" title="var">G</span> : <span class="id" title="var">graph</span> <span class="id" title="var">k</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>, <span class="id" title="var">graph_relation</span> <span class="id" title="var">G</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> ↔<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">f</span> : <span class="id" title="var">fin</span> <span class="id" title="var">k</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">G</span> <span class="id" title="var">f</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> (<span class="id" title="var">weight</span>, <span class="id" title="var">d</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">weight</span> <span class="id" title="keyword">then</span> <span class="id" title="var">k_tuple_val</span> <span class="id" title="var">f</span> <span class="id" title="var">x</span> &lt; <span class="id" title="var">k_tuple_val</span> <span class="id" title="var">d</span> <span class="id" title="var">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">Peano.le</span> (<span class="id" title="var">k_tuple_val</span> <span class="id" title="var">f</span> <span class="id" title="var">x</span>) (<span class="id" title="var">k_tuple_val</span> <span class="id" title="var">d</span> <span class="id" title="var">y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">None</span> ⇒ <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">graph_relation</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">k_related_spec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">approximates</span> {<span class="id" title="var">k</span>} (<span class="id" title="var">G</span> : <span class="id" title="var">graph</span> <span class="id" title="var">k</span>) (<span class="id" title="var">R</span> : <span class="id" title="var">relation</span> (<span class="id" title="var">k_tuple_type</span> <span class="id" title="var">k</span>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inclusion</span> <span class="id" title="var">_</span> <span class="id" title="var">R</span> (<span class="id" title="var">graph_relation</span> <span class="id" title="var">G</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Eval</span> <span class="id" title="tactic">compute</span> <span class="id" title="tactic">in</span> <span class="id" title="var">k_tuple_type</span> 2.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Example</span> <span class="id" title="var">approximates_T_l</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" title="var">approximates</span> 2 <span class="id" title="var">T_graph_l</span> <span class="id" title="var">Tl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">Tlr</span>. <span class="id" title="tactic">red</span> <span class="id" title="tactic">in</span> <span class="id" title="var">x</span>, <span class="id" title="var">y</span>, <span class="id" title="var">Tlr</span>. <span class="id" title="var">destruct_pairs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">graph_relation</span>. <span class="id" title="var">simp</span> <span class="id" title="var">k_related</span> <span class="id" title="var">T_graph_l</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Example</span> <span class="id" title="var">approximates_T_r</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" title="var">approximates</span> 2 <span class="id" title="var">T_graph_r</span> <span class="id" title="var">Tr</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">Tlr</span>. <span class="id" title="tactic">red</span> <span class="id" title="tactic">in</span> <span class="id" title="var">x</span>, <span class="id" title="var">y</span>, <span class="id" title="var">Tlr</span>. <span class="id" title="var">destruct_pairs</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">graph_relation</span>. <span class="id" title="var">simp</span> <span class="id" title="var">k_related</span> <span class="id" title="var">T_graph_l</span>; <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">compose_approximates</span> {<span class="id" title="var">k</span>} (<span class="id" title="var">G0</span> <span class="id" title="var">G1</span> : <span class="id" title="var">graph</span> <span class="id" title="var">k</span>) (<span class="id" title="var">R0</span> <span class="id" title="var">R1</span> : <span class="id" title="var">relation</span> (<span class="id" title="var">k_tuple_type</span> <span class="id" title="var">k</span>)) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">approximates</span> <span class="id" title="var">G0</span> <span class="id" title="var">R0</span> → <span class="id" title="var">approximates</span> <span class="id" title="var">G1</span> <span class="id" title="var">R1</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">approximates</span> (<span class="id" title="var">G0</span> ⋅ <span class="id" title="var">G1</span>) (<span class="id" title="var">compose_rel</span> <span class="id" title="var">R0</span> <span class="id" title="var">R1</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">approximates</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">ag0</span> <span class="id" title="var">ag1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">z</span> [<span class="id" title="var">y</span> [<span class="id" title="var">Hxy</span> <span class="id" title="var">Hyz</span>]]. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">graph_relation_spec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">f</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">ag0</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Hxy</span>). <span class="id" title="tactic">specialize</span> (<span class="id" title="var">ag1</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Hyz</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> → <span class="id" title="var">graph_relation_spec</span> <span class="id" title="tactic">in</span> <span class="id" title="var">ag0</span>, <span class="id" title="var">ag1</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">ag0</span> <span class="id" title="var">f</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">funelim</span> (<span class="id" title="var">graph_compose</span> <span class="id" title="var">G0</span> <span class="id" title="var">G1</span> <span class="id" title="var">f</span>). <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">ag0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">ag0</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">ag1</span> <span class="id" title="var">arg1</span>). <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">ag1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">weight</span>, <span class="id" title="var">weight'</span>; <span class="id" title="tactic">simpl</span>;  <span class="id" title="tactic">try</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">ag1</span> <span class="id" title="var">arg1</span>). <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">ag1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">fin_union</span> {<span class="id" title="var">A</span> <span class="id" title="var">n</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">fin</span> <span class="id" title="var">n</span> → <span class="id" title="var">relation</span> <span class="id" title="var">A</span>) : <span class="id" title="var">relation</span> <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fin_union</span> (<span class="id" title="var">n</span>:=0)   <span class="id" title="var">f</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">False</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fin_union</span> (<span class="id" title="var">n</span>:=<span class="id" title="var">S</span> <span class="id" title="var">n</span>) <span class="id" title="var">f</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> ⇒ <span class="id" title="var">f</span> <span class="id" title="var">fz</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> ∨ <span class="id" title="var">fin_union</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">f'</span> ⇒ <span class="id" title="var">f</span> (<span class="id" title="var">fs</span> <span class="id" title="var">f'</span>)) <span class="id" title="var">x</span> <span class="id" title="var">y</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fin_union_spec</span> {<span class="id" title="var">A</span> <span class="id" title="var">n</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">fin</span> <span class="id" title="var">n</span> → <span class="id" title="var">relation</span> <span class="id" title="var">A</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>, <span class="id" title="var">fin_union</span> <span class="id" title="var">f</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> ↔ <span class="id" title="tactic">∃</span> <span class="id" title="var">k</span>, <span class="id" title="var">f</span> <span class="id" title="var">k</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>. <span class="id" title="var">funelim</span> (<span class="id" title="var">fin_union</span> <span class="id" title="var">f</span>). <span class="id" title="tactic">split</span>. <span class="id" title="tactic">intros</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">k</span> <span class="id" title="var">_</span>]. <span class="id" title="var">depelim</span> <span class="id" title="var">k</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="tactic">intros</span> [<span class="id" title="var">Hfz</span>|<span class="id" title="var">Hfs</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">∃</span> <span class="id" title="var">fz</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>). <span class="id" title="tactic">rewrite</span> → <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hfs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Hfs</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">∃</span> (<span class="id" title="var">fs</span> <span class="id" title="var">x0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">k</span> <span class="id" title="var">Hk</span>]. <span class="id" title="var">depelim</span> <span class="id" title="var">k</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">left</span>. <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">H</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>). <span class="id" title="var">now</span> <span class="id" title="tactic">∃</span> <span class="id" title="var">k</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">fin_all</span> <span class="id" title="var">k</span> (<span class="id" title="var">p</span> : <span class="id" title="var">fin</span> <span class="id" title="var">k</span> → <span class="id" title="var">bool</span>) : <span class="id" title="var">bool</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fin_all</span> 0     <span class="id" title="var">_</span> := <span class="id" title="var">true</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fin_all</span> (<span class="id" title="var">S</span> <span class="id" title="var">k</span>) <span class="id" title="var">p</span> := <span class="id" title="var">p</span> <span class="id" title="var">fz</span> &amp;&amp; <span class="id" title="var">fin_all</span> <span class="id" title="var">k</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">f</span> ⇒ <span class="id" title="var">p</span> (<span class="id" title="var">fs</span> <span class="id" title="var">f</span>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fin_all_spec</span> <span class="id" title="var">k</span> (<span class="id" title="var">p</span> : <span class="id" title="var">fin</span> <span class="id" title="var">k</span> → <span class="id" title="var">bool</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">reflect</span> (<span class="id" title="keyword">∀</span> <span class="id" title="var">f</span>, <span class="id" title="var">p</span> <span class="id" title="var">f</span> = <span class="id" title="var">true</span>) (<span class="id" title="var">fin_all</span> <span class="id" title="var">k</span> <span class="id" title="var">p</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">k</span>; <span class="id" title="var">simp</span> <span class="id" title="var">fin_all</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">f</span>; <span class="id" title="var">depelim</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">p</span> <span class="id" title="var">fz</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">pfz</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHk</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">f</span> ⇒ <span class="id" title="var">p</span> (<span class="id" title="var">fs</span> <span class="id" title="var">f</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IHk</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">IHk</span>; <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">f</span>; <span class="id" title="var">depelim</span> <span class="id" title="var">f</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">Hf</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">n</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">f'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Hf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">fz</span>). <span class="id" title="tactic">rewrite</span> <span class="id" title="var">pfz</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">graph_eq</span> {<span class="id" title="var">k</span>} (<span class="id" title="var">g</span> <span class="id" title="var">g'</span> : <span class="id" title="var">graph</span> <span class="id" title="var">k</span>) : <span class="id" title="var">bool</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fin_all</span> <span class="id" title="var">k</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">f</span> ⇒ <span class="id" title="var">eqb</span> (<span class="id" title="var">g</span> <span class="id" title="var">f</span>) (<span class="id" title="var">g'</span> <span class="id" title="var">f</span>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">power_graph_n</span> {<span class="id" title="var">k</span>} (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">graph</span> <span class="id" title="var">k</span>) : <span class="id" title="var">graph</span> <span class="id" title="var">k</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">power_graph_n</span> 0 <span class="id" title="var">g</span> := <span class="id" title="var">g</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">power_graph_n</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>) <span class="id" title="var">g</span> := <span class="id" title="var">power_graph_n</span> <span class="id" title="var">n</span> <span class="id" title="var">g</span> ⋅ <span class="id" title="var">g</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">approximates_power</span> {<span class="id" title="var">k</span>} (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">graph</span> <span class="id" title="var">k</span>) <span class="id" title="var">T</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">approximates</span> <span class="id" title="var">g</span> <span class="id" title="var">T</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">approximates</span> (<span class="id" title="var">power_graph_n</span> <span class="id" title="var">n</span> <span class="id" title="var">g</span>) (<span class="id" title="var">power</span> <span class="id" title="var">n</span> <span class="id" title="var">T</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">n</span>; <span class="id" title="var">simp</span> <span class="id" title="var">power</span> <span class="id" title="var">power_graph_n</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHn</span> <span class="id" title="var">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">compose_approximates</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">list_union</span> {<span class="id" title="var">A</span>} (<span class="id" title="var">rs</span> : <span class="id" title="var">list</span> (<span class="id" title="var">relation</span> <span class="id" title="var">A</span>)) : <span class="id" title="var">relation</span> <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">list_union</span> <span class="id" title="var">nil</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">False</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">list_union</span> (<span class="id" title="var">cons</span> <span class="id" title="var">r</span> <span class="id" title="var">rs</span>) := <span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> ⇒ <span class="id" title="var">r</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> ∨ <span class="id" title="var">list_union</span> <span class="id" title="var">rs</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">approximates_family</span> {<span class="id" title="var">k</span>} (<span class="id" title="var">graphs</span> : <span class="id" title="var">list</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>)) (<span class="id" title="var">R</span> : <span class="id" title="var">relation</span> (<span class="id" title="var">k_tuple_type</span> <span class="id" title="var">k</span>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inclusion</span> <span class="id" title="var">_</span> <span class="id" title="var">R</span> (<span class="id" title="var">list_union</span> (<span class="id" title="var">List.map</span> <span class="id" title="var">graph_relation</span> <span class="id" title="var">graphs</span>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">fin_all_compose</span> {<span class="id" title="var">k</span> <span class="id" title="var">n</span>} (<span class="id" title="var">g</span> : <span class="id" title="var">graph</span> <span class="id" title="var">k</span>) (<span class="id" title="var">p</span> : <span class="id" title="var">fin</span> <span class="id" title="var">n</span> → <span class="id" title="var">graph</span> <span class="id" title="var">k</span>) : <span class="id" title="var">fin</span> <span class="id" title="var">n</span> → <span class="id" title="var">graph</span> <span class="id" title="var">k</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fin_all_compose</span> <span class="id" title="var">g</span> <span class="id" title="var">p</span> <span class="id" title="var">f</span> := <span class="id" title="var">p</span> <span class="id" title="var">f</span> ⋅ <span class="id" title="var">g</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">compose_family</span> {<span class="id" title="var">k</span>} (<span class="id" title="var">g</span> : <span class="id" title="var">list</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>)) (<span class="id" title="var">g'</span> : <span class="id" title="var">list</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>)) : <span class="id" title="var">list</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">compose_family</span> <span class="id" title="var">nil</span> <span class="id" title="var">_</span> := <span class="id" title="var">nil</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">compose_family</span> (<span class="id" title="var">cons</span> <span class="id" title="var">g</span> <span class="id" title="var">gs</span>) <span class="id" title="var">g'</span> := <span class="id" title="var">app</span> (<span class="id" title="var">map</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">g'</span> ⇒ <span class="id" title="var">g</span> ⋅ <span class="id" title="var">g'</span>) <span class="id" title="var">g'</span>) (<span class="id" title="var">compose_family</span> <span class="id" title="var">gs</span> <span class="id" title="var">g'</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">is_transitive_closure</span> {<span class="id" title="var">k</span>} (<span class="id" title="var">gs</span> : <span class="id" title="var">list</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>)) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>)) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">g</span>, <span class="id" title="var">In</span> <span class="id" title="var">g</span> <span class="id" title="var">gs</span> → <span class="id" title="var">In</span> <span class="id" title="var">g</span> <span class="id" title="var">l</span>) ∧ <span class="id" title="keyword">∀</span> <span class="id" title="var">g</span> <span class="id" title="var">g'</span>, <span class="id" title="var">In</span> <span class="id" title="var">g</span> <span class="id" title="var">l</span> ∧ <span class="id" title="var">In</span> <span class="id" title="var">g'</span> <span class="id" title="var">l</span> → <span class="id" title="var">In</span> (<span class="id" title="var">g</span> ⋅ <span class="id" title="var">g'</span>) <span class="id" title="var">l</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">graphs_relation</span> {<span class="id" title="var">k</span>} (<span class="id" title="var">gs</span> : <span class="id" title="var">list</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>)) : <span class="id" title="var">relation</span> (<span class="id" title="var">k_tuple_type</span> <span class="id" title="var">k</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">list_union</span> (<span class="id" title="var">map</span> <span class="id" title="var">graph_relation</span> <span class="id" title="var">gs</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">list_union_app</span> {<span class="id" title="var">A</span>} (<span class="id" title="var">rs</span> <span class="id" title="var">rs'</span> : <span class="id" title="var">list</span> (<span class="id" title="var">relation</span> <span class="id" title="var">A</span>)) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>, <span class="id" title="var">list_union</span> (<span class="id" title="var">rs</span> ++ <span class="id" title="var">rs'</span>) <span class="id" title="var">x</span> <span class="id" title="var">y</span> ↔ <span class="id" title="var">list_union</span> <span class="id" title="var">rs</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> ∨ <span class="id" title="var">list_union</span> <span class="id" title="var">rs'</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">rs</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="var">simp</span> <span class="id" title="var">list_union</span>; <span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> → <span class="id" title="var">IHrs</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">map_k_tuple</span> <span class="id" title="var">k</span> (<span class="id" title="var">p</span> : <span class="id" title="var">k_tuple_type</span> <span class="id" title="var">k</span>) (<span class="id" title="var">f</span> : <span class="id" title="var">fin</span> <span class="id" title="var">k</span> → <span class="id" title="var">nat</span>) : <span class="id" title="var">k_tuple_type</span> <span class="id" title="var">k</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">map_k_tuple</span> 0 <span class="id" title="var">p</span> <span class="id" title="var">f</span> := <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">map_k_tuple</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>) (<span class="id" title="var">x</span>, <span class="id" title="var">xs</span>) <span class="id" title="var">f</span> := (<span class="id" title="var">f</span> <span class="id" title="var">fz</span>, <span class="id" title="var">map_k_tuple</span> <span class="id" title="var">n</span> <span class="id" title="var">xs</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">i</span> ⇒ <span class="id" title="var">f</span> (<span class="id" title="var">fs</span> <span class="id" title="var">i</span>))).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">graph_relation_compose</span> {<span class="id" title="var">k</span>} <span class="id" title="var">x</span> <span class="id" title="var">y</span> (<span class="id" title="var">g</span> <span class="id" title="var">g'</span> : <span class="id" title="var">graph</span> <span class="id" title="var">k</span>) <span class="id" title="var">z</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">graph_relation</span> <span class="id" title="var">g</span> <span class="id" title="var">x</span> <span class="id" title="var">z</span> → <span class="id" title="var">graph_relation</span> <span class="id" title="var">g'</span> <span class="id" title="var">z</span> <span class="id" title="var">y</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">graph_relation</span> (<span class="id" title="var">g</span> ⋅ <span class="id" title="var">g'</span>) <span class="id" title="var">x</span> <span class="id" title="var">y</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">gzx</span> <span class="id" title="var">g'zy</span>. <span class="id" title="tactic">rewrite</span> → <span class="id" title="var">graph_relation_spec</span> <span class="id" title="tactic">in</span> <span class="id" title="var">gzx</span>, <span class="id" title="var">g'zy</span> |- ×. <span class="id" title="tactic">intros</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">gzx</span> <span class="id" title="var">f</span>). <span class="id" title="var">simp</span> <span class="id" title="var">graph_compose</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">g</span> <span class="id" title="var">f</span>) <span class="id" title="keyword">as</span> [[[] <span class="id" title="var">d</span>]|];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">g'zy</span> <span class="id" title="var">d</span>); <span class="id" title="tactic">destruct</span> (<span class="id" title="var">g'</span> <span class="id" title="var">d</span>) <span class="id" title="keyword">as</span> [[[] <span class="id" title="var">d'</span>]|]; <span class="id" title="var">simp</span> <span class="id" title="var">graph_compose</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>; <span class="id" title="var">lia</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">g'zy</span> <span class="id" title="var">d</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">g'</span> <span class="id" title="var">d</span>) <span class="id" title="keyword">as</span> [[[] <span class="id" title="var">d'</span>]|]; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> ×. <span class="id" title="var">lia</span>. <span class="id" title="var">lia</span>. <span class="id" title="var">lia</span>. <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">union_graph_relation_compose</span> {<span class="id" title="var">k</span>} <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">a</span> (<span class="id" title="var">g</span> : <span class="id" title="var">list</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>)) <span class="id" title="var">z</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">graph_relation</span> <span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">z</span> → <span class="id" title="var">list_union</span> (<span class="id" title="var">map</span> <span class="id" title="var">graph_relation</span> <span class="id" title="var">g</span>) <span class="id" title="var">z</span> <span class="id" title="var">y</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">list_union</span> (<span class="id" title="var">map</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> ⇒ <span class="id" title="var">graph_relation</span> (<span class="id" title="var">a</span> ⋅ <span class="id" title="var">x</span>)) <span class="id" title="var">g</span>) <span class="id" title="var">x</span> <span class="id" title="var">y</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">g</span>; <span class="id" title="tactic">simpl</span>. 1:<span class="id" title="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Hxz</span> <span class="id" title="var">Hzy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Hzy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">graph_relation_compose</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">a</span> <span class="id" title="var">a0</span>). <span class="id" title="tactic">left</span>; <span class="id" title="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">graphs_relation_compose</span> {<span class="id" title="var">k</span>} (<span class="id" title="var">g</span> <span class="id" title="var">g'</span> : <span class="id" title="var">list</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>)) <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">graphs_relation</span> <span class="id" title="var">g</span> <span class="id" title="var">x</span> <span class="id" title="var">z</span> → <span class="id" title="var">graphs_relation</span> <span class="id" title="var">g'</span> <span class="id" title="var">z</span> <span class="id" title="var">y</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">graphs_relation</span> (<span class="id" title="var">compose_family</span> <span class="id" title="var">g</span> <span class="id" title="var">g'</span>) <span class="id" title="var">x</span> <span class="id" title="var">y</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">gxz</span> <span class="id" title="var">gzy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">g</span> <span class="id" title="tactic">in</span> <span class="id" title="var">g'</span>, <span class="id" title="var">x</span>, <span class="id" title="var">y</span>, <span class="id" title="var">z</span>, <span class="id" title="var">gxz</span>, <span class="id" title="var">gzy</span> |- *; <span class="id" title="var">simp</span> <span class="id" title="var">compose_family</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">graphs_relation</span> <span class="id" title="tactic">in</span> <span class="id" title="var">gxz</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">gxz</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">gxz</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">graphs_relation</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">compose_family</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> → <span class="id" title="var">map_app</span>, <span class="id" title="var">map_map</span>, <span class="id" title="var">list_union_app</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">union_graph_relation_compose</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">z</span> <span class="id" title="var">H</span> <span class="id" title="var">gzy</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHg</span> <span class="id" title="var">g'</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> <span class="id" title="var">H</span> <span class="id" title="var">gzy</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">graphs_relation</span>. <span class="id" title="tactic">rewrite</span> → <span class="id" title="var">map_app</span>, <span class="id" title="var">map_map</span>, <span class="id" title="var">list_union_app</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">right</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">in_transitive_closure</span> {<span class="id" title="var">k</span>} (<span class="id" title="var">g</span> : <span class="id" title="var">list</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>)) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">T</span> : <span class="id" title="var">relation</span> (<span class="id" title="var">k_tuple_type</span> <span class="id" title="var">k</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">approx</span> : <span class="id" title="var">approximates_family</span> <span class="id" title="var">g</span> <span class="id" title="var">T</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">is_transitive_closure</span> <span class="id" title="var">g</span> <span class="id" title="var">l</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">i</span>,  <span class="id" title="tactic">∃</span> <span class="id" title="var">fam</span> : <span class="id" title="var">list</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">g</span>, <span class="id" title="var">In</span> <span class="id" title="var">g</span> <span class="id" title="var">fam</span> → <span class="id" title="var">In</span> <span class="id" title="var">g</span> <span class="id" title="var">l</span>) ∧ <span class="id" title="var">approximates_family</span> <span class="id" title="var">fam</span> (<span class="id" title="var">power</span> <span class="id" title="var">i</span> <span class="id" title="var">T</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">is_transitive_closure</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">inS</span> <span class="id" title="var">inScomp</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;assert&nbsp;(exists&nbsp;G,&nbsp;approximates&nbsp;G&nbsp;(power&nbsp;i&nbsp;(fin_union&nbsp;T))&nbsp;/\&nbsp;In&nbsp;G&nbsp;l).&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">i</span> <span class="id" title="tactic">in</span> |- *; <span class="id" title="var">simp</span> <span class="id" title="var">power</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">approximates</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">∃</span> <span class="id" title="var">g</span>. <span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">IHi</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">famgi</span> [<span class="id" title="var">Ingi</span> <span class="id" title="var">gixz</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (<span class="id" title="var">compose_family</span> <span class="id" title="var">famgi</span> <span class="id" title="var">g</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">revert</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">clear</span> -<span class="id" title="var">inS</span> <span class="id" title="var">inScomp</span> <span class="id" title="var">Ingi</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">famgi</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span> [].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">in_app_iff</span> <span class="id" title="var">in_map_iff</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [[<span class="id" title="var">x</span> [&lt;- <span class="id" title="var">Inx</span>]]| <span class="id" title="var">Ing</span>]. <span class="id" title="tactic">apply</span> <span class="id" title="var">inScomp</span>. <span class="id" title="tactic">intuition</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Ingi</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHfamgi</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Ingi</span>; <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">datatypes</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">red</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> [<span class="id" title="var">z</span> [<span class="id" title="var">powxz</span> <span class="id" title="var">Tzy</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">red</span> <span class="id" title="tactic">in</span> <span class="id" title="var">approx</span>, <span class="id" title="var">gixz</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">gixz</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">powxz</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">approx</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Tzy</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">graphs_relation_compose</span>; <span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">fin_list</span> {<span class="id" title="var">n</span> <span class="id" title="var">A</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">fin</span> <span class="id" title="var">n</span> → <span class="id" title="var">A</span>) : <span class="id" title="var">list</span> <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fin_list</span> (<span class="id" title="var">n</span>:=0) <span class="id" title="var">f</span> := <span class="id" title="var">nil</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fin_list</span> (<span class="id" title="var">n</span>:=<span class="id" title="var">S</span> <span class="id" title="var">n</span>) <span class="id" title="var">f</span> := <span class="id" title="var">f</span> <span class="id" title="var">fz</span> :: <span class="id" title="var">fin_list</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">i</span> ⇒ <span class="id" title="var">f</span> (<span class="id" title="var">fs</span> <span class="id" title="var">i</span>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">size_change_wf</span> {<span class="id" title="var">k</span>} (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">T</span> : <span class="id" title="var">fin</span> <span class="id" title="var">n</span> → <span class="id" title="var">relation</span> (<span class="id" title="var">k_tuple_type</span> <span class="id" title="var">k</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">graphs</span> : <span class="id" title="var">list</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">approx</span> : <span class="id" title="var">approximates_family</span> <span class="id" title="var">graphs</span> (<span class="id" title="var">fin_union</span> <span class="id" title="var">T</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">S</span> : <span class="id" title="var">list</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Strans</span> : <span class="id" title="var">is_transitive_closure</span> <span class="id" title="var">graphs</span> <span class="id" title="var">S</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">R</span> : <span class="id" title="var">relation</span> (<span class="id" title="var">k_tuple_type</span> <span class="id" title="var">k</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">AF</span> : <span class="id" title="var">AlmostFull</span> <span class="id" title="var">R</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">G</span>, <span class="id" title="var">In</span> <span class="id" title="var">G</span> <span class="id" title="var">S</span> → <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>, <span class="id" title="var">graph_relation</span> <span class="id" title="var">G</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> ∧ <span class="id" title="var">R</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span> → <span class="id" title="var">False</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">well_founded</span> (<span class="id" title="var">fin_union</span> <span class="id" title="var">T</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="var">af_wf</span> <span class="id" title="var">_</span> <span class="id" title="var">R</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> [<span class="id" title="var">Txy</span> <span class="id" title="var">Ryx</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">clos_trans_t1n_iff</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Txy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">clos_trans_power</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Txy</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">k'</span> <span class="id" title="var">Tkxy</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">red</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Strans</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">in_transitive_closure</span> <span class="id" title="var">graphs</span> <span class="id" title="var">S</span> (<span class="id" title="var">fin_union</span> <span class="id" title="var">T</span>) <span class="id" title="var">approx</span> <span class="id" title="var">Strans</span> <span class="id" title="var">k'</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">g'</span> [<span class="id" title="var">Ings</span> <span class="id" title="var">Hg</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Hg</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Tkxy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">Hg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">g'</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Tkxy</span>. <span class="id" title="tactic">elim</span> <span class="id" title="var">Tkxy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Tkxy</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">Ings</span> <span class="id" title="var">a</span>). <span class="id" title="var">forward</span> <span class="id" title="var">Ings</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> (<span class="id" title="var">H</span> <span class="id" title="var">a</span> <span class="id" title="var">Ings</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHg'</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Ings</span>; <span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">size_change_wf_fam</span> {<span class="id" title="var">k</span>} (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">T</span> : <span class="id" title="var">fin</span> <span class="id" title="var">n</span> → <span class="id" title="var">relation</span> (<span class="id" title="var">k_tuple_type</span> <span class="id" title="var">k</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">graphs</span> : <span class="id" title="var">fin</span> <span class="id" title="var">n</span> → <span class="id" title="var">graph</span> <span class="id" title="var">k</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">approx</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">f</span>, <span class="id" title="var">approximates</span> (<span class="id" title="var">graphs</span> <span class="id" title="var">f</span>) (<span class="id" title="var">T</span> <span class="id" title="var">f</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">S</span> : <span class="id" title="var">list</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Strans</span> : <span class="id" title="var">is_transitive_closure</span> (<span class="id" title="var">fin_list</span> <span class="id" title="var">graphs</span>) <span class="id" title="var">S</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">R</span> : <span class="id" title="var">relation</span> (<span class="id" title="var">k_tuple_type</span> <span class="id" title="var">k</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">AF</span> : <span class="id" title="var">AlmostFull</span> <span class="id" title="var">R</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">G</span>, <span class="id" title="var">In</span> <span class="id" title="var">G</span> <span class="id" title="var">S</span> → <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>, <span class="id" title="var">graph_relation</span> <span class="id" title="var">G</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> ∧ <span class="id" title="var">R</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span> → <span class="id" title="var">False</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">well_founded</span> (<span class="id" title="var">fin_union</span> <span class="id" title="var">T</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="var">af_wf</span> <span class="id" title="var">_</span> <span class="id" title="var">R</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> [<span class="id" title="var">Txy</span> <span class="id" title="var">Ryx</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">clos_trans_t1n_iff</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Txy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">clos_trans_power</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Txy</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">k'</span> <span class="id" title="var">Tkxy</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">red</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Strans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">approximates_family</span> (<span class="id" title="var">fin_list</span> <span class="id" title="var">graphs</span>) (<span class="id" title="var">fin_union</span> <span class="id" title="var">T</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">clear</span> -<span class="id" title="var">approx</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">n</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">red</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">red</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">red</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">Rxy</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHn</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">f</span> ⇒ <span class="id" title="var">T</span> (<span class="id" title="var">fs</span> <span class="id" title="var">f</span>)) (<span class="id" title="keyword">fun</span> <span class="id" title="var">f</span> ⇒ <span class="id" title="var">graphs</span> (<span class="id" title="var">fs</span> <span class="id" title="var">f</span>)) (<span class="id" title="keyword">fun</span> <span class="id" title="var">f</span> ⇒ <span class="id" title="var">approx</span> (<span class="id" title="var">fs</span> <span class="id" title="var">f</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">red</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IHn</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHn</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Rxy</span>. <span class="id" title="var">simp</span> <span class="id" title="var">fin_list</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">left</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">approx</span>. <span class="id" title="tactic">intuition</span>. <span class="id" title="var">simp</span> <span class="id" title="var">fin_list</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intuition</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">in_transitive_closure</span> (<span class="id" title="var">fin_list</span> <span class="id" title="var">graphs</span>) <span class="id" title="var">S</span> (<span class="id" title="var">fin_union</span> <span class="id" title="var">T</span>) <span class="id" title="var">H0</span> <span class="id" title="var">Strans</span> <span class="id" title="var">k'</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">g'</span> [<span class="id" title="var">Ings</span> <span class="id" title="var">Hg</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Hg</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Tkxy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">Hg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">g'</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Tkxy</span>. <span class="id" title="tactic">elim</span> <span class="id" title="var">Tkxy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Tkxy</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">Ings</span> <span class="id" title="var">a</span>). <span class="id" title="var">forward</span> <span class="id" title="var">Ings</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> (<span class="id" title="var">H</span> <span class="id" title="var">a</span> <span class="id" title="var">Ings</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHg'</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Ings</span>; <span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">TI_graph</span> <span class="id" title="var">k</span> : <span class="id" title="var">graph</span> <span class="id" title="var">k</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">TI_graph</span> 0 := <span class="id" title="var">λ</span>{ | ! } ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">TI_graph</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>) := <span class="id" title="keyword">fun</span> <span class="id" title="var">f</span> ⇒ <span class="id" title="var">Some</span> (<span class="id" title="var">false</span>, <span class="id" title="var">f</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">TI_compose</span> <span class="id" title="var">k</span> (<span class="id" title="var">G</span> : <span class="id" title="var">graph</span> <span class="id" title="var">k</span>) : <span class="id" title="keyword">∀</span> <span class="id" title="var">f</span>, (<span class="id" title="var">G</span> ⋅ <span class="id" title="var">TI_graph</span> <span class="id" title="var">k</span>) <span class="id" title="var">f</span> = <span class="id" title="var">G</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">k</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">TI_graph</span>. <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">red</span> <span class="id" title="tactic">in</span> <span class="id" title="var">G</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">f</span>; <span class="id" title="var">depelim</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">f</span>. <span class="id" title="var">depelim</span> <span class="id" title="var">f</span>. <span class="id" title="var">simp</span> <span class="id" title="var">TI_graph</span> <span class="id" title="var">graph_compose</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">G</span> <span class="id" title="var">fz</span>) <span class="id" title="keyword">as</span> [[<span class="id" title="var">weight</span> <span class="id" title="var">d</span>]|]; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">orb_false_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">simp</span> <span class="id" title="var">TI_graph</span> <span class="id" title="var">graph_compose</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">G</span> (<span class="id" title="var">fs</span> <span class="id" title="var">f</span>)) <span class="id" title="keyword">as</span> [[<span class="id" title="var">weight</span> <span class="id" title="var">d</span>]|]; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">trivial</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">orb_false_r</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">TI</span> <span class="id" title="var">k</span> : <span class="id" title="var">relation</span> (<span class="id" title="var">k_tuple_type</span> <span class="id" title="var">k</span>) := <span class="id" title="var">graph_relation</span> (<span class="id" title="var">TI_graph</span> <span class="id" title="var">k</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">intersection</span> <span class="id" title="var">k</span> : <span class="id" title="var">relation</span> (<span class="id" title="var">k_tuple_type</span> <span class="id" title="var">k</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">intersection</span> 0 := <span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> ⇒ <span class="id" title="var">True</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">intersection</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>) := <span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> ⇒ <span class="id" title="var">Nat.le</span> (<span class="id" title="var">fst</span> <span class="id" title="var">x</span>) (<span class="id" title="var">fst</span> <span class="id" title="var">y</span>) ∧ <span class="id" title="var">intersection</span> <span class="id" title="var">n</span> (<span class="id" title="var">snd</span> <span class="id" title="var">x</span>) (<span class="id" title="var">snd</span> <span class="id" title="var">y</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">TI_intersection_equiv</span> <span class="id" title="var">k</span> : <span class="id" title="var">relation_equivalence</span> (<span class="id" title="var">TI</span> <span class="id" title="var">k</span>) (<span class="id" title="var">intersection</span> <span class="id" title="var">k</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">k</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>. <span class="id" title="tactic">red</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">intros</span> []. <span class="id" title="tactic">exact</span> <span class="id" title="var">I</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">exact</span> <span class="id" title="var">I</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> [<span class="id" title="var">x</span> <span class="id" title="var">rx</span>] [<span class="id" title="var">y</span> <span class="id" title="var">ry</span>]. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">unfold</span> <span class="id" title="var">TI</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Hg</span>. <span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> <span class="id" title="var">Hg</span>. <span class="id" title="tactic">rewrite</span> → <span class="id" title="var">graph_relation_spec</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">pose</span> (<span class="id" title="var">H</span> <span class="id" title="var">fz</span>). <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">y0</span>. <span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">graph_relation</span> (<span class="id" title="var">TI_graph</span> <span class="id" title="var">k</span>) <span class="id" title="var">rx</span> <span class="id" title="var">ry</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">graph_relation_spec</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">y0</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> (<span class="id" title="var">fs</span> <span class="id" title="var">f</span>)). <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">TI_graph</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">k</span>. <span class="id" title="var">depelim</span> <span class="id" title="var">f</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">red</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IHk</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IHk</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHk</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span> [<span class="id" title="var">Hle</span> <span class="id" title="var">Hi</span>]. <span class="id" title="tactic">unfold</span> <span class="id" title="var">TI</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">graph_relation_spec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">depelim</span> <span class="id" title="var">f</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">red</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IHk</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IHk</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHk</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hi</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">red</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hi</span>. <span class="id" title="tactic">rewrite</span> → <span class="id" title="var">graph_relation_spec</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hi</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> -<span class="id" title="var">Hi</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">k</span>. <span class="id" title="var">depelim</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hi</span> <span class="id" title="var">f</span>). <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hi</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;#[<span class="id" title="var">global</span>] <span class="id" title="keyword">Instance</span> <span class="id" title="var">TI_AlmostFull</span> <span class="id" title="var">k</span> : <span class="id" title="var">AlmostFull</span> (<span class="id" title="var">TI</span> <span class="id" title="var">k</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">TI_intersection_equiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">k</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">red</span>. <span class="id" title="tactic">red</span>. <span class="id" title="tactic">∃</span> <span class="id" title="var">ZT</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">exact</span> <span class="id" title="var">I</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">af_interesection</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">AlmostFull_MR</span> <span class="id" title="var">Nat.le</span>). <span class="id" title="tactic">apply</span> <span class="id" title="var">almost_full_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">AlmostFull_MR</span> (<span class="id" title="var">intersection</span> <span class="id" title="var">k</span>)). <span class="id" title="tactic">apply</span> <span class="id" title="var">IHk</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">TI_compose'</span> <span class="id" title="var">k</span> (<span class="id" title="var">G</span> : <span class="id" title="var">graph</span> <span class="id" title="var">k</span>) : (<span class="id" title="var">G</span> ⋅ <span class="id" title="var">TI_graph</span> <span class="id" title="var">k</span>) = <span class="id" title="var">G</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">extensionality</span> <span class="id" title="var">f</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">TI_compose</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sct_power_check</span> {<span class="id" title="var">k</span>} <span class="id" title="var">G</span> (<span class="id" title="var">T</span> : <span class="id" title="var">relation</span> (<span class="id" title="var">k_tuple_type</span> <span class="id" title="var">k</span>)) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">approximates</span> <span class="id" title="var">G</span> <span class="id" title="var">T</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">∃</span> <span class="id" title="var">n</span> <span class="id" title="var">f</span>, <span class="id" title="var">power_graph_n</span> <span class="id" title="var">n</span> <span class="id" title="var">G</span> <span class="id" title="var">f</span> = <span class="id" title="var">Some</span> (<span class="id" title="var">true</span>, <span class="id" title="var">f</span>)) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>, <span class="id" title="var">T</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> → <span class="id" title="var">TI</span> <span class="id" title="var">_</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span> → <span class="id" title="var">False</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">approx</span> [<span class="id" title="var">n</span> [<span class="id" title="var">f</span> <span class="id" title="var">eqpow</span>]] <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">Txy</span> <span class="id" title="var">TIyx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">compose_rel</span> <span class="id" title="var">T</span> (<span class="id" title="var">TI</span> <span class="id" title="var">k</span>) <span class="id" title="var">x</span> <span class="id" title="var">x</span>). <span class="id" title="tactic">∃</span> <span class="id" title="var">y</span>; <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">power</span> <span class="id" title="var">n</span> (<span class="id" title="var">compose_rel</span> <span class="id" title="var">T</span> (<span class="id" title="var">TI</span> <span class="id" title="var">k</span>)) <span class="id" title="var">x</span> <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">clear</span> -<span class="id" title="var">H</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">n</span>; <span class="id" title="var">simp</span> <span class="id" title="var">power</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">intuition</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">compose_approximates</span> <span class="id" title="var">G</span> (<span class="id" title="var">TI_graph</span> <span class="id" title="var">k</span>) <span class="id" title="var">T</span> (<span class="id" title="var">TI</span> <span class="id" title="var">k</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">forward</span> <span class="id" title="var">a</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="var">forward</span> <span class="id" title="var">a</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">TI</span>. <span class="id" title="tactic">red</span>. <span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">TI_compose'</span> <span class="id" title="tactic">in</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">approximates_power</span> <span class="id" title="var">n</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">a</span> <span class="id" title="var">x</span> <span class="id" title="var">x</span>). <span class="id" title="tactic">specialize</span> (<span class="id" title="var">a</span> <span class="id" title="var">H0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> → <span class="id" title="var">graph_relation_spec</span> <span class="id" title="tactic">in</span> <span class="id" title="var">a</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">a</span> <span class="id" title="var">f</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">eqpow</span> <span class="id" title="tactic">in</span> <span class="id" title="var">a</span>. <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <span class="id" title="var">size_change_termination</span> {<span class="id" title="var">k</span>} (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">T</span> : <span class="id" title="var">fin</span> <span class="id" title="var">n</span> → <span class="id" title="var">relation</span> (<span class="id" title="var">k_tuple_type</span> <span class="id" title="var">k</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">graphs</span> : <span class="id" title="var">fin</span> <span class="id" title="var">n</span> → <span class="id" title="var">graph</span> <span class="id" title="var">k</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">approx</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">f</span>, <span class="id" title="var">approximates</span> (<span class="id" title="var">graphs</span> <span class="id" title="var">f</span>) (<span class="id" title="var">T</span> <span class="id" title="var">f</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">S</span> : <span class="id" title="var">list</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Strans</span> : <span class="id" title="var">is_transitive_closure</span> (<span class="id" title="var">fin_list</span> <span class="id" title="var">graphs</span>) <span class="id" title="var">S</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">haspow</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">G</span>, <span class="id" title="var">In</span> <span class="id" title="var">G</span> <span class="id" title="var">S</span> → <span class="id" title="tactic">∃</span> <span class="id" title="var">n</span> <span class="id" title="var">f</span>, <span class="id" title="var">power_graph_n</span> <span class="id" title="var">n</span> <span class="id" title="var">G</span> <span class="id" title="var">f</span> = <span class="id" title="var">Some</span> (<span class="id" title="var">true</span>, <span class="id" title="var">f</span>)) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">well_founded</span> (<span class="id" title="var">fin_union</span> <span class="id" title="var">T</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">size_change_wf_fam</span> <span class="id" title="keyword">with</span> <span class="id" title="var">graphs</span> <span class="id" title="var">S</span> (<span class="id" title="var">TI</span> <span class="id" title="var">k</span>); <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">TI_AlmostFull</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">haspow</span> <span class="id" title="var">G</span> <span class="id" title="var">H</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">Strans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">sct_power_check</span> <span class="id" title="var">G</span> (<span class="id" title="var">graph_relation</span> <span class="id" title="var">G</span>) <span class="id" title="var">_</span> <span class="id" title="var">haspow</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>). <span class="id" title="tactic">red</span>. <span class="id" title="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intuition</span>. <span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Import</span> <span class="id" title="var">ListNotations</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <span class="id" title="var">trans_clos_answer</span> (<span class="id" title="var">k</span> : <span class="id" title="var">nat</span>) : <span class="id" title="keyword">Set</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">OutOfFuel</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Finished</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Derive</span> <span class="id" title="var">NoConfusion</span> <span class="id" title="keyword">for</span> <span class="id" title="var">trans_clos_answer</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <span class="id" title="var">find_opt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>}.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">find_opt</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> → <span class="id" title="var">option</span> <span class="id" title="var">A</span>) : <span class="id" title="var">option</span> <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">find_opt</span> [] <span class="id" title="var">f</span> := <span class="id" title="var">None</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">find_opt</span> (<span class="id" title="var">x</span> :: <span class="id" title="var">xs</span>) <span class="id" title="var">f</span> <span class="id" title="keyword">with</span> <span class="id" title="var">f</span> <span class="id" title="var">x</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ | <span class="id" title="var">Some</span> <span class="id" title="var">y</span> ⇒ <span class="id" title="var">Some</span> <span class="id" title="var">y</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">None</span> ⇒ <span class="id" title="var">find_opt</span> <span class="id" title="var">xs</span> <span class="id" title="var">f</span> }.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <span class="id" title="var">find_opt</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">find_opt_spec</span> {<span class="id" title="var">A</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> → <span class="id" title="var">option</span> <span class="id" title="var">A</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">find_opt</span> <span class="id" title="var">l</span> <span class="id" title="var">f</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">x</span> ⇒ <span class="id" title="tactic">∃</span> <span class="id" title="var">a</span>, <span class="id" title="var">In</span> <span class="id" title="var">a</span> <span class="id" title="var">l</span> ∧ <span class="id" title="var">f</span> <span class="id" title="var">a</span> = <span class="id" title="var">Some</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">None</span> ⇒ <span class="id" title="keyword">∀</span> <span class="id" title="var">a</span>, <span class="id" title="var">In</span> <span class="id" title="var">a</span> <span class="id" title="var">l</span> → <span class="id" title="var">f</span> <span class="id" title="var">a</span> = <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">funelim</span> (<span class="id" title="var">find_opt</span> <span class="id" title="var">l</span> <span class="id" title="var">f</span>); <span class="id" title="var">cbn</span>; <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">elim</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">x</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">intuition</span> <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">find_opt</span> <span class="id" title="var">xs</span> <span class="id" title="var">f</span>); <span class="id" title="var">now</span> <span class="id" title="tactic">firstorder</span> <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">compute_transitive_closure</span> {<span class="id" title="var">k</span>} (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">gs</span> : <span class="id" title="var">list</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>)) : <span class="id" title="var">trans_clos_answer</span> <span class="id" title="var">k</span> <span class="id" title="tactic">by</span> <span class="id" title="keyword">struct</span> <span class="id" title="var">n</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">compute_transitive_closure</span> 0 <span class="id" title="var">_</span> := <span class="id" title="var">OutOfFuel</span> <span class="id" title="var">_</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">compute_transitive_closure</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>) <span class="id" title="var">gs</span> := <span class="id" title="var">aux</span> <span class="id" title="var">gs</span> []<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">where</span> <span class="id" title="var">aux</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>)) (<span class="id" title="var">acc</span> : <span class="id" title="var">list</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>)) : <span class="id" title="var">trans_clos_answer</span> <span class="id" title="var">k</span> <span class="id" title="tactic">by</span> <span class="id" title="keyword">struct</span> <span class="id" title="var">l</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aux</span> <span class="id" title="var">nil</span> <span class="id" title="var">acc</span> := <span class="id" title="var">Finished</span> <span class="id" title="var">_</span> <span class="id" title="var">acc</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aux</span> (<span class="id" title="var">g</span> :: <span class="id" title="var">gs'</span>) <span class="id" title="var">acc</span> := <span class="id" title="var">with_new_candidate</span> <span class="id" title="var">new_candidate</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">where</span> <span class="id" title="var">with_new_candidate</span> : <span class="id" title="var">option</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>) → <span class="id" title="var">trans_clos_answer</span> <span class="id" title="var">k</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ | <span class="id" title="var">Some</span> <span class="id" title="var">newg</span> ⇒ <span class="id" title="var">compute_transitive_closure</span> <span class="id" title="var">n</span> (<span class="id" title="var">newg</span> :: <span class="id" title="var">g</span> :: <span class="id" title="var">gs'</span> ++ <span class="id" title="var">acc</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">None</span> ⇒ <span class="id" title="var">aux</span> <span class="id" title="var">gs'</span> (<span class="id" title="var">g</span> :: <span class="id" title="var">acc</span>) }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">where</span> <span class="id" title="var">new_candidate</span> : <span class="id" title="var">option</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">new_candidate</span> := <span class="id" title="keyword">let</span> <span class="id" title="var">gs''</span> := <span class="id" title="var">g</span> :: <span class="id" title="var">acc</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">find_opt</span> <span class="id" title="var">gs''</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">g'</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">gcomp</span> := <span class="id" title="var">g'</span> ⋅ <span class="id" title="var">g</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;if&nbsp;eqb&nbsp;g&nbsp;gcomp&nbsp;then&nbsp;None&nbsp;else&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">List.existsb</span> (<span class="id" title="var">eqb</span> <span class="id" title="var">gcomp</span>) <span class="id" title="var">gs''</span> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">gcomp'</span> := <span class="id" title="var">g</span> ⋅ <span class="id" title="var">g'</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">List.existsb</span> (<span class="id" title="var">eqb</span> <span class="id" title="var">gcomp'</span>) <span class="id" title="var">gs''</span> <span class="id" title="keyword">then</span> <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">Some</span> <span class="id" title="var">gcomp'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">Some</span> <span class="id" title="var">gcomp</span>).<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Hint&nbsp;Extern&nbsp;10&nbsp;=&gt;&nbsp;progress&nbsp;simpl&nbsp;:&nbsp;rec_decision.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;FIXME&nbsp;bug&nbsp;when&nbsp;using&nbsp;with&nbsp;*)</span><br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Equations&nbsp;compute_transitive_closure&nbsp;{k}&nbsp;(n&nbsp;:&nbsp;nat)&nbsp;(gs&nbsp;:&nbsp;list&nbsp;(graph&nbsp;k))&nbsp;:&nbsp;trans_clos_answer&nbsp;k&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;by&nbsp;wf&nbsp;n&nbsp;lt&nbsp;:=&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;compute_transitive_closure&nbsp;0&nbsp;_&nbsp;:=&nbsp;OutOfFuel&nbsp;_;&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;compute_transitive_closure&nbsp;(S&nbsp;n)&nbsp;gs&nbsp;:=&nbsp;aux&nbsp;gs&nbsp;<span class="inlinecode"></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;aux&nbsp;(l&nbsp;:&nbsp;list&nbsp;(graph&nbsp;k))&nbsp;(acc&nbsp;:&nbsp;list&nbsp;(graph&nbsp;k))&nbsp;:&nbsp;trans_clos_answer&nbsp;k&nbsp;by&nbsp;struct&nbsp;l&nbsp;:=&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;aux&nbsp;nil&nbsp;acc&nbsp;:=&nbsp;Finished&nbsp;_&nbsp;acc;&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;aux&nbsp;(g&nbsp;::&nbsp;gs')&nbsp;acc&nbsp;:=&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;gs''&nbsp;:=&nbsp;g&nbsp;::&nbsp;gs'&nbsp;++&nbsp;acc&nbsp;in&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;new_candidate&nbsp;:=&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;find_opt&nbsp;gs''&nbsp;(fun&nbsp;g'&nbsp;=&gt;&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;gcomp&nbsp;:=&nbsp;g'&nbsp;⋅&nbsp;g&nbsp;in&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;eqb&nbsp;g&nbsp;gcomp&nbsp;then&nbsp;None&nbsp;else&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;List.existsb&nbsp;(eqb&nbsp;gcomp)&nbsp;gs''&nbsp;then&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;gcomp'&nbsp;:=&nbsp;g&nbsp;⋅&nbsp;g'&nbsp;in&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;List.existsb&nbsp;(eqb&nbsp;gcomp')&nbsp;gs''&nbsp;then&nbsp;None&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;Some&nbsp;gcomp'&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;Some&nbsp;gcomp)&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;match&nbsp;new_candidate&nbsp;with&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Some&nbsp;newg&nbsp;=&gt;&nbsp;compute_transitive_closure&nbsp;n&nbsp;(newg&nbsp;::&nbsp;gs'')&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;None&nbsp;=&gt;&nbsp;aux&nbsp;gs'&nbsp;(g&nbsp;::&nbsp;acc)&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end.&nbsp;*)</span><br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">becoming_transitive_closure</span> {<span class="id" title="var">k</span>} (<span class="id" title="var">acc</span> : <span class="id" title="var">list</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>)) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>)) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">g</span>, <span class="id" title="var">In</span> <span class="id" title="var">g</span> <span class="id" title="var">acc</span> → <span class="id" title="var">In</span> <span class="id" title="var">g</span> <span class="id" title="var">l</span>) ∧ <span class="id" title="keyword">∀</span> <span class="id" title="var">g</span> <span class="id" title="var">g'</span>, <span class="id" title="var">In</span> <span class="id" title="var">g</span> <span class="id" title="var">acc</span> → <span class="id" title="var">In</span> <span class="id" title="var">g'</span> <span class="id" title="var">acc</span> → <span class="id" title="var">In</span> (<span class="id" title="var">g</span> ⋅ <span class="id" title="var">g'</span>) <span class="id" title="var">l</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">transitive_closure_of</span> {<span class="id" title="var">k</span>} (<span class="id" title="var">g</span> : <span class="id" title="var">graph</span> <span class="id" title="var">k</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>)) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">g'</span>, <span class="id" title="var">In</span> <span class="id" title="var">g'</span> <span class="id" title="var">l</span> → <span class="id" title="var">In</span> (<span class="id" title="var">g</span> ⋅ <span class="id" title="var">g'</span>) <span class="id" title="var">l</span> ∧ <span class="id" title="var">In</span> (<span class="id" title="var">g'</span> ⋅ <span class="id" title="var">g</span>) <span class="id" title="var">l</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">incl_transitive_closure_of</span> {<span class="id" title="var">k</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>)) (<span class="id" title="var">l'</span> : <span class="id" title="var">list</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>)) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">trl</span>, <span class="id" title="var">is_transitive_closure</span> <span class="id" title="var">l</span> <span class="id" title="var">trl</span> → <span class="id" title="var">incl</span> <span class="id" title="var">l'</span> <span class="id" title="var">trl</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">new_candid</span> <span class="id" title="var">k</span> <span class="id" title="var">n</span> <span class="id" title="var">gs</span> <span class="id" title="var">g</span> <span class="id" title="var">l</span> <span class="id" title="var">acc</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">compute_transitive_closure_clause_2_aux_clause_2_new_candidate</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(@<span class="id" title="var">compute_transitive_closure</span>) <span class="id" title="var">k</span> <span class="id" title="var">n</span> <span class="id" title="var">gs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">compute_transitive_closure_clause_2_aux</span> (@<span class="id" title="var">compute_transitive_closure</span>) <span class="id" title="var">k</span> <span class="id" title="var">n</span> <span class="id" title="var">gs</span>) <span class="id" title="var">g</span> <span class="id" title="var">l</span> <span class="id" title="var">acc</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> <span class="id" title="var">aux</span> := <span class="id" title="var">compute_transitive_closure_clause_2_aux</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">with_new_candid</span> <span class="id" title="var">k</span> <span class="id" title="var">n</span> <span class="id" title="var">gs</span> <span class="id" title="var">g</span> <span class="id" title="var">l</span> <span class="id" title="var">acc</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">compute_transitive_closure_clause_2_aux_clause_2_with_new_candidate</span> (@<span class="id" title="var">compute_transitive_closure</span>) <span class="id" title="var">k</span> <span class="id" title="var">n</span> <span class="id" title="var">gs</span><br/>
(<span class="id" title="var">aux</span> (@<span class="id" title="var">compute_transitive_closure</span>) <span class="id" title="var">k</span> <span class="id" title="var">n</span> <span class="id" title="var">gs</span>) <span class="id" title="var">g</span> <span class="id" title="var">l</span> <span class="id" title="var">acc</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">is_transitive_closure_incl</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;∀ (<span class="id" title="var">k</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">gs</span> : <span class="id" title="var">list</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>)) (<span class="id" title="var">g</span> : <span class="id" title="var">graph</span> <span class="id" title="var">k</span>) (<span class="id" title="var">l</span> <span class="id" title="var">acc</span> <span class="id" title="var">l'</span> : <span class="id" title="var">list</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">is_transitive_closure</span> <span class="id" title="var">gs</span> <span class="id" title="var">l'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;→ <span class="id" title="var">incl_transitive_closure_of</span> <span class="id" title="var">gs</span> ((<span class="id" title="var">g</span> :: <span class="id" title="var">l</span>) ++ <span class="id" title="var">acc</span>) → <span class="id" title="var">incl_transitive_closure_of</span> ((<span class="id" title="var">g</span> :: <span class="id" title="var">l</span>) ++ <span class="id" title="var">acc</span>) <span class="id" title="var">l'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">k</span> <span class="id" title="var">gs</span> <span class="id" title="var">g</span> <span class="id" title="var">l</span> <span class="id" title="var">acc</span> <span class="id" title="var">l'</span> <span class="id" title="var">H0</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">red</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>. <span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">H3</span> <span class="id" title="var">_</span> <span class="id" title="var">H0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">red</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">assert</span> (<span class="id" title="var">is_transitive_closure</span> (<span class="id" title="var">g</span> :: <span class="id" title="var">l</span> ++ <span class="id" title="var">acc</span>) <span class="id" title="var">l'</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">red</span>. <span class="id" title="tactic">intuition</span>. <span class="id" title="tactic">red</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">red</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>, <span class="id" title="var">H2</span> |- ×. <span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">Admitted</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Ltac</span> <span class="id" title="var">apply_find_opt_spec</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id" title="keyword">context</span> [<span class="id" title="var">find_opt</span> ?<span class="id" title="var">g</span> ?<span class="id" title="var">f</span>] ⇒ <span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">find_opt_spec</span> <span class="id" title="var">g</span> <span class="id" title="var">f</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">existsb_spec</span> {<span class="id" title="var">A</span>} (<span class="id" title="var">p</span> : <span class="id" title="var">A</span> → <span class="id" title="var">bool</span>) <span class="id" title="var">l</span> : <span class="id" title="var">reflect</span> (<span class="id" title="tactic">∃</span> <span class="id" title="var">x</span>, <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span> ∧ <span class="id" title="var">p</span> <span class="id" title="var">x</span> = <span class="id" title="var">true</span>) (<span class="id" title="var">existsb</span> <span class="id" title="var">p</span> <span class="id" title="var">l</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">existsb</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">Heq</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">existsb_exists</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">intro</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">existsb_exists</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">eqb_refl</span> {<span class="id" title="var">A</span>} `{<span class="id" title="var">E</span>:<span class="id" title="var">Eq</span> <span class="id" title="var">A</span>} (<span class="id" title="var">a</span> : <span class="id" title="var">A</span>) : <span class="id" title="var">eqb</span> <span class="id" title="var">a</span> <span class="id" title="var">a</span> = <span class="id" title="var">true</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">eqb_spec</span> <span class="id" title="var">a</span> <span class="id" title="var">a</span>); <span class="id" title="tactic">intuition</span>. <span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">eqb_eq</span> {<span class="id" title="var">A</span>} `{<span class="id" title="var">E</span>:<span class="id" title="var">Eq</span> <span class="id" title="var">A</span>} (<span class="id" title="var">a</span> <span class="id" title="var">b</span> : <span class="id" title="var">A</span>) : <span class="id" title="var">eqb</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> = <span class="id" title="var">true</span> ↔ <span class="id" title="var">a</span> = <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">eqb_spec</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>); <span class="id" title="tactic">intuition</span>. <span class="id" title="tactic">discriminate</span>. <span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">eqb_neq</span> {<span class="id" title="var">A</span>} `{<span class="id" title="var">E</span>:<span class="id" title="var">Eq</span> <span class="id" title="var">A</span>} (<span class="id" title="var">a</span> <span class="id" title="var">b</span> : <span class="id" title="var">A</span>) : <span class="id" title="var">eqb</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> = <span class="id" title="var">false</span> ↔ <span class="id" title="var">a</span> ≠ <span class="id" title="var">b</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">eqb_spec</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>); <span class="id" title="tactic">intuition</span>. <span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">incl_transitive_closure</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;∀ (<span class="id" title="var">k</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">l</span> <span class="id" title="var">l'</span> <span class="id" title="var">trl</span> : <span class="id" title="var">list</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">is_transitive_closure</span> <span class="id" title="var">l'</span> <span class="id" title="var">trl</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">incl</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span> → <span class="id" title="var">incl_transitive_closure_of</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span> → <span class="id" title="var">is_transitive_closure</span> <span class="id" title="var">l</span> <span class="id" title="var">trl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">red</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>, <span class="id" title="var">H0</span>, <span class="id" title="var">H1</span> |- ×. <span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">incl_switch_head</span> {<span class="id" title="var">A</span>} (<span class="id" title="var">x</span> : <span class="id" title="var">A</span>) (<span class="id" title="var">y</span> <span class="id" title="var">l</span> <span class="id" title="var">r</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) : <span class="id" title="var">incl</span> (<span class="id" title="var">x</span> :: <span class="id" title="var">y</span> ++ <span class="id" title="var">l</span>) <span class="id" title="var">r</span> → <span class="id" title="var">incl</span> (<span class="id" title="var">y</span> ++ <span class="id" title="var">x</span> :: <span class="id" title="var">l</span>) <span class="id" title="var">r</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">incl</span> <span class="id" title="tactic">in</span> ×. <span class="id" title="tactic">intuition</span> <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">a</span>). <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">rewrite</span> → <span class="id" title="var">in_app_iff</span> <span class="id" title="tactic">in</span> ×. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intuition</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">incl_switch_head'</span> {<span class="id" title="var">A</span>} (<span class="id" title="var">x</span> : <span class="id" title="var">A</span>) (<span class="id" title="var">y</span> <span class="id" title="var">l</span> <span class="id" title="var">r</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) : <span class="id" title="var">incl</span> <span class="id" title="var">r</span> (<span class="id" title="var">x</span> :: <span class="id" title="var">y</span> ++ <span class="id" title="var">l</span>) → <span class="id" title="var">incl</span> <span class="id" title="var">r</span> (<span class="id" title="var">y</span> ++ <span class="id" title="var">x</span> :: <span class="id" title="var">l</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">incl</span> <span class="id" title="tactic">in</span> ×. <span class="id" title="tactic">intuition</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">a</span> <span class="id" title="var">H0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">rewrite</span> → <span class="id" title="var">in_app_iff</span> <span class="id" title="tactic">in</span> ×. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intuition</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">incl_switch_head'</span> : <span class="id" title="var">core</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">tr_clos_incl</span> {<span class="id" title="var">k</span>} {<span class="id" title="var">l</span> <span class="id" title="var">l'</span> : <span class="id" title="var">list</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>)} : <span class="id" title="var">is_transitive_closure</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span> → <span class="id" title="var">incl</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">is_transitive_closure</span>. <span class="id" title="tactic">intuition</span>. <span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">tr_clos_incl</span> : <span class="id" title="var">core</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">becoming_empty</span> {<span class="id" title="var">k</span>} {<span class="id" title="var">l</span>: <span class="id" title="var">list</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>)} : <span class="id" title="var">becoming_transitive_closure</span> [] <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">becoming_transitive_closure</span>. <span class="id" title="tactic">intuition</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">becoming_empty</span> : <span class="id" title="var">core</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">compute_transitive_closure_spec</span> {<span class="id" title="var">k</span>} <span class="id" title="var">n</span> (<span class="id" title="var">gs</span> : <span class="id" title="var">list</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>)) <span class="id" title="var">l</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">compute_transitive_closure</span> <span class="id" title="var">n</span> <span class="id" title="var">gs</span> = <span class="id" title="var">Finished</span> <span class="id" title="var">_</span> <span class="id" title="var">l</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">is_transitive_closure</span> <span class="id" title="var">gs</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> (<span class="id" title="var">compute_transitive_closure_elim</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">k</span> <span class="id" title="var">n</span> <span class="id" title="var">gs</span> <span class="id" title="var">r</span> ⇒ <span class="id" title="keyword">∀</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">r</span> = <span class="id" title="var">Finished</span> <span class="id" title="var">k</span> <span class="id" title="var">l</span> → <span class="id" title="var">is_transitive_closure</span> <span class="id" title="var">gs</span> <span class="id" title="var">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">k</span> <span class="id" title="var">n</span> <span class="id" title="var">gs</span> <span class="id" title="var">l</span> <span class="id" title="var">acc</span> <span class="id" title="var">res</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">is_transitive_closure</span> <span class="id" title="var">acc</span> <span class="id" title="var">acc</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">l'</span>, <span class="id" title="var">res</span> = <span class="id" title="var">Finished</span> <span class="id" title="var">k</span> <span class="id" title="var">l'</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">incl</span> (<span class="id" title="var">l</span> ++ <span class="id" title="var">acc</span>) <span class="id" title="var">l'</span> ∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">incl</span> <span class="id" title="var">gs</span> (<span class="id" title="var">l</span> ++ <span class="id" title="var">acc</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">incl_transitive_closure_of</span> <span class="id" title="var">gs</span> (<span class="id" title="var">l</span> ++ <span class="id" title="var">acc</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">becoming_transitive_closure</span> <span class="id" title="var">acc</span> <span class="id" title="var">l'</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">incl</span> (<span class="id" title="var">l</span> ++ <span class="id" title="var">acc</span>) <span class="id" title="var">l'</span> ∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">incl_transitive_closure_of</span> (<span class="id" title="var">l</span> ++ <span class="id" title="var">acc</span>) <span class="id" title="var">l'</span> ∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;becoming_transitive_closure&nbsp;l&nbsp;l'&nbsp;*)</span> <span class="id" title="var">is_transitive_closure</span> <span class="id" title="var">gs</span> <span class="id" title="var">l'</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">k</span> <span class="id" title="var">n</span> <span class="id" title="var">gs</span> <span class="id" title="var">g</span> <span class="id" title="var">l</span> <span class="id" title="var">acc</span> <span class="id" title="var">newc</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">gs'</span> := (<span class="id" title="var">g</span> :: <span class="id" title="var">acc</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">newc</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">None</span> ⇒ <span class="id" title="var">is_transitive_closure</span> <span class="id" title="var">gs'</span> <span class="id" title="var">gs'</span> ∧ <span class="id" title="var">transitive_closure_of</span> <span class="id" title="var">g</span> <span class="id" title="var">gs'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">g'</span> ⇒ ¬ <span class="id" title="var">In</span> <span class="id" title="var">g'</span> <span class="id" title="var">gs'</span> ∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">a</span>, <span class="id" title="var">In</span> <span class="id" title="var">a</span> <span class="id" title="var">gs'</span> ∧ (<span class="id" title="var">g'</span> = (<span class="id" title="var">g</span> ⋅ <span class="id" title="var">a</span>) ∨ <span class="id" title="var">g'</span> = (<span class="id" title="var">a</span> ⋅ <span class="id" title="var">g</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">k</span> <span class="id" title="var">n</span> <span class="id" title="var">gs</span> <span class="id" title="var">g</span> <span class="id" title="var">l</span> <span class="id" title="var">acc</span> <span class="id" title="var">newc</span> <span class="id" title="var">res</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">l'</span>, <span class="id" title="var">res</span> = <span class="id" title="var">Finished</span> <span class="id" title="var">k</span> <span class="id" title="var">l'</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">incl</span> (<span class="id" title="var">l</span> ++ <span class="id" title="var">acc</span>) <span class="id" title="var">l'</span> ∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">match</span> <span class="id" title="var">newc</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">c</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">incl</span> <span class="id" title="var">gs</span> (<span class="id" title="var">c</span> :: <span class="id" title="var">g</span> :: <span class="id" title="var">l</span> ++ <span class="id" title="var">acc</span>) ∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">incl_transitive_closure_of</span> <span class="id" title="var">gs</span> (<span class="id" title="var">c</span> :: <span class="id" title="var">g</span> :: <span class="id" title="var">l</span> ++ <span class="id" title="var">acc</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">None</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">incl</span> <span class="id" title="var">gs</span> (<span class="id" title="var">g</span> :: <span class="id" title="var">l</span> ++ <span class="id" title="var">acc</span>) ∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">incl_transitive_closure_of</span> <span class="id" title="var">gs</span> (<span class="id" title="var">g</span> :: <span class="id" title="var">l</span> ++ <span class="id" title="var">acc</span>) ∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">transitive_closure_of</span> <span class="id" title="var">g</span> (<span class="id" title="var">g</span> :: <span class="id" title="var">acc</span>) ∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">becoming_transitive_closure</span> (<span class="id" title="var">g</span> :: <span class="id" title="var">acc</span>) <span class="id" title="var">l'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">is_transitive_closure</span> <span class="id" title="var">gs</span> <span class="id" title="var">l'</span>))); <span class="id" title="tactic">clear</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">all</span>:<span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span> × <span class="id" title="var">H</span> <span class="id" title="var">l</span> <span class="id" title="var">Haux</span>.<br/>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forward&nbsp;H.&nbsp;red.&nbsp;intuition.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;specialize&nbsp;(H&nbsp;l&nbsp;Haux).&nbsp;apply&nbsp;H.&nbsp;auto&nbsp;with&nbsp;datatypes.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewrite&nbsp;app_nil_r.&nbsp;red.&nbsp;intuition.&nbsp;intuition.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;intros&nbsp;*&nbsp;n&nbsp;*&nbsp;tracc&nbsp;l'&nbsp;<span class="inlinecode">=</span> <span class="inlinecode">&lt;-</span>.&nbsp;simpl.&nbsp;split.&nbsp;intuition.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intros&nbsp;inclgs&nbsp;incltrgs&nbsp;becacc.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intuition.&nbsp;red.&nbsp;intuition.&nbsp;red.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intuition.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;intros&nbsp;*.&nbsp;simpl.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fold&nbsp;(new_candid&nbsp;k&nbsp;n&nbsp;gs&nbsp;g&nbsp;l&nbsp;acc).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fold&nbsp;(with_new_candid&nbsp;k&nbsp;n&nbsp;gs&nbsp;g&nbsp;l&nbsp;acc).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intros&nbsp;Hcand&nbsp;IH&nbsp;tracc&nbsp;l'&nbsp;Hnewc.&nbsp;split.&nbsp;admit.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intros&nbsp;inclgs&nbsp;incltrgs&nbsp;becaccl'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;specialize&nbsp;(IH&nbsp;_&nbsp;Hnewc).&nbsp;destruct&nbsp;IH&nbsp;as&nbsp;<span class="inlinecode"><span class="id" title="var">incll'</span></span> <span class="inlinecode"><span class="id" title="var">IH</span></span>.&nbsp;split.&nbsp;admit.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forward&nbsp;IH.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++&nbsp;destruct&nbsp;new_candid.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;Hcand&nbsp;as&nbsp;<span class="inlinecode"><span class="id" title="var">ng</span></span> <span class="inlinecode">[<span class="id" title="var">a</span></span> <span class="inlinecode">[<span class="id" title="var">Ina</span></span> <span class="inlinecode"><span class="id" title="var">Ha</span>]]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;split.&nbsp;intuition.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+++&nbsp;intros&nbsp;trl&nbsp;Htrl.&nbsp;specialize&nbsp;(incltrgs&nbsp;trl&nbsp;Htrl).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intros&nbsp;x&nbsp;Inx.&nbsp;destruct&nbsp;Inx.&nbsp;subst&nbsp;x.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;Ha&nbsp;as&nbsp;<span class="inlinecode">→</span> <span class="inlinecode">|</span> <span class="inlinecode">→</span>;&nbsp;apply&nbsp;Htrl;&nbsp;intuition.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;now&nbsp;apply&nbsp;incltrgs.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+++&nbsp;intuition.&nbsp;clear&nbsp;H2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;red.&nbsp;split.&nbsp;intros&nbsp;x&nbsp;Inx.&nbsp;simpl&nbsp;in&nbsp;Inx.&nbsp;intuition.&nbsp;subst&nbsp;x.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;admit.&nbsp;admit.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;destruct&nbsp;Ing'&nbsp;as&nbsp;<span class="inlinecode">&lt;-|<span class="id" title="var">Inlacc</span></span>.&nbsp;red&nbsp;in&nbsp;becaccl'.&nbsp;*)</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++&nbsp;intuition.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clear&nbsp;Hcand.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eapply&nbsp;is_transitive_closure_incl;&nbsp;eauto.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;intros.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remember&nbsp;(g&nbsp;::&nbsp;acc)&nbsp;as&nbsp;gs''.&nbsp;cbv&nbsp;zeta.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;apply_find_opt_spec.&nbsp;destruct&nbsp;find_opt.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++&nbsp;destruct&nbsp;H&nbsp;as&nbsp;<span class="inlinecode"><span class="id" title="var">a</span></span> <span class="inlinecode">[<span class="id" title="var">Inags''</span></span> <span class="inlinecode"><span class="id" title="var">Ineq</span>]</span>.&nbsp;subst&nbsp;gs'0.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;(existsb_spec&nbsp;(eqb&nbsp;(a&nbsp;⋅&nbsp;g))&nbsp;gs'').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;(existsb_spec&nbsp;(eqb&nbsp;(g&nbsp;⋅&nbsp;a))&nbsp;gs'').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;all:admit.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;discriminate.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;noconf&nbsp;Ineq.&nbsp;split.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+++&nbsp;intros&nbsp;Inga.&nbsp;apply&nbsp;n0.&nbsp;subst&nbsp;gs''.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;(g&nbsp;⋅&nbsp;a).&nbsp;intuition&nbsp;auto.&nbsp;subst.&nbsp;apply&nbsp;eqb_refl.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+++&nbsp;exists&nbsp;a.&nbsp;intuition.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+++&nbsp;noconf&nbsp;Ineq.&nbsp;split.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intros&nbsp;Inag.&nbsp;apply&nbsp;n0.&nbsp;exists&nbsp;(a&nbsp;⋅&nbsp;g).&nbsp;intuition.&nbsp;apply&nbsp;eqb_refl.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exists&nbsp;a.&nbsp;intuition.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;++&nbsp;split;&nbsp;intuition.&nbsp;subst&nbsp;gs'0.&nbsp;split;&nbsp;intros&nbsp;g'&nbsp;?g'';&nbsp;auto.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intros&nbsp;<span class="inlinecode"><span class="id" title="var">ing'</span></span> <span class="inlinecode"><span class="id" title="var">ing''</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;specialize&nbsp;(H&nbsp;g'&nbsp;ing').&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;(existsb_spec&nbsp;(eqb&nbsp;(g'&nbsp;⋅&nbsp;g))&nbsp;gs'').&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;(existsb_spec&nbsp;(eqb&nbsp;(g&nbsp;⋅&nbsp;g'))&nbsp;gs'').&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destruct&nbsp;e,&nbsp;e0;&nbsp;destruct_pairs.&nbsp;apply&nbsp;(eqb_eq&nbsp;_&nbsp;x)&nbsp;in&nbsp;H3.&nbsp;apply&nbsp;(eqb_eq&nbsp;_&nbsp;x0)&nbsp;in&nbsp;H2.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subst.&nbsp;admit.&nbsp;admit.&nbsp;admit.&nbsp;admit.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;+&nbsp;intros&nbsp;*&nbsp;IH&nbsp;*&nbsp;Hf.&nbsp;specialize&nbsp;(IH&nbsp;_&nbsp;Hf).&nbsp;clear&nbsp;Hf.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;split.&nbsp;intros&nbsp;x&nbsp;Inx.&nbsp;destruct&nbsp;IH&nbsp;as&nbsp;<span class="inlinecode"><span class="id" title="var">IH</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span>.&nbsp;intuition.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;intros&nbsp;<span class="inlinecode"><span class="id" title="var">inclgs</span></span> <span class="inlinecode"><span class="id" title="var">incltrgs</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;intuition.&nbsp;eapply&nbsp;incl_transitive_closure;&nbsp;eauto.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;+&nbsp;intros&nbsp;*&nbsp;IH&nbsp;*&nbsp;Hf.&nbsp;split.&nbsp;admit.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;intros&nbsp;<span class="inlinecode"><span class="id" title="var">inclgs</span></span> <span class="inlinecode">[<span class="id" title="var">incltrgs</span></span> <span class="inlinecode">[<span class="id" title="var">trg</span></span> <span class="inlinecode"><span class="id" title="var">trg'</span>]]</span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;apply&nbsp;IH.&nbsp;admit.&nbsp;auto.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;red&nbsp;in&nbsp;trg.&nbsp;now&nbsp;eapply&nbsp;incl_switch_head'&nbsp;in&nbsp;inclgs.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;red&nbsp;in&nbsp;incltrgs&nbsp;|-&nbsp;*.&nbsp;intros&nbsp;trl&nbsp;Htrl.&nbsp;specialize&nbsp;(incltrgs&nbsp;_&nbsp;Htrl).&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;now&nbsp;apply&nbsp;incl_switch_head&nbsp;in&nbsp;incltrgs.&nbsp;apply&nbsp;trg'.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="var">Admitted</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">gn_set</span> : <span class="id" title="var">list</span> (<span class="id" title="var">graph</span> 2) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[ <span class="id" title="var">T_graph_l</span>; <span class="id" title="var">T_graph_r</span> ].<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Transparent</span> <span class="id" title="var">compute_transitive_closure</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;I&nbsp;so&nbsp;wish&nbsp;we&nbsp;could&nbsp;get&nbsp;the&nbsp;scope&nbsp;without&nbsp;everything&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">string_scope</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">print_fin</span> {<span class="id" title="var">k</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">fin</span> <span class="id" title="var">k</span>) : <span class="id" title="var">String.string</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">print_fin</span> <span class="id" title="var">fz</span> := "0";<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">print_fin</span> (<span class="id" title="var">fs</span> <span class="id" title="var">fz</span>) := "1";<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">print_fin</span> (<span class="id" title="var">fs</span> (<span class="id" title="var">fs</span> <span class="id" title="var">fz</span>)) := "2";<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">print_fin</span> (<span class="id" title="var">fs</span> (<span class="id" title="var">fs</span> (<span class="id" title="var">fs</span> <span class="id" title="var">fz</span>))) := "3";<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">print_fin</span> <span class="id" title="var">f</span> := "&gt; 3".<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">print_nat</span> (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) : <span class="id" title="var">string</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">print_nat</span> 0 := "0";<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">print_nat</span> 1 := "1";<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">print_nat</span> 2 := "2";<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">print_nat</span> 3 := "3";<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">print_nat</span> 4 := "4";<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">print_nat</span> <span class="id" title="var">x</span> := "5".<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">print_node</span> {<span class="id" title="var">k'</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">data</span> : <span class="id" title="var">option</span> (<span class="id" title="var">bool</span> × <span class="id" title="var">fin</span> <span class="id" title="var">k'</span>)) : <span class="id" title="var">string</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">print_node</span> <span class="id" title="var">f</span> <span class="id" title="var">None</span> := "";<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">print_node</span> <span class="id" title="var">f</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">weight</span>, <span class="id" title="var">f'</span>)) := <span class="id" title="var">print_nat</span> <span class="id" title="var">f</span> ++ (<span class="id" title="keyword">if</span> <span class="id" title="var">weight</span> <span class="id" title="keyword">then</span> "&lt;" <span class="id" title="keyword">else</span> "&lt;=") ++ <span class="id" title="var">print_fin</span> <span class="id" title="var">f'</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">print_fin_fn</span> {<span class="id" title="var">k</span> <span class="id" title="var">k'</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">fin</span> <span class="id" title="var">k</span> → <span class="id" title="var">option</span> (<span class="id" title="var">bool</span> × <span class="id" title="var">fin</span> <span class="id" title="var">k'</span>)) : <span class="id" title="var">string</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">print_fin_fn</span> (<span class="id" title="var">k</span> := 0) <span class="id" title="var">f</span> := "";<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">print_fin_fn</span> (<span class="id" title="var">k</span> := <span class="id" title="var">S</span> <span class="id" title="var">k</span>) <span class="id" title="var">f</span> := <span class="id" title="var">print_node</span> (<span class="id" title="var">k'</span> - <span class="id" title="var">S</span> <span class="id" title="var">k</span>) (<span class="id" title="var">f</span> <span class="id" title="var">fz</span>) ++ " , " ++ <span class="id" title="var">print_fin_fn</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">n</span> ⇒ <span class="id" title="var">f</span> (<span class="id" title="var">fs</span> <span class="id" title="var">n</span>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">print_graph</span> {<span class="id" title="var">k</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">graph</span> <span class="id" title="var">k</span>) : <span class="id" title="var">string</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">print_graph</span> (<span class="id" title="var">k</span> := 0) <span class="id" title="var">f</span> := "empty";<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">print_graph</span> (<span class="id" title="var">k</span> := <span class="id" title="var">S</span> <span class="id" title="var">n</span>) <span class="id" title="var">f</span> := <span class="id" title="var">print_fin_fn</span> <span class="id" title="var">f</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">print_list</span> {<span class="id" title="var">A</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> → <span class="id" title="var">string</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) : <span class="id" title="var">string</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">print_list</span> <span class="id" title="var">f</span> <span class="id" title="var">nil</span> := "";<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">print_list</span> <span class="id" title="var">f</span> (<span class="id" title="var">cons</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>) := <span class="id" title="var">f</span> <span class="id" title="var">a</span> ++ " ; " ++ <span class="id" title="var">print_list</span> <span class="id" title="var">f</span> <span class="id" title="var">b</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Eval</span> <span class="id" title="tactic">compute</span> <span class="id" title="tactic">in</span> <span class="id" title="var">print_list</span> <span class="id" title="var">print_graph</span> <span class="id" title="var">gn_set</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">eq_dec_graph</span> {<span class="id" title="var">k</span>} : <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">graph</span> <span class="id" title="var">k</span>, { <span class="id" title="var">x</span> = <span class="id" title="var">y</span> } + { <span class="id" title="var">x</span> ≠ <span class="id" title="var">y</span> }.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">eqb</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">left</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">eqb_spec</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>). <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">eqb_spec</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>). <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">discriminate</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">uniquize</span> {<span class="id" title="var">k</span>} (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">graph</span> <span class="id" title="var">k</span>)) := <span class="id" title="var">nodup</span> (@<span class="id" title="var">eq_dec_graph</span> <span class="id" title="var">k</span>) <span class="id" title="var">l</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">T_trans_clos</span> := <span class="id" title="keyword">match</span> <span class="id" title="var">compute_transitive_closure</span> 10 <span class="id" title="var">gn_set</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Finished</span> <span class="id" title="var">l</span> ⇒ <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">OutOfFuel</span> ⇒ <span class="id" title="var">gn_set</span> <span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Eval&nbsp;compute&nbsp;in&nbsp;T_trans_clos.&nbsp;*)</span><br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Eval</span> <span class="id" title="tactic">compute</span> <span class="id" title="tactic">in</span> <span class="id" title="keyword">match</span> <span class="id" title="var">compute_transitive_closure</span> 10 <span class="id" title="var">gn_set</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Finished</span> <span class="id" title="var">l</span> ⇒ <span class="id" title="var">print_list</span> <span class="id" title="var">print_graph</span> (<span class="id" title="var">uniquize</span> <span class="id" title="var">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">OutOfFuel</span> ⇒ "outoffuel"%<span class="id" title="var">string</span> <span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">SCT</span>.<br/>

<br/>
<span class="id" title="keyword">Eval</span> <span class="id" title="tactic">compute</span> <span class="id" title="tactic">in</span> <span class="id" title="keyword">match</span> <span class="id" title="var">compute_transitive_closure</span> 10 <span class="id" title="var">gn_set</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Finished</span> <span class="id" title="var">l</span> ⇒ <span class="id" title="var">print_list</span> <span class="id" title="var">print_graph</span> (<span class="id" title="var">uniquize</span> <span class="id" title="var">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">OutOfFuel</span> ⇒ "outoffuel"%<span class="id" title="var">string</span> <span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Print</span> <span class="id" title="keyword">Assumptions</span> <span class="id" title="var">size_change_wf</span>.<br/>
<span class="id" title="keyword">Print</span> <span class="id" title="keyword">Assumptions</span> <span class="id" title="var">size_change_termination</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">R</span> := <span class="id" title="var">product_rel</span> <span class="id" title="var">Nat.le</span> <span class="id" title="var">Nat.le</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Stdlib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Lia</span>.<br/>

<br/>
<span class="id" title="keyword">Derive</span> <span class="id" title="var">Signature</span> <span class="id" title="keyword">for</span> <span class="id" title="var">clos_trans_1n</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">antisym</span> {<span class="id" title="var">X</span>} (<span class="id" title="var">R</span> : <span class="id" title="var">X</span> → <span class="id" title="var">X</span> → <span class="id" title="keyword">Prop</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>, <span class="id" title="var">R</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> → <span class="id" title="var">R</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span> → <span class="id" title="var">False</span>.<br/>

<br/>
<span class="id" title="keyword">Equations</span> <span class="id" title="var">T_rel</span> (<span class="id" title="var">f</span> : <span class="id" title="var">fin</span> 2) : <span class="id" title="var">relation</span> (<span class="id" title="var">k_tuple_type</span> 2) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">T_rel</span> <span class="id" title="var">fz</span> := <span class="id" title="var">Tl</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">T_rel</span> (<span class="id" title="var">fs</span> <span class="id" title="var">fz</span>) := <span class="id" title="var">Tr</span>.<br/>

<br/>
<span class="id" title="keyword">Equations</span> <span class="id" title="var">T_graphs</span> (<span class="id" title="var">f</span> : <span class="id" title="var">fin</span> 2) : <span class="id" title="var">graph</span> 2 :=<br/>
&nbsp;&nbsp;<span class="id" title="var">T_graphs</span> <span class="id" title="var">fz</span> := <span class="id" title="var">T_graph_l</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">T_graphs</span> (<span class="id" title="var">fs</span> <span class="id" title="var">fz</span>) := <span class="id" title="var">T_graph_r</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">gnlex</span> : (<span class="id" title="var">nat</span> × <span class="id" title="var">nat</span>) → <span class="id" title="var">nat</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">sct</span>:=<span class="id" title="var">size_change_termination</span> 2 <span class="id" title="var">T_rel</span> <span class="id" title="var">T_graphs</span>). <span class="id" title="var">forward</span> <span class="id" title="var">sct</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">f</span>; <span class="id" title="var">depelim</span> <span class="id" title="var">f</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">approximates_T_l</span>. <span class="id" title="var">depelim</span> <span class="id" title="var">f</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">approximates_T_r</span>. <span class="id" title="var">depelim</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">sct</span> <span class="id" title="var">T_trans_clos</span>). <span class="id" title="var">forward</span> <span class="id" title="var">sct</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="var">compute_transitive_closure_spec</span> 10). <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">forward</span> <span class="id" title="var">sct</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intuition</span>; <span class="id" title="tactic">subst</span> <span class="id" title="var">G</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">solve</span> [<span class="id" title="tactic">∃</span> 1; (<span class="id" title="tactic">∃</span> <span class="id" title="var">fz</span> ; <span class="id" title="tactic">reflexivity</span>) || (<span class="id" title="tactic">∃</span> (<span class="id" title="var">fs</span> <span class="id" title="var">fz</span>) ; <span class="id" title="tactic">reflexivity</span>) ].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">rel</span> :=(<span class="id" title="var">Wf.MR</span> (<span class="id" title="var">fin_union</span> <span class="id" title="var">T_rel</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> ⇒ (<span class="id" title="var">fst</span> <span class="id" title="var">x</span>, (<span class="id" title="var">snd</span> <span class="id" title="var">x</span>, <span class="id" title="var">tt</span>))))).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">WellFounded</span> <span class="id" title="var">rel</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Wf.measure_wf</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">sct</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="var">Subterm.FixWf</span> (<span class="id" title="var">WF</span>:=<span class="id" title="var">H</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> ⇒ <span class="id" title="var">nat</span>) <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">refine</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">x</span> <span class="id" title="keyword">as</span> <span class="id" title="var">w</span> <span class="id" title="keyword">return</span> ((<span class="id" title="keyword">∀</span> <span class="id" title="var">y</span>, <span class="id" title="var">rel</span> <span class="id" title="var">y</span> <span class="id" title="var">w</span> → <span class="id" title="var">nat</span>) → <span class="id" title="var">nat</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (0, <span class="id" title="var">_</span>) ⇒ <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" title="var">_</span>, 0) ⇒ <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> ⇒ 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" title="var">S</span> <span class="id" title="var">x</span>, <span class="id" title="var">S</span> <span class="id" title="var">y</span>) ⇒ <span class="id" title="keyword">fun</span> <span class="id" title="var">frec</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">frec</span> (<span class="id" title="var">S</span> <span class="id" title="var">y</span>, <span class="id" title="var">y</span>) <span class="id" title="var">_</span> +<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">frec</span> (<span class="id" title="var">S</span> <span class="id" title="var">y</span>, <span class="id" title="var">x</span>) <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">red</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">red</span>. <span class="id" title="tactic">compute</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intuition</span> <span class="id" title="var">lia</span>. <span class="id" title="tactic">red</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">compute</span>. <span class="id" title="tactic">intuition</span> <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Stdlib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">ExtrOcamlBasic</span>.<br/>
<span class="comment">(*&nbsp;Extraction&nbsp;gnlex.<br/>
Print&nbsp;Assumptions&nbsp;gnlex.&nbsp;*)</span><br/>

<br/>
<span class="comment">(*&nbsp;Eval&nbsp;native_compute&nbsp;in&nbsp;gnlex&nbsp;(4,&nbsp;3).&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">gnlex_0_l</span> <span class="id" title="var">y</span> : <span class="id" title="var">gnlex</span> (0, <span class="id" title="var">y</span>) = 1.<br/>
<span class="id" title="var">Admitted</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">gnlex_0_r</span> <span class="id" title="var">x</span> : <span class="id" title="var">gnlex</span> (<span class="id" title="var">x</span>, 0) = 1.<br/>
<span class="id" title="var">Admitted</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">gnlex_S</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="var">gnlex</span> (<span class="id" title="var">S</span> <span class="id" title="var">x</span>, <span class="id" title="var">S</span> <span class="id" title="var">y</span>) = <span class="id" title="var">gnlex</span> (<span class="id" title="var">S</span> <span class="id" title="var">y</span>, <span class="id" title="var">y</span>) + <span class="id" title="var">gnlex</span> (<span class="id" title="var">S</span> <span class="id" title="var">y</span>, <span class="id" title="var">x</span>).<br/>
<span class="id" title="var">Admitted</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">gnlex_S_test</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> : <span class="id" title="tactic">∃</span> <span class="id" title="var">foo</span>, <span class="id" title="var">gnlex</span> (<span class="id" title="var">S</span> <span class="id" title="var">x</span>, <span class="id" title="var">S</span> <span class="id" title="var">y</span>) = <span class="id" title="var">foo</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">gnlex_S</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">y</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">gnlex_0_r</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">gnlex_0_r</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">gnlex_S</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">gnlex_0_r</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">x</span>. <span class="id" title="var">admit</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">gnlex_S</span>.<br/>
<span class="id" title="var">Admitted</span>.<br/>
</div>
<hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>