<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>Examples.definterp</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<div class="code">
</div>

<div class="doc">
<a id="lab1"></a><h1 class="section">Definitional interpreter for STLC extended with references</h1>


<div class="paragraph"> </div>

  This is a port of the first part of "Intrinsically-Typed Definitional
  Interpreters for Imperative Languages", Poulsen, Rouvoet, Tolmach,
  Krebbers and Visser. POPL'18.

<div class="paragraph"> </div>

  It uses well-typed and well-scoped syntax and a monad indexed over an
  indexed set of stores to define an interpreter for an imperative
  programming language.

<div class="paragraph"> </div>

  This showcases the use of dependent pattern-matching and
  pattern-matching lambdas in Equations. We implement a variant where
  store extension is resolved using type class resolution as well as the
  dependent-passing style version. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Stdlib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Program.Basics</span> <span class="id" title="var">Program.Tactics</span>.<br/>
#[<span class="id" title="var">warnings</span>="-warn-library-file-stdlib-vector"]<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Stdlib.Vectors.VectorDef</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Stdlib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">List</span>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">ListNotations</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Stdlib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Utf8</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Equations.Prop</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="keyword">Equations</span>.<br/>

<br/>
<span class="id" title="keyword">Set</span> <span class="id" title="var">Warnings</span> "-notation-overridden".<br/>
</div>

<div class="doc">
The Σ notation of equations clashes with the Σ's used below,
    so we redefine the Σ notation using ∃ instead.
 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Notation</span> &quot;'∃' x .. y , P" := (<span class="id" title="var">sigma</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> ⇒ .. (<span class="id" title="var">sigma</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">y</span> ⇒ <span class="id" title="var">P</span>)) ..))<br/>
&nbsp;&nbsp;: <span class="id" title="var">type_scope</span>.<br/>

<br/>
<span class="id" title="keyword">Notation</span> &quot;( x , .. , y , z )" :=<br/>
&nbsp;&nbsp;(@<span class="id" title="var">sigmaI</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">x</span> .. (@<span class="id" title="var">sigmaI</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span>) ..)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">right</span> <span class="id" title="keyword">associativity</span>, <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">format</span> "( x ,  .. ,  y ,  z )") : <span class="id" title="var">equations_scope</span>.<br/>

<br/>
<span class="id" title="keyword">Notation</span> &quot; x .1 " := (<span class="id" title="var">pr1</span> <span class="id" title="var">x</span>) : <span class="id" title="var">equations_scope</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot; x .2 " := (<span class="id" title="var">pr2</span> <span class="id" title="var">x</span>) : <span class="id" title="var">equations_scope</span>.<br/>

<br/>
<span class="id" title="keyword">Local Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">equations_scope</span>.<br/>

<br/>
<span class="id" title="keyword">Set</span> <span class="id" title="keyword">Equations</span> <span class="id" title="keyword">Transparent</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><a class="idref" href="http://github.com/mattam82/Coq-Equations/tree/main/Equations.Examples.definterp.html#StoreOps.t"><span class="id" title="variable">t</span></a></span> is just <span class="inlinecode"><span class="id" title="var">Vector.t</span></span> here. 
</div>
<div class="code">
<span class="id" title="keyword">Derive</span> <span class="id" title="var">Signature</span> <span class="id" title="var">NoConfusion</span> <span class="id" title="var">NoConfusionHom</span> <span class="id" title="keyword">for</span> <span class="id" title="var">t</span>.<br/>

<br/>
</div>

<div class="doc">
Types include unit, bool, function types and references 
</div>
<div class="code">
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">Ty</span> : <span class="id" title="keyword">Set</span> :=<br/>
| <span class="id" title="var">unit</span> : <span class="id" title="var">Ty</span><br/>
| <span class="id" title="var">bool</span> : <span class="id" title="var">Ty</span><br/>
| <span class="id" title="var">arrow</span> (<span class="id" title="var">t</span> <span class="id" title="var">u</span> : <span class="id" title="var">Ty</span>) : <span class="id" title="var">Ty</span><br/>
| <span class="id" title="var">ref</span> : <span class="id" title="var">Ty</span> → <span class="id" title="var">Ty</span>.<br/>

<br/>
<span class="id" title="keyword">Derive</span> <span class="id" title="var">NoConfusion</span> <span class="id" title="keyword">for</span> <span class="id" title="var">Ty</span>.<br/>

<br/>
<span class="id" title="keyword">Infix</span> &quot;⇒" := <span class="id" title="var">arrow</span> (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 80).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">Ctx</span> := <span class="id" title="var">list</span> <span class="id" title="var">Ty</span>.<br/>

<br/>
<span class="id" title="keyword">Reserved Notation</span> &quot; x ∈ s " (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 70, <span class="id" title="var">s</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 10).<br/>

<br/>
#[<span class="id" title="var">universes</span>(<span class="id" title="var">template</span>)]<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">In</span> {<span class="id" title="var">A</span>} (<span class="id" title="var">x</span> : <span class="id" title="var">A</span>) : <span class="id" title="var">list</span> <span class="id" title="var">A</span> → <span class="id" title="keyword">Type</span> :=<br/>
| <span class="id" title="var">here</span> {<span class="id" title="var">xs</span>} : <span class="id" title="var">x</span> ∈ (<span class="id" title="var">x</span> :: <span class="id" title="var">xs</span>)<br/>
| <span class="id" title="var">there</span> {<span class="id" title="var">y</span> <span class="id" title="var">xs</span>} : <span class="id" title="var">x</span> ∈ <span class="id" title="var">xs</span> → <span class="id" title="var">x</span> ∈ (<span class="id" title="var">y</span> :: <span class="id" title="var">xs</span>)<br/>
<span class="id" title="keyword">where</span> &quot; x ∈ s " := (<span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">s</span>).<br/>
<span class="id" title="keyword">Derive</span> <span class="id" title="var">Signature</span> <span class="id" title="var">NoConfusion</span> <span class="id" title="keyword">for</span> <span class="id" title="var">In</span>.<br/>

<br/>
<span class="id" title="keyword">Arguments</span> <span class="id" title="var">here</span> {<span class="id" title="var">A</span> <span class="id" title="var">x</span> <span class="id" title="var">xs</span>}.<br/>
<span class="id" title="keyword">Arguments</span> <span class="id" title="var">there</span> {<span class="id" title="var">A</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">xs</span>} <span class="id" title="var">_</span>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">Expr</span> : <span class="id" title="var">Ctx</span> → <span class="id" title="var">Ty</span> → <span class="id" title="keyword">Set</span> :=<br/>
| <span class="id" title="var">tt</span> {<span class="id" title="var">Γ</span>} : <span class="id" title="var">Expr</span> <span class="id" title="var">Γ</span> <span class="id" title="var">unit</span><br/>
| <span class="id" title="var">true</span> {<span class="id" title="var">Γ</span>} : <span class="id" title="var">Expr</span> <span class="id" title="var">Γ</span> <span class="id" title="var">bool</span><br/>
| <span class="id" title="var">false</span> {<span class="id" title="var">Γ</span>} : <span class="id" title="var">Expr</span> <span class="id" title="var">Γ</span> <span class="id" title="var">bool</span><br/>
| <span class="id" title="var">ite</span> {<span class="id" title="var">Γ</span> <span class="id" title="var">t</span>} : <span class="id" title="var">Expr</span> <span class="id" title="var">Γ</span> <span class="id" title="var">bool</span> → <span class="id" title="var">Expr</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span> → <span class="id" title="var">Expr</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span> → <span class="id" title="var">Expr</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span><br/>
| <span class="id" title="var">var</span> {<span class="id" title="var">Γ</span>} {<span class="id" title="var">t</span>} : <span class="id" title="var">In</span> <span class="id" title="var">t</span> <span class="id" title="var">Γ</span> → <span class="id" title="var">Expr</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span><br/>
| <span class="id" title="var">abs</span> {<span class="id" title="var">Γ</span>} {<span class="id" title="var">t</span> <span class="id" title="var">u</span>} : <span class="id" title="var">Expr</span> (<span class="id" title="var">t</span> :: <span class="id" title="var">Γ</span>) <span class="id" title="var">u</span> → <span class="id" title="var">Expr</span> <span class="id" title="var">Γ</span> (<span class="id" title="var">t</span> ⇒ <span class="id" title="var">u</span>)<br/>
| <span class="id" title="var">app</span> {<span class="id" title="var">Γ</span>} {<span class="id" title="var">t</span> <span class="id" title="var">u</span>} : <span class="id" title="var">Expr</span> <span class="id" title="var">Γ</span> (<span class="id" title="var">t</span> ⇒ <span class="id" title="var">u</span>) → <span class="id" title="var">Expr</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span> → <span class="id" title="var">Expr</span> <span class="id" title="var">Γ</span> <span class="id" title="var">u</span><br/>
<br/>
<br/>
| <span class="id" title="var">new</span> {<span class="id" title="var">Γ</span> <span class="id" title="var">t</span>} : <span class="id" title="var">Expr</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span> → <span class="id" title="var">Expr</span> <span class="id" title="var">Γ</span> (<span class="id" title="var">ref</span> <span class="id" title="var">t</span>)<br/>
| <span class="id" title="var">deref</span> {<span class="id" title="var">Γ</span> <span class="id" title="var">t</span>} : <span class="id" title="var">Expr</span> <span class="id" title="var">Γ</span> (<span class="id" title="var">ref</span> <span class="id" title="var">t</span>) → <span class="id" title="var">Expr</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span><br/>
| <span class="id" title="var">assign</span> {<span class="id" title="var">Γ</span> <span class="id" title="var">t</span>} : <span class="id" title="var">Expr</span> <span class="id" title="var">Γ</span> (<span class="id" title="var">ref</span> <span class="id" title="var">t</span>) → <span class="id" title="var">Expr</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span> → <span class="id" title="var">Expr</span> <span class="id" title="var">Γ</span> <span class="id" title="var">unit</span>.<br/>

<br/>
</div>

<div class="doc">
We derive both <span class="inlinecode"><span class="id" title="var">NoConfusion</span></span> and <span class="inlinecode"><span class="id" title="var">NoConfusionHom</span></span> principles here, the later
    allows to simplify pattern-matching problems on <span class="inlinecode"><a class="idref" href="http://github.com/mattam82/Coq-Equations/tree/main/Equations.Examples.definterp.html#Expr"><span class="id" title="inductive">Expr</span></a></span> which would otherwise
    require K. It relies on an inversion analysis of every constructor, showing
    that the context and type indexes in the conclusions of every constructor
    are forced arguments. 
</div>
<div class="code">
<span class="id" title="keyword">Derive</span> <span class="id" title="var">Signature</span> <span class="id" title="var">NoConfusion</span> <span class="id" title="var">NoConfusionHom</span> <span class="id" title="keyword">for</span> <span class="id" title="var">Expr</span>.<br/>

<br/>
#[<span class="id" title="var">universes</span>(<span class="id" title="var">template</span>)]<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="keyword">All</span> {<span class="id" title="var">A</span>} (<span class="id" title="var">P</span> : <span class="id" title="var">A</span> → <span class="id" title="keyword">Type</span>) : <span class="id" title="var">list</span> <span class="id" title="var">A</span> → <span class="id" title="keyword">Type</span> :=<br/>
| <span class="id" title="var">all_nil</span> : <span class="id" title="keyword">All</span> <span class="id" title="var">P</span> []<br/>
| <span class="id" title="var">all_cons</span> {<span class="id" title="var">x</span> <span class="id" title="var">xs</span>} : <span class="id" title="var">P</span> <span class="id" title="var">x</span> → <span class="id" title="keyword">All</span> <span class="id" title="var">P</span> <span class="id" title="var">xs</span> → <span class="id" title="keyword">All</span> <span class="id" title="var">P</span> (<span class="id" title="var">x</span> :: <span class="id" title="var">xs</span>).<br/>
<span class="id" title="keyword">Arguments</span> <span class="id" title="var">all_nil</span> {<span class="id" title="var">A</span>} {<span class="id" title="var">P</span>}.<br/>
<span class="id" title="keyword">Arguments</span> <span class="id" title="var">all_cons</span> {<span class="id" title="var">A</span> <span class="id" title="var">P</span> <span class="id" title="var">x</span> <span class="id" title="var">xs</span>} <span class="id" title="var">_</span> <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Derive</span> <span class="id" title="var">Signature</span> <span class="id" title="var">NoConfusion</span> <span class="id" title="var">NoConfusionHom</span> <span class="id" title="keyword">for</span> <span class="id" title="keyword">All</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">MapAll</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">A</span>} {<span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="var">A</span> → <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span>, <span class="id" title="var">P</span> <span class="id" title="var">x</span> → <span class="id" title="var">Q</span> <span class="id" title="var">x</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">map_all</span> {<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>} : <span class="id" title="keyword">All</span> <span class="id" title="var">P</span> <span class="id" title="var">l</span> → <span class="id" title="keyword">All</span> <span class="id" title="var">Q</span> <span class="id" title="var">l</span> :=<br/>
&nbsp;&nbsp;&nbsp;| <span class="id" title="var">all_nil</span> := <span class="id" title="var">all_nil</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" title="var">all_cons</span> <span class="id" title="var">p</span> <span class="id" title="var">ps</span> := <span class="id" title="var">all_cons</span> (<span class="id" title="var">f</span> <span class="id" title="var">_</span> <span class="id" title="var">p</span>) (<span class="id" title="var">map_all</span> <span class="id" title="var">ps</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">map_all_in</span> {<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>} (<span class="id" title="var">f</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span>, <span class="id" title="var">x</span> ∈ <span class="id" title="var">l</span> → <span class="id" title="var">P</span> <span class="id" title="var">x</span> → <span class="id" title="var">Q</span> <span class="id" title="var">x</span>) : <span class="id" title="keyword">All</span> <span class="id" title="var">P</span> <span class="id" title="var">l</span> → <span class="id" title="keyword">All</span> <span class="id" title="var">Q</span> <span class="id" title="var">l</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">f</span>, <span class="id" title="var">all_nil</span> := <span class="id" title="var">all_nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">f</span>,  <span class="id" title="var">all_cons</span> <span class="id" title="var">p</span> <span class="id" title="var">ps</span> := <span class="id" title="var">all_cons</span> (<span class="id" title="var">f</span> <span class="id" title="var">_</span> <span class="id" title="var">here</span> <span class="id" title="var">p</span>) (<span class="id" title="var">map_all_in</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> <span class="id" title="var">inl</span> ⇒ <span class="id" title="var">f</span> <span class="id" title="var">x</span> (<span class="id" title="var">there</span> <span class="id" title="var">inl</span>)) <span class="id" title="var">ps</span>).<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">MapAll</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">StoreTy</span> := <span class="id" title="var">list</span> <span class="id" title="var">Ty</span>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">Val</span> : <span class="id" title="var">Ty</span> → <span class="id" title="var">StoreTy</span> → <span class="id" title="keyword">Set</span> :=<br/>
| <span class="id" title="var">val_unit</span> {<span class="id" title="var">Σ</span>} : <span class="id" title="var">Val</span> <span class="id" title="var">unit</span> <span class="id" title="var">Σ</span><br/>
| <span class="id" title="var">val_true</span> {<span class="id" title="var">Σ</span>} : <span class="id" title="var">Val</span> <span class="id" title="var">bool</span> <span class="id" title="var">Σ</span><br/>
| <span class="id" title="var">val_false</span> {<span class="id" title="var">Σ</span>} : <span class="id" title="var">Val</span> <span class="id" title="var">bool</span> <span class="id" title="var">Σ</span><br/>
| <span class="id" title="var">val_closure</span> {<span class="id" title="var">Σ</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span> <span class="id" title="var">u</span>} : <span class="id" title="var">Expr</span> (<span class="id" title="var">t</span> :: <span class="id" title="var">Γ</span>) <span class="id" title="var">u</span> → <span class="id" title="keyword">All</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">t</span> ⇒ <span class="id" title="var">Val</span> <span class="id" title="var">t</span> <span class="id" title="var">Σ</span>) <span class="id" title="var">Γ</span> → <span class="id" title="var">Val</span> (<span class="id" title="var">t</span> ⇒ <span class="id" title="var">u</span>) <span class="id" title="var">Σ</span><br/>
| <span class="id" title="var">val_loc</span> {<span class="id" title="var">Σ</span> <span class="id" title="var">t</span>} : <span class="id" title="var">t</span> ∈ <span class="id" title="var">Σ</span> → <span class="id" title="var">Val</span> (<span class="id" title="var">ref</span> <span class="id" title="var">t</span>) <span class="id" title="var">Σ</span>.<br/>

<br/>
<span class="id" title="keyword">Derive</span> <span class="id" title="var">Signature</span> <span class="id" title="var">NoConfusion</span> <span class="id" title="var">NoConfusionHom</span> <span class="id" title="keyword">for</span> <span class="id" title="var">Val</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">Env</span> (<span class="id" title="var">Γ</span> : <span class="id" title="var">Ctx</span>) (<span class="id" title="var">Σ</span> : <span class="id" title="var">StoreTy</span>) : <span class="id" title="keyword">Set</span> := <span class="id" title="keyword">All</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">t</span> ⇒ <span class="id" title="var">Val</span> <span class="id" title="var">t</span> <span class="id" title="var">Σ</span>) <span class="id" title="var">Γ</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">Store</span> (<span class="id" title="var">Σ</span> : <span class="id" title="var">StoreTy</span>) := <span class="id" title="keyword">All</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">t</span> ⇒ <span class="id" title="var">Val</span> <span class="id" title="var">t</span> <span class="id" title="var">Σ</span>) <span class="id" title="var">Σ</span>.<br/>

<br/>
<span class="id" title="keyword">Equations</span> <span class="id" title="var">lookup</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">A</span> <span class="id" title="var">P</span> <span class="id" title="var">xs</span>} {<span class="id" title="var">x</span> : <span class="id" title="var">A</span>}, <span class="id" title="keyword">All</span> <span class="id" title="var">P</span> <span class="id" title="var">xs</span> → <span class="id" title="var">x</span> ∈ <span class="id" title="var">xs</span> → <span class="id" title="var">P</span> <span class="id" title="var">x</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">lookup</span> (<span class="id" title="var">all_cons</span> <span class="id" title="var">p</span> <span class="id" title="var">_</span>) <span class="id" title="var">here</span> := <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">lookup</span> (<span class="id" title="var">all_cons</span> <span class="id" title="var">_</span> <span class="id" title="var">ps</span>) (<span class="id" title="var">there</span> <span class="id" title="var">ins</span>) := <span class="id" title="var">lookup</span> <span class="id" title="var">ps</span> <span class="id" title="var">ins</span>.<br/>

<br/>
<span class="id" title="keyword">Equations</span> <span class="id" title="var">update</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">A</span> <span class="id" title="var">P</span> <span class="id" title="var">xs</span>} {<span class="id" title="var">x</span> : <span class="id" title="var">A</span>}, <span class="id" title="keyword">All</span> <span class="id" title="var">P</span> <span class="id" title="var">xs</span> → <span class="id" title="var">x</span> ∈ <span class="id" title="var">xs</span> → <span class="id" title="var">P</span> <span class="id" title="var">x</span> → <span class="id" title="keyword">All</span> <span class="id" title="var">P</span> <span class="id" title="var">xs</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">update</span> (<span class="id" title="var">all_cons</span> <span class="id" title="var">p</span> <span class="id" title="var">ps</span>) <span class="id" title="var">here</span>        <span class="id" title="var">p'</span> := <span class="id" title="var">all_cons</span> <span class="id" title="var">p'</span> <span class="id" title="var">ps</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">update</span> (<span class="id" title="var">all_cons</span> <span class="id" title="var">p</span> <span class="id" title="var">ps</span>) (<span class="id" title="var">there</span> <span class="id" title="var">ins</span>) <span class="id" title="var">p'</span> := <span class="id" title="var">all_cons</span> <span class="id" title="var">p</span> (<span class="id" title="var">update</span> <span class="id" title="var">ps</span> <span class="id" title="var">ins</span> <span class="id" title="var">p'</span>).<br/>

<br/>
<span class="id" title="keyword">Equations</span> <span class="id" title="var">lookup_store</span> {<span class="id" title="var">Σ</span> <span class="id" title="var">t</span>} : <span class="id" title="var">t</span> ∈ <span class="id" title="var">Σ</span> → <span class="id" title="var">Store</span> <span class="id" title="var">Σ</span> → <span class="id" title="var">Val</span> <span class="id" title="var">t</span> <span class="id" title="var">Σ</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">lookup_store</span> <span class="id" title="var">l</span> σ := <span class="id" title="var">lookup</span> σ <span class="id" title="var">l</span>.<br/>

<br/>
<span class="id" title="keyword">Equations</span> <span class="id" title="var">update_store</span> {<span class="id" title="var">Σ</span> <span class="id" title="var">t</span>} : <span class="id" title="var">t</span> ∈ <span class="id" title="var">Σ</span> → <span class="id" title="var">Val</span> <span class="id" title="var">t</span> <span class="id" title="var">Σ</span> → <span class="id" title="var">Store</span> <span class="id" title="var">Σ</span> → <span class="id" title="var">Store</span> <span class="id" title="var">Σ</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">update_store</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> σ := <span class="id" title="var">update</span> σ <span class="id" title="var">l</span> <span class="id" title="var">v</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">store_incl</span> (<span class="id" title="var">Σ</span> <span class="id" title="var">Σ'</span> : <span class="id" title="var">StoreTy</span>) := <span class="id" title="var">sigma</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">Σ''</span> ⇒ <span class="id" title="var">Σ'</span> = <span class="id" title="var">Σ''</span> ++ <span class="id" title="var">Σ</span>).<br/>
<span class="id" title="keyword">Infix</span> &quot;⊑" := <span class="id" title="var">store_incl</span> (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 10).<br/>

<br/>
<span class="id" title="keyword">Equations</span> <span class="id" title="var">app_assoc</span> {<span class="id" title="var">A</span>} (<span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) : <span class="id" title="var">x</span> ++ <span class="id" title="var">y</span> ++ <span class="id" title="var">z</span> = (<span class="id" title="var">x</span> ++ <span class="id" title="var">y</span>) ++ <span class="id" title="var">z</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">app_assoc</span> <span class="id" title="var">nil</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> := <span class="id" title="var">eq_refl</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">app_assoc</span> (<span class="id" title="var">cons</span> <span class="id" title="var">x</span> <span class="id" title="var">xs</span>) <span class="id" title="var">y</span> <span class="id" title="var">z</span> := <span class="id" title="tactic">f_equal</span> (<span class="id" title="var">cons</span> <span class="id" title="var">x</span>) (<span class="id" title="var">app_assoc</span> <span class="id" title="var">xs</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span>).<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">StoreIncl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">pres_in</span> {<span class="id" title="var">Σ</span> <span class="id" title="var">Σ'</span>} (<span class="id" title="var">incl</span> : <span class="id" title="var">Σ</span> ⊑ <span class="id" title="var">Σ'</span>) <span class="id" title="var">t</span> (<span class="id" title="var">p</span> : <span class="id" title="var">t</span> ∈ <span class="id" title="var">Σ</span>) : <span class="id" title="var">t</span> ∈ <span class="id" title="var">Σ'</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pres_in</span> (<span class="id" title="var">Σ''</span>, <span class="id" title="var">eq_refl</span>) <span class="id" title="var">t</span> <span class="id" title="var">p</span> := <span class="id" title="var">aux</span> <span class="id" title="var">Σ''</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">where</span> <span class="id" title="var">aux</span> <span class="id" title="var">Σ''</span> : <span class="id" title="var">t</span> ∈ (<span class="id" title="var">Σ''</span> ++ <span class="id" title="var">Σ</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aux</span> <span class="id" title="var">nil</span> := <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aux</span> (<span class="id" title="var">cons</span> <span class="id" title="var">ty</span> <span class="id" title="var">tys</span>) := <span class="id" title="var">there</span> (<span class="id" title="var">aux</span> <span class="id" title="var">tys</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">refl_incl</span> {<span class="id" title="var">Σ</span>} : <span class="id" title="var">Σ</span> ⊑ <span class="id" title="var">Σ</span> := <span class="id" title="var">refl_incl</span> := ([], <span class="id" title="var">eq_refl</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">trans_incl</span> {<span class="id" title="var">Σ</span> <span class="id" title="var">Σ'</span> <span class="id" title="var">Σ''</span>} (<span class="id" title="var">incl</span> : <span class="id" title="var">Σ</span> ⊑ <span class="id" title="var">Σ'</span>) (<span class="id" title="var">incl'</span> : <span class="id" title="var">Σ'</span> ⊑ <span class="id" title="var">Σ''</span>) : <span class="id" title="var">Σ</span> ⊑ <span class="id" title="var">Σ''</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">trans_incl</span> (<span class="id" title="var">p</span>, <span class="id" title="var">eq_refl</span>) (<span class="id" title="var">q</span>, <span class="id" title="var">eq_refl</span>) := (<span class="id" title="var">q</span> ++ <span class="id" title="var">p</span>, <span class="id" title="var">app_assoc</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">store_ext_incl</span> {<span class="id" title="var">Σ</span> <span class="id" title="var">t</span>} : <span class="id" title="var">Σ</span> ⊑ (<span class="id" title="var">t</span> :: <span class="id" title="var">Σ</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">store_ext_incl</span> := ([<span class="id" title="var">t</span>], <span class="id" title="var">eq_refl</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">Σ</span> <span class="id" title="var">Σ'</span>} (<span class="id" title="var">incl</span> : <span class="id" title="var">Σ</span> ⊑ <span class="id" title="var">Σ'</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">weaken_val</span> {<span class="id" title="var">t</span>} (<span class="id" title="var">v</span> : <span class="id" title="var">Val</span> <span class="id" title="var">t</span> <span class="id" title="var">Σ</span>) : <span class="id" title="var">Val</span> <span class="id" title="var">t</span> <span class="id" title="var">Σ'</span> := {<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">weaken_val</span> (@<span class="id" title="var">val_unit</span> ?(<span class="id" title="var">Σ</span>)) := <span class="id" title="var">val_unit</span>;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">weaken_val</span> <span class="id" title="var">val_true</span> := <span class="id" title="var">val_true</span>;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">weaken_val</span> <span class="id" title="var">val_false</span> := <span class="id" title="var">val_false</span>;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">weaken_val</span> (<span class="id" title="var">val_closure</span> <span class="id" title="var">b</span> <span class="id" title="var">e</span>) := <span class="id" title="var">val_closure</span> <span class="id" title="var">b</span> (<span class="id" title="var">weaken_vals</span> <span class="id" title="var">e</span>);<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">weaken_val</span> (<span class="id" title="var">val_loc</span> <span class="id" title="var">H</span>) := <span class="id" title="var">val_loc</span> (<span class="id" title="var">pres_in</span> <span class="id" title="var">incl</span> <span class="id" title="var">_</span> <span class="id" title="var">H</span>) }<br/>
&nbsp;&nbsp;<span class="id" title="keyword">where</span> <span class="id" title="var">weaken_vals</span> {<span class="id" title="var">l</span>} (<span class="id" title="var">a</span> : <span class="id" title="keyword">All</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">t</span> ⇒ <span class="id" title="var">Val</span> <span class="id" title="var">t</span> <span class="id" title="var">Σ</span>) <span class="id" title="var">l</span>) : <span class="id" title="keyword">All</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">t</span> ⇒ <span class="id" title="var">Val</span> <span class="id" title="var">t</span> <span class="id" title="var">Σ'</span>) <span class="id" title="var">l</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">weaken_vals</span> <span class="id" title="var">all_nil</span> := <span class="id" title="var">all_nil</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">weaken_vals</span> (<span class="id" title="var">all_cons</span> <span class="id" title="var">p</span> <span class="id" title="var">ps</span>) := <span class="id" title="var">all_cons</span> (<span class="id" title="var">weaken_val</span> <span class="id" title="var">p</span>) (<span class="id" title="var">weaken_vals</span> <span class="id" title="var">ps</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">weakenv_vals</span> {<span class="id" title="var">l</span>} <span class="id" title="var">a</span> : @<span class="id" title="var">weaken_vals</span> <span class="id" title="var">l</span> <span class="id" title="var">a</span> = <span class="id" title="var">map_all</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">t</span> <span class="id" title="var">v</span> ⇒ <span class="id" title="var">weaken_val</span> <span class="id" title="var">v</span>) <span class="id" title="var">a</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">weakenv_vals</span> <span class="id" title="var">all_nil</span> := <span class="id" title="var">eq_refl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">weakenv_vals</span> (<span class="id" title="var">all_cons</span> <span class="id" title="var">p</span> <span class="id" title="var">ps</span>) := <span class="id" title="tactic">f_equal</span> (<span class="id" title="var">all_cons</span> (<span class="id" title="var">weaken_val</span> <span class="id" title="var">p</span>)) (<span class="id" title="var">weakenv_vals</span> <span class="id" title="var">ps</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">weaken_env</span> {<span class="id" title="var">Γ</span>} (<span class="id" title="var">v</span> : <span class="id" title="var">Env</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Σ</span>) : <span class="id" title="var">Env</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Σ'</span> := <span class="id" title="var">map_all</span> (@<span class="id" title="var">weaken_val</span>) <span class="id" title="var">v</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">StoreIncl</span>.<br/>

<br/>
<span class="id" title="keyword">Infix</span> &quot;⊚" := <span class="id" title="var">trans_incl</span> (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 10).<br/>

<br/>
<span class="id" title="keyword">Equations</span> <span class="id" title="var">M</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">Γ</span> : <span class="id" title="var">Ctx</span>) (<span class="id" title="var">P</span> : <span class="id" title="var">StoreTy</span> → <span class="id" title="keyword">Type</span>) (<span class="id" title="var">Σ</span> : <span class="id" title="var">StoreTy</span>), <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">M</span> <span class="id" title="var">Γ</span> <span class="id" title="var">P</span> <span class="id" title="var">Σ</span> := <span class="id" title="keyword">∀</span> (<span class="id" title="var">E</span> : <span class="id" title="var">Env</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Σ</span>) (<span class="id" title="var">μ</span> : <span class="id" title="var">Store</span> <span class="id" title="var">Σ</span>), <span class="id" title="var">option</span> (∃ <span class="id" title="var">Σ'</span> (<span class="id" title="var">μ'</span> : <span class="id" title="var">Store</span> <span class="id" title="var">Σ'</span>) (<span class="id" title="var">_</span> : <span class="id" title="var">P</span> <span class="id" title="var">Σ'</span>), <span class="id" title="var">Σ</span> ⊑ <span class="id" title="var">Σ'</span>).<br/>

<br/>
<span class="id" title="keyword">Equations</span> <span class="id" title="var">bind</span> {<span class="id" title="var">Σ</span> <span class="id" title="var">Γ</span>} {<span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="var">StoreTy</span> → <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">M</span> <span class="id" title="var">Γ</span> <span class="id" title="var">P</span> <span class="id" title="var">Σ</span>) (<span class="id" title="var">g</span> : ∀ {<span class="id" title="var">Σ'</span>}, <span class="id" title="var">P</span> <span class="id" title="var">Σ'</span> → <span class="id" title="var">M</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Q</span> <span class="id" title="var">Σ'</span>) : <span class="id" title="var">M</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Q</span> <span class="id" title="var">Σ</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">bind</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span> <span class="id" title="var">E</span> <span class="id" title="var">μ</span> <span class="id" title="keyword">with</span> <span class="id" title="var">f</span> <span class="id" title="var">E</span> <span class="id" title="var">μ</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">None</span> := <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> (<span class="id" title="var">Σ'</span>, <span class="id" title="var">μ'</span>, <span class="id" title="var">x</span>, <span class="id" title="var">ext</span>) <span class="id" title="keyword">with</span> <span class="id" title="var">g</span> <span class="id" title="var">_</span> <span class="id" title="var">x</span> (<span class="id" title="var">weaken_env</span> <span class="id" title="var">ext</span> <span class="id" title="var">E</span>) <span class="id" title="var">μ'</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">None</span> := <span class="id" title="var">None</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> (<span class="id" title="var">_</span>, <span class="id" title="var">μ''</span>, <span class="id" title="var">y</span>, <span class="id" title="var">ext'</span>) := <span class="id" title="var">Some</span> (<span class="id" title="var">_</span>, <span class="id" title="var">μ''</span>, <span class="id" title="var">y</span>, <span class="id" title="var">ext</span> ⊚ <span class="id" title="var">ext'</span>).<br/>

<br/>
<span class="id" title="keyword">Infix</span> &quot;&gt;&gt;=" := <span class="id" title="var">bind</span> (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 20, <span class="id" title="tactic">left</span> <span class="id" title="keyword">associativity</span>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">transp_op</span> {<span class="id" title="var">Γ</span> <span class="id" title="var">Σ</span> <span class="id" title="var">P</span>} (<span class="id" title="var">x</span> : <span class="id" title="var">Store</span> <span class="id" title="var">Σ</span> → <span class="id" title="var">P</span> <span class="id" title="var">Σ</span>) : <span class="id" title="var">M</span> <span class="id" title="var">Γ</span> <span class="id" title="var">P</span> <span class="id" title="var">Σ</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">E</span> <span class="id" title="var">μ</span> ⇒ <span class="id" title="var">Some</span> (<span class="id" title="var">Σ</span>, <span class="id" title="var">μ</span>, <span class="id" title="var">x</span> <span class="id" title="var">μ</span>, <span class="id" title="var">refl_incl</span>).<br/>

<br/>
<span class="id" title="keyword">Equations</span> <span class="id" title="var">ret</span> : ∀ {<span class="id" title="var">Γ</span> <span class="id" title="var">Σ</span> <span class="id" title="var">P</span>}, <span class="id" title="var">P</span> <span class="id" title="var">Σ</span> → <span class="id" title="var">M</span> <span class="id" title="var">Γ</span> <span class="id" title="var">P</span> <span class="id" title="var">Σ</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">ret</span> (<span class="id" title="var">Σ</span>:=<span class="id" title="var">Σ</span>) <span class="id" title="var">a</span> <span class="id" title="var">E</span> <span class="id" title="var">μ</span> := <span class="id" title="var">Some</span> (<span class="id" title="var">Σ</span>, <span class="id" title="var">μ</span>, <span class="id" title="var">a</span>, <span class="id" title="var">refl_incl</span>).<br/>

<br/>
<span class="id" title="keyword">Equations</span> <span class="id" title="var">getEnv</span> : ∀ {<span class="id" title="var">Γ</span> <span class="id" title="var">Σ</span>}, <span class="id" title="var">M</span> <span class="id" title="var">Γ</span> (<span class="id" title="var">Env</span> <span class="id" title="var">Γ</span>) <span class="id" title="var">Σ</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">getEnv</span> (<span class="id" title="var">Σ</span>:=<span class="id" title="var">Σ</span>) <span class="id" title="var">E</span> <span class="id" title="var">μ</span> := <span class="id" title="var">Some</span> (<span class="id" title="var">Σ</span>, <span class="id" title="var">μ</span>, <span class="id" title="var">E</span>, <span class="id" title="var">refl_incl</span>).<br/>

<br/>
<span class="id" title="keyword">Equations</span> <span class="id" title="var">usingEnv</span> {<span class="id" title="var">Γ</span> <span class="id" title="var">Γ'</span> <span class="id" title="var">Σ</span> <span class="id" title="var">P</span>} (<span class="id" title="var">E</span> : <span class="id" title="var">Env</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Σ</span>) (<span class="id" title="var">m</span> : <span class="id" title="var">M</span> <span class="id" title="var">Γ</span> <span class="id" title="var">P</span> <span class="id" title="var">Σ</span>) : <span class="id" title="var">M</span> <span class="id" title="var">Γ'</span> <span class="id" title="var">P</span> <span class="id" title="var">Σ</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">usingEnv</span> <span class="id" title="var">E</span> <span class="id" title="var">m</span> <span class="id" title="var">E'</span> <span class="id" title="var">μ</span> := <span class="id" title="var">m</span> <span class="id" title="var">E</span> <span class="id" title="var">μ</span>.<br/>

<br/>
<span class="id" title="keyword">Equations</span> <span class="id" title="var">timeout</span> : ∀ {<span class="id" title="var">Γ</span> <span class="id" title="var">Σ</span> <span class="id" title="var">P</span>}, <span class="id" title="var">M</span> <span class="id" title="var">Γ</span> <span class="id" title="var">P</span> <span class="id" title="var">Σ</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">timeout</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> := <span class="id" title="var">None</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">StoreOps</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">StoreTy</span>} {<span class="id" title="var">Γ</span> : <span class="id" title="var">Ctx</span>} {<span class="id" title="var">t</span> : <span class="id" title="var">Ty</span>}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">storeM</span> (<span class="id" title="var">v</span> : <span class="id" title="var">Val</span> <span class="id" title="var">t</span> <span class="id" title="var">Σ</span>) : <span class="id" title="var">M</span> <span class="id" title="var">Γ</span> (<span class="id" title="var">Val</span> (<span class="id" title="var">ref</span> <span class="id" title="var">t</span>)) <span class="id" title="var">Σ</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">storeM</span> <span class="id" title="var">v</span> <span class="id" title="var">E</span> <span class="id" title="var">μ</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">v</span> : <span class="id" title="var">Val</span> <span class="id" title="var">t</span> (<span class="id" title="var">t</span> :: <span class="id" title="var">Σ</span>) := <span class="id" title="var">weaken_val</span> <span class="id" title="var">store_ext_incl</span> <span class="id" title="var">v</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">μ'</span> := <span class="id" title="var">map_all</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">t'</span> ⇒ <span class="id" title="var">weaken_val</span> <span class="id" title="var">store_ext_incl</span>) <span class="id" title="var">μ</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> (<span class="id" title="var">t</span> :: <span class="id" title="var">Σ</span>, <span class="id" title="var">all_cons</span> <span class="id" title="var">v</span> <span class="id" title="var">μ'</span>, <span class="id" title="var">val_loc</span> <span class="id" title="var">here</span>, <span class="id" title="var">store_ext_incl</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">derefM</span> (<span class="id" title="var">l</span> : <span class="id" title="var">t</span> ∈ <span class="id" title="var">Σ</span>) : <span class="id" title="var">M</span> <span class="id" title="var">Γ</span> (<span class="id" title="var">Val</span> <span class="id" title="var">t</span>) <span class="id" title="var">Σ</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">derefM</span> <span class="id" title="var">l</span> := <span class="id" title="var">transp_op</span> (<span class="id" title="var">lookup_store</span> <span class="id" title="var">l</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">updateM</span> (<span class="id" title="var">l</span> : <span class="id" title="var">t</span> ∈ <span class="id" title="var">Σ</span>) (<span class="id" title="var">v</span> : <span class="id" title="var">Val</span> <span class="id" title="var">t</span> <span class="id" title="var">Σ</span>) : <span class="id" title="var">M</span> <span class="id" title="var">Γ</span> (<span class="id" title="var">Val</span> <span class="id" title="var">unit</span>) <span class="id" title="var">Σ</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">updateM</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">E</span> <span class="id" title="var">μ</span> := <span class="id" title="var">Some</span> (<span class="id" title="var">Σ</span>, <span class="id" title="var">update_store</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">μ</span>, <span class="id" title="var">val_unit</span>, <span class="id" title="var">refl_incl</span>).<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">StoreOps</span>.<br/>

<br/>
<span class="id" title="keyword">Reserved Notation</span> &quot;P ⊛ Q" (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 10).<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">storepred_prod</span> (<span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="var">StoreTy</span> → <span class="id" title="keyword">Type</span>) : <span class="id" title="var">StoreTy</span> → <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">storepred_pair</span> {<span class="id" title="var">Σ</span>} : <span class="id" title="var">P</span> <span class="id" title="var">Σ</span> → <span class="id" title="var">Q</span> <span class="id" title="var">Σ</span> → (<span class="id" title="var">P</span> ⊛ <span class="id" title="var">Q</span>) <span class="id" title="var">Σ</span><br/>
<span class="id" title="keyword">where</span> &quot;P ⊛ Q" := (<span class="id" title="var">storepred_prod</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span>).<br/>
<span class="id" title="keyword">Arguments</span> <span class="id" title="var">storepred_pair</span> {<span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">Σ</span>}.<br/>

<br/>
<span class="id" title="keyword">Class</span> <span class="id" title="var">Weakenable</span> (<span class="id" title="var">P</span> : <span class="id" title="var">StoreTy</span> → <span class="id" title="keyword">Type</span>) : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">weaken</span> : <span class="id" title="keyword">∀</span> {<span class="id" title="var">Σ</span> <span class="id" title="var">Σ'</span>}, <span class="id" title="var">Σ</span> ⊑ <span class="id" title="var">Σ'</span> → <span class="id" title="var">P</span> <span class="id" title="var">Σ</span> → <span class="id" title="var">P</span> <span class="id" title="var">Σ'</span>.<br/>

<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Instance</span> <span class="id" title="var">val_weaken</span> {<span class="id" title="var">t</span>} : <span class="id" title="var">Weakenable</span> (<span class="id" title="var">Val</span> <span class="id" title="var">t</span>) := <span class="id" title="keyword">fun</span> <span class="id" title="var">Σ</span> <span class="id" title="var">Σ'</span> <span class="id" title="var">incl</span> ⇒ <span class="id" title="var">weaken_val</span> <span class="id" title="var">incl</span>.<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Instance</span> <span class="id" title="var">env_weaken</span> {<span class="id" title="var">Γ</span>} : <span class="id" title="var">Weakenable</span> (<span class="id" title="var">Env</span> <span class="id" title="var">Γ</span>) := <span class="id" title="keyword">fun</span> <span class="id" title="var">Σ</span> <span class="id" title="var">Σ'</span> <span class="id" title="var">incl</span> ⇒ <span class="id" title="var">weaken_env</span> <span class="id" title="var">incl</span>.<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Instance</span> <span class="id" title="var">loc_weaken</span> (<span class="id" title="var">t</span> : <span class="id" title="var">Ty</span>) : <span class="id" title="var">Weakenable</span> (<span class="id" title="var">In</span> <span class="id" title="var">t</span>) := <span class="id" title="keyword">fun</span> <span class="id" title="var">Σ</span> <span class="id" title="var">Σ'</span> <span class="id" title="var">incl</span> ⇒ <span class="id" title="var">pres_in</span> <span class="id" title="var">incl</span> <span class="id" title="var">t</span>.<br/>

<br/>
<span class="id" title="keyword">Class</span> <span class="id" title="var">IsIncludedOnce</span> (<span class="id" title="var">Σ</span> <span class="id" title="var">Σ'</span> : <span class="id" title="var">StoreTy</span>) : <span class="id" title="keyword">Type</span> := <span class="id" title="var">is_included_once</span> : <span class="id" title="var">Σ</span> ⊑ <span class="id" title="var">Σ'</span>.<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="var">Mode</span> <span class="id" title="var">IsIncludedOnce</span> + + : <span class="id" title="var">typeclass_instances</span>.<br/>

<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Instance</span> <span class="id" title="var">IsIncludedOnce_ext</span> {<span class="id" title="var">T</span>} <span class="id" title="var">Σ</span> : <span class="id" title="var">IsIncludedOnce</span> <span class="id" title="var">Σ</span> (<span class="id" title="var">T</span> :: <span class="id" title="var">Σ</span>) := <span class="id" title="var">store_ext_incl</span>.<br/>

<br/>
<span class="id" title="keyword">Class</span> <span class="id" title="var">IsIncluded</span> (<span class="id" title="var">Σ</span> <span class="id" title="var">Σ'</span> : <span class="id" title="var">StoreTy</span>) : <span class="id" title="keyword">Type</span> := <span class="id" title="var">is_included</span> : <span class="id" title="var">Σ</span> ⊑ <span class="id" title="var">Σ'</span>.<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="var">Mode</span> <span class="id" title="var">IsIncluded</span> + + : <span class="id" title="var">typeclass_instances</span>.<br/>

<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Instance</span> <span class="id" title="var">IsIncluded_refl</span> <span class="id" title="var">Σ</span> : <span class="id" title="var">IsIncluded</span> <span class="id" title="var">Σ</span> <span class="id" title="var">Σ</span> := <span class="id" title="var">refl_incl</span>.<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Instance</span> <span class="id" title="var">IsIncluded_trans</span> <span class="id" title="var">Σ</span> <span class="id" title="var">Σ'</span> <span class="id" title="var">Σ''</span> : <span class="id" title="var">IsIncludedOnce</span> <span class="id" title="var">Σ</span> <span class="id" title="var">Σ'</span> → <span class="id" title="var">IsIncluded</span> <span class="id" title="var">Σ'</span> <span class="id" title="var">Σ''</span> → <span class="id" title="var">IsIncluded</span> <span class="id" title="var">Σ</span> <span class="id" title="var">Σ''</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">H</span> <span class="id" title="var">H'</span> ⇒ <span class="id" title="var">trans_incl</span> <span class="id" title="var">H</span> <span class="id" title="var">H'</span>.<br/>

<br/>
<span class="id" title="keyword">Equations</span> <span class="id" title="var">wk</span> {<span class="id" title="var">Σ</span> <span class="id" title="var">Σ'</span> <span class="id" title="var">P</span>} {<span class="id" title="var">W</span> : <span class="id" title="var">Weakenable</span> <span class="id" title="var">P</span>} (<span class="id" title="var">p</span> : <span class="id" title="var">P</span> <span class="id" title="var">Σ</span>) {<span class="id" title="var">incl</span> : <span class="id" title="var">IsIncluded</span> <span class="id" title="var">Σ</span> <span class="id" title="var">Σ'</span>} : <span class="id" title="var">P</span> <span class="id" title="var">Σ'</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">wk</span> <span class="id" title="var">p</span> := <span class="id" title="var">weaken</span> <span class="id" title="var">incl</span> <span class="id" title="var">p</span>.<br/>

<br/>
<span class="id" title="keyword">Equations</span> <span class="id" title="var">bind_ext</span> {<span class="id" title="var">Σ</span> <span class="id" title="var">Γ</span>} {<span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="var">StoreTy</span> → <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">M</span> <span class="id" title="var">Γ</span> <span class="id" title="var">P</span> <span class="id" title="var">Σ</span>) (<span class="id" title="var">g</span> : ∀ {<span class="id" title="var">Σ'</span>} `{<span class="id" title="var">IsIncluded</span> <span class="id" title="var">Σ</span> <span class="id" title="var">Σ'</span>}, <span class="id" title="var">P</span> <span class="id" title="var">Σ'</span> → <span class="id" title="var">M</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Q</span> <span class="id" title="var">Σ'</span>) : <span class="id" title="var">M</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Q</span> <span class="id" title="var">Σ</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">bind_ext</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span> <span class="id" title="var">E</span> <span class="id" title="var">μ</span> <span class="id" title="keyword">with</span> <span class="id" title="var">f</span> <span class="id" title="var">E</span> <span class="id" title="var">μ</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ | <span class="id" title="var">None</span> := <span class="id" title="var">None</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> (<span class="id" title="var">Σ'</span>, <span class="id" title="var">μ'</span>, <span class="id" title="var">x</span>, <span class="id" title="var">ext</span>) <span class="id" title="keyword">with</span> <span class="id" title="var">g</span> <span class="id" title="var">_</span> <span class="id" title="var">ext</span> <span class="id" title="var">x</span> (<span class="id" title="var">weaken_env</span> <span class="id" title="var">ext</span> <span class="id" title="var">E</span>) <span class="id" title="var">μ'</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ | <span class="id" title="var">None</span> := <span class="id" title="var">None</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> (<span class="id" title="var">_</span>, <span class="id" title="var">μ''</span>, <span class="id" title="var">y</span>, <span class="id" title="var">ext'</span>) := <span class="id" title="var">Some</span> (<span class="id" title="var">_</span>, <span class="id" title="var">μ''</span>, <span class="id" title="var">y</span>, <span class="id" title="var">ext</span> ⊚ <span class="id" title="var">ext'</span>) } }.<br/>

<br/>
<span class="id" title="keyword">Infix</span> &quot;&gt;&gt;='" := <span class="id" title="var">bind_ext</span> (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 20, <span class="id" title="tactic">left</span> <span class="id" title="keyword">associativity</span>).<br/>

<br/>
<span class="id" title="keyword">Equations</span> <span class="id" title="var">eval_ext</span> (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) {<span class="id" title="var">Γ</span> <span class="id" title="var">Σ</span> <span class="id" title="var">t</span>} (<span class="id" title="var">e</span> : <span class="id" title="var">Expr</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span>) : <span class="id" title="var">M</span> <span class="id" title="var">Γ</span> (<span class="id" title="var">Val</span> <span class="id" title="var">t</span>) <span class="id" title="var">Σ</span> :=<br/>
&nbsp;&nbsp;| 0, <span class="id" title="var">_</span>                := <span class="id" title="var">timeout</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">k</span>, <span class="id" title="var">tt</span>           := <span class="id" title="var">ret</span> <span class="id" title="var">val_unit</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">k</span>, <span class="id" title="var">true</span>         := <span class="id" title="var">ret</span> <span class="id" title="var">val_true</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">k</span>, <span class="id" title="var">false</span>        := <span class="id" title="var">ret</span> <span class="id" title="var">val_false</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">k</span>, <span class="id" title="var">ite</span> <span class="id" title="var">b</span> <span class="id" title="var">tr</span> <span class="id" title="var">fa</span>    := <span class="id" title="var">eval_ext</span> <span class="id" title="var">k</span> <span class="id" title="var">b</span> &gt;&gt;=' <span class="id" title="var">λ</span>{ | <span class="id" title="var">_</span> | <span class="id" title="var">ext</span> | <span class="id" title="var">val_true</span> ⇒ <span class="id" title="var">eval_ext</span> <span class="id" title="var">k</span> <span class="id" title="var">tr</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> | <span class="id" title="var">ext</span> | <span class="id" title="var">val_false</span> ⇒ <span class="id" title="var">eval_ext</span> <span class="id" title="var">k</span> <span class="id" title="var">fa</span> }<br/>
<br/>
&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">k</span>, <span class="id" title="var">var</span> <span class="id" title="var">x</span>        := <span class="id" title="var">getEnv</span> &gt;&gt;=' <span class="id" title="keyword">fun</span> {<span class="id" title="var">Σ</span> <span class="id" title="var">ext</span>} <span class="id" title="var">E</span> ⇒ <span class="id" title="var">ret</span> (<span class="id" title="var">lookup</span> <span class="id" title="var">E</span> <span class="id" title="var">x</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">k</span>, <span class="id" title="var">abs</span> <span class="id" title="var">x</span>        := <span class="id" title="var">getEnv</span> &gt;&gt;=' <span class="id" title="keyword">fun</span> {<span class="id" title="var">Σ</span> <span class="id" title="var">ext</span>} <span class="id" title="var">E</span> ⇒ <span class="id" title="var">ret</span> (<span class="id" title="var">val_closure</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">k</span>, @<span class="id" title="var">app</span> <span class="id" title="var">Γ</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eval_ext</span> <span class="id" title="var">k</span> <span class="id" title="var">e1</span> &gt;&gt;=' <span class="id" title="var">λ</span>{ | <span class="id" title="var">_</span> | <span class="id" title="var">ext</span> | <span class="id" title="var">val_closure</span> <span class="id" title="var">e'</span> <span class="id" title="var">E</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eval_ext</span> <span class="id" title="var">k</span> <span class="id" title="var">e2</span> &gt;&gt;=' <span class="id" title="keyword">fun</span> {<span class="id" title="var">Σ'</span> <span class="id" title="var">ext'</span>} <span class="id" title="var">v</span> ⇒ <span class="id" title="var">usingEnv</span> (<span class="id" title="var">all_cons</span> <span class="id" title="var">v</span> (<span class="id" title="var">wk</span> (<span class="id" title="var">P</span>:=<span class="id" title="var">Env</span> <span class="id" title="var">_</span>) <span class="id" title="var">E</span>)) (<span class="id" title="var">eval_ext</span> <span class="id" title="var">k</span> <span class="id" title="var">e'</span>)}<br/>
&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">k</span>, <span class="id" title="var">new</span> <span class="id" title="var">e</span>      := <span class="id" title="var">eval_ext</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> &gt;&gt;=' <span class="id" title="keyword">fun</span> {<span class="id" title="var">Σ</span> <span class="id" title="var">ext</span>} <span class="id" title="var">v</span> ⇒ <span class="id" title="var">storeM</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">k</span>, <span class="id" title="var">deref</span> <span class="id" title="var">l</span>    := <span class="id" title="var">eval_ext</span> <span class="id" title="var">k</span> <span class="id" title="var">l</span> &gt;&gt;=' <span class="id" title="var">λ</span>{ | <span class="id" title="var">_</span> | <span class="id" title="var">ext</span> | <span class="id" title="var">val_loc</span> <span class="id" title="var">l'</span> ⇒ <span class="id" title="var">derefM</span> <span class="id" title="var">l'</span> }<br/>
&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">k</span>, <span class="id" title="var">assign</span> <span class="id" title="var">l</span> <span class="id" title="var">e</span> := <span class="id" title="var">eval_ext</span> <span class="id" title="var">k</span> <span class="id" title="var">l</span> &gt;&gt;=' <span class="id" title="var">λ</span>{ | <span class="id" title="var">_</span> | <span class="id" title="var">ext</span> | <span class="id" title="var">val_loc</span> <span class="id" title="var">l'</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eval_ext</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> &gt;&gt;=' <span class="id" title="var">λ</span>{ | <span class="id" title="var">_</span> | <span class="id" title="var">ext'</span> | <span class="id" title="var">v</span> ⇒ <span class="id" title="var">updateM</span> (<span class="id" title="var">wk</span> <span class="id" title="var">l'</span>) (<span class="id" title="var">wk</span> <span class="id" title="var">v</span>) }}.<br/>

<br/>
<span class="id" title="keyword">Equations</span> <span class="id" title="var">strength</span> {<span class="id" title="var">Σ</span> <span class="id" title="var">Γ</span>} {<span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="var">StoreTy</span> → <span class="id" title="keyword">Type</span>} {<span class="id" title="var">w</span> : <span class="id" title="var">Weakenable</span> <span class="id" title="var">Q</span>} (<span class="id" title="var">m</span> : <span class="id" title="var">M</span> <span class="id" title="var">Γ</span> <span class="id" title="var">P</span> <span class="id" title="var">Σ</span>) (<span class="id" title="var">q</span> : <span class="id" title="var">Q</span> <span class="id" title="var">Σ</span>) : <span class="id" title="var">M</span> <span class="id" title="var">Γ</span> (<span class="id" title="var">P</span> ⊛ <span class="id" title="var">Q</span>) <span class="id" title="var">Σ</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">strength</span> <span class="id" title="var">m</span> <span class="id" title="var">q</span> <span class="id" title="var">E</span> <span class="id" title="var">μ</span> <span class="id" title="keyword">with</span> <span class="id" title="var">m</span> <span class="id" title="var">E</span> <span class="id" title="var">μ</span> ⇒ {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">None</span> ⇒ <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> (<span class="id" title="var">Σ'</span>, <span class="id" title="var">μ'</span>, <span class="id" title="var">p</span>, <span class="id" title="var">ext</span>) ⇒ <span class="id" title="var">Some</span> (<span class="id" title="var">Σ'</span>, <span class="id" title="var">μ'</span>, <span class="id" title="var">storepred_pair</span> <span class="id" title="var">p</span> (<span class="id" title="var">weaken</span> <span class="id" title="var">ext</span> <span class="id" title="var">q</span>), <span class="id" title="var">ext</span>) }.<br/>

<br/>
<span class="id" title="keyword">Infix</span> &quot;^" := <span class="id" title="var">strength</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Issue:&nbsp;improve&nbsp;pattern&nbsp;matching&nbsp;lambda&nbsp;to&nbsp;have&nbsp;implicit&nbsp;arguments&nbsp;implicit.<br/>
&nbsp;&nbsp;&nbsp;Hard&nbsp;because&nbsp;Coq&nbsp;does&nbsp;not&nbsp;keep&nbsp;the&nbsp;implicit&nbsp;status&nbsp;of&nbsp;bind's&nbsp;<span class="inlinecode"><span class="id" title="var">g</span></span>&nbsp;argument.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Equations</span> <span class="id" title="tactic">eval</span> (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) {<span class="id" title="var">Γ</span> <span class="id" title="var">Σ</span> <span class="id" title="var">t</span>} (<span class="id" title="var">e</span> : <span class="id" title="var">Expr</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span>) : <span class="id" title="var">M</span> <span class="id" title="var">Γ</span> (<span class="id" title="var">Val</span> <span class="id" title="var">t</span>) <span class="id" title="var">Σ</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eval</span> 0 <span class="id" title="var">_</span>                := <span class="id" title="var">timeout</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eval</span> (<span class="id" title="var">S</span> <span class="id" title="var">k</span>) <span class="id" title="var">tt</span>           := <span class="id" title="var">ret</span> <span class="id" title="var">val_unit</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eval</span> (<span class="id" title="var">S</span> <span class="id" title="var">k</span>) <span class="id" title="var">true</span>         := <span class="id" title="var">ret</span> <span class="id" title="var">val_true</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eval</span> (<span class="id" title="var">S</span> <span class="id" title="var">k</span>) <span class="id" title="var">false</span>        := <span class="id" title="var">ret</span> <span class="id" title="var">val_false</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eval</span> (<span class="id" title="var">S</span> <span class="id" title="var">k</span>) (<span class="id" title="var">ite</span> <span class="id" title="var">b</span> <span class="id" title="var">tr</span> <span class="id" title="var">fa</span>)  := <span class="id" title="tactic">eval</span> <span class="id" title="var">k</span> <span class="id" title="var">b</span> &gt;&gt;= <span class="id" title="var">λ</span>{ | <span class="id" title="var">_</span> | <span class="id" title="var">val_true</span> ⇒ <span class="id" title="tactic">eval</span> <span class="id" title="var">k</span> <span class="id" title="var">tr</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> | <span class="id" title="var">val_false</span> ⇒ <span class="id" title="tactic">eval</span> <span class="id" title="var">k</span> <span class="id" title="var">fa</span> };<br/>
<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eval</span> (<span class="id" title="var">S</span> <span class="id" title="var">k</span>) (<span class="id" title="var">var</span> <span class="id" title="var">x</span>)      := <span class="id" title="var">getEnv</span> &gt;&gt;= <span class="id" title="keyword">fun</span> <span class="id" title="var">Σ</span> <span class="id" title="var">E</span> ⇒ <span class="id" title="var">ret</span> (<span class="id" title="var">lookup</span> <span class="id" title="var">E</span> <span class="id" title="var">x</span>);<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eval</span> (<span class="id" title="var">S</span> <span class="id" title="var">k</span>) (<span class="id" title="var">abs</span> <span class="id" title="var">x</span>)      := <span class="id" title="var">getEnv</span> &gt;&gt;= <span class="id" title="keyword">fun</span> <span class="id" title="var">Σ</span> <span class="id" title="var">E</span> ⇒ <span class="id" title="var">ret</span> (<span class="id" title="var">val_closure</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span>);<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eval</span> (<span class="id" title="var">S</span> <span class="id" title="var">k</span>) (<span class="id" title="var">app</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eval</span> <span class="id" title="var">k</span> <span class="id" title="var">e1</span> &gt;&gt;= <span class="id" title="var">λ</span>{ | <span class="id" title="var">_</span> | <span class="id" title="var">val_closure</span> <span class="id" title="var">e'</span> <span class="id" title="var">E</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">eval</span> <span class="id" title="var">k</span> <span class="id" title="var">e2</span> ^ <span class="id" title="var">E</span>) &gt;&gt;= <span class="id" title="keyword">fun</span> <span class="id" title="var">Σ'</span> '(<span class="id" title="var">storepred_pair</span> <span class="id" title="var">v</span> <span class="id" title="var">E</span>) ⇒ <span class="id" title="var">usingEnv</span> (<span class="id" title="var">all_cons</span> <span class="id" title="var">v</span> <span class="id" title="var">E</span>) (<span class="id" title="tactic">eval</span> <span class="id" title="var">k</span> <span class="id" title="var">e'</span>)};<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eval</span> (<span class="id" title="var">S</span> <span class="id" title="var">k</span>) (<span class="id" title="var">new</span> <span class="id" title="var">e</span>)      := <span class="id" title="tactic">eval</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> &gt;&gt;= <span class="id" title="keyword">fun</span> <span class="id" title="var">Σ</span> <span class="id" title="var">v</span> ⇒ <span class="id" title="var">storeM</span> <span class="id" title="var">v</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eval</span> (<span class="id" title="var">S</span> <span class="id" title="var">k</span>) (<span class="id" title="var">deref</span> <span class="id" title="var">l</span>)    := <span class="id" title="tactic">eval</span> <span class="id" title="var">k</span> <span class="id" title="var">l</span> &gt;&gt;= <span class="id" title="var">λ</span>{ | <span class="id" title="var">_</span> | <span class="id" title="var">val_loc</span> <span class="id" title="var">l'</span> ⇒ <span class="id" title="var">derefM</span> <span class="id" title="var">l'</span> };<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eval</span> (<span class="id" title="var">S</span> <span class="id" title="var">k</span>) (<span class="id" title="var">assign</span> <span class="id" title="var">l</span> <span class="id" title="var">e</span>) := <span class="id" title="tactic">eval</span> <span class="id" title="var">k</span> <span class="id" title="var">l</span> &gt;&gt;= <span class="id" title="var">λ</span>{ | <span class="id" title="var">_</span> | <span class="id" title="var">val_loc</span> <span class="id" title="var">l'</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">eval</span> <span class="id" title="var">k</span> <span class="id" title="var">e</span> ^ <span class="id" title="var">l'</span>) &gt;&gt;= <span class="id" title="var">λ</span>{ | <span class="id" title="var">_</span> | <span class="id" title="var">storepred_pair</span> <span class="id" title="var">v</span> <span class="id" title="var">l''</span> ⇒ <span class="id" title="var">updateM</span> <span class="id" title="var">l''</span> <span class="id" title="var">v</span> }}.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">idu</span> : <span class="id" title="var">Expr</span> [] (<span class="id" title="var">unit</span> ⇒ <span class="id" title="var">unit</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">abs</span> (<span class="id" title="var">var</span> <span class="id" title="var">here</span>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">idapp</span> : <span class="id" title="var">Expr</span> [] <span class="id" title="var">unit</span> := <span class="id" title="var">app</span> <span class="id" title="var">idu</span> <span class="id" title="var">tt</span>.<br/>

<br/>
</div>

<div class="doc">
All definitions are axiom-free (and actually not even dependent on a provable UIP instance), so
 everything computes. 
</div>
<div class="code">
<span class="id" title="keyword">Eval</span> <span class="id" title="keyword">vm_compute</span> <span class="id" title="tactic">in</span> <span class="id" title="tactic">eval</span> 100 <span class="id" title="var">idapp</span> <span class="id" title="var">all_nil</span> <span class="id" title="var">all_nil</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">neg</span> : <span class="id" title="var">Expr</span> [] (<span class="id" title="var">bool</span> ⇒ <span class="id" title="var">bool</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">abs</span> (<span class="id" title="var">ite</span> (<span class="id" title="var">var</span> <span class="id" title="var">here</span>) <span class="id" title="var">false</span> <span class="id" title="var">true</span>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">letref</span> {<span class="id" title="var">t</span> <span class="id" title="var">u</span>} (<span class="id" title="var">v</span> : <span class="id" title="var">Expr</span> [] <span class="id" title="var">t</span>) (<span class="id" title="var">b</span> : <span class="id" title="var">Expr</span> [<span class="id" title="var">ref</span> <span class="id" title="var">t</span>] <span class="id" title="var">u</span>) : <span class="id" title="var">Expr</span> [] <span class="id" title="var">u</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">app</span> (<span class="id" title="var">abs</span> <span class="id" title="var">b</span>) (<span class="id" title="var">new</span> <span class="id" title="var">v</span>).<br/>
<span class="id" title="keyword">Local Obligation</span> <span class="id" title="keyword">Tactic</span> := <span class="id" title="tactic">idtac</span>.<br/>

<br/>
<span class="id" title="keyword">Equations</span> <span class="id" title="var">in_app_weaken</span> {<span class="id" title="var">Σ</span> <span class="id" title="var">Σ'</span> <span class="id" title="var">Σ''</span> : <span class="id" title="var">StoreTy</span>} {<span class="id" title="var">t</span>} (<span class="id" title="var">p</span> : <span class="id" title="var">t</span> ∈ (<span class="id" title="var">Σ</span> ++ <span class="id" title="var">Σ''</span>)) : <span class="id" title="var">t</span> ∈ (<span class="id" title="var">Σ</span> ++ <span class="id" title="var">Σ'</span> ++ <span class="id" title="var">Σ''</span>) <span class="id" title="tactic">by</span> <span class="id" title="keyword">struct</span> <span class="id" title="var">Σ</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">in_app_weaken</span> (<span class="id" title="var">Σ</span>:=<span class="id" title="var">nil</span>) <span class="id" title="var">p</span> := <span class="id" title="var">pres_in</span> (<span class="id" title="var">Σ'</span>, <span class="id" title="var">eq_refl</span>) <span class="id" title="var">t</span> <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">in_app_weaken</span> (<span class="id" title="var">Σ</span>:=<span class="id" title="var">cons</span> <span class="id" title="var">_</span> <span class="id" title="var">tys</span>) <span class="id" title="var">here</span> := <span class="id" title="var">here</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">in_app_weaken</span> (<span class="id" title="var">Σ</span>:=<span class="id" title="var">cons</span> <span class="id" title="var">_</span> <span class="id" title="var">tys</span>) (<span class="id" title="var">there</span> <span class="id" title="var">p</span>) := <span class="id" title="var">there</span> (<span class="id" title="var">in_app_weaken</span> <span class="id" title="var">p</span>).<br/>

<br/>
<span class="id" title="keyword">Equations</span> <span class="id" title="var">pres_in_prefix</span> {<span class="id" title="var">Σ</span> <span class="id" title="var">Σ'</span> <span class="id" title="var">Σ''</span>} (<span class="id" title="var">incl</span> : <span class="id" title="var">Σ'</span> ⊑ <span class="id" title="var">Σ''</span>) {<span class="id" title="var">t</span>} (<span class="id" title="var">p</span> : <span class="id" title="var">t</span> ∈ (<span class="id" title="var">Σ</span> ++ <span class="id" title="var">Σ'</span>)) : <span class="id" title="var">t</span> ∈ (<span class="id" title="var">Σ</span> ++ <span class="id" title="var">Σ''</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">pres_in_prefix</span> (<span class="id" title="var">Σ''</span>, <span class="id" title="var">eq_refl</span>) <span class="id" title="var">p</span> := <span class="id" title="var">in_app_weaken</span> <span class="id" title="var">p</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="keyword">Equations</span>?</span> enters refinement mode, which can be used to solve the case of variables in proof mode. 
</div>
<div class="code">
<span class="id" title="keyword">Equations</span>? <span class="id" title="var">weaken_expr</span> {<span class="id" title="var">Γ</span> <span class="id" title="var">Γ'</span> <span class="id" title="var">t</span> <span class="id" title="var">u</span>} (<span class="id" title="var">e1</span> : <span class="id" title="var">Expr</span> (<span class="id" title="var">Γ</span> ++ <span class="id" title="var">Γ'</span>) <span class="id" title="var">t</span>) : <span class="id" title="var">Expr</span> (<span class="id" title="var">Γ</span> ++ <span class="id" title="var">u</span> :: <span class="id" title="var">Γ'</span>) <span class="id" title="var">t</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">weaken_expr</span> <span class="id" title="var">tt</span>              := <span class="id" title="var">tt</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">weaken_expr</span> <span class="id" title="var">true</span>            := <span class="id" title="var">true</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">weaken_expr</span> <span class="id" title="var">false</span>           := <span class="id" title="var">false</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">weaken_expr</span> (<span class="id" title="var">ite</span> <span class="id" title="var">b</span> <span class="id" title="var">tr</span> <span class="id" title="var">fa</span>)   := <span class="id" title="var">ite</span> (<span class="id" title="var">weaken_expr</span> <span class="id" title="var">b</span>) (<span class="id" title="var">weaken_expr</span> <span class="id" title="var">tr</span>) (<span class="id" title="var">weaken_expr</span> <span class="id" title="var">fa</span>);<br/>
&nbsp;&nbsp;<span class="id" title="var">weaken_expr</span> (<span class="id" title="var">var</span> (<span class="id" title="var">t</span>:=<span class="id" title="var">ty</span>) <span class="id" title="var">x</span>) := <span class="id" title="var">var</span> <span class="id" title="var">_</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">weaken_expr</span> (<span class="id" title="var">abs</span> (<span class="id" title="var">t</span>:=<span class="id" title="var">t</span>) <span class="id" title="var">x</span>)  := <span class="id" title="var">abs</span> (<span class="id" title="var">weaken_expr</span> (<span class="id" title="var">Γ</span> := <span class="id" title="var">t</span> :: <span class="id" title="var">Γ</span>) <span class="id" title="var">x</span>);<br/>
&nbsp;&nbsp;<span class="id" title="var">weaken_expr</span> (<span class="id" title="var">app</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span>)     := <span class="id" title="var">app</span> (<span class="id" title="var">weaken_expr</span> <span class="id" title="var">e1</span>) (<span class="id" title="var">weaken_expr</span> <span class="id" title="var">e2</span>);<br/>
&nbsp;&nbsp;<span class="id" title="var">weaken_expr</span> (<span class="id" title="var">new</span> <span class="id" title="var">e</span>)         := <span class="id" title="var">new</span> (<span class="id" title="var">weaken_expr</span> <span class="id" title="var">e</span>);<br/>
&nbsp;&nbsp;<span class="id" title="var">weaken_expr</span> (<span class="id" title="var">deref</span> <span class="id" title="var">l</span>)       := <span class="id" title="var">deref</span> (<span class="id" title="var">weaken_expr</span> <span class="id" title="var">l</span>);<br/>
&nbsp;&nbsp;<span class="id" title="var">weaken_expr</span> (<span class="id" title="var">assign</span> <span class="id" title="var">l</span> <span class="id" title="var">e</span>)    := <span class="id" title="var">assign</span> (<span class="id" title="var">weaken_expr</span> <span class="id" title="var">l</span>) (<span class="id" title="var">weaken_expr</span> <span class="id" title="var">e</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">weaken_expr</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="var">pres_in_prefix</span> (<span class="id" title="var">Σ'</span> := <span class="id" title="var">Γ'</span>) ([<span class="id" title="var">u</span>], <span class="id" title="var">eq_refl</span>) <span class="id" title="var">x</span>).<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">seq</span> {<span class="id" title="var">Γ</span> <span class="id" title="var">u</span>} (<span class="id" title="var">e1</span> : <span class="id" title="var">Expr</span> <span class="id" title="var">Γ</span> <span class="id" title="var">unit</span>) (<span class="id" title="var">e2</span> : <span class="id" title="var">Expr</span> <span class="id" title="var">Γ</span> <span class="id" title="var">u</span>) : <span class="id" title="var">Expr</span> <span class="id" title="var">Γ</span> <span class="id" title="var">u</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">app</span> (<span class="id" title="var">abs</span> (<span class="id" title="var">weaken_expr</span> (<span class="id" title="var">Γ</span> := []) <span class="id" title="var">e2</span>)) <span class="id" title="var">e1</span>.<br/>

<br/>
<span class="comment">(*&nbsp;let&nbsp;x&nbsp;=&nbsp;ref&nbsp;true&nbsp;in<br/>
&nbsp;&nbsp;&nbsp;x&nbsp;:=&nbsp;false;&nbsp;!x&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">letupdate</span> : <span class="id" title="var">Expr</span> [] <span class="id" title="var">bool</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">letref</span> <span class="id" title="var">true</span> (<span class="id" title="var">seq</span> (<span class="id" title="var">assign</span> (<span class="id" title="var">var</span> <span class="id" title="var">here</span>) <span class="id" title="var">false</span>) (<span class="id" title="var">deref</span> (<span class="id" title="var">var</span> <span class="id" title="var">here</span>))).<br/>

<br/>
<span class="id" title="keyword">Eval</span> <span class="id" title="keyword">vm_compute</span> <span class="id" title="tactic">in</span> <span class="id" title="tactic">eval</span> 100 <span class="id" title="var">letupdate</span> <span class="id" title="var">all_nil</span> <span class="id" title="var">all_nil</span>.<br/>
</div>

<div class="doc">
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;= <a class="idref" href="http://coq.inria.fr/doc/V9.0+rc1/stdlib//Corelib.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> ([<a class="idref" href="http://github.com/mattam82/Coq-Equations/tree/main/Equations.Examples.definterp.html#bool"><span class="id" title="constructor">bool</span></a>], <a class="idref" href="http://github.com/mattam82/Coq-Equations/tree/main/Equations.Examples.definterp.html#all_cons"><span class="id" title="constructor">all_cons</span></a> <a class="idref" href="http://github.com/mattam82/Coq-Equations/tree/main/Equations.Examples.definterp.html#val_false"><span class="id" title="constructor">val_false</span></a> <a class="idref" href="http://github.com/mattam82/Coq-Equations/tree/main/Equations.Examples.definterp.html#all_nil"><span class="id" title="constructor">all_nil</span></a>, <a class="idref" href="http://github.com/mattam82/Coq-Equations/tree/main/Equations.Examples.definterp.html#val_false"><span class="id" title="constructor">val_false</span></a>, [<a class="idref" href="http://github.com/mattam82/Coq-Equations/tree/main/Equations.Examples.definterp.html#bool"><span class="id" title="constructor">bool</span></a>], <a class="idref" href="http://coq.inria.fr/doc/V9.0+rc1/stdlib//Corelib.Init.Logic.html#eq_refl"><span class="id" title="constructor">eq_refl</span></a>)<br/>
&nbsp;&nbsp;&nbsp;: <a class="idref" href="http://coq.inria.fr/doc/V9.0+rc1/stdlib//Corelib.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> (∃ (<a class="idref" href="http://github.com/mattam82/Coq-Equations/tree/main/Equations.Examples.definterp.html#711ca5f514e76ccc192c9af9402e3193"><span class="id" title="variable">Σ'</span></a> : <a class="idref" href="http://github.com/mattam82/Coq-Equations/tree/main/Equations.Examples.definterp.html#StoreTy"><span class="id" title="definition">StoreTy</span></a>) (<span class="id" title="var">_</span> : <a class="idref" href="http://github.com/mattam82/Coq-Equations/tree/main/Equations.Examples.definterp.html#Store"><span class="id" title="definition">Store</span></a> <a class="idref" href="http://github.com/mattam82/Coq-Equations/tree/main/Equations.Examples.definterp.html#711ca5f514e76ccc192c9af9402e3193"><span class="id" title="variable">Σ'</span></a>) (<span class="id" title="var">_</span> : <a class="idref" href="http://github.com/mattam82/Coq-Equations/tree/main/Equations.Examples.definterp.html#Val"><span class="id" title="inductive">Val</span></a> <a class="idref" href="http://github.com/mattam82/Coq-Equations/tree/main/Equations.Examples.definterp.html#bool"><span class="id" title="constructor">bool</span></a> <a class="idref" href="http://github.com/mattam82/Coq-Equations/tree/main/Equations.Examples.definterp.html#711ca5f514e76ccc192c9af9402e3193"><span class="id" title="variable">Σ'</span></a>), [] ⊑ <a class="idref" href="http://github.com/mattam82/Coq-Equations/tree/main/Equations.Examples.definterp.html#711ca5f514e76ccc192c9af9402e3193"><span class="id" title="variable">Σ'</span></a>)
<div class="paragraph"> </div>

</span>
</div>
<div class="code">
</div>
<hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>