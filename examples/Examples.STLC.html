<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>Examples.STLC</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<div class="code">
</div>

<div class="doc">
<a id="lab1"></a><h1 class="section">Normalization of Simply Typed Lambda-Calculus through Hereditary Substitutions.</h1>


<div class="paragraph"> </div>

  Uses extrinsic encoding of terms, with de Bruijn indices, lifting and
  substitution. Derive hereditary substitution function justified by a
  well-founded order on typable terms and conclude with a normalizer building
  beta-short eta-long normal forms, typable in a bidirectional type system. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Stdlib</span> <span class="id" title="keyword">Require</span> <span class="id" title="var">Program</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Equations.Prop</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="keyword">Equations</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Stdlib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Lia</span> <span class="id" title="var">List</span> <span class="id" title="var">Utf8</span>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">ListNotations</span>.<br/>

<br/>
<span class="id" title="keyword">Set</span> <span class="id" title="var">Keyed</span> <span class="id" title="var">Unification</span>.<br/>

<br/>
<span class="id" title="keyword">Derive</span> <span class="id" title="var">Signature</span> <span class="id" title="keyword">for</span> <span class="id" title="var">le</span> <span class="id" title="var">CompareSpec</span>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">term</span> := <br/>
| <span class="id" title="var">Var</span> (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>)<br/>
| <span class="id" title="var">Lambda</span> (<span class="id" title="var">t</span> : <span class="id" title="var">term</span>)<br/>
| <span class="id" title="var">App</span> (<span class="id" title="var">t</span> <span class="id" title="var">u</span> : <span class="id" title="var">term</span>)<br/>
| <span class="id" title="var">Pair</span> (<span class="id" title="var">t</span> <span class="id" title="var">u</span> : <span class="id" title="var">term</span>)<br/>
| <span class="id" title="var">Fst</span> (<span class="id" title="var">t</span> : <span class="id" title="var">term</span>) | <span class="id" title="var">Snd</span> (<span class="id" title="var">t</span> : <span class="id" title="var">term</span>)<br/>
| <span class="id" title="var">Tt</span>.<br/>

<br/>
<span class="id" title="keyword">Derive</span> <span class="id" title="var">NoConfusion</span> <span class="id" title="var">Subterm</span> <span class="id" title="var">EqDec</span> <span class="id" title="keyword">for</span> <span class="id" title="var">term</span>.<br/>

<br/>
<span class="id" title="keyword">Coercion</span> <span class="id" title="var">Var</span> : <span class="id" title="var">nat</span> &gt;-&gt; <span class="id" title="var">term</span>.<br/>

<br/>
<span class="id" title="keyword">Declare Scope</span> <span class="id" title="var">term_scope</span>.<br/>
<span class="id" title="keyword">Delimit</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">term_scope</span> <span class="id" title="keyword">with</span> <span class="id" title="var">term</span>.<br/>
<span class="id" title="keyword">Bind Scope</span> <span class="id" title="var">term_scope</span> <span class="id" title="keyword">with</span> <span class="id" title="var">term</span>.<br/>

<br/>
<span class="id" title="keyword">Notation</span> &quot; @( f , x ) " := (<span class="id" title="var">App</span> (<span class="id" title="var">f</span>%<span class="id" title="var">term</span>) (<span class="id" title="var">x</span>%<span class="id" title="var">term</span>)).<br/>
#[<span class="id" title="var">warnings</span>="-notation-incompatible-prefix"]<br/>
<span class="id" title="keyword">Notation</span> " 'λ' t " := (<span class="id" title="var">Lambda</span> (<span class="id" title="var">t</span>%<span class="id" title="var">term</span>)) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 10).<br/>
<span class="id" title="keyword">Notation</span> &quot; &lt;&lt; t , u &gt;&gt; " := (<span class="id" title="var">Pair</span> (<span class="id" title="var">t</span>%<span class="id" title="var">term</span>) (<span class="id" title="var">u</span>%<span class="id" title="var">term</span>)).<br/>

<br/>
<span class="id" title="keyword">Parameter</span> <span class="id" title="var">atomic_type</span> : <span class="id" title="keyword">Set</span>.<br/>
<span class="id" title="keyword">Parameter</span> <span class="id" title="var">atomic_type_eqdec</span> : <span class="id" title="var">EqDec</span> <span class="id" title="var">atomic_type</span>.<br/>
#[<span class="id" title="var">export</span>] <span class="id" title="var">Existing</span> <span class="id" title="keyword">Instance</span> <span class="id" title="var">atomic_type_eqdec</span>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="keyword">type</span> :=<br/>
| <span class="id" title="var">atom</span> (<span class="id" title="var">a</span> : <span class="id" title="var">atomic_type</span>)<br/>
| <span class="id" title="var">product</span> (<span class="id" title="var">a</span> <span class="id" title="var">b</span> : <span class="id" title="keyword">type</span>)<br/>
| <span class="id" title="var">unit</span><br/>
| <span class="id" title="var">arrow</span> (<span class="id" title="var">a</span> <span class="id" title="var">b</span> : <span class="id" title="keyword">type</span>).<br/>

<br/>
<span class="id" title="keyword">Derive</span> <span class="id" title="var">NoConfusion</span> <span class="id" title="var">Subterm</span> <span class="id" title="var">EqDec</span> <span class="id" title="keyword">for</span> <span class="id" title="keyword">type</span>.<br/>

<br/>
<span class="id" title="keyword">Coercion</span> <span class="id" title="var">atom</span> : <span class="id" title="var">atomic_type</span> &gt;-&gt; <span class="id" title="keyword">type</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot; x × y " := (<span class="id" title="var">product</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 90).<br/>
<span class="id" title="keyword">Notation</span> &quot; x ---&gt; y " := (<span class="id" title="var">arrow</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 30).<br/>

<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Stdlib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Arith</span>.<br/>

<br/>
<span class="id" title="keyword">Equations</span> <span class="id" title="var">lift</span> (<span class="id" title="var">k</span> <span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">term</span>) : <span class="id" title="var">term</span> :=<br/>
<span class="id" title="var">lift</span> <span class="id" title="var">k</span> <span class="id" title="var">n</span> (<span class="id" title="var">Var</span> <span class="id" title="var">i</span>) <span class="id" title="keyword">with</span> <span class="id" title="var">Nat.compare</span> <span class="id" title="var">i</span> <span class="id" title="var">k</span> := {<br/>
&nbsp;&nbsp;| <span class="id" title="var">Lt</span> := <span class="id" title="var">Var</span> <span class="id" title="var">i</span> ;<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> := <span class="id" title="var">Var</span> (<span class="id" title="var">i</span> + <span class="id" title="var">n</span>) } ;<br/>
<span class="id" title="var">lift</span> <span class="id" title="var">k</span> <span class="id" title="var">n</span> (<span class="id" title="var">Lambda</span> <span class="id" title="var">t</span>) := <span class="id" title="var">Lambda</span> (<span class="id" title="var">lift</span> (<span class="id" title="var">S</span> <span class="id" title="var">k</span>) <span class="id" title="var">n</span> <span class="id" title="var">t</span>) ;<br/>
<span class="id" title="var">lift</span> <span class="id" title="var">k</span> <span class="id" title="var">n</span> (<span class="id" title="var">App</span> <span class="id" title="var">t</span> <span class="id" title="var">u</span>) := @(<span class="id" title="var">lift</span> <span class="id" title="var">k</span> <span class="id" title="var">n</span> <span class="id" title="var">t</span>, <span class="id" title="var">lift</span> <span class="id" title="var">k</span> <span class="id" title="var">n</span> <span class="id" title="var">u</span>) ;<br/>
<span class="id" title="var">lift</span> <span class="id" title="var">k</span> <span class="id" title="var">n</span> (<span class="id" title="var">Pair</span> <span class="id" title="var">t</span> <span class="id" title="var">u</span>) := &lt;&lt; <span class="id" title="var">lift</span> <span class="id" title="var">k</span> <span class="id" title="var">n</span> <span class="id" title="var">t</span>, <span class="id" title="var">lift</span> <span class="id" title="var">k</span> <span class="id" title="var">n</span> <span class="id" title="var">u</span> &gt;&gt; ;<br/>
<span class="id" title="var">lift</span> <span class="id" title="var">k</span> <span class="id" title="var">n</span> (<span class="id" title="var">Fst</span> <span class="id" title="var">t</span>) := <span class="id" title="var">Fst</span> (<span class="id" title="var">lift</span> <span class="id" title="var">k</span> <span class="id" title="var">n</span> <span class="id" title="var">t</span>) ;<br/>
<span class="id" title="var">lift</span> <span class="id" title="var">k</span> <span class="id" title="var">n</span> (<span class="id" title="var">Snd</span> <span class="id" title="var">t</span>) := <span class="id" title="var">Snd</span> (<span class="id" title="var">lift</span> <span class="id" title="var">k</span> <span class="id" title="var">n</span> <span class="id" title="var">t</span>) ;<br/>
<span class="id" title="var">lift</span> <span class="id" title="var">k</span> <span class="id" title="var">n</span> <span class="id" title="var">Tt</span> := <span class="id" title="var">Tt</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "absurd"  <span class="id" title="var">tactic</span>(<span class="id" title="var">tac</span>) := <span class="id" title="var">exfalso</span>; <span class="id" title="var">tac</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">term_eq</span> := <br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id" title="var">Var</span> <span class="id" title="var">_</span> = <span class="id" title="var">Var</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="tactic">f_equal</span> ; <span class="id" title="var">lia</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| |- @<span class="id" title="var">eq</span> <span class="id" title="var">nat</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">lia</span> || <span class="id" title="var">absurd</span> <span class="id" title="var">lia</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id" title="var">lt</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">lia</span> || <span class="id" title="var">absurd</span> <span class="id" title="var">lia</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id" title="var">le</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">lia</span> || <span class="id" title="var">absurd</span> <span class="id" title="var">lia</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id" title="var">gt</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">lia</span> || <span class="id" title="var">absurd</span> <span class="id" title="var">lia</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id" title="var">ge</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">lia</span> || <span class="id" title="var">absurd</span> <span class="id" title="var">lia</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Extern</span> 4 ⇒ <span class="id" title="var">term_eq</span> : <span class="id" title="var">term</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">term</span> := <span class="id" title="var">typeclasses</span> <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">term</span> <span class="id" title="var">core</span> <span class="id" title="var">arith</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">do_rewrites</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H</span> : ?<span class="id" title="var">lhs</span> = ?<span class="id" title="var">rhs</span> |- <span class="id" title="keyword">context</span> [?<span class="id" title="var">lhs</span>] ⇒ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">crush</span> := <span class="id" title="var">do_rewrites</span>; <span class="id" title="tactic">auto</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">term</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">lift0</span> <span class="id" title="var">k</span> <span class="id" title="var">t</span> : <span class="id" title="var">lift</span> <span class="id" title="var">k</span> 0 <span class="id" title="var">t</span> = <span class="id" title="var">t</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">funelim</span> (<span class="id" title="var">lift</span> <span class="id" title="var">k</span> 0 <span class="id" title="var">t</span>); <span class="id" title="var">term</span> || <span class="id" title="tactic">rewrite</span> ?<span class="id" title="var">H</span>; <span class="id" title="var">crush</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Rewrite</span> <span class="id" title="var">lift0</span> : <span class="id" title="var">lift</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Stdlib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Lia</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">lift_k_lift_k</span> <span class="id" title="var">k</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> <span class="id" title="var">t</span> : <span class="id" title="var">lift</span> <span class="id" title="var">k</span> <span class="id" title="var">n</span> (<span class="id" title="var">lift</span> <span class="id" title="var">k</span> <span class="id" title="var">m</span> <span class="id" title="var">t</span>) = <span class="id" title="var">lift</span> <span class="id" title="var">k</span> (<span class="id" title="var">n</span> + <span class="id" title="var">m</span>) <span class="id" title="var">t</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">funelim</span> (<span class="id" title="var">lift</span> <span class="id" title="var">k</span> <span class="id" title="var">m</span> <span class="id" title="var">t</span>); <span class="id" title="tactic">intros</span>; <span class="id" title="var">simp</span> <span class="id" title="var">lift</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> ; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>; <span class="id" title="tactic">auto</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">Nat.compare_spec</span> <span class="id" title="var">i</span> <span class="id" title="var">k</span>); <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">case_eq</span> (<span class="id" title="var">Nat.compare</span> (<span class="id" title="var">k</span> + <span class="id" title="var">n</span>) <span class="id" title="var">k</span>); <span class="id" title="tactic">intro</span> <span class="id" title="var">H</span>; <span class="id" title="var">simp</span> <span class="id" title="var">lift</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">term</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Nat.compare_lt_iff</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="var">term</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq</span>; <span class="id" title="var">simp</span> <span class="id" title="var">lift</span>; <span class="id" title="var">term</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Nat.compare_gt_iff</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="var">simp</span> <span class="id" title="var">lift</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">Nat.compare_spec</span> (<span class="id" title="var">i</span> + <span class="id" title="var">n</span>) <span class="id" title="var">k</span>); <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>; <span class="id" title="var">simp</span> <span class="id" title="var">lift</span>; <span class="id" title="var">term</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Rewrite</span> <span class="id" title="var">lift_k_lift_k</span> : <span class="id" title="var">lift</span>.<br/>

<br/>
<span class="id" title="keyword">Equations</span> <span class="id" title="tactic">subst</span> (<span class="id" title="var">k</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">term</span>) (<span class="id" title="var">u</span> : <span class="id" title="var">term</span>) : <span class="id" title="var">term</span> :=<br/>
<span class="id" title="tactic">subst</span> <span class="id" title="var">k</span> (<span class="id" title="var">Var</span> <span class="id" title="var">i</span>) <span class="id" title="var">u</span> <span class="id" title="keyword">with</span> <span class="id" title="var">Nat.compare</span> <span class="id" title="var">i</span> <span class="id" title="var">k</span> := {<br/>
&nbsp;&nbsp;| <span class="id" title="var">Eq</span> := <span class="id" title="var">lift</span> 0 <span class="id" title="var">k</span> <span class="id" title="var">u</span> ;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Lt</span> := <span class="id" title="var">i</span> ;<br/>
&nbsp;&nbsp;| <span class="id" title="var">Gt</span> := <span class="id" title="var">Var</span> (<span class="id" title="var">pred</span> <span class="id" title="var">i</span>) } ;<br/>
<span class="id" title="tactic">subst</span> <span class="id" title="var">k</span> (<span class="id" title="var">Lambda</span> <span class="id" title="var">t</span>) <span class="id" title="var">u</span> := <span class="id" title="var">Lambda</span> (<span class="id" title="tactic">subst</span> (<span class="id" title="var">S</span> <span class="id" title="var">k</span>) <span class="id" title="var">t</span> <span class="id" title="var">u</span>) ;<br/>
<span class="id" title="tactic">subst</span> <span class="id" title="var">k</span> (<span class="id" title="var">App</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>) <span class="id" title="var">u</span> := @(<span class="id" title="tactic">subst</span> <span class="id" title="var">k</span> <span class="id" title="var">a</span> <span class="id" title="var">u</span>, <span class="id" title="tactic">subst</span> <span class="id" title="var">k</span> <span class="id" title="var">b</span> <span class="id" title="var">u</span>) ;<br/>
<span class="id" title="tactic">subst</span> <span class="id" title="var">k</span> (<span class="id" title="var">Pair</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>) <span class="id" title="var">u</span> := &lt;&lt; <span class="id" title="tactic">subst</span> <span class="id" title="var">k</span> <span class="id" title="var">a</span> <span class="id" title="var">u</span>, <span class="id" title="tactic">subst</span> <span class="id" title="var">k</span> <span class="id" title="var">b</span> <span class="id" title="var">u</span> &gt;&gt; ;<br/>
<span class="id" title="tactic">subst</span> <span class="id" title="var">k</span> (<span class="id" title="var">Fst</span> <span class="id" title="var">t</span>) <span class="id" title="var">u</span> := <span class="id" title="var">Fst</span> (<span class="id" title="tactic">subst</span> <span class="id" title="var">k</span> <span class="id" title="var">t</span> <span class="id" title="var">u</span>) ;<br/>
<span class="id" title="tactic">subst</span> <span class="id" title="var">k</span> (<span class="id" title="var">Snd</span> <span class="id" title="var">t</span>) <span class="id" title="var">u</span> := <span class="id" title="var">Snd</span> (<span class="id" title="tactic">subst</span> <span class="id" title="var">k</span> <span class="id" title="var">t</span> <span class="id" title="var">u</span>) ;<br/>
<span class="id" title="tactic">subst</span> <span class="id" title="var">k</span> <span class="id" title="var">Tt</span> <span class="id" title="var">_</span> := <span class="id" title="var">Tt</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">substnn</span> <span class="id" title="var">n</span> <span class="id" title="var">t</span> : <span class="id" title="tactic">subst</span> <span class="id" title="var">n</span> <span class="id" title="var">n</span> <span class="id" title="var">t</span> = <span class="id" title="var">lift</span> 0 <span class="id" title="var">n</span> <span class="id" title="var">t</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="var">funelim</span> (<span class="id" title="tactic">subst</span> <span class="id" title="var">n</span> <span class="id" title="var">n</span> <span class="id" title="var">t</span>) ; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> ; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>; <span class="id" title="var">simp</span> <span class="id" title="var">lift</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Nat.compare_lt_iff</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>; <span class="id" title="var">absurd</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Nat.compare_gt_iff</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>; <span class="id" title="var">absurd</span> <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Rewrite</span> <span class="id" title="var">substnn</span> : <span class="id" title="tactic">subst</span>.<br/>
<span class="id" title="keyword">Notation</span> <span class="id" title="var">ctx</span> := (<span class="id" title="var">list</span> <span class="id" title="keyword">type</span>).<br/>

<br/>
<span class="id" title="keyword">Reserved Notation</span> &quot; Γ |-- t : A " (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 70, <span class="id" title="var">t</span>, <span class="id" title="var">A</span> <span class="id" title="tactic">at</span> <span class="id" title="var">next</span> <span class="id" title="keyword">level</span>).<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">types</span> : <span class="id" title="var">ctx</span> → <span class="id" title="var">term</span> → <span class="id" title="keyword">type</span> → <span class="id" title="keyword">Prop</span> :=<br/>
| <span class="id" title="var">axiom</span> <span class="id" title="var">Γ</span> <span class="id" title="var">i</span> : <span class="id" title="var">i</span> &lt; <span class="id" title="var">length</span> <span class="id" title="var">Γ</span> → (<span class="id" title="var">Γ</span> |-- <span class="id" title="var">i</span> : <span class="id" title="var">nth</span> <span class="id" title="var">i</span> <span class="id" title="var">Γ</span> <span class="id" title="var">unit</span>) <br/>
<br/>
| <span class="id" title="var">abstraction</span> <span class="id" title="var">Γ</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">t</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">A</span> :: <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> : <span class="id" title="var">B</span> → <span class="id" title="var">Γ</span> |-- <span class="id" title="var">λ</span> <span class="id" title="var">t</span> : <span class="id" title="var">A</span> ---&gt; <span class="id" title="var">B</span><br/>
<br/>
| <span class="id" title="var">application</span> <span class="id" title="var">Γ</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">t</span> <span class="id" title="var">u</span> : <br/>
&nbsp;&nbsp;<span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> : <span class="id" title="var">A</span> ---&gt; <span class="id" title="var">B</span> → <span class="id" title="var">Γ</span> |-- <span class="id" title="var">u</span> : <span class="id" title="var">A</span> → <span class="id" title="var">Γ</span> |-- @(<span class="id" title="var">t</span>, <span class="id" title="var">u</span>) : <span class="id" title="var">B</span><br/>
<br/>
| <span class="id" title="var">unit_intro</span> <span class="id" title="var">Γ</span> : <span class="id" title="var">Γ</span> |-- <span class="id" title="var">Tt</span> : <span class="id" title="var">unit</span><br/>
<br/>
| <span class="id" title="var">pair_intro</span> <span class="id" title="var">Γ</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">t</span> <span class="id" title="var">u</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> : <span class="id" title="var">A</span> → <span class="id" title="var">Γ</span> |-- <span class="id" title="var">u</span> : <span class="id" title="var">B</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Γ</span> |-- &lt;&lt; <span class="id" title="var">t</span> , <span class="id" title="var">u</span> &gt;&gt; : (<span class="id" title="var">A</span> × <span class="id" title="var">B</span>)<br/>
<br/>
| <span class="id" title="var">pair_elim_fst</span> <span class="id" title="var">Γ</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">t</span> : <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> : (<span class="id" title="var">A</span> × <span class="id" title="var">B</span>) → <span class="id" title="var">Γ</span> |-- <span class="id" title="var">Fst</span> <span class="id" title="var">t</span> : <span class="id" title="var">A</span><br/>
<br/>
| <span class="id" title="var">pair_elim_snd</span> <span class="id" title="var">Γ</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">t</span> : <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> : (<span class="id" title="var">A</span> × <span class="id" title="var">B</span>) → <span class="id" title="var">Γ</span> |-- <span class="id" title="var">Snd</span> <span class="id" title="var">t</span> : <span class="id" title="var">B</span><br/>
<br/>
<span class="id" title="keyword">where</span> &quot;Γ |-- i : A " := (<span class="id" title="var">types</span> <span class="id" title="var">Γ</span> <span class="id" title="var">i</span> <span class="id" title="var">A</span>).<br/>

<br/>
<span class="id" title="keyword">Derive</span> <span class="id" title="var">Signature</span> <span class="id" title="keyword">for</span> <span class="id" title="var">types</span>.<br/>

<br/>
#[<span class="id" title="var">warnings</span>="-notation-incompatible-prefix"]<br/>
<span class="id" title="keyword">Notation</span> " [ t ] u " := (<span class="id" title="tactic">subst</span> 0 <span class="id" title="var">u</span> <span class="id" title="var">t</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 10).<br/>

<br/>
<span class="id" title="keyword">Notation</span> &quot; x @ y " := (<span class="id" title="var">app</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 30, <span class="id" title="tactic">right</span> <span class="id" title="keyword">associativity</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">nth_length</span> {<span class="id" title="var">A</span>} <span class="id" title="var">x</span> <span class="id" title="var">t</span> (<span class="id" title="var">l</span> <span class="id" title="var">l'</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) : <span class="id" title="var">nth</span> (<span class="id" title="var">length</span> <span class="id" title="var">l</span>) (<span class="id" title="var">l</span> @ (<span class="id" title="var">t</span> :: <span class="id" title="var">l'</span>)) <span class="id" title="var">x</span> = <span class="id" title="var">t</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Constructors</span> <span class="id" title="var">types</span> : <span class="id" title="var">term</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">nat_compare_elim</span> (<span class="id" title="var">P</span> : <span class="id" title="var">nat</span> → <span class="id" title="var">nat</span> → <span class="id" title="var">comparison</span> → <span class="id" title="keyword">Prop</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">PEq</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">i</span>, <span class="id" title="var">P</span> <span class="id" title="var">i</span> <span class="id" title="var">i</span> <span class="id" title="var">Eq</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">PLt</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">i</span> <span class="id" title="var">j</span>, <span class="id" title="var">i</span> &lt; <span class="id" title="var">j</span> → <span class="id" title="var">P</span> <span class="id" title="var">i</span> <span class="id" title="var">j</span> <span class="id" title="var">Lt</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">PGt</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">i</span> <span class="id" title="var">j</span>, <span class="id" title="var">i</span> &gt; <span class="id" title="var">j</span> → <span class="id" title="var">P</span> <span class="id" title="var">i</span> <span class="id" title="var">j</span> <span class="id" title="var">Gt</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">i</span> <span class="id" title="var">j</span>, <span class="id" title="var">P</span> <span class="id" title="var">i</span> <span class="id" title="var">j</span> (<span class="id" title="var">Nat.compare</span> <span class="id" title="var">i</span> <span class="id" title="var">j</span>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">case</span> (<span class="id" title="var">Nat.compare_spec</span> <span class="id" title="var">i</span> <span class="id" title="var">j</span>); <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">nth_extend_left</span> {<span class="id" title="var">A</span>} (<span class="id" title="var">a</span> : <span class="id" title="var">A</span>) <span class="id" title="var">n</span> (<span class="id" title="var">l</span> <span class="id" title="var">l'</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) : <span class="id" title="var">nth</span> <span class="id" title="var">n</span> <span class="id" title="var">l</span> <span class="id" title="var">a</span> = <span class="id" title="var">nth</span> (<span class="id" title="var">length</span> <span class="id" title="var">l'</span> + <span class="id" title="var">n</span>) (<span class="id" title="var">l'</span> @ <span class="id" title="var">l</span>) <span class="id" title="var">a</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">l'</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">nth_app_l</span> {<span class="id" title="var">A</span>} (<span class="id" title="var">a</span> : <span class="id" title="var">A</span>) {<span class="id" title="var">n</span>} (<span class="id" title="var">l</span> <span class="id" title="var">l'</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) : <span class="id" title="var">n</span> &lt; <span class="id" title="var">length</span> <span class="id" title="var">l</span> → <span class="id" title="var">nth</span> <span class="id" title="var">n</span> (<span class="id" title="var">l</span> @ <span class="id" title="var">l'</span>) <span class="id" title="var">a</span> = <span class="id" title="var">nth</span> <span class="id" title="var">n</span> <span class="id" title="var">l</span> <span class="id" title="var">a</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span> <span class="id" title="var">n</span>; <span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="var">depelim</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">n</span>; <span class="id" title="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHl</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">nth_app_r</span> {<span class="id" title="var">A</span>} (<span class="id" title="var">a</span> : <span class="id" title="var">A</span>) {<span class="id" title="var">n</span>} (<span class="id" title="var">l</span> <span class="id" title="var">l'</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) : <span class="id" title="var">length</span> <span class="id" title="var">l</span> ≤ <span class="id" title="var">n</span> → <br/>
&nbsp;&nbsp;<span class="id" title="var">nth</span> <span class="id" title="var">n</span> (<span class="id" title="var">l</span> @ <span class="id" title="var">l'</span>) <span class="id" title="var">a</span> = <span class="id" title="var">nth</span> (<span class="id" title="var">n</span> - <span class="id" title="var">length</span> <span class="id" title="var">l</span>) <span class="id" title="var">l'</span> <span class="id" title="var">a</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span> <span class="id" title="var">n</span>; <span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">depelim</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">n</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">depelim</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">IHl</span>; <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">nth_extend_middle</span> {<span class="id" title="var">A</span>} (<span class="id" title="var">a</span> : <span class="id" title="var">A</span>) <span class="id" title="var">n</span> (<span class="id" title="var">l</span> <span class="id" title="var">l'</span> <span class="id" title="var">l''</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) : <br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">Nat.compare</span> <span class="id" title="var">n</span> (<span class="id" title="var">length</span> <span class="id" title="var">l'</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Lt</span> ⇒ <span class="id" title="var">nth</span> <span class="id" title="var">n</span> (<span class="id" title="var">l'</span> @ <span class="id" title="var">l</span>) <span class="id" title="var">a</span> = <span class="id" title="var">nth</span> <span class="id" title="var">n</span> (<span class="id" title="var">l'</span> @ <span class="id" title="var">l''</span> @ <span class="id" title="var">l</span>) <span class="id" title="var">a</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <span class="id" title="var">nth</span> <span class="id" title="var">n</span> (<span class="id" title="var">l'</span> @ <span class="id" title="var">l</span>) <span class="id" title="var">a</span> = <span class="id" title="var">nth</span> (<span class="id" title="var">n</span> + <span class="id" title="var">length</span> <span class="id" title="var">l''</span>) (<span class="id" title="var">l'</span> @ <span class="id" title="var">l''</span> @ <span class="id" title="var">l</span>) <span class="id" title="var">a</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">foo</span>:=<span class="id" title="var">Nat.compare_spec</span> <span class="id" title="var">n</span> (<span class="id" title="var">length</span> <span class="id" title="var">l'</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">foo</span>; <span class="id" title="tactic">fold</span> (<span class="id" title="var">length</span> <span class="id" title="var">l'</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">nth_extend_left</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">length</span> <span class="id" title="var">l''</span>) <span class="id" title="keyword">with</span> (<span class="id" title="var">length</span> <span class="id" title="var">l''</span> + 0) <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">arith</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">nth_extend_left</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">length</span> <span class="id" title="var">l'</span>) <span class="id" title="keyword">with</span> (<span class="id" title="var">length</span> <span class="id" title="var">l'</span> + 0) <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">arith</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">nth_extend_left</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">H0</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> !<span class="id" title="var">nth_app_l</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">rewrite</span> !<span class="id" title="var">nth_app_r</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Rewrite</span> &lt;- <span class="id" title="var">app_assoc</span> <span class="id" title="var">in_app_iff</span> <span class="id" title="var">in_inv</span> : <span class="id" title="var">list</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">type_lift</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span> <span class="id" title="var">Γ'</span> : <span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> : <span class="id" title="var">T</span> → <br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">Γ''</span>, <span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ''</span> @ <span class="id" title="var">Γ</span> |-- <span class="id" title="var">lift</span> (<span class="id" title="var">length</span> <span class="id" title="var">Γ'</span>) (<span class="id" title="var">length</span> <span class="id" title="var">Γ''</span>) <span class="id" title="var">t</span> : <span class="id" title="var">T</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">depind</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="var">simp</span> <span class="id" title="var">lift</span>; <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">term</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> (<span class="id" title="var">nth_extend_middle</span> <span class="id" title="var">unit</span> <span class="id" title="var">i</span> <span class="id" title="var">Γ0</span> <span class="id" title="var">Γ'</span> <span class="id" title="var">Γ''</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Nat.compare</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">H'</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H'</span>; <span class="id" title="var">simp</span> <span class="id" title="var">lift</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">axiom</span>; <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">list</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span> |- *; <span class="id" title="var">lia</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">abstraction</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_comm_cons</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">IHtypes</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">type_lift1</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span> <span class="id" title="var">A</span> : <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> : <span class="id" title="var">T</span> → <span class="id" title="var">A</span> :: <span class="id" title="var">Γ</span> |-- <span class="id" title="var">lift</span> 0 1 <span class="id" title="var">t</span> : <span class="id" title="var">T</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="var">type_lift</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span> [] <span class="id" title="var">H</span> [<span class="id" title="var">A</span>]). <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">type_liftn</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Γ'</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span> : <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> : <span class="id" title="var">T</span> → <span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ</span> |-- <span class="id" title="var">lift</span> 0 (<span class="id" title="var">length</span> <span class="id" title="var">Γ'</span>) <span class="id" title="var">t</span> : <span class="id" title="var">T</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="var">type_lift</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span> [] <span class="id" title="var">H</span> <span class="id" title="var">Γ'</span>). <span class="id" title="keyword">Qed</span>.<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Resolve</span> <span class="id" title="var">type_lift1</span> <span class="id" title="var">type_lift</span> <span class="id" title="var">type_liftn</span> : <span class="id" title="var">term</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">crush</span> ::= <span class="id" title="var">do_rewrites</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="var">do_rewrites</span>; <span class="id" title="tactic">auto</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">term</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">app_cons_snoc_app</span> {<span class="id" title="var">A</span>} <span class="id" title="var">l</span> (<span class="id" title="var">a</span> : <span class="id" title="var">A</span>) <span class="id" title="var">l'</span> : <span class="id" title="var">l</span> ++ (<span class="id" title="var">a</span> :: <span class="id" title="var">l'</span>) = (<span class="id" title="var">l</span> ++ <span class="id" title="var">a</span> :: <span class="id" title="var">nil</span>) ++ <span class="id" title="var">l'</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>; <span class="id" title="var">crush</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Extern</span> 5 ⇒ <span class="id" title="tactic">progress</span> (<span class="id" title="tactic">simpl</span> ; <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">list</span>) : <span class="id" title="var">term</span>.<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">term</span> ::= <span class="id" title="var">simp</span> <span class="id" title="var">lift</span> <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">typeclasses</span> <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">core</span> <span class="id" title="var">term</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">substitutive</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span> <span class="id" title="var">Γ'</span> <span class="id" title="var">u</span> <span class="id" title="var">U</span> : <br/>
&nbsp;&nbsp;(<span class="id" title="var">Γ'</span> @ (<span class="id" title="var">U</span> :: <span class="id" title="var">Γ</span>)) |-- <span class="id" title="var">t</span> : <span class="id" title="var">T</span> → <span class="id" title="var">Γ</span> |-- <span class="id" title="var">u</span> : <span class="id" title="var">U</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ</span> |-- <span class="id" title="tactic">subst</span> (<span class="id" title="var">length</span> <span class="id" title="var">Γ'</span>) <span class="id" title="var">t</span> <span class="id" title="var">u</span> : <span class="id" title="var">T</span>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">with</span> <span class="id" title="var">term</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>. <span class="id" title="var">depind</span> <span class="id" title="var">H</span>; <span class="id" title="var">term</span>. <span class="id" title="tactic">intros</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Var&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">spec</span>:=<span class="id" title="var">Nat.compare_spec</span> <span class="id" title="var">i</span> (<span class="id" title="var">length</span> <span class="id" title="var">Γ'</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">spec</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">fold</span> (<span class="id" title="var">length</span> <span class="id" title="var">Γ'</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>; <span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H1</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H2</span> ; <span class="id" title="var">simp</span> <span class="id" title="tactic">subst</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Eq&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> (<span class="id" title="var">type_lift</span> <span class="id" title="var">Γ0</span> <span class="id" title="var">u</span> <span class="id" title="var">U</span> [] <span class="id" title="var">H0</span> <span class="id" title="var">Γ'</span>); <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_cons_snoc_app</span>, <span class="id" title="var">app_nth1</span>, <span class="id" title="var">app_nth2</span>; <span class="id" title="tactic">try</span> (<span class="id" title="tactic">simpl</span>; <span class="id" title="var">lia</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Nat.sub_diag</span>. <span class="id" title="var">term</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Lt&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nth1</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>. <span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">app_nth1</span> <span class="id" title="var">_</span> <span class="id" title="var">Γ0</span>); <span class="id" title="var">term</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Gt&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nth2</span>; <span class="id" title="var">term</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">change</span> (<span class="id" title="var">U</span> :: <span class="id" title="var">Γ0</span>) <span class="id" title="keyword">with</span> ((<span class="id" title="var">cons</span> <span class="id" title="var">U</span> <span class="id" title="var">nil</span>) @ <span class="id" title="var">Γ0</span>). <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_nth2</span>; <span class="id" title="var">term</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">nth_extend_left</span> <span class="id" title="var">unit</span> <span class="id" title="var">_</span> <span class="id" title="var">Γ0</span> <span class="id" title="var">Γ'</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">length</span> <span class="id" title="var">Γ'</span> + (<span class="id" title="var">i</span> - <span class="id" title="var">length</span> <span class="id" title="var">Γ'</span> - 1)) <span class="id" title="keyword">with</span> (<span class="id" title="var">pred</span> <span class="id" title="var">i</span>); <span class="id" title="var">term</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">axiom</span>. <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">list</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span> |- ×. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">lia</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Abstraction&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">abstraction</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> (<span class="id" title="var">IHtypes</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">A</span> :: <span class="id" title="var">Γ'</span>)).<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">subst1</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span> <span class="id" title="var">u</span> <span class="id" title="var">U</span> : <span class="id" title="var">U</span> :: <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> : <span class="id" title="var">T</span> → <span class="id" title="var">Γ</span> |-- <span class="id" title="var">u</span> : <span class="id" title="var">U</span> → <span class="id" title="var">Γ</span> |-- <span class="id" title="tactic">subst</span> 0 <span class="id" title="var">t</span> <span class="id" title="var">u</span> : <span class="id" title="var">T</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>; <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> (<span class="id" title="var">substitutive</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span> [] <span class="id" title="var">u</span> <span class="id" title="var">U</span>). <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Reserved Notation</span> &quot; t --&gt; u " (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 55, <span class="id" title="tactic">right</span> <span class="id" title="keyword">associativity</span>).<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">reduce</span> : <span class="id" title="var">term</span> → <span class="id" title="var">term</span> → <span class="id" title="keyword">Prop</span> :=<br/>
| <span class="id" title="var">red_beta</span> <span class="id" title="var">t</span> <span class="id" title="var">u</span> : @((<span class="id" title="var">Lambda</span> <span class="id" title="var">t</span>) , <span class="id" title="var">u</span>) --&gt; <span class="id" title="tactic">subst</span> 0 <span class="id" title="var">t</span> <span class="id" title="var">u</span><br/>
| <span class="id" title="var">red_fst</span> <span class="id" title="var">t</span> <span class="id" title="var">u</span> : <span class="id" title="var">Fst</span> &lt;&lt; <span class="id" title="var">t</span> , <span class="id" title="var">u</span> &gt;&gt; --&gt; <span class="id" title="var">t</span><br/>
| <span class="id" title="var">red_snd</span> <span class="id" title="var">t</span> <span class="id" title="var">u</span> : <span class="id" title="var">Snd</span> &lt;&lt; <span class="id" title="var">t</span> , <span class="id" title="var">u</span> &gt;&gt; --&gt; <span class="id" title="var">u</span><br/>
<br/>
<span class="id" title="keyword">where</span> &quot; t --&gt; u " := (<span class="id" title="var">reduce</span> <span class="id" title="var">t</span> <span class="id" title="var">u</span>).<br/>
<span class="id" title="keyword">Derive</span> <span class="id" title="var">Signature</span> <span class="id" title="keyword">for</span> <span class="id" title="var">reduce</span>.<br/>

<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Stdlib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Relations</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">reduces</span> := <span class="id" title="var">clos_refl_trans</span> <span class="id" title="var">term</span> <span class="id" title="var">reduce</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot; t --&gt;* u " := (<span class="id" title="var">reduces</span> <span class="id" title="var">t</span> <span class="id" title="var">u</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 55).<br/>

<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Stdlib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Setoid</span>.<br/>

<br/>
#[<span class="id" title="var">local</span>]<br/>
<span class="id" title="keyword">Instance</span>: <span class="id" title="var">Transitive</span> <span class="id" title="var">reduces</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">red</span>; <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">econstructor</span> 3; <span class="id" title="tactic">eauto</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
#[<span class="id" title="var">local</span>]<br/>
<span class="id" title="keyword">Instance</span>: <span class="id" title="var">Reflexive</span> <span class="id" title="var">reduces</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">red</span>; <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">econstructor</span> 2; <span class="id" title="tactic">eauto</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">value</span> : <span class="id" title="var">term</span> → <span class="id" title="keyword">Prop</span> :=<br/>
| <span class="id" title="var">val_var</span> (<span class="id" title="var">i</span> : <span class="id" title="var">nat</span>) : <span class="id" title="var">value</span> <span class="id" title="var">i</span><br/>
| <span class="id" title="var">val_unit</span> : <span class="id" title="var">value</span> <span class="id" title="var">Tt</span><br/>
| <span class="id" title="var">val_pair</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> : <span class="id" title="var">value</span> <span class="id" title="var">a</span> → <span class="id" title="var">value</span> <span class="id" title="var">b</span> → <span class="id" title="var">value</span> &lt;&lt; <span class="id" title="var">a</span>, <span class="id" title="var">b</span> &gt;&gt;<br/>
| <span class="id" title="var">val_lambda</span> <span class="id" title="var">t</span> : <span class="id" title="var">value</span> (<span class="id" title="var">λ</span> <span class="id" title="var">t</span>).<br/>
<span class="id" title="keyword">Derive</span> <span class="id" title="var">Signature</span> <span class="id" title="keyword">for</span> <span class="id" title="var">value</span>.<br/>

<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Constructors</span> <span class="id" title="var">value</span> : <span class="id" title="var">term</span>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">reduce_congr</span> : <span class="id" title="var">relation</span> <span class="id" title="var">term</span> :=<br/>
| <span class="id" title="var">reduce1</span> <span class="id" title="var">t</span> <span class="id" title="var">u</span> : <span class="id" title="var">reduce</span> <span class="id" title="var">t</span> <span class="id" title="var">u</span> → <span class="id" title="var">reduce_congr</span> <span class="id" title="var">t</span> <span class="id" title="var">u</span><br/>
| <span class="id" title="var">reduce_app_l</span> <span class="id" title="var">t</span> <span class="id" title="var">t'</span> <span class="id" title="var">u</span> : <span class="id" title="var">reduce_congr</span> <span class="id" title="var">t</span> <span class="id" title="var">t'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">reduce_congr</span> (@(<span class="id" title="var">t</span>, <span class="id" title="var">u</span>)) (@(<span class="id" title="var">t'</span>, <span class="id" title="var">u</span>))<br/>
| <span class="id" title="var">reduce_app_r</span> <span class="id" title="var">t</span> <span class="id" title="var">u</span> <span class="id" title="var">u'</span> : <span class="id" title="var">reduce_congr</span> <span class="id" title="var">u</span> <span class="id" title="var">u'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">reduce_congr</span> (@(<span class="id" title="var">t</span>, <span class="id" title="var">u</span>)) (@(<span class="id" title="var">t</span>, <span class="id" title="var">u'</span>))<br/>
| <span class="id" title="var">reduce_pair_l</span> <span class="id" title="var">t</span> <span class="id" title="var">t'</span> <span class="id" title="var">u</span> : <span class="id" title="var">reduce_congr</span> <span class="id" title="var">t</span> <span class="id" title="var">t'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">reduce_congr</span> (&lt;&lt; <span class="id" title="var">t</span>, <span class="id" title="var">u</span> &gt;&gt;) (&lt;&lt; <span class="id" title="var">t'</span>, <span class="id" title="var">u</span> &gt;&gt;)<br/>
| <span class="id" title="var">reduce_pair_r</span> <span class="id" title="var">t</span> <span class="id" title="var">u</span> <span class="id" title="var">u'</span> : <span class="id" title="var">reduce_congr</span> <span class="id" title="var">u</span> <span class="id" title="var">u'</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">reduce_congr</span> (&lt;&lt; <span class="id" title="var">t</span>, <span class="id" title="var">u</span> &gt;&gt;) (&lt;&lt; <span class="id" title="var">t</span>, <span class="id" title="var">u'</span> &gt;&gt;)<br/>
| <span class="id" title="var">reduce_fst</span> <span class="id" title="var">t</span> <span class="id" title="var">t'</span> : <span class="id" title="var">reduce_congr</span> <span class="id" title="var">t</span> <span class="id" title="var">t'</span> → <span class="id" title="var">reduce_congr</span> (<span class="id" title="var">Fst</span> <span class="id" title="var">t</span>) (<span class="id" title="var">Fst</span> <span class="id" title="var">t'</span>)<br/>
| <span class="id" title="var">reduce_snd</span> <span class="id" title="var">t</span> <span class="id" title="var">t'</span> : <span class="id" title="var">reduce_congr</span> <span class="id" title="var">t</span> <span class="id" title="var">t'</span> → <span class="id" title="var">reduce_congr</span> (<span class="id" title="var">Snd</span> <span class="id" title="var">t</span>) (<span class="id" title="var">Snd</span> <span class="id" title="var">t'</span>).<br/>
<span class="id" title="keyword">Derive</span> <span class="id" title="var">Signature</span> <span class="id" title="keyword">for</span> <span class="id" title="var">reduce_congr</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">find_empty</span> := <br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ <span class="id" title="var">H</span> : <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> ] ⇒ <span class="id" title="tactic">solve</span> [ <span class="id" title="var">depelim</span> <span class="id" title="var">H</span> ]<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">preserves_red1</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span> τ : <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> : τ → <span class="id" title="keyword">∀</span> <span class="id" title="var">u</span>, <span class="id" title="var">t</span> --&gt; <span class="id" title="var">u</span> → <span class="id" title="var">Γ</span> |-- <span class="id" title="var">u</span> : τ.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">induction</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">t'</span> <span class="id" title="var">redtt'</span>; <span class="id" title="var">term</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">find_empty</span>; <span class="id" title="var">depelim</span> <span class="id" title="var">redtt'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">subst1</span> <span class="id" title="keyword">with</span> <span class="id" title="var">A</span>. <span class="id" title="var">now</span> <span class="id" title="var">depelim</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">depelim</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">depelim</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">preserves_redpar</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span> τ : <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> : τ → <span class="id" title="keyword">∀</span> <span class="id" title="var">u</span>, <span class="id" title="var">reduce_congr</span> <span class="id" title="var">t</span> <span class="id" title="var">u</span> → <span class="id" title="var">Γ</span> |-- <span class="id" title="var">u</span> : τ.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">t'</span> <span class="id" title="var">rtt'</span>; <span class="id" title="var">depelim</span> <span class="id" title="var">rtt'</span>; <span class="id" title="var">term</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">find_empty</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">H1</span>. <span class="id" title="var">depelim</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">subst1</span>; <span class="id" title="tactic">eauto</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">H0</span>; <span class="id" title="var">depelim</span> <span class="id" title="var">H</span>; <span class="id" title="var">term</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">H0</span>; <span class="id" title="var">depelim</span> <span class="id" title="var">H</span>; <span class="id" title="var">term</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">subject_reduction</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span> τ : <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> : τ → <span class="id" title="keyword">∀</span> <span class="id" title="var">u</span>, <span class="id" title="var">t</span> --&gt;* <span class="id" title="var">u</span> → <span class="id" title="var">Γ</span> |-- <span class="id" title="var">u</span> : τ.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">induction</span> 2; <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> <span class="id" title="var">preserves_red1</span>. <span class="id" title="keyword">Qed</span>.<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Constructors</span> <span class="id" title="var">reduce</span> <span class="id" title="var">reduce_congr</span> : <span class="id" title="var">term</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">progress_</span> <span class="id" title="var">t</span> τ : <span class="id" title="var">nil</span> |-- <span class="id" title="var">t</span> : τ → (<span class="id" title="tactic">∃</span> <span class="id" title="var">t'</span>, <span class="id" title="var">reduce_congr</span> <span class="id" title="var">t</span> <span class="id" title="var">t'</span>) ∨ <span class="id" title="var">value</span> <span class="id" title="var">t</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>; <span class="id" title="var">depind</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">auto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">term</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IHtypes1</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">t'</span> <span class="id" title="var">tt'</span>]|<span class="id" title="var">vt</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">left</span>; <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">term</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IHtypes2</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">u'</span> <span class="id" title="var">uu'</span>]|<span class="id" title="var">vu</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">left</span>; <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">term</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">H</span>; [<span class="id" title="var">depelim</span> <span class="id" title="var">H</span>|<span class="id" title="var">depelim</span> <span class="id" title="var">vt</span>..].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">left</span>. <span class="id" title="tactic">∃</span> ([<span class="id" title="var">u</span>]<span class="id" title="var">t0</span>). <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">term</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IHtypes1</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">t'</span> <span class="id" title="var">tt'</span>]|<span class="id" title="var">vt</span>]; <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">term</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IHtypes2</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">u'</span> <span class="id" title="var">uu'</span>]|<span class="id" title="var">vu</span>]; <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">term</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IHtypes</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">t'</span> <span class="id" title="var">tt'</span>]|<span class="id" title="var">vt</span>]; <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">term</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">vt</span>; <span class="id" title="var">depelim</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">term</span>. <span class="id" title="var">depelim</span> <span class="id" title="var">H</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IHtypes</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">t'</span> <span class="id" title="var">tt'</span>]|<span class="id" title="var">vt</span>]; <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">term</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">vt</span>; <span class="id" title="var">depelim</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">term</span>. <span class="id" title="var">depelim</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Reserved Notation</span> &quot; Γ |-- t =&gt; A " (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 70, <span class="id" title="var">t</span>, <span class="id" title="var">A</span> <span class="id" title="tactic">at</span> <span class="id" title="var">next</span> <span class="id" title="keyword">level</span>).<br/>
<span class="id" title="keyword">Reserved Notation</span> &quot; Γ |-- t &lt;= A " (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 70, <span class="id" title="var">t</span>, <span class="id" title="var">A</span> <span class="id" title="tactic">at</span> <span class="id" title="var">next</span> <span class="id" title="keyword">level</span>).<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">atomic</span> : <span class="id" title="keyword">type</span> → <span class="id" title="keyword">Prop</span> :=<br/>
| <span class="id" title="var">atomic_atom</span> <span class="id" title="var">a</span> : <span class="id" title="var">atomic</span> (<span class="id" title="var">atom</span> <span class="id" title="var">a</span>).<br/>

<br/>
<span class="id" title="keyword">Derive</span> <span class="id" title="var">Signature</span> <span class="id" title="keyword">for</span> <span class="id" title="var">atomic</span>.<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Constructors</span> <span class="id" title="var">atomic</span> : <span class="id" title="var">term</span>.<br/>

<br/>
<span class="comment">(*&nbsp;FIXME&nbsp;bug&nbsp;*)</span><br/>
<span class="id" title="keyword">Equations</span>? <span class="id" title="var">atomic_dec</span> (<span class="id" title="var">t</span> : <span class="id" title="keyword">type</span>) : { <span class="id" title="var">atomic</span> <span class="id" title="var">t</span> } + { ¬ <span class="id" title="var">atomic</span> <span class="id" title="var">t</span> } :=<br/>
<span class="id" title="var">atomic_dec</span> (<span class="id" title="var">atom</span> <span class="id" title="var">a</span>) := <span class="id" title="tactic">left</span> (<span class="id" title="var">atomic_atom</span> <span class="id" title="var">a</span>) ;<br/>
<span class="id" title="var">atomic_dec</span> <span class="id" title="var">t</span> := <span class="id" title="tactic">right</span> <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="var">all</span>:(<span class="id" title="tactic">intro</span> <span class="id" title="var">H</span>; <span class="id" title="var">depelim</span> <span class="id" title="var">H</span>). <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">check</span> : <span class="id" title="var">ctx</span> → <span class="id" title="var">term</span> → <span class="id" title="keyword">type</span> → <span class="id" title="keyword">Prop</span> :=<br/>
| <span class="id" title="var">abstraction_check</span> <span class="id" title="var">Γ</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">t</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">A</span> :: <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> ≤ <span class="id" title="var">B</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">Γ</span> |-- <span class="id" title="var">λ</span> <span class="id" title="var">t</span> ≤ <span class="id" title="var">A</span> ---&gt; <span class="id" title="var">B</span><br/>
<br/>
| <span class="id" title="var">pair_intro_check</span> <span class="id" title="var">Γ</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">t</span> <span class="id" title="var">u</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> ≤ <span class="id" title="var">A</span> → <span class="id" title="var">Γ</span> |-- <span class="id" title="var">u</span> ≤ <span class="id" title="var">B</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Γ</span> |-- &lt;&lt; <span class="id" title="var">t</span> , <span class="id" title="var">u</span> &gt;&gt; ≤ (<span class="id" title="var">A</span> × <span class="id" title="var">B</span>)<br/>
<br/>
| <span class="id" title="var">unit_intro_check</span> <span class="id" title="var">Γ</span> : <span class="id" title="var">Γ</span> |-- <span class="id" title="var">Tt</span> ≤ <span class="id" title="var">unit</span><br/>
<br/>
| <span class="id" title="var">check_synth</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span> : <span class="id" title="var">atomic</span> <span class="id" title="var">T</span> → <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> ⇒ <span class="id" title="var">T</span> → <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> ≤ <span class="id" title="var">T</span><br/>
<br/>
<span class="id" title="keyword">with</span> <span class="id" title="var">synthetize</span> : <span class="id" title="var">ctx</span> → <span class="id" title="var">term</span> → <span class="id" title="keyword">type</span> → <span class="id" title="keyword">Prop</span> :=<br/>
<br/>
| <span class="id" title="var">axiom_synth</span> <span class="id" title="var">Γ</span> <span class="id" title="var">i</span> : <span class="id" title="var">i</span> &lt; <span class="id" title="var">length</span> <span class="id" title="var">Γ</span> → <br/>
&nbsp;&nbsp;<span class="id" title="var">Γ</span> |-- <span class="id" title="var">i</span> ⇒ <span class="id" title="var">nth</span> <span class="id" title="var">i</span> <span class="id" title="var">Γ</span> <span class="id" title="var">unit</span><br/>
&nbsp;<br/>
| <span class="id" title="var">application_synth</span> {<span class="id" title="var">Γ</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">t</span> <span class="id" title="var">u</span>} : <br/>
&nbsp;&nbsp;<span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> ⇒ <span class="id" title="var">A</span> ---&gt; <span class="id" title="var">B</span> → <span class="id" title="var">Γ</span> |-- <span class="id" title="var">u</span> ≤ <span class="id" title="var">A</span> → <span class="id" title="var">Γ</span> |-- @(<span class="id" title="var">t</span>, <span class="id" title="var">u</span>) ⇒ <span class="id" title="var">B</span><br/>
<br/>
| <span class="id" title="var">pair_elim_fst_synth</span> {<span class="id" title="var">Γ</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">t</span>} : <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> ⇒ (<span class="id" title="var">A</span> × <span class="id" title="var">B</span>) → <span class="id" title="var">Γ</span> |-- <span class="id" title="var">Fst</span> <span class="id" title="var">t</span> ⇒ <span class="id" title="var">A</span><br/>
<br/>
| <span class="id" title="var">pair_elim_snd_synth</span> {<span class="id" title="var">Γ</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">t</span>} : <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> ⇒ (<span class="id" title="var">A</span> × <span class="id" title="var">B</span>) → <span class="id" title="var">Γ</span> |-- <span class="id" title="var">Snd</span> <span class="id" title="var">t</span> ⇒ <span class="id" title="var">B</span><br/>
<br/>
<span class="id" title="keyword">where</span> &quot;Γ |-- i =&gt; A " := (<span class="id" title="var">synthetize</span> <span class="id" title="var">Γ</span> <span class="id" title="var">i</span> <span class="id" title="var">A</span>)<br/>
<span class="id" title="var">and</span>  "Γ |-- i &lt;= A " := (<span class="id" title="var">check</span> <span class="id" title="var">Γ</span> <span class="id" title="var">i</span> <span class="id" title="var">A</span>).<br/>
<span class="id" title="keyword">Derive</span> <span class="id" title="var">Signature</span> <span class="id" title="keyword">for</span> <span class="id" title="var">check</span> <span class="id" title="var">synthetize</span>.<br/>

<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Constructors</span> <span class="id" title="var">synthetize</span> <span class="id" title="var">check</span> : <span class="id" title="var">term</span>.<br/>

<br/>
<span class="id" title="keyword">Scheme</span> <span class="id" title="var">check_mut_ind</span> := <span class="id" title="keyword">Induction</span> <span class="id" title="keyword">for</span> <span class="id" title="var">check</span> <span class="id" title="keyword">Sort</span> <span class="id" title="keyword">Prop</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">synthetize_mut_ind</span> := <span class="id" title="keyword">Induction</span> <span class="id" title="keyword">for</span> <span class="id" title="var">synthetize</span> <span class="id" title="keyword">Sort</span> <span class="id" title="keyword">Prop</span>.<br/>

<br/>
<span class="id" title="keyword">Combined Scheme</span> <span class="id" title="var">check_synthetize</span> <span class="id" title="var">from</span> <span class="id" title="var">check_mut_ind</span>, <span class="id" title="var">synthetize_mut_ind</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">synth_arrow</span> {<span class="id" title="var">Γ</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span>} : <span class="id" title="keyword">∀</span> <span class="id" title="var">A</span> : <span class="id" title="keyword">Prop</span>, <span class="id" title="var">Γ</span> |-- <span class="id" title="var">λ</span> (<span class="id" title="var">t</span>) ⇒ <span class="id" title="var">T</span> → <span class="id" title="var">A</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">A</span> <span class="id" title="var">H</span>. <span class="id" title="var">depelim</span> <span class="id" title="var">H</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">synth_pair</span> {<span class="id" title="var">Γ</span> <span class="id" title="var">t</span> <span class="id" title="var">u</span> <span class="id" title="var">T</span>} : <span class="id" title="keyword">∀</span> <span class="id" title="var">A</span> : <span class="id" title="keyword">Prop</span>, <span class="id" title="var">Γ</span> |-- &lt;&lt; <span class="id" title="var">t</span>, <span class="id" title="var">u</span> &gt;&gt; ⇒ <span class="id" title="var">T</span> → <span class="id" title="var">A</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">A</span> <span class="id" title="var">H</span>. <span class="id" title="var">depelim</span> <span class="id" title="var">H</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">synth_unit</span> {<span class="id" title="var">Γ</span> <span class="id" title="var">T</span>} : <span class="id" title="keyword">∀</span> <span class="id" title="var">A</span> : <span class="id" title="keyword">Prop</span>, <span class="id" title="var">Γ</span> |-- <span class="id" title="var">Tt</span> ⇒ <span class="id" title="var">T</span> → <span class="id" title="var">A</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">A</span> <span class="id" title="var">H</span>. <span class="id" title="var">depelim</span> <span class="id" title="var">H</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Extern</span> 3 ⇒ <br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">H</span> : ?<span class="id" title="var">Γ</span> |-- ?<span class="id" title="var">t</span> ⇒ ?<span class="id" title="var">T</span> |- <span class="id" title="var">_</span> ⇒ <span class="id" title="tactic">apply</span> (<span class="id" title="var">synth_arrow</span> <span class="id" title="var">_</span> <span class="id" title="var">H</span>) || <span class="id" title="tactic">apply</span> (<span class="id" title="var">synth_pair</span> <span class="id" title="var">_</span> <span class="id" title="var">H</span>) || <span class="id" title="tactic">apply</span> (<span class="id" title="var">synth_unit</span> <span class="id" title="var">_</span> <span class="id" title="var">H</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span> : <span class="id" title="var">term</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">check_types</span> : (<span class="id" title="keyword">∀</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span>, <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> ≤ <span class="id" title="var">T</span> → <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> : <span class="id" title="var">T</span>)<br/>
<span class="id" title="keyword">with</span> <span class="id" title="var">synthetizes_types</span> : (<span class="id" title="keyword">∀</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span>, <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> ⇒ <span class="id" title="var">T</span> → <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> : <span class="id" title="var">T</span>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">econstructor</span>; <span class="id" title="var">term</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [ <span class="id" title="tactic">econstructor</span>; <span class="id" title="var">term</span> ].<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Resolve</span> <span class="id" title="var">check_types</span> <span class="id" title="var">synthetizes_types</span> : <span class="id" title="var">term</span>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">normal</span> : <span class="id" title="var">term</span> → <span class="id" title="keyword">Prop</span> :=<br/>
| <span class="id" title="var">normal_unit</span> : <span class="id" title="var">normal</span> <span class="id" title="var">Tt</span><br/>
| <span class="id" title="var">normal_pair</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> : <span class="id" title="var">normal</span> <span class="id" title="var">a</span> → <span class="id" title="var">normal</span> <span class="id" title="var">b</span> → <span class="id" title="var">normal</span> &lt;&lt; <span class="id" title="var">a</span>, <span class="id" title="var">b</span> &gt;&gt;<br/>
| <span class="id" title="var">normal_abs</span> <span class="id" title="var">t</span> : <span class="id" title="var">normal</span> <span class="id" title="var">t</span> → <span class="id" title="var">normal</span> (<span class="id" title="var">λ</span> <span class="id" title="var">t</span>)<br/>
| <span class="id" title="var">normal_neutral</span> <span class="id" title="var">r</span> : <span class="id" title="var">neutral</span> <span class="id" title="var">r</span> → <span class="id" title="var">normal</span> <span class="id" title="var">r</span><br/>
<br/>
<span class="id" title="keyword">with</span> <span class="id" title="var">neutral</span> : <span class="id" title="var">term</span> → <span class="id" title="keyword">Prop</span> :=<br/>
| <span class="id" title="var">neutral_var</span> <span class="id" title="var">i</span> : <span class="id" title="var">neutral</span> (<span class="id" title="var">Var</span> <span class="id" title="var">i</span>)<br/>
| <span class="id" title="var">neutral_fst</span> <span class="id" title="var">t</span> : <span class="id" title="var">neutral</span> <span class="id" title="var">t</span> → <span class="id" title="var">neutral</span> (<span class="id" title="var">Fst</span> <span class="id" title="var">t</span>)<br/>
| <span class="id" title="var">neutral_snd</span> <span class="id" title="var">t</span> : <span class="id" title="var">neutral</span> <span class="id" title="var">t</span> → <span class="id" title="var">neutral</span> (<span class="id" title="var">Snd</span> <span class="id" title="var">t</span>)<br/>
| <span class="id" title="var">neutral_app</span> <span class="id" title="var">t</span> <span class="id" title="var">n</span> : <span class="id" title="var">neutral</span> <span class="id" title="var">t</span> → <span class="id" title="var">normal</span> <span class="id" title="var">n</span> → <span class="id" title="var">neutral</span> (@(<span class="id" title="var">t</span>, <span class="id" title="var">n</span>)).<br/>

<br/>
<span class="id" title="keyword">Derive</span> <span class="id" title="var">Signature</span> <span class="id" title="keyword">for</span> <span class="id" title="var">normal</span> <span class="id" title="var">neutral</span>.<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Constructors</span> <span class="id" title="var">normal</span> <span class="id" title="var">neutral</span> : <span class="id" title="var">term</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">check_lift_gen</span> <span class="id" title="var">Δ</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span> (<span class="id" title="var">H</span> : <span class="id" title="var">Δ</span> |-- <span class="id" title="var">t</span> ≤ <span class="id" title="var">T</span>) : <span class="id" title="keyword">∀</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Γ'</span>, <span class="id" title="var">Δ</span> = <span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ</span> →<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">Γ''</span>, <span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ''</span> @ <span class="id" title="var">Γ</span> |-- <span class="id" title="var">lift</span> (<span class="id" title="var">length</span> <span class="id" title="var">Γ'</span>) (<span class="id" title="var">length</span> <span class="id" title="var">Γ''</span>) <span class="id" title="var">t</span> ≤ <span class="id" title="var">T</span><br/>
<span class="id" title="keyword">with</span> <span class="id" title="var">synthetize_lift_gen</span> <span class="id" title="var">Δ</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span> (<span class="id" title="var">H</span> : <span class="id" title="var">Δ</span> |-- <span class="id" title="var">t</span> ⇒ <span class="id" title="var">T</span>) : <span class="id" title="keyword">∀</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Γ'</span>, <span class="id" title="var">Δ</span> = <span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ</span> →<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">Γ''</span>, <span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ''</span> @ <span class="id" title="var">Γ</span> |-- <span class="id" title="var">lift</span> (<span class="id" title="var">length</span> <span class="id" title="var">Γ'</span>) (<span class="id" title="var">length</span> <span class="id" title="var">Γ''</span>) <span class="id" title="var">t</span> ⇒ <span class="id" title="var">T</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="var">simp</span> <span class="id" title="var">lift</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">change</span> (<span class="id" title="var">S</span> (<span class="id" title="var">length</span> <span class="id" title="var">Γ'</span>)) <span class="id" title="keyword">with</span> (<span class="id" title="var">length</span> (<span class="id" title="var">A</span> :: <span class="id" title="var">Γ'</span>)). <span class="id" title="tactic">change</span> (<span class="id" title="var">A</span> :: <span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ''</span> @ <span class="id" title="var">Γ0</span>) <span class="id" title="keyword">with</span> ((<span class="id" title="var">A</span> :: <span class="id" title="var">Γ'</span>) @ <span class="id" title="var">Γ''</span> @ <span class="id" title="var">Γ0</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">check_lift_gen</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_comm_cons</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">eassumption</span>; <span class="id" title="tactic">trivial</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eapply</span> <span class="id" title="var">check_lift_gen</span>; <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span>. <span class="id" title="var">eassumption</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">synthetize_lift_gen</span>; <span class="id" title="var">eassumption</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="var">simp</span> <span class="id" title="var">lift</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span> [<span class="id" title="tactic">econstructor</span>; <span class="id" title="var">term</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">check_lift_gen</span> <span class="id" title="var">synthetize_lift_gen</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> (<span class="id" title="var">nth_extend_middle</span> <span class="id" title="var">unit</span> <span class="id" title="var">i</span> <span class="id" title="var">Γ0</span> <span class="id" title="var">Γ'</span> <span class="id" title="var">Γ''</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Nat.compare</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">H'</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H'</span>; <span class="id" title="var">simp</span> <span class="id" title="var">lift</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">axiom_synth</span>; <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">list</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span> |- *; <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">check_lift</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span> <span class="id" title="var">Γ'</span> (<span class="id" title="var">H</span> : <span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> ≤ <span class="id" title="var">T</span>) : <br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">Γ''</span>, <span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ''</span> @ <span class="id" title="var">Γ</span> |-- <span class="id" title="var">lift</span> (<span class="id" title="var">length</span> <span class="id" title="var">Γ'</span>) (<span class="id" title="var">length</span> <span class="id" title="var">Γ''</span>) <span class="id" title="var">t</span> ≤ <span class="id" title="var">T</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">check_lift_gen</span> (<span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ</span>) <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">eq_refl</span>.<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">synthetize_lift</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span> <span class="id" title="var">Γ'</span> (<span class="id" title="var">H</span> : <span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> ⇒ <span class="id" title="var">T</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">Γ''</span>, <span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ''</span> @ <span class="id" title="var">Γ</span> |-- <span class="id" title="var">lift</span> (<span class="id" title="var">length</span> <span class="id" title="var">Γ'</span>) (<span class="id" title="var">length</span> <span class="id" title="var">Γ''</span>) <span class="id" title="var">t</span> ⇒ <span class="id" title="var">T</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">synthetize_lift_gen</span> (<span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ</span>) <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">eq_refl</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">check_lift1</span> {<span class="id" title="var">Γ</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span> <span class="id" title="var">A</span>} : <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> ≤ <span class="id" title="var">T</span> → <span class="id" title="var">A</span> :: <span class="id" title="var">Γ</span> |-- <span class="id" title="var">lift</span> 0 1 <span class="id" title="var">t</span> ≤ <span class="id" title="var">T</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="var">check_lift</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span> [] <span class="id" title="var">H</span> [<span class="id" title="var">A</span>]). <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">synth_lift1</span> {<span class="id" title="var">Γ</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span> <span class="id" title="var">A</span>} : <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> ⇒ <span class="id" title="var">T</span> → <span class="id" title="var">A</span> :: <span class="id" title="var">Γ</span> |-- <span class="id" title="var">lift</span> 0 1 <span class="id" title="var">t</span> ⇒ <span class="id" title="var">T</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="var">synthetize_lift</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span> [] <span class="id" title="var">H</span> [<span class="id" title="var">A</span>]). <span class="id" title="keyword">Qed</span>.<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Resolve</span> <span class="id" title="var">check_lift1</span> <span class="id" title="var">synth_lift1</span> : <span class="id" title="var">term</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">check_lift_ctx</span> {<span class="id" title="var">Γ</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span> <span class="id" title="var">Γ'</span>} : <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> ≤ <span class="id" title="var">T</span> → <span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ</span> |-- <span class="id" title="var">lift</span> 0 (<span class="id" title="var">length</span> <span class="id" title="var">Γ'</span>) <span class="id" title="var">t</span> ≤ <span class="id" title="var">T</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="var">check_lift</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span> [] <span class="id" title="var">H</span> <span class="id" title="var">Γ'</span>). <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">synth_lift_ctx</span> {<span class="id" title="var">Γ</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span> <span class="id" title="var">Γ'</span>} : <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> ⇒ <span class="id" title="var">T</span> → <span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ</span> |-- <span class="id" title="var">lift</span> 0 (<span class="id" title="var">length</span> <span class="id" title="var">Γ'</span>) <span class="id" title="var">t</span> ⇒ <span class="id" title="var">T</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="var">synthetize_lift</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span> [] <span class="id" title="var">H</span> <span class="id" title="var">Γ'</span>). <span class="id" title="keyword">Qed</span>.<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Resolve</span> <span class="id" title="var">check_lift_ctx</span> <span class="id" title="var">synth_lift_ctx</span> : <span class="id" title="var">term</span>.<br/>

<br/>
<span class="id" title="keyword">Equations</span> <span class="id" title="var">η</span> (<span class="id" title="var">a</span> : <span class="id" title="keyword">type</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">term</span>) : <span class="id" title="var">term</span> :=<br/>
<span class="id" title="var">η</span> (<span class="id" title="var">atom</span> <span class="id" title="var">_</span>) <span class="id" title="var">t</span> := <span class="id" title="var">t</span> ;<br/>
<span class="id" title="var">η</span> (<span class="id" title="var">product</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>) <span class="id" title="var">t</span> := &lt;&lt; <span class="id" title="var">η</span> <span class="id" title="var">a</span> (<span class="id" title="var">Fst</span> <span class="id" title="var">t</span>), <span class="id" title="var">η</span> <span class="id" title="var">b</span> (<span class="id" title="var">Snd</span> <span class="id" title="var">t</span>) &gt;&gt; ;<br/>
<span class="id" title="var">η</span> (<span class="id" title="var">arrow</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>) <span class="id" title="var">t</span> := (<span class="id" title="var">Lambda</span> (<span class="id" title="var">η</span> <span class="id" title="var">b</span> @(<span class="id" title="var">lift</span> 0 1 <span class="id" title="var">t</span>, <span class="id" title="var">η</span> <span class="id" title="var">a</span> 0)))%<span class="id" title="var">term</span> ;<br/>
<span class="id" title="var">η</span> <span class="id" title="var">unit</span> <span class="id" title="var">t</span> := <span class="id" title="var">Tt</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">checks_arrow</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> ≤ <span class="id" title="var">A</span> ---&gt; <span class="id" title="var">B</span> → ∃ <span class="id" title="var">t'</span>, <span class="id" title="var">t</span> = <span class="id" title="var">λ</span> <span class="id" title="var">t'</span> ∧ <span class="id" title="var">A</span> :: <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t'</span> ≤ <span class="id" title="var">B</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">t0</span>; <span class="id" title="var">term</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">normal_lift</span> {<span class="id" title="var">t</span> <span class="id" title="var">k</span> <span class="id" title="var">n</span>} : <span class="id" title="var">normal</span> <span class="id" title="var">t</span> → <span class="id" title="var">normal</span> (<span class="id" title="var">lift</span> <span class="id" title="var">k</span> <span class="id" title="var">n</span> <span class="id" title="var">t</span>) <br/>
&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">neutral_lift</span> {<span class="id" title="var">t</span> <span class="id" title="var">k</span> <span class="id" title="var">n</span>} : <span class="id" title="var">neutral</span> <span class="id" title="var">t</span> → <span class="id" title="var">neutral</span> (<span class="id" title="var">lift</span> <span class="id" title="var">k</span> <span class="id" title="var">n</span> <span class="id" title="var">t</span>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">destruct</span> 1; <span class="id" title="var">simp</span> <span class="id" title="var">lift</span>; <span class="id" title="tactic">constructor</span>; <span class="id" title="var">term</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> 1; <span class="id" title="var">simp</span> <span class="id" title="var">lift</span>; <span class="id" title="tactic">try</span> (<span class="id" title="tactic">constructor</span>; <span class="id" title="var">term</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Nat.compare</span>; <span class="id" title="var">term</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Resolve</span> <span class="id" title="var">normal_lift</span> <span class="id" title="var">neutral_lift</span> : <span class="id" title="var">term</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">check_normal</span> {<span class="id" title="var">Γ</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span>} : <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> ≤ <span class="id" title="var">T</span> → <span class="id" title="var">normal</span> <span class="id" title="var">t</span><br/>
&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">synth_neutral</span> {<span class="id" title="var">Γ</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span>} : <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> ⇒ <span class="id" title="var">T</span> → <span class="id" title="var">neutral</span> <span class="id" title="var">t</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">destruct</span> 1; <span class="id" title="tactic">constructor</span>; <span class="id" title="var">term</span>. <span class="id" title="tactic">destruct</span> 1; <span class="id" title="tactic">constructor</span>; <span class="id" title="var">term</span>. <span class="id" title="keyword">Qed</span>.<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Resolve</span> <span class="id" title="var">check_normal</span> <span class="id" title="var">synth_neutral</span> : <span class="id" title="var">term</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">eta_expand</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span> <span class="id" title="var">A</span> : <span class="id" title="var">neutral</span> <span class="id" title="var">t</span> → <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> ⇒ <span class="id" title="var">A</span> → <span class="id" title="var">Γ</span> |-- <span class="id" title="var">η</span> <span class="id" title="var">A</span> <span class="id" title="var">t</span> ≤ <span class="id" title="var">A</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="var">revert</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span>; <span class="id" title="tactic">induction</span> <span class="id" title="var">A</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="var">simp</span> <span class="id" title="var">η</span>; <span class="id" title="tactic">constructor</span>; <span class="id" title="var">term</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(0 &lt; <span class="id" title="var">length</span> (<span class="id" title="var">A1</span> :: <span class="id" title="var">Γ</span>)) <span class="id" title="tactic">by</span> (<span class="id" title="tactic">simpl</span>; <span class="id" title="var">lia</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHA1</span> (<span class="id" title="var">A1</span> :: <span class="id" title="var">Γ</span>) 0 (<span class="id" title="var">neutral_var</span> <span class="id" title="var">_</span>) (<span class="id" title="var">axiom_synth</span> (<span class="id" title="var">A1</span> :: <span class="id" title="var">Γ</span>) 0 <span class="id" title="var">H1</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">IHA2</span> (<span class="id" title="var">A1</span> :: <span class="id" title="var">Γ</span>) @(<span class="id" title="var">lift</span> 0 1 <span class="id" title="var">t</span>, <span class="id" title="var">η</span> <span class="id" title="var">A1</span> 0)); <span class="id" title="var">term</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">η_normal</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">Γ</span> <span class="id" title="var">A</span> <span class="id" title="var">t</span>, <span class="id" title="var">neutral</span> <span class="id" title="var">t</span> → <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> ⇒ <span class="id" title="var">A</span> → <span class="id" title="var">normal</span> (<span class="id" title="var">η</span> <span class="id" title="var">A</span> <span class="id" title="var">t</span>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">eta_expand</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>; <span class="id" title="var">term</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Going to use the subterm order 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Stdlib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Arith</span> <span class="id" title="var">Wf_nat</span>.<br/>
#[<span class="id" title="var">export</span>] <span class="id" title="keyword">Instance</span> <span class="id" title="var">wf_nat</span> : <span class="id" title="var">Classes.WellFounded</span> <span class="id" title="var">lt</span> := <span class="id" title="var">lt_wf</span>.<br/>

<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Constructors</span> <span class="id" title="var">Subterm.lexprod</span> : <span class="id" title="var">subterm_relation</span>.<br/>

<br/>
<span class="id" title="keyword">Derive</span> <span class="id" title="var">Signature</span> <span class="id" title="keyword">for</span> <span class="id" title="var">Acc</span>.<br/>
<span class="id" title="keyword">Notation</span> <span class="id" title="var">lexicographic</span> <span class="id" title="var">R</span> <span class="id" title="var">S</span> := (<span class="id" title="var">Subterm.lexprod</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">R</span> <span class="id" title="var">S</span>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">her_order</span> : <span class="id" title="var">relation</span> (<span class="id" title="keyword">type</span> × <span class="id" title="var">term</span> × <span class="id" title="var">term</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">lexicographic</span> (<span class="id" title="var">lexicographic</span> <span class="id" title="var">type_subterm</span> <span class="id" title="var">term_subterm</span>) <span class="id" title="var">term_subterm</span>.<br/>

<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Unfold</span> <span class="id" title="var">her_order</span> : <span class="id" title="var">subterm_relation</span>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">Program.Tactics</span>.<br/>
<span class="id" title="keyword">Local Obligation</span> <span class="id" title="keyword">Tactic</span> := <span class="id" title="tactic">program_simpl</span>.<br/>

<br/>
<span class="id" title="keyword">Arguments</span> <span class="id" title="var">exist</span> [<span class="id" title="var">A</span>] [<span class="id" title="var">P</span>].<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">hereditary_type</span> (<span class="id" title="var">t</span> : <span class="id" title="keyword">type</span> × <span class="id" title="var">term</span> × <span class="id" title="var">term</span>) :=<br/>
&nbsp;&nbsp;(<span class="id" title="var">term</span> × <span class="id" title="var">option</span> { <span class="id" title="var">u</span> : <span class="id" title="keyword">type</span> | <span class="id" title="var">u</span> = (<span class="id" title="var">fst</span> (<span class="id" title="var">fst</span> <span class="id" title="var">t</span>)) ∨ <span class="id" title="var">type_subterm</span> <span class="id" title="var">u</span> (<span class="id" title="var">fst</span> (<span class="id" title="var">fst</span> <span class="id" title="var">t</span>)) })%<span class="id" title="keyword">type</span>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">IsLambda</span> {<span class="id" title="var">t</span>} : <span class="id" title="var">hereditary_type</span> <span class="id" title="var">t</span> → <span class="id" title="keyword">Set</span> :=<br/>
| <span class="id" title="var">isLambda</span> <span class="id" title="var">abs</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">prf</span> : <span class="id" title="var">IsLambda</span> (<span class="id" title="var">Lambda</span> <span class="id" title="var">abs</span>, <span class="id" title="var">Some</span> (<span class="id" title="var">exist</span> (<span class="id" title="var">arrow</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>) <span class="id" title="var">prf</span>)).<br/>

<br/>
<span class="id" title="keyword">Equations</span> <span class="id" title="var">is_lambda</span> {<span class="id" title="var">t</span>} (<span class="id" title="var">h</span> : <span class="id" title="var">hereditary_type</span> <span class="id" title="var">t</span>) : <span class="id" title="var">IsLambda</span> <span class="id" title="var">h</span> + <span class="id" title="var">term</span> :=<br/>
<span class="id" title="var">is_lambda</span> (<span class="id" title="var">pair</span> (<span class="id" title="var">Lambda</span> <span class="id" title="var">abs</span>) (<span class="id" title="var">Some</span> (<span class="id" title="var">exist</span> (<span class="id" title="var">arrow</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>) <span class="id" title="var">prf</span>))) := <span class="id" title="var">inl</span> (<span class="id" title="var">isLambda</span> <span class="id" title="var">abs</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">prf</span>) ;<br/>
<span class="id" title="var">is_lambda</span> (<span class="id" title="var">pair</span> <span class="id" title="var">t'</span> <span class="id" title="var">_</span>) := <span class="id" title="var">inr</span> <span class="id" title="var">t'</span>.<br/>
<span class="id" title="keyword">Arguments</span> <span class="id" title="var">is_lambda</span> : <span class="id" title="tactic">simpl</span> <span class="id" title="var">never</span>.<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">is_lambda_inr</span> {<span class="id" title="var">t</span>} (<span class="id" title="var">h</span> : <span class="id" title="var">hereditary_type</span> <span class="id" title="var">t</span>) : <span class="id" title="keyword">∀</span> <span class="id" title="var">t'</span>, <span class="id" title="var">is_lambda</span> <span class="id" title="var">h</span> = <span class="id" title="var">inr</span> <span class="id" title="var">t'</span> → <span class="id" title="var">fst</span> <span class="id" title="var">h</span> = <span class="id" title="var">t'</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="tactic">elim</span> := <span class="id" title="keyword">constr</span>:(<span class="id" title="var">fun_elim</span> (<span class="id" title="var">f</span>:=@<span class="id" title="var">is_lambda</span>)) <span class="id" title="tactic">in</span> <span class="id" title="tactic">apply</span> <span class="id" title="tactic">elim</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">congruence</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">IsPair</span> {<span class="id" title="var">t</span>} : <span class="id" title="var">hereditary_type</span> <span class="id" title="var">t</span> → <span class="id" title="keyword">Set</span> :=<br/>
| <span class="id" title="var">isPair</span> <span class="id" title="var">u</span> <span class="id" title="var">v</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">prf</span> : <span class="id" title="var">IsPair</span> (<span class="id" title="var">Pair</span> <span class="id" title="var">u</span> <span class="id" title="var">v</span>, <span class="id" title="var">Some</span> (<span class="id" title="var">exist</span> (<span class="id" title="var">product</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>) <span class="id" title="var">prf</span>)).<br/>

<br/>
<span class="id" title="keyword">Equations</span> <span class="id" title="var">is_pair</span> {<span class="id" title="var">t</span>} (<span class="id" title="var">h</span> : <span class="id" title="var">hereditary_type</span> <span class="id" title="var">t</span>) : <span class="id" title="var">IsPair</span> <span class="id" title="var">h</span> + <span class="id" title="var">term</span> :=<br/>
<span class="id" title="var">is_pair</span> (<span class="id" title="var">pair</span> (<span class="id" title="var">Pair</span> <span class="id" title="var">u</span> <span class="id" title="var">v</span>) (<span class="id" title="var">Some</span> (<span class="id" title="var">exist</span> (<span class="id" title="var">product</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>) <span class="id" title="var">prf</span>))) := <span class="id" title="var">inl</span> (<span class="id" title="var">isPair</span> <span class="id" title="var">u</span> <span class="id" title="var">v</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">prf</span>) ;<br/>
<span class="id" title="var">is_pair</span> (<span class="id" title="var">pair</span> <span class="id" title="var">t'</span> <span class="id" title="var">_</span>) := <span class="id" title="var">inr</span> <span class="id" title="var">t'</span>.<br/>
<span class="id" title="keyword">Arguments</span> <span class="id" title="var">is_pair</span> : <span class="id" title="tactic">simpl</span> <span class="id" title="var">never</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">is_pair_inr</span> {<span class="id" title="var">t</span>} (<span class="id" title="var">h</span> : <span class="id" title="var">hereditary_type</span> <span class="id" title="var">t</span>) : <span class="id" title="keyword">∀</span> <span class="id" title="var">t'</span>, <span class="id" title="var">is_pair</span> <span class="id" title="var">h</span> = <span class="id" title="var">inr</span> <span class="id" title="var">t'</span> → <span class="id" title="var">fst</span> <span class="id" title="var">h</span> = <span class="id" title="var">t'</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="tactic">elim</span> := <span class="id" title="keyword">constr</span>:(<span class="id" title="var">fun_elim</span> (<span class="id" title="var">f</span>:=@<span class="id" title="var">is_pair</span>)) <span class="id" title="tactic">in</span> <span class="id" title="tactic">apply</span> <span class="id" title="tactic">elim</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">congruence</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">nth_extend_right</span> {<span class="id" title="var">A</span>} (<span class="id" title="var">a</span> : <span class="id" title="var">A</span>) <span class="id" title="var">n</span> (<span class="id" title="var">l</span> <span class="id" title="var">l'</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) : <span class="id" title="var">n</span> &lt; <span class="id" title="var">length</span> <span class="id" title="var">l</span> → <br/>
&nbsp;&nbsp;<span class="id" title="var">nth</span> <span class="id" title="var">n</span> <span class="id" title="var">l</span> <span class="id" title="var">a</span> = <span class="id" title="var">nth</span> <span class="id" title="var">n</span> (<span class="id" title="var">l</span> @ <span class="id" title="var">l'</span>) <span class="id" title="var">a</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="var">revert</span> <span class="id" title="var">n</span> <span class="id" title="var">l'</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="var">depelim</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">n</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHl</span>. <span class="id" title="tactic">auto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">arith</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">her_type</span> (<span class="id" title="var">t</span> : <span class="id" title="keyword">type</span> × <span class="id" title="var">term</span> × <span class="id" title="var">term</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">u'</span> := <span class="id" title="var">fst</span> (<span class="id" title="var">fst</span> <span class="id" title="var">t</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">u</span> : <span class="id" title="keyword">type</span> | <span class="id" title="var">u</span> = <span class="id" title="var">u'</span> ∨ <span class="id" title="var">type_subterm</span> <span class="id" title="var">u</span> <span class="id" title="var">u'</span> }.<br/>

<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="var">Remove</span> <span class="id" title="var">Hints</span> <span class="id" title="var">t_step</span> : <span class="id" title="var">subterm_relation</span>.<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="var">Remove</span> <span class="id" title="var">Hints</span> <span class="id" title="var">Subterm.clos_trans_stepr</span> : <span class="id" title="var">subterm_relation</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">apply_step</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|- <span class="id" title="var">clos_trans</span> ?<span class="id" title="var">A</span> ?<span class="id" title="var">R</span> ?<span class="id" title="var">x</span> ?<span class="id" title="var">y</span> ⇒ <span class="id" title="var">not_evar</span> <span class="id" title="var">y</span>; <span class="id" title="tactic">eapply</span> <span class="id" title="var">t_step</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Extern</span> 30 (<span class="id" title="var">clos_trans</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) ⇒ <span class="id" title="var">apply_step</span> : <span class="id" title="var">subterm_relation</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">clos_trans_inv</span> {<span class="id" title="var">A</span>} <span class="id" title="var">R</span> (<span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> : <span class="id" title="var">A</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">clos_trans</span> <span class="id" title="var">A</span> <span class="id" title="var">R</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span> → <span class="id" title="var">clos_trans</span> <span class="id" title="var">A</span> <span class="id" title="var">R</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> → <span class="id" title="var">clos_trans</span> <span class="id" title="var">A</span> <span class="id" title="var">R</span> <span class="id" title="var">x</span> <span class="id" title="var">z</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">using</span> <span class="id" title="var">t_trans</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">apply_transitivity</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|- <span class="id" title="var">clos_trans</span> ?<span class="id" title="var">A</span> ?<span class="id" title="var">R</span> ?<span class="id" title="var">x</span> ?<span class="id" title="var">y</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">not_evar</span> <span class="id" title="var">x</span>; <span class="id" title="var">not_evar</span> <span class="id" title="var">y</span>; <span class="id" title="tactic">eapply</span> <span class="id" title="var">clos_trans_inv</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Extern</span> 31 (<span class="id" title="var">clos_trans</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) ⇒ <span class="id" title="var">apply_transitivity</span> : <span class="id" title="var">subterm_relation</span>.<br/>

<br/>
<span class="id" title="keyword">Equations</span>? <span class="id" title="var">hereditary_subst</span> (<span class="id" title="var">t</span> : <span class="id" title="keyword">type</span> × <span class="id" title="var">term</span> × <span class="id" title="var">term</span>) (<span class="id" title="var">k</span> : <span class="id" title="var">nat</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">term</span> × <span class="id" title="var">option</span> (<span class="id" title="var">her_type</span> <span class="id" title="var">t</span>)<br/>
&nbsp;&nbsp;<span class="id" title="tactic">by</span> <span class="id" title="keyword">wf</span> <span class="id" title="var">t</span> <span class="id" title="var">her_order</span> :=<br/>
<br/>
<span class="id" title="var">hereditary_subst</span> (<span class="id" title="var">pair</span> (<span class="id" title="var">pair</span> <span class="id" title="var">A</span> <span class="id" title="var">a</span>) <span class="id" title="var">t</span>) <span class="id" title="var">k</span> <span class="id" title="keyword">with</span> <span class="id" title="var">t</span> := {<br/>
&nbsp;&nbsp;| <span class="id" title="var">Var</span> <span class="id" title="var">i</span> <span class="id" title="keyword">with</span> <span class="id" title="var">Nat.compare</span> <span class="id" title="var">i</span> <span class="id" title="var">k</span> := {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Eq</span> := (<span class="id" title="var">lift</span> 0 <span class="id" title="var">k</span> <span class="id" title="var">a</span>, <span class="id" title="var">Some</span> (<span class="id" title="var">exist</span> <span class="id" title="var">A</span> <span class="id" title="var">_</span>)) ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Lt</span> := (<span class="id" title="var">Var</span> <span class="id" title="var">i</span>, <span class="id" title="var">None</span>) ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Gt</span> := (<span class="id" title="var">Var</span> (<span class="id" title="var">pred</span> <span class="id" title="var">i</span>), <span class="id" title="var">None</span>) } ;<br/>
<br/>
&nbsp;&nbsp;| <span class="id" title="var">Lambda</span> <span class="id" title="var">t'</span> := (<span class="id" title="var">Lambda</span> (<span class="id" title="var">fst</span> (<span class="id" title="var">hereditary_subst</span> (<span class="id" title="var">A</span>, <span class="id" title="var">a</span>, <span class="id" title="var">t'</span>) (<span class="id" title="var">S</span> <span class="id" title="var">k</span>))), <span class="id" title="var">None</span>) ;<br/>
<br/>
&nbsp;&nbsp;| <span class="id" title="var">App</span> <span class="id" title="var">f</span> <span class="id" title="var">arg</span> <span class="id" title="keyword">with</span> <span class="id" title="var">hereditary_subst</span> (<span class="id" title="var">A</span>, <span class="id" title="var">a</span>, <span class="id" title="var">f</span>) <span class="id" title="var">k</span> := {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">p</span> <span class="id" title="keyword">with</span> <span class="id" title="var">is_lambda</span> <span class="id" title="var">p</span> := {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">inl</span> (<span class="id" title="var">isLambda</span> <span class="id" title="var">f'</span> <span class="id" title="var">A'</span> <span class="id" title="var">B'</span> <span class="id" title="var">prf</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<span class="id" title="var">f''</span>, <span class="id" title="var">y</span>) := <span class="id" title="var">hereditary_subst</span> (<span class="id" title="var">A'</span>, <span class="id" title="var">fst</span> (<span class="id" title="var">hereditary_subst</span> (<span class="id" title="var">A</span>, <span class="id" title="var">a</span>, <span class="id" title="var">arg</span>) <span class="id" title="var">k</span>), <span class="id" title="var">f'</span>) 0 <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">f''</span>, <span class="id" title="var">Some</span> (<span class="id" title="var">exist</span> <span class="id" title="var">B'</span> <span class="id" title="var">_</span>)) ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">inr</span> <span class="id" title="var">f'</span> := (@(<span class="id" title="var">f'</span>, <span class="id" title="var">fst</span> (<span class="id" title="var">hereditary_subst</span> (<span class="id" title="var">A</span>, <span class="id" title="var">a</span>, <span class="id" title="var">arg</span>) <span class="id" title="var">k</span>)), <span class="id" title="var">None</span>) } } ;<br/>
<br/>
&nbsp;&nbsp;| <span class="id" title="var">Pair</span> <span class="id" title="var">i</span> <span class="id" title="var">j</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(&lt;&lt; <span class="id" title="var">fst</span> (<span class="id" title="var">hereditary_subst</span> (<span class="id" title="var">A</span>, <span class="id" title="var">a</span>, <span class="id" title="var">i</span>) <span class="id" title="var">k</span>), <span class="id" title="var">fst</span> (<span class="id" title="var">hereditary_subst</span> (<span class="id" title="var">A</span>, <span class="id" title="var">a</span>, <span class="id" title="var">j</span>) <span class="id" title="var">k</span>) &gt;&gt;, <span class="id" title="var">None</span>) ;<br/>
<br/>
&nbsp;&nbsp;| <span class="id" title="var">Fst</span> <span class="id" title="var">t'</span> <span class="id" title="keyword">with</span> <span class="id" title="var">hereditary_subst</span> (<span class="id" title="var">A</span>, <span class="id" title="var">a</span>, <span class="id" title="var">t'</span>) <span class="id" title="var">k</span> := {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">p</span> <span class="id" title="keyword">with</span> <span class="id" title="var">is_pair</span> <span class="id" title="var">p</span> := {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">inl</span> (<span class="id" title="var">isPair</span> <span class="id" title="var">u</span> <span class="id" title="var">v</span> <span class="id" title="var">a'</span> <span class="id" title="var">b'</span> <span class="id" title="var">prf</span>) := (<span class="id" title="var">u</span>, <span class="id" title="var">Some</span> (<span class="id" title="var">exist</span> <span class="id" title="var">a'</span> <span class="id" title="var">_</span>)) ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">inr</span> <span class="id" title="var">p'</span> := (<span class="id" title="var">Fst</span> <span class="id" title="var">p'</span>, <span class="id" title="var">None</span>) } } ;<br/>
<br/>
&nbsp;&nbsp;| <span class="id" title="var">Snd</span> <span class="id" title="var">t'</span> <span class="id" title="keyword">with</span> <span class="id" title="var">hereditary_subst</span> (<span class="id" title="var">A</span>, <span class="id" title="var">a</span>, <span class="id" title="var">t'</span>) <span class="id" title="var">k</span> := {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">p</span> <span class="id" title="keyword">with</span> <span class="id" title="var">is_pair</span> <span class="id" title="var">p</span> := {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">inl</span> (<span class="id" title="var">isPair</span> <span class="id" title="var">u</span> <span class="id" title="var">v</span> <span class="id" title="var">a'</span> <span class="id" title="var">b'</span> <span class="id" title="var">prf</span>) := (<span class="id" title="var">v</span>, <span class="id" title="var">Some</span> (<span class="id" title="var">exist</span> <span class="id" title="var">b'</span> <span class="id" title="var">_</span>)) ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">inr</span> <span class="id" title="var">p'</span> := (<span class="id" title="var">Snd</span> <span class="id" title="var">p'</span>, <span class="id" title="var">None</span>) } } ;<br/>
<br/>
&nbsp;&nbsp;| <span class="id" title="var">Tt</span> := (<span class="id" title="var">Tt</span>, <span class="id" title="var">None</span>) }.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">all</span>:(<span class="id" title="tactic">try</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> |- <span class="id" title="var">her_order</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">her_type</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">try</span> (<span class="id" title="tactic">clear</span>; <span class="id" title="tactic">constructor</span> 2; <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">constructor</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>).<br/>
&nbsp;&nbsp;1:(<span class="id" title="tactic">destruct</span> <span class="id" title="var">prf</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">eauto</span> 10 <span class="id" title="keyword">with</span> <span class="id" title="var">subterm_relation</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">all</span>:(<span class="id" title="tactic">clear</span> -<span class="id" title="var">prf</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">destruct</span> <span class="id" title="var">prf</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">eauto</span> 5 <span class="id" title="keyword">with</span> <span class="id" title="var">subterm_relation</span>).<br/>
<span class="id" title="keyword">Defined</span>.<br/>

<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Unfold</span> <span class="id" title="var">her_type</span> : <span class="id" title="var">subterm_relation</span>.<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Unfold</span> <span class="id" title="var">Program.Basics.const</span> : <span class="id" title="var">subterm_relation</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">autoh</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">type_subterm</span> <span class="id" title="tactic">in</span> × ; <span class="id" title="tactic">try</span> <span class="id" title="var">typeclasses</span> <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">hereditary_subst</span> <span class="id" title="var">subterm_relation</span>.<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">simph</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="var">rewrite_strat</span> (<span class="id" title="var">innermost</span> (<span class="id" title="var">hints</span> <span class="id" title="var">hereditary_subst</span>)));<br/>
&nbsp;&nbsp;<span class="id" title="var">autoh</span>.<br/>

<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Transparent</span> <span class="id" title="var">type_subterm</span> : <span class="id" title="var">subterm_relation</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">invert_term</span> := <br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : <span class="id" title="var">check</span> <span class="id" title="var">_</span> (<span class="id" title="var">Lambda</span> <span class="id" title="var">_</span>) <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> ] ⇒ <span class="id" title="var">depelim</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : <span class="id" title="var">check</span> <span class="id" title="var">_</span> (<span class="id" title="var">Pair</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> ] ⇒ <span class="id" title="var">depelim</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : <span class="id" title="var">check</span> <span class="id" title="var">_</span> <span class="id" title="var">Tt</span> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> ] ⇒ <span class="id" title="var">depelim</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id" title="var">H</span> : <span class="id" title="var">types</span> <span class="id" title="var">_</span> ?<span class="id" title="var">t</span> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> ] ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Var</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">depelim</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Lambda</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">depelim</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">App</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">depelim</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Pair</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">depelim</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Fst</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">depelim</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Snd</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">depelim</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Tt</span> ⇒ <span class="id" title="var">depelim</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">hereditary_subst_type</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Γ'</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span> <span class="id" title="var">u</span> <span class="id" title="var">U</span> : <span class="id" title="var">Γ</span> |-- <span class="id" title="var">u</span> : <span class="id" title="var">U</span> → <span class="id" title="var">Γ'</span> @ (<span class="id" title="var">U</span> :: <span class="id" title="var">Γ</span>) |-- <span class="id" title="var">t</span> : <span class="id" title="var">T</span> →<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<span class="id" title="var">t'</span>, <span class="id" title="var">o</span>) := <span class="id" title="var">hereditary_subst</span> (<span class="id" title="var">U</span>, <span class="id" title="var">u</span>, <span class="id" title="var">t</span>) (<span class="id" title="var">length</span> <span class="id" title="var">Γ'</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t'</span> : <span class="id" title="var">T</span> ∧ (<span class="id" title="keyword">∀</span> <span class="id" title="var">ty</span> <span class="id" title="var">prf</span>, <span class="id" title="var">o</span> = <span class="id" title="var">Some</span> (<span class="id" title="var">exist</span> <span class="id" title="var">ty</span> <span class="id" title="var">prf</span>) → <span class="id" title="var">ty</span> = <span class="id" title="var">T</span>)).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">funelim</span> (<span class="id" title="var">hereditary_subst</span> (<span class="id" title="var">U</span>, <span class="id" title="var">u</span>, <span class="id" title="var">t</span>) (<span class="id" title="var">length</span> <span class="id" title="var">Γ'</span>)) <span class="id" title="var">Heqcall</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqcall</span> |- *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">DepElim.simpl_dep_elim</span>; <span class="id" title="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">split</span>; [ (<span class="id" title="tactic">intros</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>) | <span class="id" title="tactic">solve</span> [ <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">discriminate</span> ] ]);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">DepElim.simplify_dep_elim</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="var">invert_term</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> ×. <span class="id" title="tactic">apply</span> <span class="id" title="var">abstraction</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">Γ</span> (<span class="id" title="var">A0</span> :: <span class="id" title="var">Γ'</span>)). <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">eqns_specialize_eqs</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">on_call</span> <span class="id" title="var">hereditary_subst</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">c</span> ⇒ <span class="id" title="var">remember</span> <span class="id" title="var">c</span> <span class="id" title="keyword">as</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">_</span> <span class="id" title="var">H0</span> <span class="id" title="var">H1</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">auto</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="var">on_call</span> <span class="id" title="var">hereditary_subst</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">c</span> ⇒ <span class="id" title="var">remember</span> <span class="id" title="var">c</span> <span class="id" title="keyword">as</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *).<br/>
&nbsp;&nbsp;<span class="id" title="var">on_call</span> <span class="id" title="var">hereditary_subst</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">c</span> ⇒ <span class="id" title="var">remember</span> <span class="id" title="var">c</span> <span class="id" title="keyword">as</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *).<br/>
&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">H0</span>. <span class="id" title="var">term</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Var&nbsp;*)</span> <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Nat.compare_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> !<span class="id" title="var">nth_length</span>. <span class="id" title="tactic">split</span>. <span class="id" title="var">term</span>. <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">noconf</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">auto</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Lt&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Nat.compare_lt_iff</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="var">depelim</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">nth</span> <span class="id" title="var">i</span> (<span class="id" title="var">Γ'</span> @ (<span class="id" title="var">_</span> :: <span class="id" title="var">Γ</span>)) <span class="id" title="var">unit</span>) <span class="id" title="keyword">with</span> (<span class="id" title="var">nth</span> <span class="id" title="var">i</span> (<span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ</span>) <span class="id" title="var">unit</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">length_app</span>. <span class="id" title="tactic">auto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">arith</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">nth_extend_right</span> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Gt&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">substitutive</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H0</span> <span class="id" title="var">H</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">simp</span> <span class="id" title="tactic">subst</span> <span class="id" title="tactic">in</span> <span class="id" title="var">t</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">t</span>. <span class="id" title="var">simp</span> <span class="id" title="tactic">subst</span> <span class="id" title="tactic">in</span> <span class="id" title="var">t</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;App&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> ×.<br/>
&nbsp;&nbsp;- <span class="id" title="var">on_call</span> (<span class="id" title="var">hereditary_subst</span> (<span class="id" title="var">A</span>, <span class="id" title="var">a</span>, <span class="id" title="var">arg</span>)) <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">c</span> ⇒ <span class="id" title="var">remember</span> <span class="id" title="var">c</span> <span class="id" title="keyword">as</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">on_call</span> <span class="id" title="var">hereditary_subst</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">c</span> ⇒ <span class="id" title="var">remember</span> <span class="id" title="var">c</span> <span class="id" title="keyword">as</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> × ).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">dependent</span> <span class="id" title="var">elimination</span> <span class="id" title="var">H2</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">application</span> <span class="id" title="var">_</span> <span class="id" title="var">U</span> <span class="id" title="var">T</span> <span class="id" title="var">f</span> <span class="id" title="var">arg</span> <span class="id" title="var">tyfn</span> <span class="id" title="var">tyu</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H1</span> <span class="id" title="var">tyu</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hind</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H1</span> <span class="id" title="var">tyfn</span>). <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqcall</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Hind</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Ht'</span> <span class="id" title="var">Ht''</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">dependent</span> <span class="id" title="var">elimination</span> <span class="id" title="var">Ht'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">abstraction</span> <span class="id" title="var">_</span> <span class="id" title="var">U</span> <span class="id" title="var">T</span> <span class="id" title="var">abs</span> <span class="id" title="var">tyabs</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eqns_specialize_eqs</span> <span class="id" title="var">Ht''</span>. <span class="id" title="var">noconf</span> <span class="id" title="var">Ht''</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Ht</span> <span class="id" title="var">tty</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H0</span> <span class="id" title="var">_</span> [] <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Ht</span> <span class="id" title="var">tyabs</span> <span class="id" title="var">eq_refl</span> <span class="id" title="var">Heqhsubst0</span>). <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Heqhsubst0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H0</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H0</span> <span class="id" title="var">H5</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">ty</span> <span class="id" title="var">prf0</span> <span class="id" title="var">Heq'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">noconf</span> <span class="id" title="var">Heq'</span>. <span class="id" title="tactic">auto</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;App&nbsp;no&nbsp;redex&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">is_lambda_inr</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="var">revert</span> <span class="id" title="var">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> &lt;-. <span class="id" title="var">depelim</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H0</span> <span class="id" title="var">H1_0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hind</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H0</span> <span class="id" title="var">H1_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">on_call</span> <span class="id" title="var">hereditary_subst</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">c</span> ⇒ <span class="id" title="var">remember</span> <span class="id" title="var">c</span> <span class="id" title="keyword">as</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> × ).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">on_call</span> (<span class="id" title="var">hereditary_subst</span> (<span class="id" title="var">A</span>, <span class="id" title="var">a</span>, <span class="id" title="var">arg</span>)) <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">c</span> ⇒ <span class="id" title="var">remember</span> <span class="id" title="var">c</span> <span class="id" title="keyword">as</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> × ).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>, <span class="id" title="var">Hind</span>. <span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eauto</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Fst&nbsp;redex&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hind</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H</span> <span class="id" title="var">H0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqcall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Hind</span>. <span class="id" title="var">depelim</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">intuition</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eqns_specialize_eqs</span> <span class="id" title="var">H2</span>. <span class="id" title="var">noconf</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">noconf</span> <span class="id" title="var">H1</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Fst&nbsp;no&nbsp;redex&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">is_pair_inr</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="var">revert</span> <span class="id" title="var">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">on_call</span> <span class="id" title="var">hereditary_subst</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">c</span> ⇒ <span class="id" title="var">remember</span> <span class="id" title="var">c</span> <span class="id" title="keyword">as</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> × ).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">intros</span> &lt;-.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hind</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H</span> <span class="id" title="var">H0</span>); <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Hind</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">pair_elim_fst</span> <span class="id" title="keyword">with</span> <span class="id" title="var">B</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Snd&nbsp;redex&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>. <span class="id" title="var">depelim</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hind</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H</span> <span class="id" title="var">H0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Hind</span>. <span class="id" title="var">depelim</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">intuition</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eqns_specialize_eqs</span> <span class="id" title="var">H2</span>. <span class="id" title="var">noconf</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">noconf</span> <span class="id" title="var">H1</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Snd&nbsp;no&nbsp;redex&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">is_pair_inr</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="var">revert</span> <span class="id" title="var">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">on_call</span> <span class="id" title="var">hereditary_subst</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">c</span> ⇒ <span class="id" title="var">remember</span> <span class="id" title="var">c</span> <span class="id" title="keyword">as</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> × ).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Ht2</span>; <span class="id" title="tactic">subst</span> <span class="id" title="var">t</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> ×. <span class="id" title="var">depelim</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hind</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H</span> <span class="id" title="var">H0</span>); <span class="id" title="tactic">eauto</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">pair_elim_snd</span> <span class="id" title="keyword">with</span> <span class="id" title="var">A0</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="comment">(*&nbsp;Print&nbsp;Assumptions&nbsp;hereditary_subst_type.&nbsp;*)</span><br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">Program.Basics</span>.<br/>
#[<span class="id" title="var">export</span>] <span class="id" title="keyword">Instance</span>: <span class="id" title="var">subrelation</span> <span class="id" title="var">eq</span> (<span class="id" title="var">flip</span> <span class="id" title="var">impl</span>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="var">reduce</span>. <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">nth_pred</span> <span class="id" title="var">Γ'</span> <span class="id" title="var">Γ</span> <span class="id" title="var">U</span> <span class="id" title="var">n</span> : <span class="id" title="var">n</span> &gt; <span class="id" title="var">length</span> <span class="id" title="var">Γ'</span> → <span class="id" title="var">nth</span> (<span class="id" title="var">pred</span> <span class="id" title="var">n</span>) (<span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ</span>) <span class="id" title="var">unit</span> = <span class="id" title="var">nth</span> <span class="id" title="var">n</span> (<span class="id" title="var">Γ'</span> @ (<span class="id" title="var">U</span> :: <span class="id" title="var">Γ</span>)) <span class="id" title="var">unit</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">revert_until</span> <span class="id" title="var">Γ'</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">Γ'</span>; <span class="id" title="tactic">intros</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">n</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="var">depelim</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">n</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="var">pred</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">IHΓ'</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">n</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">depelim</span> <span class="id" title="var">H</span>. <span class="id" title="var">depelim</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *; <span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">hereditary_subst_subst</span> <span class="id" title="var">U</span> <span class="id" title="var">u</span> <span class="id" title="var">t</span> <span class="id" title="var">Γ'</span> :<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">Γ</span> <span class="id" title="var">T</span>, <span class="id" title="var">Γ</span> |-- <span class="id" title="var">u</span> ≤ <span class="id" title="var">U</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">hereditary_subst</span> (<span class="id" title="var">U</span>, <span class="id" title="var">u</span>, <span class="id" title="var">t</span>) (<span class="id" title="var">length</span> <span class="id" title="var">Γ'</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" title="var">t'</span>, <span class="id" title="var">Some</span> (<span class="id" title="var">exist</span> <span class="id" title="var">ty</span> <span class="id" title="var">_</span>)) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">Γ'</span> @ (<span class="id" title="var">U</span> :: <span class="id" title="var">Γ</span>) |-- <span class="id" title="var">t</span> ≤ <span class="id" title="var">T</span> → <span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t'</span> ≤ <span class="id" title="var">T</span> ∧ <span class="id" title="var">ty</span> = <span class="id" title="var">T</span>) ∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ'</span> @ (<span class="id" title="var">U</span> :: <span class="id" title="var">Γ</span>) |-- <span class="id" title="var">t</span> ⇒ <span class="id" title="var">T</span> → <span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t'</span> ≤ <span class="id" title="var">T</span> ∧ <span class="id" title="var">ty</span> = <span class="id" title="var">T</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" title="var">t'</span>, <span class="id" title="var">None</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ'</span> @ (<span class="id" title="var">U</span> :: <span class="id" title="var">Γ</span>) |-- <span class="id" title="var">t</span> ≤ <span class="id" title="var">T</span> → <span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t'</span> ≤ <span class="id" title="var">T</span>) ∧<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ'</span> @ (<span class="id" title="var">U</span> :: <span class="id" title="var">Γ</span>) |-- <span class="id" title="var">t</span> ⇒ <span class="id" title="var">T</span> → <span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t'</span> ⇒ <span class="id" title="var">T</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">funelim</span> (<span class="id" title="var">hereditary_subst</span> (<span class="id" title="var">U</span>, <span class="id" title="var">u</span>, <span class="id" title="var">t</span>) (<span class="id" title="var">length</span> <span class="id" title="var">Γ'</span>)); <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> ×.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">Hind</span> := <span class="id" title="tactic">fresh</span> "Hind" <span class="id" title="tactic">in</span> <span class="id" title="tactic">rename</span> <span class="id" title="var">H</span> <span class="id" title="var">into</span> <span class="id" title="var">Hind</span>; <span class="id" title="tactic">intros</span> ?? <span class="id" title="var">Hu</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> ×.<br/>

<br/>
</div>

<div class="doc">
Lambda 
</div>
<div class="code">
&nbsp;&nbsp;- <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">on_call</span> <span class="id" title="var">hereditary_subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">c</span> ⇒ <span class="id" title="var">remember</span> <span class="id" title="var">c</span> <span class="id" title="keyword">as</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">Hsyn</span>; [| <span class="id" title="tactic">elim</span> (<span class="id" title="var">synth_arrow</span> <span class="id" title="var">False</span> <span class="id" title="var">Hsyn</span>)].<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">invert_term</span>. <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hind</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> (<span class="id" title="var">A0</span> :: <span class="id" title="var">Γ'</span>) <span class="id" title="var">eq_refl</span>). <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hind</span> <span class="id" title="var">Heqhsubst</span> <span class="id" title="var">_</span> <span class="id" title="var">B</span> <span class="id" title="var">Hu</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Heqhsubst</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">o</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">ty</span> <span class="id" title="var">prf</span>]|], <span class="id" title="var">Hind</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Hind0</span> <span class="id" title="var">Hind1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Hind0</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">elim</span> (<span class="id" title="var">synth_arrow</span> <span class="id" title="var">False</span> <span class="id" title="var">H0</span>).<br/>

<br/>
</div>

<div class="doc">
Pairs 
</div>
<div class="code">
&nbsp;&nbsp;- <span class="id" title="tactic">do</span> 2 <span class="id" title="var">on_call</span> <span class="id" title="var">hereditary_subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">c</span> ⇒ <span class="id" title="var">remember</span> <span class="id" title="var">c</span> <span class="id" title="keyword">as</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">Hsyn</span>; [|<span class="id" title="tactic">elim</span> (<span class="id" title="var">synth_pair</span> <span class="id" title="var">False</span> <span class="id" title="var">Hsyn</span>)].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">invert_term</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H0</span> <span class="id" title="var">_</span> <span class="id" title="var">B</span> <span class="id" title="var">H1</span>). <span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">_</span> <span class="id" title="var">A0</span> <span class="id" title="var">H1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">o</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">ty</span> <span class="id" title="var">prf</span>]|], <span class="id" title="var">o0</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">ty'</span> <span class="id" title="var">prf'</span>]|], <span class="id" title="var">H</span>, <span class="id" title="var">H0</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_conjs</span>; <span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">elim</span> (<span class="id" title="var">synth_pair</span> <span class="id" title="var">False</span> <span class="id" title="var">H3</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Unit&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="id" title="tactic">split</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">Hsyn</span>; [|<span class="id" title="tactic">elim</span> (<span class="id" title="var">synth_unit</span> <span class="id" title="var">False</span> <span class="id" title="var">Hsyn</span>)].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">Hsyn</span>. <span class="id" title="var">term</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">elim</span> (<span class="id" title="var">synth_unit</span> <span class="id" title="var">False</span> <span class="id" title="var">H1</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Var:&nbsp;eq&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">Nat.compare_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>; <span class="id" title="tactic">subst</span> <span class="id" title="var">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">Hsyn</span>; <span class="id" title="var">depelim</span> <span class="id" title="var">Hsyn</span>; <span class="id" title="tactic">rewrite</span> ?<span class="id" title="var">nth_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">H1</span>; <span class="id" title="tactic">rewrite</span> !<span class="id" title="var">nth_length</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">split</span>; <span class="id" title="var">term</span>. <span class="id" title="tactic">split</span>; <span class="id" title="var">term</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Lt&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">Nat.compare_lt_iff</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">Hsyn</span>; <span class="id" title="var">depelim</span> <span class="id" title="var">Hsyn</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="var">depelim</span> <span class="id" title="var">H1</span>;<span class="id" title="tactic">constructor</span>;<span class="id" title="tactic">auto</span>|];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">rewrite</span> <span class="id" title="var">nth_app_l</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>; <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">nth_app_l</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">l'</span>:=<span class="id" title="var">Γ</span>) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">length_app</span>; <span class="id" title="tactic">auto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">arith</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Gt&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">Nat.compare_gt_iff</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">Hsyn</span>; <span class="id" title="var">depelim</span> <span class="id" title="var">Hsyn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">nth</span> <span class="id" title="var">i</span> (<span class="id" title="var">Γ'</span> @ (<span class="id" title="var">A</span> :: <span class="id" title="var">Γ</span>)) <span class="id" title="var">unit</span>) <span class="id" title="keyword">with</span> (<span class="id" title="var">nth</span> (<span class="id" title="var">pred</span> <span class="id" title="var">i</span>) (<span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ</span>) <span class="id" title="var">unit</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">length_app</span> <span class="id" title="tactic">in</span> ×. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">nth_pred</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">nth</span> <span class="id" title="var">_</span> (<span class="id" title="var">Γ'</span> @ (<span class="id" title="var">_</span> :: <span class="id" title="var">_</span>)) <span class="id" title="var">unit</span>) <span class="id" title="keyword">with</span> (<span class="id" title="var">nth</span> (<span class="id" title="var">pred</span> <span class="id" title="var">i</span>) (<span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ</span>) <span class="id" title="var">unit</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">length_app</span> <span class="id" title="tactic">in</span> ×. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>. <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">nth_pred</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;App&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="id" title="var">cbn</span>. <span class="id" title="var">on_call</span> (<span class="id" title="var">hereditary_subst</span> (<span class="id" title="var">A</span>,<span class="id" title="var">a</span>,<span class="id" title="var">arg</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">c</span> ⇒ <span class="id" title="var">remember</span> <span class="id" title="var">c</span> <span class="id" title="keyword">as</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H0</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> [] <span class="id" title="var">eq_refl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heq0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">on_call</span> <span class="id" title="var">hereditary_subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">c</span> ⇒ <span class="id" title="var">remember</span> <span class="id" title="var">c</span> <span class="id" title="keyword">as</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Redex&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>((<span class="id" title="var">Γ'</span> @ (<span class="id" title="var">A</span> :: <span class="id" title="var">Γ</span>) |-- @(<span class="id" title="var">f</span>, <span class="id" title="var">arg</span>) ⇒ <span class="id" title="var">T</span> → <span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t0</span> ≤ <span class="id" title="var">T</span> ∧ <span class="id" title="var">B'</span> = <span class="id" title="var">T</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Ht</span>; <span class="id" title="var">depelim</span> <span class="id" title="var">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">Hind</span> <span class="id" title="var">Γ</span> (<span class="id" title="var">A0</span> ---&gt; <span class="id" title="var">T</span>) <span class="id" title="var">H1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">_</span> <span class="id" title="var">A'</span> <span class="id" title="var">H1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">H4</span> <span class="id" title="var">Ht</span>). <span class="id" title="var">noconf</span> <span class="id" title="var">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">H5</span>. <span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">o</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">h</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">H</span> <span class="id" title="var">H2</span>). <span class="id" title="tactic">subst</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H0</span> <span class="id" title="var">Heqhsubst0</span> <span class="id" title="var">_</span> <span class="id" title="var">B'</span> <span class="id" title="var">H7</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Heqhsubst0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">o0</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">ty</span> <span class="id" title="var">typrf</span>]|]; <span class="id" title="tactic">destruct</span> <span class="id" title="var">H0</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Hcheck</span> <span class="id" title="var">Hinf</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">Hcheck</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">Hcheck</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H0</span> <span class="id" title="var">Heqhsubst0</span> <span class="id" title="var">_</span> <span class="id" title="var">B'</span> (<span class="id" title="var">H</span> <span class="id" title="var">H2</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Heqhsubst0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">o0</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">ty</span> <span class="id" title="var">typrf</span>]|]; <span class="id" title="tactic">destruct</span> <span class="id" title="var">H0</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Hcheck</span> <span class="id" title="var">Hinf</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">Hcheck</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">Hcheck</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">H6</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Ht3u</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">depelim</span> <span class="id" title="var">Ht3u</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;No&nbsp;redex&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">Γ</span> <span class="id" title="var">T</span> <span class="id" title="var">Hu</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">Γ'</span> @ (<span class="id" title="var">A</span> :: <span class="id" title="var">Γ</span>) |-- @( <span class="id" title="var">f</span>, <span class="id" title="var">arg</span>) ⇒ <span class="id" title="var">T</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;→ <span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ</span> |-- @( <span class="id" title="var">f'</span>, <span class="id" title="var">fst</span> (<span class="id" title="var">hereditary_subst</span> (<span class="id" title="var">A</span>, <span class="id" title="var">a</span>, <span class="id" title="var">arg</span>) (<span class="id" title="var">length</span> <span class="id" title="var">Γ'</span>))) ⇒ <span class="id" title="var">T</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Ht</span>; <span class="id" title="var">depelim</span> <span class="id" title="var">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">on_call</span> <span class="id" title="var">hereditary_subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">c</span> ⇒ <span class="id" title="var">remember</span> <span class="id" title="var">c</span> <span class="id" title="keyword">as</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">on_call</span> <span class="id" title="var">hereditary_subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">c</span> ⇒ <span class="id" title="var">remember</span> <span class="id" title="var">c</span> <span class="id" title="keyword">as</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">Hind</span> <span class="id" title="var">_</span> (<span class="id" title="var">A0</span> ---&gt; <span class="id" title="var">T</span>) <span class="id" title="var">Hu</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">o0</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">ty</span> <span class="id" title="var">prf'</span>]|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">destruct</span> <span class="id" title="var">y</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Hind'</span> <span class="id" title="var">Hind''</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hind''</span> <span class="id" title="var">Ht</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">Hind''</span>; <span class="id" title="tactic">subst</span> <span class="id" title="var">ty</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">_</span> <span class="id" title="var">A0</span> <span class="id" title="var">Hu</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">o</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">ty'</span> <span class="id" title="var">prf''</span>]|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Hind0</span> <span class="id" title="var">Hind0'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hind0</span> <span class="id" title="var">H0</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">Hind0</span>. <span class="id" title="tactic">subst</span> <span class="id" title="var">ty'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">application_synth</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">H1</span>. <span class="id" title="var">simp</span> <span class="id" title="var">is_lambda</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="var">noconf</span> <span class="id" title="var">Heq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">H1</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++ <span class="id" title="var">depelim</span> <span class="id" title="var">H1</span>. <span class="id" title="var">simp</span> <span class="id" title="var">is_lambda</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="var">noconf</span> <span class="id" title="var">Heq</span>. <span class="id" title="var">depelim</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">clear</span> <span class="id" title="var">y</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">_</span> <span class="id" title="var">A0</span> <span class="id" title="var">Hu</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">Hind</span> <span class="id" title="var">_</span> (<span class="id" title="var">A0</span> ---&gt; <span class="id" title="var">T</span>) <span class="id" title="var">Hu</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">is_lambda_inr</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>; <span class="id" title="tactic">subst</span> <span class="id" title="var">t0</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">o</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">ty</span> <span class="id" title="var">prf</span>]|]; <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Hindt0</span> <span class="id" title="var">Hindt0'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">application_synth</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">Hindt0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">application_synth</span>; <span class="id" title="tactic">eauto</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>; <span class="id" title="tactic">auto</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Pair&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq0</span>. <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">is_pair</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">prf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Γ</span> <span class="id" title="var">T</span> <span class="id" title="var">Hu</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>( (<span class="id" title="var">Γ'</span> @ (<span class="id" title="var">A</span> :: <span class="id" title="var">Γ</span>) |-- <span class="id" title="var">Fst</span> <span class="id" title="var">t'</span> ⇒ <span class="id" title="var">T</span> → <span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ</span> |-- <span class="id" title="var">u</span> ≤ <span class="id" title="var">T</span> ∧ <span class="id" title="var">a'</span> = <span class="id" title="var">T</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Ht</span>; <span class="id" title="var">depelim</span> <span class="id" title="var">Ht</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hind</span> <span class="id" title="var">_</span> (<span class="id" title="var">T</span> × <span class="id" title="var">B</span>) <span class="id" title="var">Hu</span>). <span class="id" title="var">revert</span> <span class="id" title="var">Hind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">on_call</span> <span class="id" title="var">hereditary_subst</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">c</span> ⇒ <span class="id" title="var">remember</span> <span class="id" title="var">c</span> <span class="id" title="keyword">as</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">noconf</span> <span class="id" title="var">Heq0</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heqcall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">Hind</span> <span class="id" title="var">Hind'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hind'</span> <span class="id" title="var">Ht</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">Hind'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H0</span> <span class="id" title="var">H1</span>]. <span class="id" title="var">noconf</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H1</span>. <span class="id" title="var">depelim</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">intuition</span>.<br/>

<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">Γ</span> <span class="id" title="var">T</span> <span class="id" title="var">Hu</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Γ'</span> @ (<span class="id" title="var">A</span> :: <span class="id" title="var">Γ</span>) |-- <span class="id" title="var">Fst</span> <span class="id" title="var">t'</span> ⇒ <span class="id" title="var">T</span> → <span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ</span> |-- <span class="id" title="var">Fst</span> <span class="id" title="var">p'</span> ⇒ <span class="id" title="var">T</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Ht</span>; <span class="id" title="var">depelim</span> <span class="id" title="var">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hind</span> <span class="id" title="var">_</span> (<span class="id" title="var">T</span> × <span class="id" title="var">B</span>) <span class="id" title="var">Hu</span>). <span class="id" title="var">revert</span> <span class="id" title="var">Hind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">on_call</span> <span class="id" title="var">hereditary_subst</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">c</span> ⇒ <span class="id" title="var">remember</span> <span class="id" title="var">c</span> <span class="id" title="keyword">as</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">o</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">ty</span> <span class="id" title="var">prf</span>]|]. <span class="id" title="tactic">intros</span> [<span class="id" title="var">Hind</span> <span class="id" title="var">Hind'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">Hind'</span> <span class="id" title="var">Ht</span>). <span class="id" title="tactic">subst</span> <span class="id" title="var">ty</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">H</span>. <span class="id" title="var">simp</span> <span class="id" title="var">is_pair</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">H</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">is_pair_inr</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span> ; <span class="id" title="tactic">subst</span> <span class="id" title="var">p'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">Hind</span> <span class="id" title="var">Hind'</span>]. <span class="id" title="tactic">eapply</span> <span class="id" title="var">pair_elim_fst_synth</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">Hind'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H2</span>. <span class="id" title="var">depelim</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">intuition</span> <span class="id" title="tactic">auto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">term</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Snd&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">Γ</span> <span class="id" title="var">T</span> <span class="id" title="var">Hu</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>((<span class="id" title="var">Γ'</span> @ (<span class="id" title="var">A</span> :: <span class="id" title="var">Γ</span>) |-- <span class="id" title="var">Snd</span> <span class="id" title="var">t'</span> ⇒ <span class="id" title="var">T</span> → <span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ</span> |-- <span class="id" title="var">v</span> ≤ <span class="id" title="var">T</span> ∧ <span class="id" title="var">b'</span> = <span class="id" title="var">T</span>)).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Ht</span>; <span class="id" title="var">depelim</span> <span class="id" title="var">Ht</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hind</span> <span class="id" title="var">_</span> (<span class="id" title="var">A0</span> × <span class="id" title="var">T</span>) <span class="id" title="var">Hu</span>). <span class="id" title="var">revert</span> <span class="id" title="var">Hind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">on_call</span> <span class="id" title="var">hereditary_subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">c</span> ⇒ <span class="id" title="var">remember</span> <span class="id" title="var">c</span> <span class="id" title="keyword">as</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">noconf</span> <span class="id" title="var">Heq0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">Hind</span> <span class="id" title="var">Hind'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hind'</span> <span class="id" title="var">Ht</span>). <span class="id" title="tactic">destruct</span> <span class="id" title="var">Hind'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H0</span> <span class="id" title="var">H1</span>]. <span class="id" title="var">noconf</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="var">depelim</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H1</span>. <span class="id" title="var">depelim</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">intuition</span> <span class="id" title="tactic">auto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">term</span>.<br/>

<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">Γ</span> <span class="id" title="var">T</span> <span class="id" title="var">Hu</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Γ'</span> @ (<span class="id" title="var">A</span> :: <span class="id" title="var">Γ</span>) |-- <span class="id" title="var">Snd</span> <span class="id" title="var">t'</span> ⇒ <span class="id" title="var">T</span> → <span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ</span> |-- <span class="id" title="var">Snd</span> <span class="id" title="var">p'</span> ⇒ <span class="id" title="var">T</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Ht</span>; <span class="id" title="var">depelim</span> <span class="id" title="var">Ht</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hind</span> <span class="id" title="var">_</span> (<span class="id" title="var">A0</span> × <span class="id" title="var">T</span>) <span class="id" title="var">Hu</span>). <span class="id" title="var">revert</span> <span class="id" title="var">Hind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">on_call</span> <span class="id" title="var">hereditary_subst</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">c</span> ⇒ <span class="id" title="var">remember</span> <span class="id" title="var">c</span> <span class="id" title="keyword">as</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">hsubst</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">o</span> <span class="id" title="keyword">as</span> [[<span class="id" title="var">ty</span> <span class="id" title="var">prf</span>]|]. <span class="id" title="tactic">intros</span> [<span class="id" title="var">Hind</span> <span class="id" title="var">Hind'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">Hind'</span> <span class="id" title="var">Ht</span>). <span class="id" title="tactic">subst</span> <span class="id" title="var">ty</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">H</span>. <span class="id" title="var">simp</span> <span class="id" title="var">is_pair</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">H</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">Hind</span> <span class="id" title="var">Hind'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">is_pair_inr</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Heq</span>. <span class="id" title="tactic">subst</span> <span class="id" title="var">p'</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hind'</span> <span class="id" title="var">Ht</span>). <span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eauto</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H1</span>. <span class="id" title="var">depelim</span> <span class="id" title="var">H1</span>. <span class="id" title="var">term</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Print&nbsp;Assumptions&nbsp;hereditary_subst_subst.&nbsp;*)</span><br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">check_liftn</span> {<span class="id" title="var">Γ</span> <span class="id" title="var">Γ'</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span>} : <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> ≤ <span class="id" title="var">T</span> → <span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ</span> |-- <span class="id" title="var">lift</span> 0 (<span class="id" title="var">length</span> <span class="id" title="var">Γ'</span>) <span class="id" title="var">t</span> ≤ <span class="id" title="var">T</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="var">check_lift</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span> [] <span class="id" title="var">H</span> <span class="id" title="var">Γ'</span>). <span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">synth_liftn</span> {<span class="id" title="var">Γ</span> <span class="id" title="var">Γ'</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span>} : <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> ⇒ <span class="id" title="var">T</span> → <span class="id" title="var">Γ'</span> @ <span class="id" title="var">Γ</span> |-- <span class="id" title="var">lift</span> 0 (<span class="id" title="var">length</span> <span class="id" title="var">Γ'</span>) <span class="id" title="var">t</span> ⇒ <span class="id" title="var">T</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="var">synthetize_lift</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span> [] <span class="id" title="var">H</span> <span class="id" title="var">Γ'</span>). <span class="id" title="keyword">Qed</span>.<br/>
#[<span class="id" title="var">local</span>] <span class="id" title="keyword">Hint</span> <span class="id" title="keyword">Resolve</span> <span class="id" title="var">check_liftn</span> <span class="id" title="var">synth_liftn</span> : <span class="id" title="var">term</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Write&nbsp;normalization&nbsp;function&nbsp;*)</span><br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">types_normalizes</span> <span class="id" title="var">Γ</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span> : <span class="id" title="var">Γ</span> |-- <span class="id" title="var">t</span> : <span class="id" title="var">T</span> → ∃ <span class="id" title="var">u</span>, <span class="id" title="var">Γ</span> |-- <span class="id" title="var">u</span> ≤ <span class="id" title="var">T</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">induction</span> 1. <span class="comment">(*&nbsp;eta-exp&nbsp;*)</span><br/>

<br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (<span class="id" title="var">η</span> (<span class="id" title="var">nth</span> <span class="id" title="var">i</span> <span class="id" title="var">Γ</span> <span class="id" title="var">unit</span>) <span class="id" title="var">i</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">eta_expand</span> <span class="id" title="var">Γ</span> <span class="id" title="var">i</span> (<span class="id" title="var">nth</span> <span class="id" title="var">i</span> <span class="id" title="var">Γ</span> <span class="id" title="var">unit</span>) (<span class="id" title="var">neutral_var</span> <span class="id" title="var">_</span>)); <span class="id" title="var">term</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IHtypes</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">t'</span> <span class="id" title="var">tt'</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (<span class="id" title="var">λ</span> <span class="id" title="var">t'</span>); <span class="id" title="var">term</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IHtypes1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">t'</span> <span class="id" title="var">tt'</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IHtypes2</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">u'</span> <span class="id" title="var">uu'</span>].<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Hereditary&nbsp;substitution&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">checks_arrow</span> <span class="id" title="tactic">in</span> <span class="id" title="var">tt'</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">tt'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">t''</span> [<span class="id" title="var">t't''</span> <span class="id" title="var">t'B</span>]]. <span class="id" title="tactic">subst</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> (<span class="id" title="var">hereditary_subst_subst</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">t''</span> [] <span class="id" title="var">Γ</span> <span class="id" title="var">B</span> <span class="id" title="var">uu'</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct_call</span> <span class="id" title="var">hereditary_subst</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">o</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">h</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> ×. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">∃</span> <span class="id" title="var">t0</span>; <span class="id" title="tactic">intuition</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> ×. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">∃</span> <span class="id" title="var">t0</span>; <span class="id" title="tactic">intuition</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Unit&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">Tt</span>; <span class="id" title="var">term</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Pair&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IHtypes1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">t'</span> <span class="id" title="var">tt'</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IHtypes2</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">u'</span> <span class="id" title="var">uu'</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> &lt;&lt; <span class="id" title="var">t'</span> , <span class="id" title="var">u'</span> &gt;&gt;. <span class="id" title="var">term</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Fst&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IHtypes</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">t'</span> <span class="id" title="var">tt'</span>].<br/>
&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">tt'</span>. <span class="id" title="tactic">∃</span> <span class="id" title="var">t0</span>; <span class="id" title="var">term</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">H0</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Snd&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IHtypes</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">t'</span> <span class="id" title="var">tt'</span>].<br/>
&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">tt'</span>. <span class="id" title="tactic">∃</span> <span class="id" title="var">u</span>; <span class="id" title="var">term</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="var">depelim</span> <span class="id" title="var">H0</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;Print&nbsp;Assumptions&nbsp;types_normalizes.&nbsp;*)</span><br/>
</div>
<hr/>This page has been generated by <a href="http://rocq-prover.org/">coqdoc</a>
</div>

</div>

</body>
</html>