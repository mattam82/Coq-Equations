<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>Examples.RoseTree</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<div class="code">
<span class="comment">(**********************************************************************)</span><br/>
<span class="comment">(*&nbsp;Equations&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;Copyright&nbsp;(c)&nbsp;2009-2021&nbsp;Matthieu&nbsp;Sozeau&nbsp;&lt;matthieu.sozeau@inria.fr&gt;&nbsp;*)</span><br/>
<span class="comment">(**********************************************************************)</span><br/>
<span class="comment">(*&nbsp;This&nbsp;file&nbsp;is&nbsp;distributed&nbsp;under&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;GNU&nbsp;Lesser&nbsp;General&nbsp;Public&nbsp;License&nbsp;Version&nbsp;2.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br/>
<span class="comment">(**********************************************************************)</span><br/>

<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Stdlib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Program</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Equations.Prop</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="keyword">Equations</span>.<br/>

<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Stdlib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Utf8</span> <span class="id" title="var">Lia</span> <span class="id" title="var">Arith</span>.<br/>

<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Stdlib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">List</span>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">ListNotations</span>.<br/>

<br/>
<span class="id" title="keyword">Set</span> <span class="id" title="var">Keyed</span> <span class="id" title="var">Unification</span>.<br/>

<br/>
<span class="id" title="keyword">Equations</span> <span class="id" title="var">map_In</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) (<span class="id" title="var">f</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">x</span> : <span class="id" title="var">A</span>), <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span> → <span class="id" title="var">B</span>) : <span class="id" title="var">list</span> <span class="id" title="var">B</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">nil</span>, <span class="id" title="var">_</span> := <span class="id" title="var">nil</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">cons</span> <span class="id" title="var">x</span> <span class="id" title="var">xs</span>, <span class="id" title="var">f</span> := <span class="id" title="var">cons</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span> <span class="id" title="var">_</span>) (<span class="id" title="var">map_In</span> <span class="id" title="var">xs</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> <span class="id" title="var">H</span> ⇒ <span class="id" title="var">f</span> <span class="id" title="var">x</span> <span class="id" title="var">_</span>)).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">map_In_spec</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> → <span class="id" title="var">B</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">map_In</span> <span class="id" title="var">l</span> (<span class="id" title="keyword">fun</span> (<span class="id" title="var">x</span> : <span class="id" title="var">A</span>) (<span class="id" title="var">_</span> : <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span>) ⇒ <span class="id" title="var">f</span> <span class="id" title="var">x</span>) = <span class="id" title="var">List.map</span> <span class="id" title="var">f</span> <span class="id" title="var">l</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">funelim</span> (<span class="id" title="var">map_In</span> <span class="id" title="var">l</span> <span class="id" title="var">_</span>); <span class="id" title="tactic">rewrite</span> ?<span class="id" title="var">H</span>; <span class="id" title="tactic">trivial</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">list_size</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> → <span class="id" title="var">nat</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">list_size</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) : <span class="id" title="var">nat</span> :=<br/>
&nbsp;&nbsp;&nbsp;| <span class="id" title="var">nil</span> := 0<br/>
&nbsp;&nbsp;&nbsp;| <span class="id" title="var">x</span> :: <span class="id" title="var">xs</span> := <span class="id" title="var">S</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span> + <span class="id" title="var">list_size</span> <span class="id" title="var">xs</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">In_list_size</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">xs</span>, <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">xs</span> → <span class="id" title="var">f</span> <span class="id" title="var">x</span> &lt; <span class="id" title="var">S</span> (<span class="id" title="var">list_size</span> <span class="id" title="var">xs</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">funelim</span> (<span class="id" title="var">list_size</span> <span class="id" title="var">xs</span>); <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> ×. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">subst</span>; <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">_</span> <span class="id" title="var">H0</span>). <span class="id" title="tactic">intuition</span>. <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">list_size</span>.<br/>
<span class="id" title="keyword">Transparent</span> <span class="id" title="var">list_size</span>.<br/>

<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="var">RoseTree</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <span class="id" title="var">roserec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Set</span>}.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <span class="id" title="var">t</span> : <span class="id" title="keyword">Set</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">leaf</span> (<span class="id" title="var">a</span> : <span class="id" title="var">A</span>) : <span class="id" title="var">t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">node</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">t</span>) : <span class="id" title="var">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Derive</span> <span class="id" title="var">NoConfusion</span> <span class="id" title="keyword">for</span> <span class="id" title="var">t</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">size</span> (<span class="id" title="var">r</span> : <span class="id" title="var">t</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">r</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">leaf</span> <span class="id" title="var">a</span> ⇒ 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">node</span> <span class="id" title="var">l</span> ⇒ <span class="id" title="var">S</span> (<span class="id" title="var">list_size</span> <span class="id" title="var">size</span> <span class="id" title="var">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Equations</span>? <span class="id" title="var">elements</span> (<span class="id" title="var">r</span> : <span class="id" title="var">t</span>) : <span class="id" title="var">list</span> <span class="id" title="var">A</span> <span class="id" title="tactic">by</span> <span class="id" title="keyword">wf</span> (<span class="id" title="var">size</span> <span class="id" title="var">r</span>) <span class="id" title="var">lt</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">elements</span> (<span class="id" title="var">leaf</span> <span class="id" title="var">a</span>) := [<span class="id" title="var">a</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">elements</span> (<span class="id" title="var">node</span> <span class="id" title="var">l</span>) := <span class="id" title="var">concat</span> (<span class="id" title="var">map_In</span> <span class="id" title="var">l</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> <span class="id" title="var">H</span> ⇒ <span class="id" title="var">elements</span> <span class="id" title="var">x</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">red</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">In_list_size</span>. <span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">elements_def</span> (<span class="id" title="var">r</span> : <span class="id" title="var">t</span>) : <span class="id" title="var">list</span> <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">elements_def</span> (<span class="id" title="var">leaf</span> <span class="id" title="var">a</span>) := [<span class="id" title="var">a</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">elements_def</span> (<span class="id" title="var">node</span> <span class="id" title="var">l</span>) := <span class="id" title="var">concat</span> (<span class="id" title="var">List.map</span> <span class="id" title="var">elements_def</span> <span class="id" title="var">l</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">elements_equation</span> (<span class="id" title="var">r</span> : <span class="id" title="var">t</span>) : <span class="id" title="var">elements</span> <span class="id" title="var">r</span> = <span class="id" title="var">elements_def</span> <span class="id" title="var">r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">funelim</span> (<span class="id" title="var">elements</span> <span class="id" title="var">r</span>); <span class="id" title="var">simp</span> <span class="id" title="var">elements_def</span>; <span class="id" title="tactic">trivial</span>. <span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">map_In_spec</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">Heqcall</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">IHl</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">constructor</span> 2. <span class="id" title="var">now</span> <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
To solve measure subgoals 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Hint Extern</span> 4 (<span class="id" title="var">_</span> &lt; <span class="id" title="var">_</span>) ⇒ <span class="id" title="tactic">simpl</span>; <span class="id" title="var">lia</span> : <span class="id" title="var">rec_decision</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Hint Extern</span> 4 (<span class="id" title="var">MR</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) ⇒ <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">red</span>; <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *; <span class="id" title="var">lia</span> : <span class="id" title="var">rec_decision</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Obligation</span> <span class="id" title="keyword">Tactic</span> := <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">program_simpl</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">typeclasses</span> <span class="id" title="tactic">eauto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">subterm_relation</span> <span class="id" title="var">simp</span> <span class="id" title="var">rec_decision</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Nested&nbsp;rec&nbsp;*)</span><br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">elements_acc</span> (<span class="id" title="var">r</span> : <span class="id" title="var">t</span>) (<span class="id" title="var">acc</span> : <span class="id" title="var">list</span> <span class="id" title="var">A</span>) : <span class="id" title="var">list</span> <span class="id" title="var">A</span> <span class="id" title="tactic">by</span> <span class="id" title="keyword">wf</span> (<span class="id" title="var">size</span> <span class="id" title="var">r</span>) <span class="id" title="var">lt</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">elements_acc</span> (<span class="id" title="var">leaf</span> <span class="id" title="var">a</span>) <span class="id" title="var">acc</span> := <span class="id" title="var">a</span> :: <span class="id" title="var">acc</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">elements_acc</span> (<span class="id" title="var">node</span> <span class="id" title="var">l</span>) <span class="id" title="var">acc</span> := <span class="id" title="var">aux</span> <span class="id" title="var">l</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">where</span> <span class="id" title="var">aux</span> (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">t</span>) (<span class="id" title="var">H</span> : <span class="id" title="var">list_size</span> <span class="id" title="var">size</span> <span class="id" title="var">x</span> &lt; <span class="id" title="var">size</span> (<span class="id" title="var">node</span> <span class="id" title="var">l</span>)) : <span class="id" title="var">list</span> <span class="id" title="var">A</span> <span class="id" title="tactic">by</span> <span class="id" title="keyword">wf</span> (<span class="id" title="var">list_size</span> <span class="id" title="var">size</span> <span class="id" title="var">x</span>) <span class="id" title="var">lt</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aux</span> <span class="id" title="var">nil</span> <span class="id" title="var">_</span> := <span class="id" title="var">acc</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aux</span> (<span class="id" title="var">cons</span> <span class="id" title="var">x</span> <span class="id" title="var">xs</span>) <span class="id" title="var">H</span> := <span class="id" title="var">elements_acc</span> <span class="id" title="var">x</span> (<span class="id" title="var">aux</span> <span class="id" title="var">xs</span> <span class="id" title="var">_</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">elements2</span> (<span class="id" title="var">r</span> : <span class="id" title="var">t</span>) : <span class="id" title="var">list</span> <span class="id" title="var">A</span> := <span class="id" title="var">elements_acc</span> <span class="id" title="var">r</span> [].<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">elements2_equation</span> <span class="id" title="var">r</span> <span class="id" title="var">acc</span> : <span class="id" title="var">elements_acc</span> <span class="id" title="var">r</span> <span class="id" title="var">acc</span> = <span class="id" title="var">elements_def</span> <span class="id" title="var">r</span> ++ <span class="id" title="var">acc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">r</span> <span class="id" title="var">acc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">t</span> := <span class="id" title="keyword">constr</span>:(<span class="id" title="var">fun_elim</span> (<span class="id" title="var">f</span>:=<span class="id" title="var">elements_acc</span>)) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">t</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">r</span> <span class="id" title="var">acc</span> <span class="id" title="var">res</span> ⇒ <span class="id" title="var">res</span> = <span class="id" title="var">elements_def</span> <span class="id" title="var">r</span> ++ <span class="id" title="var">acc</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">r</span> <span class="id" title="var">acc</span> <span class="id" title="var">x</span> <span class="id" title="var">H</span> <span class="id" title="var">res</span> ⇒ <span class="id" title="var">res</span> = <span class="id" title="var">concat</span> (<span class="id" title="var">List.map</span> <span class="id" title="var">elements_def</span> <span class="id" title="var">x</span>) ++ <span class="id" title="var">acc</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>; <span class="id" title="var">simp</span> <span class="id" title="var">elements</span>; <span class="id" title="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">app_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">elements'</span> (<span class="id" title="var">r</span> : <span class="id" title="var">t</span>) : <span class="id" title="var">list</span> <span class="id" title="var">A</span> <span class="id" title="tactic">by</span> <span class="id" title="keyword">wf</span> <span class="id" title="var">r</span> (<span class="id" title="var">MR</span> <span class="id" title="var">lt</span> <span class="id" title="var">size</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">leaf</span> <span class="id" title="var">a</span> := [<span class="id" title="var">a</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">node</span> <span class="id" title="var">l</span> := <span class="id" title="var">fn</span> <span class="id" title="var">l</span> <span class="id" title="var">hidebody</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">where</span> <span class="id" title="var">fn</span> (<span class="id" title="var">x</span> : <span class="id" title="var">list</span> <span class="id" title="var">t</span>) (<span class="id" title="var">H</span> : <span class="id" title="var">list_size</span> <span class="id" title="var">size</span> <span class="id" title="var">x</span> &lt; <span class="id" title="var">size</span> (<span class="id" title="var">node</span> <span class="id" title="var">l</span>)) : <span class="id" title="var">list</span> <span class="id" title="var">A</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> <span class="id" title="keyword">wf</span> <span class="id" title="var">x</span> (<span class="id" title="var">MR</span> <span class="id" title="var">lt</span> (<span class="id" title="var">list_size</span> <span class="id" title="var">size</span>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">nil</span>, <span class="id" title="var">_</span> := <span class="id" title="var">nil</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">cons</span> <span class="id" title="var">x</span> <span class="id" title="var">xs</span>, <span class="id" title="var">_</span> := <span class="id" title="var">elements'</span> <span class="id" title="var">x</span> ++ <span class="id" title="var">fn</span> <span class="id" title="var">xs</span> <span class="id" title="var">hidebody</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">elements'_def</span> (<span class="id" title="var">r</span> : <span class="id" title="var">t</span>) : <span class="id" title="var">list</span> <span class="id" title="var">A</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">elements'_def</span> (<span class="id" title="var">leaf</span> <span class="id" title="var">a</span>) := [<span class="id" title="var">a</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">elements'_def</span> (<span class="id" title="var">node</span> <span class="id" title="var">l</span>) := <span class="id" title="var">concat</span> (<span class="id" title="var">List.map</span> <span class="id" title="var">elements'</span> <span class="id" title="var">l</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">elements'_equation</span> (<span class="id" title="var">r</span> : <span class="id" title="var">t</span>) : <span class="id" title="var">elements'</span> <span class="id" title="var">r</span> = <span class="id" title="var">elements'_def</span> <span class="id" title="var">r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pose</span> (<span class="id" title="var">fun_elim</span> (<span class="id" title="var">f</span>:=<span class="id" title="var">elements'</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">p</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">r</span> <span class="id" title="var">f</span> ⇒ <span class="id" title="var">f</span> = <span class="id" title="var">elements'_def</span> <span class="id" title="var">r</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">l</span> <span class="id" title="var">x</span> <span class="id" title="var">H</span> <span class="id" title="var">r</span> ⇒ <span class="id" title="var">r</span> = <span class="id" title="var">concat</span> (<span class="id" title="var">List.map</span> <span class="id" title="var">elements'</span> <span class="id" title="var">x</span>)));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">p</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="var">simp</span> <span class="id" title="var">elements'_def</span>; <span class="id" title="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">f_equal</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <span class="id" title="var">roserec</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Arguments</span> <span class="id" title="var">t</span> : <span class="id" title="tactic">clear</span> <span class="id" title="var">implicits</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <span class="id" title="var">AltSize</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">A</span> : <span class="id" title="keyword">Set</span>}.<br/>

<br/>
</div>

<div class="doc">
Let's use an alternative size criterion allowing to make recursive calls
        on non-strict subterms of the initial list: we just count the maximal
        depth of <span class="inlinecode"><a class="idref" href="http://github.com/mattam82/Coq-Equations/tree/main/Equations.Examples.RoseTree.html#RoseTree.node"><span class="id" title="constructor">node</span></a></span> constructors among all forests. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">alt_size</span> (<span class="id" title="var">r</span> : <span class="id" title="var">t</span> <span class="id" title="var">A</span>) : <span class="id" title="var">nat</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">alt_size</span> (<span class="id" title="var">leaf</span> <span class="id" title="var">_</span>) ⇒ 0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">alt_size</span> (<span class="id" title="var">node</span> <span class="id" title="var">l</span>) ⇒ <span class="id" title="var">S</span> (<span class="id" title="var">max_size</span> <span class="id" title="var">l</span>) }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">where</span> <span class="id" title="var">max_size</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> (<span class="id" title="var">t</span> <span class="id" title="var">A</span>)) : <span class="id" title="var">nat</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="var">max_size</span> <span class="id" title="var">nil</span> := 0;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">max_size</span> (<span class="id" title="var">cons</span> <span class="id" title="var">a</span> <span class="id" title="var">t</span>) := <span class="id" title="var">Nat.max</span> (<span class="id" title="var">alt_size</span> <span class="id" title="var">a</span>) (<span class="id" title="var">max_size</span> <span class="id" title="var">t</span>) }.<br/>

<br/>
</div>

<div class="doc">
This has the property that the maximal size of two appended lists is the maximal
        size of the separate lists. 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">max_size_app</span> <span class="id" title="var">l</span> <span class="id" title="var">l'</span> : <span class="id" title="var">max_size</span> (<span class="id" title="var">l</span> ++ <span class="id" title="var">l'</span>) = <span class="id" title="var">Nat.max</span> (<span class="id" title="var">max_size</span> <span class="id" title="var">l</span>) (<span class="id" title="var">max_size</span> <span class="id" title="var">l'</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">l</span>; <span class="id" title="var">simp</span> <span class="id" title="var">max_size</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Nat.max_assoc</span>. <span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">B</span> : <span class="id" title="keyword">Set</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> → <span class="id" title="var">B</span>).<br/>

<br/>
</div>

<div class="doc">
It hence becomes possible to recurse on an arbitrary list as long as the depth
        decreases, for example by appending the subforest to itself in the <span class="inlinecode"><a class="idref" href="http://github.com/mattam82/Coq-Equations/tree/main/Equations.Examples.RoseTree.html#RoseTree.node"><span class="id" title="constructor">node</span></a></span> case.
        The same is possible with sized types where node has type <span class="inlinecode"><span class="id" title="var">j</span></span> <span class="inlinecode">&lt;</span> <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><a class="idref" href="http://rocq-prover.org/doc/V9.2+alpha/stdlib//Corelib.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a>^<span class="id" title="var">i</span></span> <span class="inlinecode">(<a class="idref" href="http://github.com/mattam82/Coq-Equations/tree/main/Equations.Examples.RoseTree.html#RoseTree.t"><span class="id" title="inductive">t</span></a>^<span class="id" title="var">j</span>)</span> <span class="inlinecode">→</span> <span class="inlinecode"><a class="idref" href="http://github.com/mattam82/Coq-Equations/tree/main/Equations.Examples.RoseTree.html#RoseTree.t"><span class="id" title="inductive">t</span></a>^(<a class="idref" href="http://rocq-prover.org/doc/V9.2+alpha/stdlib//Corelib.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a></span> <span class="inlinecode"><span class="id" title="var">i</span>)</span>.
     
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Equations</span>? <span class="id" title="var">map_t</span> (<span class="id" title="var">r</span> : <span class="id" title="var">t</span> <span class="id" title="var">A</span>) : <span class="id" title="var">t</span> <span class="id" title="var">B</span> <span class="id" title="tactic">by</span> <span class="id" title="keyword">wf</span> (<span class="id" title="var">alt_size</span> <span class="id" title="var">r</span>) <span class="id" title="var">lt</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">map_t</span> (<span class="id" title="var">leaf</span> <span class="id" title="var">a</span>) := <span class="id" title="var">leaf</span> (<span class="id" title="var">f</span> <span class="id" title="var">a</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">map_t</span> (<span class="id" title="var">node</span> <span class="id" title="var">l</span>) := <span class="id" title="var">node</span> (<span class="id" title="var">map_list</span> (<span class="id" title="var">l</span> ++ <span class="id" title="var">l</span>) <span class="id" title="var">_</span>)<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">where</span> <span class="id" title="var">map_list</span> (<span class="id" title="var">l'</span> : <span class="id" title="var">list</span> (<span class="id" title="var">t</span> <span class="id" title="var">A</span>)) (<span class="id" title="var">H</span> : <span class="id" title="var">max_size</span> <span class="id" title="var">l'</span> ≤ <span class="id" title="var">max_size</span> <span class="id" title="var">l</span>) : <span class="id" title="var">list</span> (<span class="id" title="var">t</span> <span class="id" title="var">B</span>) <span class="id" title="tactic">by</span> <span class="id" title="keyword">struct</span> <span class="id" title="var">l'</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">map_list</span> <span class="id" title="var">nil</span> <span class="id" title="var">_</span> := <span class="id" title="var">nil</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">map_list</span> (<span class="id" title="var">cons</span> <span class="id" title="var">a</span> <span class="id" title="var">t</span>) <span class="id" title="var">Hl'</span> := <span class="id" title="var">cons</span> (<span class="id" title="var">map_t</span> <span class="id" title="var">a</span>) (<span class="id" title="var">map_list</span> <span class="id" title="var">t</span> <span class="id" title="var">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="var">simp</span> <span class="id" title="var">alt_size</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Nat.lt_succ_r</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">Nat.max_lub_l</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hl'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">Nat.max_lub_r</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hl'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">map_list</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">max_size_app</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Nat.max_id</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <span class="id" title="var">AltSize</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Section</span> <span class="id" title="var">fns</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Set</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">A</span> → <span class="id" title="var">B</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">B</span> → <span class="id" title="var">A</span> → <span class="id" title="var">B</span>) (<span class="id" title="var">h</span> : <span class="id" title="var">A</span> → <span class="id" title="var">B</span> → <span class="id" title="var">B</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">map</span> (<span class="id" title="var">r</span> : <span class="id" title="var">t</span> <span class="id" title="var">A</span>) : <span class="id" title="var">t</span> <span class="id" title="var">B</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">leaf</span> <span class="id" title="var">a</span> := <span class="id" title="var">leaf</span> (<span class="id" title="var">f</span> <span class="id" title="var">a</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">node</span> <span class="id" title="var">l</span> := <span class="id" title="var">node</span> (<span class="id" title="var">List.map</span> <span class="id" title="var">map</span> <span class="id" title="var">l</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="tactic">fold</span> (<span class="id" title="var">acc</span> : <span class="id" title="var">B</span>) (<span class="id" title="var">r</span> : <span class="id" title="var">t</span> <span class="id" title="var">A</span>) : <span class="id" title="var">B</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">fold</span> <span class="id" title="var">acc</span> (<span class="id" title="var">leaf</span> <span class="id" title="var">a</span>) := <span class="id" title="var">g</span> <span class="id" title="var">acc</span> <span class="id" title="var">a</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">fold</span> <span class="id" title="var">acc</span> (<span class="id" title="var">node</span> <span class="id" title="var">l</span>) := <span class="id" title="var">List.fold_left</span> <span class="id" title="tactic">fold</span> <span class="id" title="var">l</span> <span class="id" title="var">acc</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Equations</span> <span class="id" title="var">fold_right</span> (<span class="id" title="var">r</span> : <span class="id" title="var">t</span> <span class="id" title="var">A</span>) (<span class="id" title="var">acc</span> : <span class="id" title="var">B</span>) : <span class="id" title="var">B</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fold_right</span> (<span class="id" title="var">leaf</span> <span class="id" title="var">a</span>) <span class="id" title="var">acc</span> := <span class="id" title="var">h</span> <span class="id" title="var">a</span> <span class="id" title="var">acc</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fold_right</span> (<span class="id" title="var">node</span> <span class="id" title="var">l</span>) <span class="id" title="var">acc</span> := <span class="id" title="var">List.fold_right</span> <span class="id" title="var">fold_right</span> <span class="id" title="var">acc</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <span class="id" title="var">fns</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">RoseTree</span>.<br/>
</div>
<hr/>This page has been generated by <a href="http://rocq-prover.org/">coqdoc</a>
</div>

</div>

</body>
</html>